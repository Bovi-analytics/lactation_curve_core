<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 16.0.0"/>
    <title>lactationcurve.characteristics API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{  --pdoc-accent-color:#053D6F;  --pdoc-accent-color-dark:#073362;}body{  background-color:#FFF !important;  font-family:"Helvetica Neue", Arial, sans-serif;  line-height:1.6;  color:#222;}h1{  font-family:"Helvetica Neue", Arial, sans-serif;  color:#053D6F;  font-weight:600;}h2,h3{  color:#053D6F;  font-weight:500;}h1{  border-bottom:2px solid #37B7EA;  padding-bottom:0.3em;}a{  color:#053D6F;  text-decoration:none;}a:hover{  color:#073362;  text-decoration:underline;}code{  background-color:#EDF4FA;  padding:2px 6px;  border-radius:4px;}pre{  background-color:#EDF4FA;  border-left:4px solid #37B7EA;  padding:1em;  border-radius:6px;  overflow-x:auto;}footer{  border-top:1px solid #E2E8F0;  color:#3C80A9;  font-size:0.9em;}.doc-function>.doc-heading{  font-weight:600;  font-size:1.1em;  color:#053D6F;}.doc-function{  margin-top:1.8em;  padding-left:1em;  border-left:4px solid #37B7EA;}.doc-function{  border-left:3px solid #37B7EA;  padding-left:1em;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:27px;vertical-align:bottom;width:50px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../lactationcurve.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;lactationcurve</a>

<a href="https://bovi-analytics.org">            <img src="C:/Users/Meike van Leerdam/lactation_curve_core/packages/python/lactation/site/logo.png" class="logo" alt="project logo"/>
</a>
            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#calculate_characteristic">calculate_characteristic</a>
            </li>
            <li>
                    <a class="function" href="#lactation_curve_characteristic_function">lactation_curve_characteristic_function</a>
            </li>
            <li>
                    <a class="function" href="#numeric_cumulative_yield">numeric_cumulative_yield</a>
            </li>
            <li>
                    <a class="function" href="#numeric_peak_yield">numeric_peak_yield</a>
            </li>
            <li>
                    <a class="function" href="#numeric_time_to_peak">numeric_time_to_peak</a>
            </li>
            <li>
                    <a class="function" href="#persistency_fitted_curve">persistency_fitted_curve</a>
            </li>
            <li>
                    <a class="function" href="#persistency_milkbot">persistency_milkbot</a>
            </li>
            <li>
                    <a class="function" href="#persistency_wood">persistency_wood</a>
            </li>
            <li>
                    <a class="function" href="#test_interval_method">test_interval_method</a>
            </li>
    </ul>


            <footer>Lactation Curve Package â€“ Bovi-Analytics lab</footer>

        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22160%22%20viewBox%3D%220%200%20150%2080%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M132.316%2048.886c.276-4.679%202.342-6.698%204.409-7.982s4.27-1.165%206.751-1.055c1.586.07%203.044.156%204.222-.482%201.142-.619%202.026-1.932%202.162-3.739.268-3.576-1.929-5.368-5.006-5.551s-7.599.524-10.517%201.606c-4.455%201.652-8.588%206.606-9.552%208.992s-2.342%206.193-1.745%2010.873%202.664%209.221%205.878%2011.79%205.878%203.808%2010.103%204.312%203.444.229%206.062.229%205.006-2.202%204.914-4.909-2.296-5.001-4.501-4.863-3.077.505-5.281.229-7.715-2.064-7.899-9.451z%22%20fill%3D%22%23198754%22/%3E%3Ccircle%20cx%3D%22101.504%22%20cy%3D%2248.943%22%20r%3D%2214.208%22%20fill%3D%22none%22%20stroke%3D%22%23198754%22%20stroke-width%3D%229.354%22/%3E%3Cpath%20d%3D%22M87.81.002c-3.637.065-5.001.454-7.014%201.232s-3.443%201.363-6.3%204.282c-1.723%201.76-3.148%205.019-3.776%207.329-.413%201.521-.316%202.63-.316%202.63l-.195%2034.612c.065%205.774-6.755%208.305-9.612%208.37s-9.678-1.038-9.743-9.408%207.128-9.521%208.362-9.521c1.413-.13%202.526-.021%203.718-.016%202.071.009%204.157-.778%204.092-4.671s-4.157-4.736-4.157-4.736c-6.3-.843-11.43%202.206-11.43%202.206S40.917%2038.15%2041.372%2049.634%2051.568%2068.19%2061.311%2068.125s18.316-7.007%2018.445-17.193l.13-22.772c.046-2.291%202.683-3.644%204.476-4.203.745-.232%201.694-.274%201.694-.274l10.457-.13s4.871-.324%207.729-3.114%204.352-6.294%204.352-6.294.974-3.049.13-4.606-.195-1.233-2.792-3.309-8.573-4.477-8.573-4.477S91.447-.063%2087.81.002zM0%2047.169l.065%2028.417S0%2080.127%204.481%2079.997s5.072-3.866%205.049-4.152l-.113-28.482s1.624-7.656%209.937-7.721%2010.002%206.942%2010.002%208.499-.909%2010.51-9.093%2010.51c-.948%200-2.99-.567-4.145-.272-3.919%201-3.194%204.554-3.194%204.554s.065%205.061%207.404%204.996%2018.575-6.034%2018.575-19.074S26.953%2030.04%2019.549%2029.91%201.234%2035.296%200%2047.169z%22%20fill%3D%22%23198754%22/%3E%3Cg%20transform%3D%22matrix%28.325601%200%200%20.325256%20-10.32669%20-45.802786%29%22%3E%3Ccircle%20cx%3D%22297.554%22%20cy%3D%22172.286%22%20r%3D%2216.5%22%20fill%3D%22%23fff%22/%3E%3Cellipse%20cx%3D%22297.709%22%20cy%3D%22172.642%22%20rx%3D%2211.071%22%20ry%3D%2210.871%22%20fill%3D%22%23105a48%22/%3E%3Ccircle%20cx%3D%22304.104%22%20cy%3D%22167.667%22%20r%3D%224.5%22%20fill%3D%22%23fff%22/%3E%3C/g%3E%3Cpath%20d%3D%22M94.661%2017.032l.893-1.476s.99.714%201.916.925%201.575.114%202.955.114l14.565-.162c1.283-.032%203.085-.762%203.02-3.293s-.373-3.503-.373-3.503l1.283-.487s.52.503.877%201.573.309%201.995.292%202.66-.227%201.541-.227%201.541%201.564-.308%202.359-1.038.823-.779%201.489-1.508.812-.86.812-.86.552-.13.877.26.341.957.065%201.46-1.672%202.206-3.247%203.066-2.76%201.427-3.929%201.768-3.848.73-7.063.714l-10.944-.114s-2.143-.081-3.02-.373-2.241-.973-2.598-1.265z%22%20fill%3D%22%23d36d49%22/%3E%3Cg%20fill%3D%22%23105a48%22%3E%3Cellipse%20cx%3D%2293.052%22%20cy%3D%2243.567%22%20rx%3D%22.869%22%20ry%3D%221.014%22%20transform%3D%22rotate%28341.022%29%22/%3E%3Cellipse%20cx%3D%22104.3%22%20cy%3D%22-16.184%22%20rx%3D%22.865%22%20ry%3D%221.009%22%20transform%3D%22rotate%2814.786%29%22/%3E%3C/g%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../lactationcurve.html">lactationcurve</a><wbr>.characteristics    </h1>


                        <input id="mod-characteristics-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-characteristics-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.lactation_curve_characteristics</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a>    <span class="n">calculate_characteristic</span><span class="p">,</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a>    <span class="n">lactation_curve_characteristic_function</span><span class="p">,</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a>    <span class="n">numeric_cumulative_yield</span><span class="p">,</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a>    <span class="n">numeric_peak_yield</span><span class="p">,</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a>    <span class="n">numeric_time_to_peak</span><span class="p">,</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a>    <span class="n">persistency_fitted_curve</span><span class="p">,</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a>    <span class="n">persistency_milkbot</span><span class="p">,</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a>    <span class="n">persistency_wood</span><span class="p">,</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a><span class="p">)</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.method_test_interval</span><span class="w"> </span><span class="kn">import</span> <span class="n">test_interval_method</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a>    <span class="s2">&quot;calculate_characteristic&quot;</span><span class="p">,</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a>    <span class="s2">&quot;lactation_curve_characteristic_function&quot;</span><span class="p">,</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a>    <span class="s2">&quot;numeric_cumulative_yield&quot;</span><span class="p">,</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a>    <span class="s2">&quot;numeric_peak_yield&quot;</span><span class="p">,</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a>    <span class="s2">&quot;numeric_time_to_peak&quot;</span><span class="p">,</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">19</span></a>    <span class="s2">&quot;persistency_fitted_curve&quot;</span><span class="p">,</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">20</span></a>    <span class="s2">&quot;persistency_milkbot&quot;</span><span class="p">,</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">21</span></a>    <span class="s2">&quot;persistency_wood&quot;</span><span class="p">,</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">22</span></a>    <span class="s2">&quot;test_interval_method&quot;</span><span class="p">,</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">23</span></a><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="calculate_characteristic">
                            <input id="calculate_characteristic-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">calculate_characteristic</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dim</span>,</span><span class="param">	<span class="n">milkrecordings</span>,</span><span class="param">	<span class="n">model</span><span class="o">=</span><span class="s1">&#39;wood&#39;</span>,</span><span class="param">	<span class="n">characteristic</span><span class="o">=</span><span class="s1">&#39;cumulative_milk_yield&#39;</span>,</span><span class="param">	<span class="n">fitting</span><span class="o">=</span><span class="s1">&#39;frequentist&#39;</span>,</span><span class="param">	<span class="n">key</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">parity</span><span class="o">=</span><span class="mi">3</span>,</span><span class="param">	<span class="n">breed</span><span class="o">=</span><span class="s1">&#39;H&#39;</span>,</span><span class="param">	<span class="n">continent</span><span class="o">=</span><span class="s1">&#39;USA&#39;</span>,</span><span class="param">	<span class="n">persistency_method</span><span class="o">=</span><span class="s1">&#39;derived&#39;</span>,</span><span class="param">	<span class="n">lactation_length</span><span class="o">=</span><span class="mi">305</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="calculate_characteristic-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#calculate_characteristic"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="calculate_characteristic-292"><a href="#calculate_characteristic-292"><span class="linenos">292</span></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_characteristic</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;wood&#39;</span><span class="p">,</span> <span class="n">characteristic</span><span class="o">=</span><span class="s1">&#39;cumulative_milk_yield&#39;</span><span class="p">,</span>
</span><span id="calculate_characteristic-293"><a href="#calculate_characteristic-293"><span class="linenos">293</span></a>                             <span class="n">fitting</span><span class="o">=</span><span class="s1">&#39;frequentist&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parity</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">breed</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">continent</span><span class="o">=</span><span class="s1">&#39;USA&#39;</span><span class="p">,</span>
</span><span id="calculate_characteristic-294"><a href="#calculate_characteristic-294"><span class="linenos">294</span></a>                             <span class="n">persistency_method</span><span class="o">=</span><span class="s1">&#39;derived&#39;</span><span class="p">,</span> <span class="n">lactation_length</span><span class="o">=</span><span class="mi">305</span><span class="p">):</span>
</span><span id="calculate_characteristic-295"><a href="#calculate_characteristic-295"><span class="linenos">295</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluate a lactation curve characteristic from observed test-day data.</span>
</span><span id="calculate_characteristic-296"><a href="#calculate_characteristic-296"><span class="linenos">296</span></a>
</span><span id="calculate_characteristic-297"><a href="#calculate_characteristic-297"><span class="linenos">297</span></a><span class="sd">    This function fits the requested model (frequentist or Bayesian via MilkBot),</span>
</span><span id="calculate_characteristic-298"><a href="#calculate_characteristic-298"><span class="linenos">298</span></a><span class="sd">    retrieves model parameters, and evaluates the requested characteristic using the</span>
</span><span id="calculate_characteristic-299"><a href="#calculate_characteristic-299"><span class="linenos">299</span></a><span class="sd">    symbolic expression (if available), falling back to numeric methods when needed.</span>
</span><span id="calculate_characteristic-300"><a href="#calculate_characteristic-300"><span class="linenos">300</span></a>
</span><span id="calculate_characteristic-301"><a href="#calculate_characteristic-301"><span class="linenos">301</span></a><span class="sd">    Args:</span>
</span><span id="calculate_characteristic-302"><a href="#calculate_characteristic-302"><span class="linenos">302</span></a><span class="sd">        dim (Int): Days in milk (DIM).</span>
</span><span id="calculate_characteristic-303"><a href="#calculate_characteristic-303"><span class="linenos">303</span></a><span class="sd">        milkrecordings (Float): Milk recordings (kg or lbs) for each DIM.</span>
</span><span id="calculate_characteristic-304"><a href="#calculate_characteristic-304"><span class="linenos">304</span></a><span class="sd">        model (str): Model name. Supported for this function:</span>
</span><span id="calculate_characteristic-305"><a href="#calculate_characteristic-305"><span class="linenos">305</span></a><span class="sd">            &#39;milkbot&#39;, &#39;wood&#39;, &#39;wilmink&#39;, &#39;ali_schaeffer&#39;, &#39;fischer&#39;.</span>
</span><span id="calculate_characteristic-306"><a href="#calculate_characteristic-306"><span class="linenos">306</span></a><span class="sd">        characteristic (str): One of &#39;time_to_peak&#39;, &#39;peak_yield&#39;, &#39;cumulative_milk_yield&#39;, &#39;persistency&#39;.</span>
</span><span id="calculate_characteristic-307"><a href="#calculate_characteristic-307"><span class="linenos">307</span></a><span class="sd">        fitting (str): &#39;frequentist&#39; (default) or &#39;bayesian&#39;.</span>
</span><span id="calculate_characteristic-308"><a href="#calculate_characteristic-308"><span class="linenos">308</span></a><span class="sd">        key (str | None): API key for MilkBot Bayesian fitting.</span>
</span><span id="calculate_characteristic-309"><a href="#calculate_characteristic-309"><span class="linenos">309</span></a><span class="sd">        parity (Int): Parity of the cow; values above 3 are considered as 3 (Bayesian).</span>
</span><span id="calculate_characteristic-310"><a href="#calculate_characteristic-310"><span class="linenos">310</span></a><span class="sd">        breed (str): &#39;H&#39; (Holstein) or &#39;J&#39; (Jersey) (Bayesian).</span>
</span><span id="calculate_characteristic-311"><a href="#calculate_characteristic-311"><span class="linenos">311</span></a><span class="sd">        continent (str): &#39;USA&#39;, &#39;EU&#39;, or &#39;CHEN&#39; (Bayesian).</span>
</span><span id="calculate_characteristic-312"><a href="#calculate_characteristic-312"><span class="linenos">312</span></a><span class="sd">        persistency_method (str): &#39;derived&#39; (average slope after peak; default) or &#39;literature&#39;</span>
</span><span id="calculate_characteristic-313"><a href="#calculate_characteristic-313"><span class="linenos">313</span></a><span class="sd">            (only for Wood and MilkBot).</span>
</span><span id="calculate_characteristic-314"><a href="#calculate_characteristic-314"><span class="linenos">314</span></a><span class="sd">        lactation_length (Int | str): Horizon for persistency calculation:</span>
</span><span id="calculate_characteristic-315"><a href="#calculate_characteristic-315"><span class="linenos">315</span></a><span class="sd">            305 (default), &#39;max&#39; (use max DIM in data), or an integer.</span>
</span><span id="calculate_characteristic-316"><a href="#calculate_characteristic-316"><span class="linenos">316</span></a>
</span><span id="calculate_characteristic-317"><a href="#calculate_characteristic-317"><span class="linenos">317</span></a><span class="sd">    Returns:</span>
</span><span id="calculate_characteristic-318"><a href="#calculate_characteristic-318"><span class="linenos">318</span></a><span class="sd">        float: The requested characteristic value.</span>
</span><span id="calculate_characteristic-319"><a href="#calculate_characteristic-319"><span class="linenos">319</span></a>
</span><span id="calculate_characteristic-320"><a href="#calculate_characteristic-320"><span class="linenos">320</span></a><span class="sd">    Raises:</span>
</span><span id="calculate_characteristic-321"><a href="#calculate_characteristic-321"><span class="linenos">321</span></a><span class="sd">        Exception: If inputs are invalid, the model/characteristic is unsupported,</span>
</span><span id="calculate_characteristic-322"><a href="#calculate_characteristic-322"><span class="linenos">322</span></a><span class="sd">            an API key is missing for Bayesian fitting, or the characteristic cannot be computed.</span>
</span><span id="calculate_characteristic-323"><a href="#calculate_characteristic-323"><span class="linenos">323</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="calculate_characteristic-324"><a href="#calculate_characteristic-324"><span class="linenos">324</span></a>    <span class="c1"># check and prepare input</span>
</span><span id="calculate_characteristic-325"><a href="#calculate_characteristic-325"><span class="linenos">325</span></a>    <span class="n">inputs</span> <span class="o">=</span> <span class="n">validate_and_prepare_inputs</span><span class="p">(</span>
</span><span id="calculate_characteristic-326"><a href="#calculate_characteristic-326"><span class="linenos">326</span></a>        <span class="n">dim</span><span class="p">,</span>
</span><span id="calculate_characteristic-327"><a href="#calculate_characteristic-327"><span class="linenos">327</span></a>        <span class="n">milkrecordings</span><span class="p">,</span>
</span><span id="calculate_characteristic-328"><a href="#calculate_characteristic-328"><span class="linenos">328</span></a>        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
</span><span id="calculate_characteristic-329"><a href="#calculate_characteristic-329"><span class="linenos">329</span></a>        <span class="n">fitting</span><span class="o">=</span><span class="n">fitting</span><span class="p">,</span>
</span><span id="calculate_characteristic-330"><a href="#calculate_characteristic-330"><span class="linenos">330</span></a>        <span class="n">breed</span><span class="o">=</span><span class="n">breed</span><span class="p">,</span>
</span><span id="calculate_characteristic-331"><a href="#calculate_characteristic-331"><span class="linenos">331</span></a>        <span class="n">parity</span><span class="o">=</span><span class="n">parity</span><span class="p">,</span>
</span><span id="calculate_characteristic-332"><a href="#calculate_characteristic-332"><span class="linenos">332</span></a>        <span class="n">continent</span><span class="o">=</span><span class="n">continent</span><span class="p">,</span>
</span><span id="calculate_characteristic-333"><a href="#calculate_characteristic-333"><span class="linenos">333</span></a>        <span class="n">persistency_method</span><span class="o">=</span><span class="n">persistency_method</span><span class="p">,</span>
</span><span id="calculate_characteristic-334"><a href="#calculate_characteristic-334"><span class="linenos">334</span></a>        <span class="n">lactation_length</span><span class="o">=</span><span class="n">lactation_length</span>
</span><span id="calculate_characteristic-335"><a href="#calculate_characteristic-335"><span class="linenos">335</span></a>    <span class="p">)</span>
</span><span id="calculate_characteristic-336"><a href="#calculate_characteristic-336"><span class="linenos">336</span></a>
</span><span id="calculate_characteristic-337"><a href="#calculate_characteristic-337"><span class="linenos">337</span></a>    <span class="n">dim</span><span class="p">:</span> <span class="n">ndarray</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">dim</span>
</span><span id="calculate_characteristic-338"><a href="#calculate_characteristic-338"><span class="linenos">338</span></a>    <span class="n">milkrecordings</span><span class="p">:</span> <span class="n">ndarray</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">milkrecordings</span>
</span><span id="calculate_characteristic-339"><a href="#calculate_characteristic-339"><span class="linenos">339</span></a>    <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">model</span>
</span><span id="calculate_characteristic-340"><a href="#calculate_characteristic-340"><span class="linenos">340</span></a>    <span class="n">fitting</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">fitting</span>
</span><span id="calculate_characteristic-341"><a href="#calculate_characteristic-341"><span class="linenos">341</span></a>    <span class="n">breed</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">breed</span>
</span><span id="calculate_characteristic-342"><a href="#calculate_characteristic-342"><span class="linenos">342</span></a>    <span class="n">parity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">parity</span>
</span><span id="calculate_characteristic-343"><a href="#calculate_characteristic-343"><span class="linenos">343</span></a>    <span class="n">continent</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">continent</span>
</span><span id="calculate_characteristic-344"><a href="#calculate_characteristic-344"><span class="linenos">344</span></a>    <span class="n">persistency_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">persistency_method</span>
</span><span id="calculate_characteristic-345"><a href="#calculate_characteristic-345"><span class="linenos">345</span></a>    <span class="n">lactation_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">lactation_length</span>
</span><span id="calculate_characteristic-346"><a href="#calculate_characteristic-346"><span class="linenos">346</span></a>
</span><span id="calculate_characteristic-347"><a href="#calculate_characteristic-347"><span class="linenos">347</span></a>    <span class="k">if</span> <span class="n">model</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;milkbot&#39;</span><span class="p">,</span> <span class="s1">&#39;wood&#39;</span><span class="p">,</span> <span class="s1">&#39;wilmink&#39;</span><span class="p">,</span> <span class="s1">&#39;ali_schaeffer&#39;</span><span class="p">,</span> <span class="s1">&#39;fischer&#39;</span><span class="p">]:</span>
</span><span id="calculate_characteristic-348"><a href="#calculate_characteristic-348"><span class="linenos">348</span></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;this function currently only works for the milkbot, wood, wilmink, ali_schaeffer and fischer models&#39;</span><span class="p">)</span>
</span><span id="calculate_characteristic-349"><a href="#calculate_characteristic-349"><span class="linenos">349</span></a>
</span><span id="calculate_characteristic-350"><a href="#calculate_characteristic-350"><span class="linenos">350</span></a>    <span class="n">characteristic_options</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;time_to_peak&quot;</span><span class="p">,</span> <span class="s2">&quot;peak_yield&quot;</span><span class="p">,</span> <span class="s2">&quot;cumulative_milk_yield&quot;</span><span class="p">,</span> <span class="s2">&quot;persistency&quot;</span><span class="p">]</span>
</span><span id="calculate_characteristic-351"><a href="#calculate_characteristic-351"><span class="linenos">351</span></a>
</span><span id="calculate_characteristic-352"><a href="#calculate_characteristic-352"><span class="linenos">352</span></a>    <span class="k">if</span> <span class="n">characteristic</span> <span class="ow">in</span> <span class="n">characteristic_options</span><span class="p">:</span>
</span><span id="calculate_characteristic-353"><a href="#calculate_characteristic-353"><span class="linenos">353</span></a>        <span class="k">if</span> <span class="n">fitting</span> <span class="o">==</span> <span class="s1">&#39;frequentist&#39;</span><span class="p">:</span>
</span><span id="calculate_characteristic-354"><a href="#calculate_characteristic-354"><span class="linenos">354</span></a>
</span><span id="calculate_characteristic-355"><a href="#calculate_characteristic-355"><span class="linenos">355</span></a>            <span class="c1"># Get fitted parameters from your fitting function</span>
</span><span id="calculate_characteristic-356"><a href="#calculate_characteristic-356"><span class="linenos">356</span></a>            <span class="n">fitted_params</span> <span class="o">=</span> <span class="n">get_lc_parameters</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
</span><span id="calculate_characteristic-357"><a href="#calculate_characteristic-357"><span class="linenos">357</span></a>
</span><span id="calculate_characteristic-358"><a href="#calculate_characteristic-358"><span class="linenos">358</span></a>            <span class="k">if</span> <span class="n">characteristic</span> <span class="o">!=</span> <span class="s1">&#39;persistency&#39;</span><span class="p">:</span>
</span><span id="calculate_characteristic-359"><a href="#calculate_characteristic-359"><span class="linenos">359</span></a>                <span class="c1"># Try symbolic formula first</span>
</span><span id="calculate_characteristic-360"><a href="#calculate_characteristic-360"><span class="linenos">360</span></a>                <span class="n">expr</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span> <span class="n">lactation_curve_characteristic_function</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">characteristic</span><span class="p">,</span> <span class="n">lactation_length</span><span class="p">)</span>
</span><span id="calculate_characteristic-361"><a href="#calculate_characteristic-361"><span class="linenos">361</span></a>                <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>  <span class="c1"># get rid of warnings for invalid operations</span>
</span><span id="calculate_characteristic-362"><a href="#calculate_characteristic-362"><span class="linenos">362</span></a>                    <span class="n">value</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">fitted_params</span><span class="p">)</span>
</span><span id="calculate_characteristic-363"><a href="#calculate_characteristic-363"><span class="linenos">363</span></a>
</span><span id="calculate_characteristic-364"><a href="#calculate_characteristic-364"><span class="linenos">364</span></a>                <span class="c1"># If symbolic formula fails or is invalid (use numeric approach)</span>
</span><span id="calculate_characteristic-365"><a href="#calculate_characteristic-365"><span class="linenos">365</span></a>                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">characteristic</span> <span class="o">==</span> <span class="s1">&#39;time_to_peak&#39;</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="calculate_characteristic-366"><a href="#calculate_characteristic-366"><span class="linenos">366</span></a>                    <span class="k">if</span> <span class="n">characteristic</span> <span class="o">==</span> <span class="s1">&#39;time_to_peak&#39;</span><span class="p">:</span>
</span><span id="calculate_characteristic-367"><a href="#calculate_characteristic-367"><span class="linenos">367</span></a>                        <span class="n">value</span> <span class="o">=</span> <span class="n">numeric_time_to_peak</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fitting</span><span class="o">=</span><span class="n">fitting</span><span class="p">,</span>
</span><span id="calculate_characteristic-368"><a href="#calculate_characteristic-368"><span class="linenos">368</span></a>                                                     <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">parity</span><span class="o">=</span><span class="n">parity</span><span class="p">,</span> <span class="n">breed</span><span class="o">=</span><span class="n">breed</span><span class="p">,</span> <span class="n">continent</span><span class="o">=</span><span class="n">continent</span><span class="p">)</span>
</span><span id="calculate_characteristic-369"><a href="#calculate_characteristic-369"><span class="linenos">369</span></a>                    <span class="k">elif</span> <span class="n">characteristic</span> <span class="o">==</span> <span class="s1">&#39;peak_yield&#39;</span><span class="p">:</span>
</span><span id="calculate_characteristic-370"><a href="#calculate_characteristic-370"><span class="linenos">370</span></a>                        <span class="n">value</span> <span class="o">=</span> <span class="n">numeric_peak_yield</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fitting</span><span class="o">=</span><span class="n">fitting</span><span class="p">,</span>
</span><span id="calculate_characteristic-371"><a href="#calculate_characteristic-371"><span class="linenos">371</span></a>                                                   <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">parity</span><span class="o">=</span><span class="n">parity</span><span class="p">,</span> <span class="n">breed</span><span class="o">=</span><span class="n">breed</span><span class="p">,</span> <span class="n">continent</span><span class="o">=</span><span class="n">continent</span><span class="p">)</span>
</span><span id="calculate_characteristic-372"><a href="#calculate_characteristic-372"><span class="linenos">372</span></a>                    <span class="k">elif</span> <span class="n">characteristic</span> <span class="o">==</span> <span class="s1">&#39;cumulative_milk_yield&#39;</span><span class="p">:</span>
</span><span id="calculate_characteristic-373"><a href="#calculate_characteristic-373"><span class="linenos">373</span></a>                        <span class="n">value</span> <span class="o">=</span> <span class="n">numeric_cumulative_yield</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fitting</span><span class="o">=</span><span class="n">fitting</span><span class="p">,</span>
</span><span id="calculate_characteristic-374"><a href="#calculate_characteristic-374"><span class="linenos">374</span></a>                                                         <span class="n">lactation_length</span><span class="o">=</span><span class="n">lactation_length</span><span class="p">,</span>
</span><span id="calculate_characteristic-375"><a href="#calculate_characteristic-375"><span class="linenos">375</span></a>                                                         <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">parity</span><span class="o">=</span><span class="n">parity</span><span class="p">,</span> <span class="n">breed</span><span class="o">=</span><span class="n">breed</span><span class="p">,</span> <span class="n">continent</span><span class="o">=</span><span class="n">continent</span><span class="p">)</span>
</span><span id="calculate_characteristic-376"><a href="#calculate_characteristic-376"><span class="linenos">376</span></a>
</span><span id="calculate_characteristic-377"><a href="#calculate_characteristic-377"><span class="linenos">377</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="calculate_characteristic-378"><a href="#calculate_characteristic-378"><span class="linenos">378</span></a>                <span class="k">if</span> <span class="n">persistency_method</span> <span class="o">==</span> <span class="s1">&#39;derived&#39;</span><span class="p">:</span>
</span><span id="calculate_characteristic-379"><a href="#calculate_characteristic-379"><span class="linenos">379</span></a>                    <span class="c1"># find lactation length from data</span>
</span><span id="calculate_characteristic-380"><a href="#calculate_characteristic-380"><span class="linenos">380</span></a>                    <span class="k">if</span> <span class="n">lactation_length</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
</span><span id="calculate_characteristic-381"><a href="#calculate_characteristic-381"><span class="linenos">381</span></a>                        <span class="n">lactation_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
</span><span id="calculate_characteristic-382"><a href="#calculate_characteristic-382"><span class="linenos">382</span></a>                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lactation_length</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="calculate_characteristic-383"><a href="#calculate_characteristic-383"><span class="linenos">383</span></a>                        <span class="n">lactation_length</span> <span class="o">=</span> <span class="n">lactation_length</span>
</span><span id="calculate_characteristic-384"><a href="#calculate_characteristic-384"><span class="linenos">384</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="calculate_characteristic-385"><a href="#calculate_characteristic-385"><span class="linenos">385</span></a>                        <span class="n">lactation_length</span> <span class="o">=</span> <span class="mi">305</span>
</span><span id="calculate_characteristic-386"><a href="#calculate_characteristic-386"><span class="linenos">386</span></a>                    <span class="n">value</span> <span class="o">=</span> <span class="n">persistency_fitted_curve</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fitting</span><span class="o">=</span><span class="s1">&#39;frequentist&#39;</span><span class="p">,</span> <span class="n">lactation_length</span><span class="o">=</span><span class="n">lactation_length</span><span class="p">)</span>
</span><span id="calculate_characteristic-387"><a href="#calculate_characteristic-387"><span class="linenos">387</span></a>
</span><span id="calculate_characteristic-388"><a href="#calculate_characteristic-388"><span class="linenos">388</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="calculate_characteristic-389"><a href="#calculate_characteristic-389"><span class="linenos">389</span></a>                    <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;wood&#39;</span><span class="p">:</span>
</span><span id="calculate_characteristic-390"><a href="#calculate_characteristic-390"><span class="linenos">390</span></a>                        <span class="n">value</span> <span class="o">=</span> <span class="n">persistency_wood</span><span class="p">(</span><span class="n">fitted_params</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">fitted_params</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="calculate_characteristic-391"><a href="#calculate_characteristic-391"><span class="linenos">391</span></a>
</span><span id="calculate_characteristic-392"><a href="#calculate_characteristic-392"><span class="linenos">392</span></a>                    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;milkbot&#39;</span><span class="p">:</span>
</span><span id="calculate_characteristic-393"><a href="#calculate_characteristic-393"><span class="linenos">393</span></a>                        <span class="n">value</span> <span class="o">=</span> <span class="n">persistency_milkbot</span><span class="p">(</span><span class="n">fitted_params</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</span><span id="calculate_characteristic-394"><a href="#calculate_characteristic-394"><span class="linenos">394</span></a>
</span><span id="calculate_characteristic-395"><a href="#calculate_characteristic-395"><span class="linenos">395</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="calculate_characteristic-396"><a href="#calculate_characteristic-396"><span class="linenos">396</span></a>                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="calculate_characteristic-397"><a href="#calculate_characteristic-397"><span class="linenos">397</span></a>                            <span class="s1">&#39;Currently only the Wood model and MilkBot model have a separate model function from the literature integrated for persistency. if persistency=&quot;derived&quot; is selected, persistency can be calculated for every model as the average slope of the lactation after the peak.&#39;</span><span class="p">)</span>
</span><span id="calculate_characteristic-398"><a href="#calculate_characteristic-398"><span class="linenos">398</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="calculate_characteristic-399"><a href="#calculate_characteristic-399"><span class="linenos">399</span></a>                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="calculate_characteristic-400"><a href="#calculate_characteristic-400"><span class="linenos">400</span></a>            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="calculate_characteristic-401"><a href="#calculate_characteristic-401"><span class="linenos">401</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Could not compute characteristic, possibly due to invalid fitted parameters&#39;</span><span class="p">)</span>
</span><span id="calculate_characteristic-402"><a href="#calculate_characteristic-402"><span class="linenos">402</span></a>
</span><span id="calculate_characteristic-403"><a href="#calculate_characteristic-403"><span class="linenos">403</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="calculate_characteristic-404"><a href="#calculate_characteristic-404"><span class="linenos">404</span></a>            <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;milkbot&#39;</span><span class="p">:</span>
</span><span id="calculate_characteristic-405"><a href="#calculate_characteristic-405"><span class="linenos">405</span></a>                <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="calculate_characteristic-406"><a href="#calculate_characteristic-406"><span class="linenos">406</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Key needed to use Bayesian fitting engine MilkBot&#39;</span><span class="p">)</span>
</span><span id="calculate_characteristic-407"><a href="#calculate_characteristic-407"><span class="linenos">407</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="calculate_characteristic-408"><a href="#calculate_characteristic-408"><span class="linenos">408</span></a>                    <span class="n">fitted_params_bayes</span> <span class="o">=</span> <span class="n">bayesian_fit_milkbot_single_lactation</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">parity</span><span class="p">,</span> <span class="n">breed</span><span class="p">,</span> <span class="n">continent</span><span class="p">)</span>
</span><span id="calculate_characteristic-409"><a href="#calculate_characteristic-409"><span class="linenos">409</span></a>                    <span class="n">fitted_params_bayes</span> <span class="o">=</span> <span class="n">fitted_params_bayes</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">],</span> <span class="n">fitted_params_bayes</span><span class="p">[</span><span class="s1">&#39;ramp&#39;</span><span class="p">],</span> <span class="n">fitted_params_bayes</span><span class="p">[</span><span class="s1">&#39;offset&#39;</span><span class="p">],</span> <span class="n">fitted_params_bayes</span><span class="p">[</span><span class="s1">&#39;decay&#39;</span><span class="p">]</span>
</span><span id="calculate_characteristic-410"><a href="#calculate_characteristic-410"><span class="linenos">410</span></a>
</span><span id="calculate_characteristic-411"><a href="#calculate_characteristic-411"><span class="linenos">411</span></a>                    <span class="k">if</span> <span class="n">characteristic</span> <span class="o">!=</span> <span class="s1">&#39;persistency&#39;</span><span class="p">:</span>
</span><span id="calculate_characteristic-412"><a href="#calculate_characteristic-412"><span class="linenos">412</span></a>                        <span class="c1"># Get the symbolic expression and model parameters</span>
</span><span id="calculate_characteristic-413"><a href="#calculate_characteristic-413"><span class="linenos">413</span></a>                        <span class="n">expr</span><span class="p">,</span> <span class="n">param_symbols</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span> <span class="n">lactation_curve_characteristic_function</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">characteristic</span><span class="p">)</span>
</span><span id="calculate_characteristic-414"><a href="#calculate_characteristic-414"><span class="linenos">414</span></a>                        <span class="n">value</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">fitted_params_bayes</span><span class="p">)</span>
</span><span id="calculate_characteristic-415"><a href="#calculate_characteristic-415"><span class="linenos">415</span></a>
</span><span id="calculate_characteristic-416"><a href="#calculate_characteristic-416"><span class="linenos">416</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="calculate_characteristic-417"><a href="#calculate_characteristic-417"><span class="linenos">417</span></a>                        <span class="k">if</span> <span class="n">persistency_method</span> <span class="o">==</span> <span class="s1">&#39;derived&#39;</span><span class="p">:</span>
</span><span id="calculate_characteristic-418"><a href="#calculate_characteristic-418"><span class="linenos">418</span></a>                            <span class="c1"># find lactation length from data</span>
</span><span id="calculate_characteristic-419"><a href="#calculate_characteristic-419"><span class="linenos">419</span></a>                            <span class="k">if</span> <span class="n">lactation_length</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
</span><span id="calculate_characteristic-420"><a href="#calculate_characteristic-420"><span class="linenos">420</span></a>                                <span class="n">lactation_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
</span><span id="calculate_characteristic-421"><a href="#calculate_characteristic-421"><span class="linenos">421</span></a>                            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lactation_length</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="calculate_characteristic-422"><a href="#calculate_characteristic-422"><span class="linenos">422</span></a>                                <span class="n">lactation_length</span> <span class="o">=</span> <span class="n">lactation_length</span>
</span><span id="calculate_characteristic-423"><a href="#calculate_characteristic-423"><span class="linenos">423</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="calculate_characteristic-424"><a href="#calculate_characteristic-424"><span class="linenos">424</span></a>                                <span class="n">lactation_length</span> <span class="o">=</span> <span class="mi">305</span>
</span><span id="calculate_characteristic-425"><a href="#calculate_characteristic-425"><span class="linenos">425</span></a>                            <span class="n">value</span> <span class="o">=</span> <span class="n">persistency_fitted_curve</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fitting</span><span class="o">=</span><span class="s1">&#39;bayesian&#39;</span><span class="p">,</span>
</span><span id="calculate_characteristic-426"><a href="#calculate_characteristic-426"><span class="linenos">426</span></a>                                                             <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">parity</span><span class="o">=</span><span class="n">parity</span><span class="p">,</span> <span class="n">breed</span><span class="o">=</span><span class="n">breed</span><span class="p">,</span> <span class="n">continent</span><span class="o">=</span><span class="n">continent</span><span class="p">,</span>
</span><span id="calculate_characteristic-427"><a href="#calculate_characteristic-427"><span class="linenos">427</span></a>                                                             <span class="n">lactation_length</span><span class="o">=</span><span class="n">lactation_length</span><span class="p">)</span>
</span><span id="calculate_characteristic-428"><a href="#calculate_characteristic-428"><span class="linenos">428</span></a>
</span><span id="calculate_characteristic-429"><a href="#calculate_characteristic-429"><span class="linenos">429</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="calculate_characteristic-430"><a href="#calculate_characteristic-430"><span class="linenos">430</span></a>                            <span class="n">value</span> <span class="o">=</span> <span class="n">persistency_milkbot</span><span class="p">(</span><span class="n">fitted_params_bayes</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</span><span id="calculate_characteristic-431"><a href="#calculate_characteristic-431"><span class="linenos">431</span></a>
</span><span id="calculate_characteristic-432"><a href="#calculate_characteristic-432"><span class="linenos">432</span></a>                    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="calculate_characteristic-433"><a href="#calculate_characteristic-433"><span class="linenos">433</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="calculate_characteristic-434"><a href="#calculate_characteristic-434"><span class="linenos">434</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Bayesian fitting is currently only implemented for MilkBot models&#39;</span><span class="p">)</span>
</span><span id="calculate_characteristic-435"><a href="#calculate_characteristic-435"><span class="linenos">435</span></a>
</span><span id="calculate_characteristic-436"><a href="#calculate_characteristic-436"><span class="linenos">436</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="calculate_characteristic-437"><a href="#calculate_characteristic-437"><span class="linenos">437</span></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unknown characteristic&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Evaluate a lactation curve characteristic from observed test-day data.</p>

<p>This function fits the requested model (frequentist or Bayesian via MilkBot),
retrieves model parameters, and evaluates the requested characteristic using the
symbolic expression (if available), falling back to numeric methods when needed.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>dim (Int):</strong>  Days in milk (DIM).</li>
<li><strong>milkrecordings (Float):</strong>  Milk recordings (kg or lbs) for each DIM.</li>
<li><strong>model (str):</strong>  Model name. Supported for this function:
'milkbot', 'wood', 'wilmink', 'ali_schaeffer', 'fischer'.</li>
<li><strong>characteristic (str):</strong>  One of 'time_to_peak', 'peak_yield', 'cumulative_milk_yield', 'persistency'.</li>
<li><strong>fitting (str):</strong>  'frequentist' (default) or 'bayesian'.</li>
<li><strong>key (str | None):</strong>  API key for MilkBot Bayesian fitting.</li>
<li><strong>parity (Int):</strong>  Parity of the cow; values above 3 are considered as 3 (Bayesian).</li>
<li><strong>breed (str):</strong>  'H' (Holstein) or 'J' (Jersey) (Bayesian).</li>
<li><strong>continent (str):</strong>  'USA', 'EU', or 'CHEN' (Bayesian).</li>
<li><strong>persistency_method (str):</strong>  'derived' (average slope after peak; default) or 'literature'
(only for Wood and MilkBot).</li>
<li><strong>lactation_length (Int | str):</strong>  Horizon for persistency calculation:
305 (default), 'max' (use max DIM in data), or an integer.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>float: The requested characteristic value.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>Exception:</strong>  If inputs are invalid, the model/characteristic is unsupported,
an API key is missing for Bayesian fitting, or the characteristic cannot be computed.</li>
</ul>
</div>


                </section>
                <section id="lactation_curve_characteristic_function">
                            <input id="lactation_curve_characteristic_function-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">lactation_curve_characteristic_function</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">model</span><span class="o">=</span><span class="s1">&#39;wood&#39;</span>, </span><span class="param"><span class="n">characteristic</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">lactation_length</span><span class="o">=</span><span class="mi">305</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="lactation_curve_characteristic_function-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#lactation_curve_characteristic_function"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="lactation_curve_characteristic_function-94"><a href="#lactation_curve_characteristic_function-94"><span class="linenos"> 94</span></a><span class="k">def</span><span class="w"> </span><span class="nf">lactation_curve_characteristic_function</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;wood&#39;</span><span class="p">,</span> <span class="n">characteristic</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lactation_length</span><span class="o">=</span><span class="mi">305</span><span class="p">):</span>
</span><span id="lactation_curve_characteristic_function-95"><a href="#lactation_curve_characteristic_function-95"><span class="linenos"> 95</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Build (or fetch from cache) a symbolic expression and fast numeric function for an LCC.</span>
</span><span id="lactation_curve_characteristic_function-96"><a href="#lactation_curve_characteristic_function-96"><span class="linenos"> 96</span></a>
</span><span id="lactation_curve_characteristic_function-97"><a href="#lactation_curve_characteristic_function-97"><span class="linenos"> 97</span></a><span class="sd">    This function derives the requested **lactation curve characteristic** for a given</span>
</span><span id="lactation_curve_characteristic_function-98"><a href="#lactation_curve_characteristic_function-98"><span class="linenos"> 98</span></a><span class="sd">    model using SymPy (derivative / root finding / integration). It returns the symbolic</span>
</span><span id="lactation_curve_characteristic_function-99"><a href="#lactation_curve_characteristic_function-99"><span class="linenos"> 99</span></a><span class="sd">    expression, the tuple of parameter symbols (argument order), and a lambdified</span>
</span><span id="lactation_curve_characteristic_function-100"><a href="#lactation_curve_characteristic_function-100"><span class="linenos">100</span></a><span class="sd">    numeric function that can be evaluated with numerical parameters.</span>
</span><span id="lactation_curve_characteristic_function-101"><a href="#lactation_curve_characteristic_function-101"><span class="linenos">101</span></a>
</span><span id="lactation_curve_characteristic_function-102"><a href="#lactation_curve_characteristic_function-102"><span class="linenos">102</span></a><span class="sd">    The symbolic derivation and integration are done only once per (model, characteristic)</span>
</span><span id="lactation_curve_characteristic_function-103"><a href="#lactation_curve_characteristic_function-103"><span class="linenos">103</span></a><span class="sd">    and then **cached** for reuse.</span>
</span><span id="lactation_curve_characteristic_function-104"><a href="#lactation_curve_characteristic_function-104"><span class="linenos">104</span></a>
</span><span id="lactation_curve_characteristic_function-105"><a href="#lactation_curve_characteristic_function-105"><span class="linenos">105</span></a><span class="sd">    Args:</span>
</span><span id="lactation_curve_characteristic_function-106"><a href="#lactation_curve_characteristic_function-106"><span class="linenos">106</span></a><span class="sd">        model (str): Model name. Options:</span>
</span><span id="lactation_curve_characteristic_function-107"><a href="#lactation_curve_characteristic_function-107"><span class="linenos">107</span></a><span class="sd">            &#39;milkbot&#39;, &#39;wood&#39;, &#39;wilmink&#39;, &#39;ali_schaeffer&#39;, &#39;fischer&#39;,</span>
</span><span id="lactation_curve_characteristic_function-108"><a href="#lactation_curve_characteristic_function-108"><span class="linenos">108</span></a><span class="sd">            &#39;brody&#39;, &#39;sikka&#39;, &#39;nelder&#39;, &#39;dhanoa&#39;, &#39;emmans&#39;, &#39;hayashi&#39;,</span>
</span><span id="lactation_curve_characteristic_function-109"><a href="#lactation_curve_characteristic_function-109"><span class="linenos">109</span></a><span class="sd">            &#39;rook&#39;, &#39;dijkstra&#39;, &#39;prasad&#39;.</span>
</span><span id="lactation_curve_characteristic_function-110"><a href="#lactation_curve_characteristic_function-110"><span class="linenos">110</span></a><span class="sd">        characteristic (str | None): Desired characteristic. Options:</span>
</span><span id="lactation_curve_characteristic_function-111"><a href="#lactation_curve_characteristic_function-111"><span class="linenos">111</span></a><span class="sd">            &#39;time_to_peak&#39;, &#39;peak_yield&#39;, &#39;cumulative_milk_yield&#39;, &#39;persistency&#39;.</span>
</span><span id="lactation_curve_characteristic_function-112"><a href="#lactation_curve_characteristic_function-112"><span class="linenos">112</span></a><span class="sd">            If `None` or unrecognized, a dict of all available characteristics is returned</span>
</span><span id="lactation_curve_characteristic_function-113"><a href="#lactation_curve_characteristic_function-113"><span class="linenos">113</span></a><span class="sd">            (with `persistency` possibly `None` if derivation is not feasible).</span>
</span><span id="lactation_curve_characteristic_function-114"><a href="#lactation_curve_characteristic_function-114"><span class="linenos">114</span></a><span class="sd">        lactation_length (int): Length of lactation in days used in persistency</span>
</span><span id="lactation_curve_characteristic_function-115"><a href="#lactation_curve_characteristic_function-115"><span class="linenos">115</span></a><span class="sd">            computation (default 305).</span>
</span><span id="lactation_curve_characteristic_function-116"><a href="#lactation_curve_characteristic_function-116"><span class="linenos">116</span></a>
</span><span id="lactation_curve_characteristic_function-117"><a href="#lactation_curve_characteristic_function-117"><span class="linenos">117</span></a><span class="sd">    Returns:</span>
</span><span id="lactation_curve_characteristic_function-118"><a href="#lactation_curve_characteristic_function-118"><span class="linenos">118</span></a><span class="sd">        tuple:</span>
</span><span id="lactation_curve_characteristic_function-119"><a href="#lactation_curve_characteristic_function-119"><span class="linenos">119</span></a><span class="sd">            expr: SymPy expression (or dict of expressions if `characteristic` is None).</span>
</span><span id="lactation_curve_characteristic_function-120"><a href="#lactation_curve_characteristic_function-120"><span class="linenos">120</span></a><span class="sd">            params: Tuple of SymPy symbols for model parameters (argument order).</span>
</span><span id="lactation_curve_characteristic_function-121"><a href="#lactation_curve_characteristic_function-121"><span class="linenos">121</span></a><span class="sd">            func: Lambdified numeric function `f(*params)` (or dict of functions).</span>
</span><span id="lactation_curve_characteristic_function-122"><a href="#lactation_curve_characteristic_function-122"><span class="linenos">122</span></a>
</span><span id="lactation_curve_characteristic_function-123"><a href="#lactation_curve_characteristic_function-123"><span class="linenos">123</span></a><span class="sd">    Raises:</span>
</span><span id="lactation_curve_characteristic_function-124"><a href="#lactation_curve_characteristic_function-124"><span class="linenos">124</span></a><span class="sd">        Exception: If the model is unknown, or if no positive real solution for</span>
</span><span id="lactation_curve_characteristic_function-125"><a href="#lactation_curve_characteristic_function-125"><span class="linenos">125</span></a><span class="sd">            peak timing/yield exists where required.</span>
</span><span id="lactation_curve_characteristic_function-126"><a href="#lactation_curve_characteristic_function-126"><span class="linenos">126</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="lactation_curve_characteristic_function-127"><a href="#lactation_curve_characteristic_function-127"><span class="linenos">127</span></a>    <span class="c1"># check the cache</span>
</span><span id="lactation_curve_characteristic_function-128"><a href="#lactation_curve_characteristic_function-128"><span class="linenos">128</span></a>    <span class="n">storage</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">characteristic</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-129"><a href="#lactation_curve_characteristic_function-129"><span class="linenos">129</span></a>    <span class="k">if</span> <span class="n">storage</span> <span class="ow">in</span> <span class="n">_LCC_CACHE</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-130"><a href="#lactation_curve_characteristic_function-130"><span class="linenos">130</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">_LCC_CACHE</span><span class="p">[</span><span class="n">storage</span><span class="p">][</span><span class="s2">&quot;expr&quot;</span><span class="p">],</span>
</span><span id="lactation_curve_characteristic_function-131"><a href="#lactation_curve_characteristic_function-131"><span class="linenos">131</span></a>                <span class="n">_LCC_CACHE</span><span class="p">[</span><span class="n">storage</span><span class="p">][</span><span class="s2">&quot;params&quot;</span><span class="p">],</span>
</span><span id="lactation_curve_characteristic_function-132"><a href="#lactation_curve_characteristic_function-132"><span class="linenos">132</span></a>                <span class="n">_LCC_CACHE</span><span class="p">[</span><span class="n">storage</span><span class="p">][</span><span class="s2">&quot;func&quot;</span><span class="p">])</span>
</span><span id="lactation_curve_characteristic_function-133"><a href="#lactation_curve_characteristic_function-133"><span class="linenos">133</span></a>
</span><span id="lactation_curve_characteristic_function-134"><a href="#lactation_curve_characteristic_function-134"><span class="linenos">134</span></a>    <span class="c1"># make sure model is all lowercase</span>
</span><span id="lactation_curve_characteristic_function-135"><a href="#lactation_curve_characteristic_function-135"><span class="linenos">135</span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="lactation_curve_characteristic_function-136"><a href="#lactation_curve_characteristic_function-136"><span class="linenos">136</span></a>
</span><span id="lactation_curve_characteristic_function-137"><a href="#lactation_curve_characteristic_function-137"><span class="linenos">137</span></a>    <span class="c1"># define functions</span>
</span><span id="lactation_curve_characteristic_function-138"><a href="#lactation_curve_characteristic_function-138"><span class="linenos">138</span></a>    <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;brody&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-139"><a href="#lactation_curve_characteristic_function-139"><span class="linenos">139</span></a>        <span class="c1"># === BRODY 1 ===</span>
</span><span id="lactation_curve_characteristic_function-140"><a href="#lactation_curve_characteristic_function-140"><span class="linenos">140</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a b k1 k2 t&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-141"><a href="#lactation_curve_characteristic_function-141"><span class="linenos">141</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-142"><a href="#lactation_curve_characteristic_function-142"><span class="linenos">142</span></a>
</span><span id="lactation_curve_characteristic_function-143"><a href="#lactation_curve_characteristic_function-143"><span class="linenos">143</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;sikka&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-144"><a href="#lactation_curve_characteristic_function-144"><span class="linenos">144</span></a>        <span class="c1"># === SIKKA ===</span>
</span><span id="lactation_curve_characteristic_function-145"><a href="#lactation_curve_characteristic_function-145"><span class="linenos">145</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a b c t&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-146"><a href="#lactation_curve_characteristic_function-146"><span class="linenos">146</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">t</span> <span class="o">-</span> <span class="n">c</span> <span class="o">*</span> <span class="n">t</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-147"><a href="#lactation_curve_characteristic_function-147"><span class="linenos">147</span></a>
</span><span id="lactation_curve_characteristic_function-148"><a href="#lactation_curve_characteristic_function-148"><span class="linenos">148</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;fischer&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-149"><a href="#lactation_curve_characteristic_function-149"><span class="linenos">149</span></a>        <span class="c1"># === FISCHER ===</span>
</span><span id="lactation_curve_characteristic_function-150"><a href="#lactation_curve_characteristic_function-150"><span class="linenos">150</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a b c t&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-151"><a href="#lactation_curve_characteristic_function-151"><span class="linenos">151</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span> <span class="o">*</span> <span class="n">t</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">c</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-152"><a href="#lactation_curve_characteristic_function-152"><span class="linenos">152</span></a>
</span><span id="lactation_curve_characteristic_function-153"><a href="#lactation_curve_characteristic_function-153"><span class="linenos">153</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;nelder&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-154"><a href="#lactation_curve_characteristic_function-154"><span class="linenos">154</span></a>        <span class="c1"># === NELDER ===</span>
</span><span id="lactation_curve_characteristic_function-155"><a href="#lactation_curve_characteristic_function-155"><span class="linenos">155</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a b c t&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-156"><a href="#lactation_curve_characteristic_function-156"><span class="linenos">156</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="n">t</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">t</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-157"><a href="#lactation_curve_characteristic_function-157"><span class="linenos">157</span></a>
</span><span id="lactation_curve_characteristic_function-158"><a href="#lactation_curve_characteristic_function-158"><span class="linenos">158</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;wood&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-159"><a href="#lactation_curve_characteristic_function-159"><span class="linenos">159</span></a>        <span class="c1"># === WOOD ===</span>
</span><span id="lactation_curve_characteristic_function-160"><a href="#lactation_curve_characteristic_function-160"><span class="linenos">160</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a b c t&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-161"><a href="#lactation_curve_characteristic_function-161"><span class="linenos">161</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">t</span> <span class="o">**</span> <span class="n">b</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">c</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-162"><a href="#lactation_curve_characteristic_function-162"><span class="linenos">162</span></a>
</span><span id="lactation_curve_characteristic_function-163"><a href="#lactation_curve_characteristic_function-163"><span class="linenos">163</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;dhanoa&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-164"><a href="#lactation_curve_characteristic_function-164"><span class="linenos">164</span></a>        <span class="c1"># === DHANOA ===</span>
</span><span id="lactation_curve_characteristic_function-165"><a href="#lactation_curve_characteristic_function-165"><span class="linenos">165</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a b c t&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-166"><a href="#lactation_curve_characteristic_function-166"><span class="linenos">166</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">t</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">c</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-167"><a href="#lactation_curve_characteristic_function-167"><span class="linenos">167</span></a>
</span><span id="lactation_curve_characteristic_function-168"><a href="#lactation_curve_characteristic_function-168"><span class="linenos">168</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;emmans&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-169"><a href="#lactation_curve_characteristic_function-169"><span class="linenos">169</span></a>        <span class="c1"># === EMMANS ===</span>
</span><span id="lactation_curve_characteristic_function-170"><a href="#lactation_curve_characteristic_function-170"><span class="linenos">170</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a b c d t&#39;</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-171"><a href="#lactation_curve_characteristic_function-171"><span class="linenos">171</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">exp</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">b</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">c</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-172"><a href="#lactation_curve_characteristic_function-172"><span class="linenos">172</span></a>
</span><span id="lactation_curve_characteristic_function-173"><a href="#lactation_curve_characteristic_function-173"><span class="linenos">173</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;ali_schaeffer&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-174"><a href="#lactation_curve_characteristic_function-174"><span class="linenos">174</span></a>        <span class="c1"># ====ALI=====</span>
</span><span id="lactation_curve_characteristic_function-175"><a href="#lactation_curve_characteristic_function-175"><span class="linenos">175</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a b c d k t&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-176"><a href="#lactation_curve_characteristic_function-176"><span class="linenos">176</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="lactation_curve_characteristic_function-177"><a href="#lactation_curve_characteristic_function-177"><span class="linenos">177</span></a>            <span class="n">a</span>
</span><span id="lactation_curve_characteristic_function-178"><a href="#lactation_curve_characteristic_function-178"><span class="linenos">178</span></a>            <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">/</span> <span class="mi">340</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-179"><a href="#lactation_curve_characteristic_function-179"><span class="linenos">179</span></a>            <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">/</span> <span class="mi">340</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="lactation_curve_characteristic_function-180"><a href="#lactation_curve_characteristic_function-180"><span class="linenos">180</span></a>            <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">t</span> <span class="o">/</span> <span class="mi">340</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-181"><a href="#lactation_curve_characteristic_function-181"><span class="linenos">181</span></a>            <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">log</span><span class="p">((</span><span class="mi">340</span> <span class="o">/</span> <span class="n">t</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-182"><a href="#lactation_curve_characteristic_function-182"><span class="linenos">182</span></a>        <span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-183"><a href="#lactation_curve_characteristic_function-183"><span class="linenos">183</span></a>
</span><span id="lactation_curve_characteristic_function-184"><a href="#lactation_curve_characteristic_function-184"><span class="linenos">184</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;wilmink&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-185"><a href="#lactation_curve_characteristic_function-185"><span class="linenos">185</span></a>        <span class="c1"># === WILMINK ===</span>
</span><span id="lactation_curve_characteristic_function-186"><a href="#lactation_curve_characteristic_function-186"><span class="linenos">186</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a b c k t&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-187"><a href="#lactation_curve_characteristic_function-187"><span class="linenos">187</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-188"><a href="#lactation_curve_characteristic_function-188"><span class="linenos">188</span></a>
</span><span id="lactation_curve_characteristic_function-189"><a href="#lactation_curve_characteristic_function-189"><span class="linenos">189</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;hayashi&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-190"><a href="#lactation_curve_characteristic_function-190"><span class="linenos">190</span></a>        <span class="c1"># === HAYASHI ===</span>
</span><span id="lactation_curve_characteristic_function-191"><a href="#lactation_curve_characteristic_function-191"><span class="linenos">191</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a b c d t&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-192"><a href="#lactation_curve_characteristic_function-192"><span class="linenos">192</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span> <span class="o">/</span> <span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">c</span><span class="p">)))</span>
</span><span id="lactation_curve_characteristic_function-193"><a href="#lactation_curve_characteristic_function-193"><span class="linenos">193</span></a>
</span><span id="lactation_curve_characteristic_function-194"><a href="#lactation_curve_characteristic_function-194"><span class="linenos">194</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;rook&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-195"><a href="#lactation_curve_characteristic_function-195"><span class="linenos">195</span></a>        <span class="c1"># === ROOK ===</span>
</span><span id="lactation_curve_characteristic_function-196"><a href="#lactation_curve_characteristic_function-196"><span class="linenos">196</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a b c d t&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-197"><a href="#lactation_curve_characteristic_function-197"><span class="linenos">197</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">b</span> <span class="o">/</span> <span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="n">t</span><span class="p">)))</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">d</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-198"><a href="#lactation_curve_characteristic_function-198"><span class="linenos">198</span></a>
</span><span id="lactation_curve_characteristic_function-199"><a href="#lactation_curve_characteristic_function-199"><span class="linenos">199</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;dijkstra&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-200"><a href="#lactation_curve_characteristic_function-200"><span class="linenos">200</span></a>        <span class="c1"># === DIJKSTRA ===</span>
</span><span id="lactation_curve_characteristic_function-201"><a href="#lactation_curve_characteristic_function-201"><span class="linenos">201</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a b c d t&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-202"><a href="#lactation_curve_characteristic_function-202"><span class="linenos">202</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">exp</span><span class="p">((</span><span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">c</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span> <span class="o">/</span> <span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="n">d</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-203"><a href="#lactation_curve_characteristic_function-203"><span class="linenos">203</span></a>
</span><span id="lactation_curve_characteristic_function-204"><a href="#lactation_curve_characteristic_function-204"><span class="linenos">204</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;prasad&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-205"><a href="#lactation_curve_characteristic_function-205"><span class="linenos">205</span></a>        <span class="c1"># === PRASAD ===</span>
</span><span id="lactation_curve_characteristic_function-206"><a href="#lactation_curve_characteristic_function-206"><span class="linenos">206</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a b c d t&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-207"><a href="#lactation_curve_characteristic_function-207"><span class="linenos">207</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">t</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">d</span> <span class="o">/</span> <span class="n">t</span>
</span><span id="lactation_curve_characteristic_function-208"><a href="#lactation_curve_characteristic_function-208"><span class="linenos">208</span></a>
</span><span id="lactation_curve_characteristic_function-209"><a href="#lactation_curve_characteristic_function-209"><span class="linenos">209</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;milkbot&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-210"><a href="#lactation_curve_characteristic_function-210"><span class="linenos">210</span></a>        <span class="c1"># === MILKBOT ===</span>
</span><span id="lactation_curve_characteristic_function-211"><a href="#lactation_curve_characteristic_function-211"><span class="linenos">211</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a b c d t&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-212"><a href="#lactation_curve_characteristic_function-212"><span class="linenos">212</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">exp</span><span class="p">((</span><span class="n">c</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">d</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-213"><a href="#lactation_curve_characteristic_function-213"><span class="linenos">213</span></a>
</span><span id="lactation_curve_characteristic_function-214"><a href="#lactation_curve_characteristic_function-214"><span class="linenos">214</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-215"><a href="#lactation_curve_characteristic_function-215"><span class="linenos">215</span></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unknown model&quot;</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-216"><a href="#lactation_curve_characteristic_function-216"><span class="linenos">216</span></a>
</span><span id="lactation_curve_characteristic_function-217"><a href="#lactation_curve_characteristic_function-217"><span class="linenos">217</span></a>    <span class="c1"># find derivative</span>
</span><span id="lactation_curve_characteristic_function-218"><a href="#lactation_curve_characteristic_function-218"><span class="linenos">218</span></a>    <span class="n">fdiff</span> <span class="o">=</span> <span class="n">diff</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-219"><a href="#lactation_curve_characteristic_function-219"><span class="linenos">219</span></a>    <span class="c1"># solve derivative for when it is zero to find the function for time of peak</span>
</span><span id="lactation_curve_characteristic_function-220"><a href="#lactation_curve_characteristic_function-220"><span class="linenos">220</span></a>    <span class="n">tpeak</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">fdiff</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-221"><a href="#lactation_curve_characteristic_function-221"><span class="linenos">221</span></a>
</span><span id="lactation_curve_characteristic_function-222"><a href="#lactation_curve_characteristic_function-222"><span class="linenos">222</span></a>    <span class="c1"># define the end of lactation</span>
</span><span id="lactation_curve_characteristic_function-223"><a href="#lactation_curve_characteristic_function-223"><span class="linenos">223</span></a>    <span class="n">T</span> <span class="o">=</span> <span class="n">lactation_length</span>  <span class="c1"># days in milk</span>
</span><span id="lactation_curve_characteristic_function-224"><a href="#lactation_curve_characteristic_function-224"><span class="linenos">224</span></a>
</span><span id="lactation_curve_characteristic_function-225"><a href="#lactation_curve_characteristic_function-225"><span class="linenos">225</span></a>    <span class="c1"># Persistency = average slope after peak, does not work for all models so therefore try except</span>
</span><span id="lactation_curve_characteristic_function-226"><a href="#lactation_curve_characteristic_function-226"><span class="linenos">226</span></a>    <span class="n">persistency</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="lactation_curve_characteristic_function-227"><a href="#lactation_curve_characteristic_function-227"><span class="linenos">227</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-228"><a href="#lactation_curve_characteristic_function-228"><span class="linenos">228</span></a>        <span class="k">if</span> <span class="n">tpeak</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-229"><a href="#lactation_curve_characteristic_function-229"><span class="linenos">229</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span> <span class="o">-</span> <span class="n">function</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">tpeak</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">/</span> <span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="n">tpeak</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="lactation_curve_characteristic_function-230"><a href="#lactation_curve_characteristic_function-230"><span class="linenos">230</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>  <span class="c1"># light simplification</span>
</span><span id="lactation_curve_characteristic_function-231"><a href="#lactation_curve_characteristic_function-231"><span class="linenos">231</span></a>            <span class="k">if</span> <span class="n">is_valid_sympy_expr</span><span class="p">(</span><span class="n">tmp</span><span class="p">):</span>
</span><span id="lactation_curve_characteristic_function-232"><a href="#lactation_curve_characteristic_function-232"><span class="linenos">232</span></a>                <span class="n">persistency</span> <span class="o">=</span> <span class="n">tmp</span>
</span><span id="lactation_curve_characteristic_function-233"><a href="#lactation_curve_characteristic_function-233"><span class="linenos">233</span></a>    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-234"><a href="#lactation_curve_characteristic_function-234"><span class="linenos">234</span></a>        <span class="n">persistency</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="lactation_curve_characteristic_function-235"><a href="#lactation_curve_characteristic_function-235"><span class="linenos">235</span></a>
</span><span id="lactation_curve_characteristic_function-236"><a href="#lactation_curve_characteristic_function-236"><span class="linenos">236</span></a>    <span class="k">if</span> <span class="n">characteristic</span> <span class="o">!=</span> <span class="s1">&#39;cumulative_milk_yield&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-237"><a href="#lactation_curve_characteristic_function-237"><span class="linenos">237</span></a>        <span class="k">if</span> <span class="n">tpeak</span><span class="p">:</span>  <span class="c1"># Check if the list is not empty</span>
</span><span id="lactation_curve_characteristic_function-238"><a href="#lactation_curve_characteristic_function-238"><span class="linenos">238</span></a>            <span class="n">peak_expr</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">tpeak</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="lactation_curve_characteristic_function-239"><a href="#lactation_curve_characteristic_function-239"><span class="linenos">239</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-240"><a href="#lactation_curve_characteristic_function-240"><span class="linenos">240</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;No positive real solution for time to peak and peak yield found&#39;</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-241"><a href="#lactation_curve_characteristic_function-241"><span class="linenos">241</span></a>
</span><span id="lactation_curve_characteristic_function-242"><a href="#lactation_curve_characteristic_function-242"><span class="linenos">242</span></a>    <span class="c1"># find function for cumulative milk yield over the first 305 days of the lactation</span>
</span><span id="lactation_curve_characteristic_function-243"><a href="#lactation_curve_characteristic_function-243"><span class="linenos">243</span></a>    <span class="n">cum_my_expr</span> <span class="o">=</span> <span class="n">integrate</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">305</span><span class="p">))</span>
</span><span id="lactation_curve_characteristic_function-244"><a href="#lactation_curve_characteristic_function-244"><span class="linenos">244</span></a>
</span><span id="lactation_curve_characteristic_function-245"><a href="#lactation_curve_characteristic_function-245"><span class="linenos">245</span></a>    <span class="c1"># Sorted parameter list (exclude t)</span>
</span><span id="lactation_curve_characteristic_function-246"><a href="#lactation_curve_characteristic_function-246"><span class="linenos">246</span></a>    <span class="n">params</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">([</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">function</span><span class="o">.</span><span class="n">free_symbols</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;t&quot;</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</span><span id="lactation_curve_characteristic_function-247"><a href="#lactation_curve_characteristic_function-247"><span class="linenos">247</span></a>
</span><span id="lactation_curve_characteristic_function-248"><a href="#lactation_curve_characteristic_function-248"><span class="linenos">248</span></a>    <span class="c1"># ----------------------------------------------------</span>
</span><span id="lactation_curve_characteristic_function-249"><a href="#lactation_curve_characteristic_function-249"><span class="linenos">249</span></a>    <span class="c1"># Select requested characteristic</span>
</span><span id="lactation_curve_characteristic_function-250"><a href="#lactation_curve_characteristic_function-250"><span class="linenos">250</span></a>    <span class="c1"># ----------------------------------------------------</span>
</span><span id="lactation_curve_characteristic_function-251"><a href="#lactation_curve_characteristic_function-251"><span class="linenos">251</span></a>    <span class="k">if</span> <span class="n">characteristic</span> <span class="o">==</span> <span class="s2">&quot;time_to_peak&quot;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-252"><a href="#lactation_curve_characteristic_function-252"><span class="linenos">252</span></a>        <span class="n">expr</span> <span class="o">=</span> <span class="n">tpeak</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="lactation_curve_characteristic_function-253"><a href="#lactation_curve_characteristic_function-253"><span class="linenos">253</span></a>    <span class="k">elif</span> <span class="n">characteristic</span> <span class="o">==</span> <span class="s2">&quot;peak_yield&quot;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-254"><a href="#lactation_curve_characteristic_function-254"><span class="linenos">254</span></a>        <span class="n">expr</span> <span class="o">=</span> <span class="n">peak_expr</span>
</span><span id="lactation_curve_characteristic_function-255"><a href="#lactation_curve_characteristic_function-255"><span class="linenos">255</span></a>    <span class="k">elif</span> <span class="n">characteristic</span> <span class="o">==</span> <span class="s2">&quot;cumulative_milk_yield&quot;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-256"><a href="#lactation_curve_characteristic_function-256"><span class="linenos">256</span></a>        <span class="n">expr</span> <span class="o">=</span> <span class="n">cum_my_expr</span>
</span><span id="lactation_curve_characteristic_function-257"><a href="#lactation_curve_characteristic_function-257"><span class="linenos">257</span></a>    <span class="k">elif</span> <span class="n">characteristic</span> <span class="o">==</span> <span class="s1">&#39;persistency&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-258"><a href="#lactation_curve_characteristic_function-258"><span class="linenos">258</span></a>        <span class="k">if</span> <span class="n">persistency</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-259"><a href="#lactation_curve_characteristic_function-259"><span class="linenos">259</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Persistency could not be computed symbolically&quot;</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-260"><a href="#lactation_curve_characteristic_function-260"><span class="linenos">260</span></a>        <span class="n">expr</span> <span class="o">=</span> <span class="n">persistency</span>
</span><span id="lactation_curve_characteristic_function-261"><a href="#lactation_curve_characteristic_function-261"><span class="linenos">261</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-262"><a href="#lactation_curve_characteristic_function-262"><span class="linenos">262</span></a>        <span class="c1"># Return all four if None or &#39;all&#39;</span>
</span><span id="lactation_curve_characteristic_function-263"><a href="#lactation_curve_characteristic_function-263"><span class="linenos">263</span></a>        <span class="n">expr</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="lactation_curve_characteristic_function-264"><a href="#lactation_curve_characteristic_function-264"><span class="linenos">264</span></a>            <span class="s2">&quot;time_to_peak&quot;</span><span class="p">:</span> <span class="n">tpeak</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="lactation_curve_characteristic_function-265"><a href="#lactation_curve_characteristic_function-265"><span class="linenos">265</span></a>            <span class="s2">&quot;peak_yield&quot;</span><span class="p">:</span> <span class="n">peak_expr</span><span class="p">,</span>
</span><span id="lactation_curve_characteristic_function-266"><a href="#lactation_curve_characteristic_function-266"><span class="linenos">266</span></a>            <span class="s2">&quot;persistency&quot;</span><span class="p">:</span> <span class="n">persistency</span><span class="p">,</span>  <span class="c1"># possibly None</span>
</span><span id="lactation_curve_characteristic_function-267"><a href="#lactation_curve_characteristic_function-267"><span class="linenos">267</span></a>            <span class="s2">&quot;cumulative_milk_yield&quot;</span><span class="p">:</span> <span class="n">cum_my_expr</span><span class="p">,</span>
</span><span id="lactation_curve_characteristic_function-268"><a href="#lactation_curve_characteristic_function-268"><span class="linenos">268</span></a>        <span class="p">}</span>
</span><span id="lactation_curve_characteristic_function-269"><a href="#lactation_curve_characteristic_function-269"><span class="linenos">269</span></a>
</span><span id="lactation_curve_characteristic_function-270"><a href="#lactation_curve_characteristic_function-270"><span class="linenos">270</span></a>    <span class="c1"># ----------------------------------------------------</span>
</span><span id="lactation_curve_characteristic_function-271"><a href="#lactation_curve_characteristic_function-271"><span class="linenos">271</span></a>    <span class="c1"># Build fast numeric function with lambdify</span>
</span><span id="lactation_curve_characteristic_function-272"><a href="#lactation_curve_characteristic_function-272"><span class="linenos">272</span></a>    <span class="c1"># ----------------------------------------------------</span>
</span><span id="lactation_curve_characteristic_function-273"><a href="#lactation_curve_characteristic_function-273"><span class="linenos">273</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="lactation_curve_characteristic_function-274"><a href="#lactation_curve_characteristic_function-274"><span class="linenos">274</span></a>        <span class="n">func</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">lambdify</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">ex</span><span class="p">,</span> <span class="n">modules</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;numpy&quot;</span><span class="p">,</span> <span class="s1">&#39;scipy&#39;</span><span class="p">])</span>
</span><span id="lactation_curve_characteristic_function-275"><a href="#lactation_curve_characteristic_function-275"><span class="linenos">275</span></a>                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">ex</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="lactation_curve_characteristic_function-276"><a href="#lactation_curve_characteristic_function-276"><span class="linenos">276</span></a>                <span class="k">if</span> <span class="n">ex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
</span><span id="lactation_curve_characteristic_function-277"><a href="#lactation_curve_characteristic_function-277"><span class="linenos">277</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-278"><a href="#lactation_curve_characteristic_function-278"><span class="linenos">278</span></a>        <span class="n">func</span> <span class="o">=</span> <span class="n">lambdify</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">modules</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;numpy&quot;</span><span class="p">,</span> <span class="s1">&#39;scipy&#39;</span><span class="p">])</span>
</span><span id="lactation_curve_characteristic_function-279"><a href="#lactation_curve_characteristic_function-279"><span class="linenos">279</span></a>
</span><span id="lactation_curve_characteristic_function-280"><a href="#lactation_curve_characteristic_function-280"><span class="linenos">280</span></a>    <span class="c1"># ----------------------------------------------------</span>
</span><span id="lactation_curve_characteristic_function-281"><a href="#lactation_curve_characteristic_function-281"><span class="linenos">281</span></a>    <span class="c1"># Store in cache</span>
</span><span id="lactation_curve_characteristic_function-282"><a href="#lactation_curve_characteristic_function-282"><span class="linenos">282</span></a>    <span class="c1"># ----------------------------------------------------</span>
</span><span id="lactation_curve_characteristic_function-283"><a href="#lactation_curve_characteristic_function-283"><span class="linenos">283</span></a>    <span class="n">_LCC_CACHE</span><span class="p">[</span><span class="n">storage</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="lactation_curve_characteristic_function-284"><a href="#lactation_curve_characteristic_function-284"><span class="linenos">284</span></a>        <span class="s2">&quot;expr&quot;</span><span class="p">:</span> <span class="n">expr</span><span class="p">,</span>
</span><span id="lactation_curve_characteristic_function-285"><a href="#lactation_curve_characteristic_function-285"><span class="linenos">285</span></a>        <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">,</span>
</span><span id="lactation_curve_characteristic_function-286"><a href="#lactation_curve_characteristic_function-286"><span class="linenos">286</span></a>        <span class="s2">&quot;func&quot;</span><span class="p">:</span> <span class="n">func</span>
</span><span id="lactation_curve_characteristic_function-287"><a href="#lactation_curve_characteristic_function-287"><span class="linenos">287</span></a>    <span class="p">}</span>
</span><span id="lactation_curve_characteristic_function-288"><a href="#lactation_curve_characteristic_function-288"><span class="linenos">288</span></a>
</span><span id="lactation_curve_characteristic_function-289"><a href="#lactation_curve_characteristic_function-289"><span class="linenos">289</span></a>    <span class="k">return</span> <span class="n">expr</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">func</span>
</span></pre></div>


            <div class="docstring"><p>Build (or fetch from cache) a symbolic expression and fast numeric function for an LCC.</p>

<p>This function derives the requested <strong>lactation curve characteristic</strong> for a given
model using SymPy (derivative / root finding / integration). It returns the symbolic
expression, the tuple of parameter symbols (argument order), and a lambdified
numeric function that can be evaluated with numerical parameters.</p>

<p>The symbolic derivation and integration are done only once per (model, characteristic)
and then <strong>cached</strong> for reuse.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model (str):</strong>  Model name. Options:
'milkbot', 'wood', 'wilmink', 'ali_schaeffer', 'fischer',
'brody', 'sikka', 'nelder', 'dhanoa', 'emmans', 'hayashi',
'rook', 'dijkstra', 'prasad'.</li>
<li><strong>characteristic (str | None):</strong>  Desired characteristic. Options:
'time_to_peak', 'peak_yield', 'cumulative_milk_yield', 'persistency'.
If <code>None</code> or unrecognized, a dict of all available characteristics is returned
(with <code>persistency</code> possibly <code>None</code> if derivation is not feasible).</li>
<li><strong>lactation_length (int):</strong>  Length of lactation in days used in persistency
computation (default 305).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>tuple:
      expr: SymPy expression (or dict of expressions if <code>characteristic</code> is None).
      params: Tuple of SymPy symbols for model parameters (argument order).
      func: Lambdified numeric function <code>f(*params)</code> (or dict of functions).</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>Exception:</strong>  If the model is unknown, or if no positive real solution for
peak timing/yield exists where required.</li>
</ul>
</div>


                </section>
                <section id="numeric_cumulative_yield">
                            <input id="numeric_cumulative_yield-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">numeric_cumulative_yield</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dim</span>,</span><span class="param">	<span class="n">milkrecordings</span>,</span><span class="param">	<span class="n">model</span>,</span><span class="param">	<span class="n">fitting</span><span class="o">=</span><span class="s1">&#39;frequentist&#39;</span>,</span><span class="param">	<span class="n">lactation_length</span><span class="o">=</span><span class="mi">305</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="numeric_cumulative_yield-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#numeric_cumulative_yield"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="numeric_cumulative_yield-469"><a href="#numeric_cumulative_yield-469"><span class="linenos">469</span></a><span class="k">def</span><span class="w"> </span><span class="nf">numeric_cumulative_yield</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fitting</span><span class="o">=</span><span class="s1">&#39;frequentist&#39;</span><span class="p">,</span> <span class="n">lactation_length</span><span class="o">=</span><span class="mi">305</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="numeric_cumulative_yield-470"><a href="#numeric_cumulative_yield-470"><span class="linenos">470</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute cumulative milk yield numerically over a given horizon.</span>
</span><span id="numeric_cumulative_yield-471"><a href="#numeric_cumulative_yield-471"><span class="linenos">471</span></a>
</span><span id="numeric_cumulative_yield-472"><a href="#numeric_cumulative_yield-472"><span class="linenos">472</span></a><span class="sd">    Adds up the fitted milk yield for the first `lactation_length` days of the</span>
</span><span id="numeric_cumulative_yield-473"><a href="#numeric_cumulative_yield-473"><span class="linenos">473</span></a><span class="sd">    predicted yield curve.</span>
</span><span id="numeric_cumulative_yield-474"><a href="#numeric_cumulative_yield-474"><span class="linenos">474</span></a>
</span><span id="numeric_cumulative_yield-475"><a href="#numeric_cumulative_yield-475"><span class="linenos">475</span></a><span class="sd">    Args:</span>
</span><span id="numeric_cumulative_yield-476"><a href="#numeric_cumulative_yield-476"><span class="linenos">476</span></a><span class="sd">        dim: DIM values.</span>
</span><span id="numeric_cumulative_yield-477"><a href="#numeric_cumulative_yield-477"><span class="linenos">477</span></a><span class="sd">        milkrecordings: Milk recordings (kg).</span>
</span><span id="numeric_cumulative_yield-478"><a href="#numeric_cumulative_yield-478"><span class="linenos">478</span></a><span class="sd">        model: Model name.</span>
</span><span id="numeric_cumulative_yield-479"><a href="#numeric_cumulative_yield-479"><span class="linenos">479</span></a><span class="sd">        fitting: &#39;frequentist&#39; or &#39;bayesian&#39;.</span>
</span><span id="numeric_cumulative_yield-480"><a href="#numeric_cumulative_yield-480"><span class="linenos">480</span></a><span class="sd">        lactation_length: Number of days to integrate (default 305).</span>
</span><span id="numeric_cumulative_yield-481"><a href="#numeric_cumulative_yield-481"><span class="linenos">481</span></a><span class="sd">        **kwargs: Additional arguments forwarded to `fit_lactation_curve`.</span>
</span><span id="numeric_cumulative_yield-482"><a href="#numeric_cumulative_yield-482"><span class="linenos">482</span></a>
</span><span id="numeric_cumulative_yield-483"><a href="#numeric_cumulative_yield-483"><span class="linenos">483</span></a><span class="sd">    Returns:</span>
</span><span id="numeric_cumulative_yield-484"><a href="#numeric_cumulative_yield-484"><span class="linenos">484</span></a><span class="sd">        float: Cumulative milk yield over the specified horizon.</span>
</span><span id="numeric_cumulative_yield-485"><a href="#numeric_cumulative_yield-485"><span class="linenos">485</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="numeric_cumulative_yield-486"><a href="#numeric_cumulative_yield-486"><span class="linenos">486</span></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">fit_lactation_curve</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fitting</span><span class="o">=</span><span class="n">fitting</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="numeric_cumulative_yield-487"><a href="#numeric_cumulative_yield-487"><span class="linenos">487</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">trapezoid</span><span class="p">(</span><span class="n">y</span><span class="p">[:</span><span class="n">lactation_length</span><span class="p">],</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Compute cumulative milk yield numerically over a given horizon.</p>

<p>Adds up the fitted milk yield for the first <code>lactation_length</code> days of the
predicted yield curve.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>dim:</strong>  DIM values.</li>
<li><strong>milkrecordings:</strong>  Milk recordings (kg).</li>
<li><strong>model:</strong>  Model name.</li>
<li><strong>fitting:</strong>  'frequentist' or 'bayesian'.</li>
<li><strong>lactation_length:</strong>  Number of days to integrate (default 305).</li>
<li><strong>**kwargs:</strong>  Additional arguments forwarded to <code>fit_lactation_curve</code>.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>float: Cumulative milk yield over the specified horizon.</p>
</blockquote>
</div>


                </section>
                <section id="numeric_peak_yield">
                            <input id="numeric_peak_yield-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">numeric_peak_yield</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dim</span>,</span><span class="param">	<span class="n">milkrecordings</span>,</span><span class="param">	<span class="n">model</span>,</span><span class="param">	<span class="n">fitting</span><span class="o">=</span><span class="s1">&#39;frequentist&#39;</span>,</span><span class="param">	<span class="n">key</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">parity</span><span class="o">=</span><span class="mi">3</span>,</span><span class="param">	<span class="n">breed</span><span class="o">=</span><span class="s1">&#39;H&#39;</span>,</span><span class="param">	<span class="n">continent</span><span class="o">=</span><span class="s1">&#39;USA&#39;</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="numeric_peak_yield-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#numeric_peak_yield"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="numeric_peak_yield-490"><a href="#numeric_peak_yield-490"><span class="linenos">490</span></a><span class="k">def</span><span class="w"> </span><span class="nf">numeric_peak_yield</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fitting</span><span class="o">=</span><span class="s1">&#39;frequentist&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parity</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="numeric_peak_yield-491"><a href="#numeric_peak_yield-491"><span class="linenos">491</span></a>                       <span class="n">breed</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">continent</span><span class="o">=</span><span class="s1">&#39;USA&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="numeric_peak_yield-492"><a href="#numeric_peak_yield-492"><span class="linenos">492</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute peak yield numerically from the fitted curve.</span>
</span><span id="numeric_peak_yield-493"><a href="#numeric_peak_yield-493"><span class="linenos">493</span></a>
</span><span id="numeric_peak_yield-494"><a href="#numeric_peak_yield-494"><span class="linenos">494</span></a><span class="sd">    Args:</span>
</span><span id="numeric_peak_yield-495"><a href="#numeric_peak_yield-495"><span class="linenos">495</span></a><span class="sd">        dim: DIM values.</span>
</span><span id="numeric_peak_yield-496"><a href="#numeric_peak_yield-496"><span class="linenos">496</span></a><span class="sd">        milkrecordings: Milk recordings (kg).</span>
</span><span id="numeric_peak_yield-497"><a href="#numeric_peak_yield-497"><span class="linenos">497</span></a><span class="sd">        model: Model name.</span>
</span><span id="numeric_peak_yield-498"><a href="#numeric_peak_yield-498"><span class="linenos">498</span></a><span class="sd">        fitting: &#39;frequentist&#39; or &#39;bayesian&#39;.</span>
</span><span id="numeric_peak_yield-499"><a href="#numeric_peak_yield-499"><span class="linenos">499</span></a><span class="sd">        key: API key for MilkBot (Bayesian).</span>
</span><span id="numeric_peak_yield-500"><a href="#numeric_peak_yield-500"><span class="linenos">500</span></a><span class="sd">        parity: Parity for Bayesian fitting.</span>
</span><span id="numeric_peak_yield-501"><a href="#numeric_peak_yield-501"><span class="linenos">501</span></a><span class="sd">        breed: Breed for Bayesian fitting (&#39;H&#39; or &#39;J&#39;).</span>
</span><span id="numeric_peak_yield-502"><a href="#numeric_peak_yield-502"><span class="linenos">502</span></a><span class="sd">        continent: Prior source for Bayesian (&#39;USA&#39;, &#39;EU&#39;, &#39;CHEN&#39;).</span>
</span><span id="numeric_peak_yield-503"><a href="#numeric_peak_yield-503"><span class="linenos">503</span></a>
</span><span id="numeric_peak_yield-504"><a href="#numeric_peak_yield-504"><span class="linenos">504</span></a><span class="sd">    Returns:</span>
</span><span id="numeric_peak_yield-505"><a href="#numeric_peak_yield-505"><span class="linenos">505</span></a><span class="sd">        float: Maximum predicted milk yield.</span>
</span><span id="numeric_peak_yield-506"><a href="#numeric_peak_yield-506"><span class="linenos">506</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="numeric_peak_yield-507"><a href="#numeric_peak_yield-507"><span class="linenos">507</span></a>    <span class="c1"># Fit the curve to get predicted milk yields</span>
</span><span id="numeric_peak_yield-508"><a href="#numeric_peak_yield-508"><span class="linenos">508</span></a>    <span class="n">yields</span> <span class="o">=</span> <span class="n">fit_lactation_curve</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fitting</span><span class="o">=</span><span class="n">fitting</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">parity</span><span class="o">=</span><span class="n">parity</span><span class="p">,</span> <span class="n">breed</span><span class="o">=</span><span class="n">breed</span><span class="p">,</span> <span class="n">continent</span><span class="o">=</span><span class="n">continent</span><span class="p">)</span>
</span><span id="numeric_peak_yield-509"><a href="#numeric_peak_yield-509"><span class="linenos">509</span></a>    <span class="c1"># Find the peak yield</span>
</span><span id="numeric_peak_yield-510"><a href="#numeric_peak_yield-510"><span class="linenos">510</span></a>    <span class="n">peak_yield</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">yields</span><span class="p">)</span>
</span><span id="numeric_peak_yield-511"><a href="#numeric_peak_yield-511"><span class="linenos">511</span></a>    <span class="k">return</span> <span class="n">peak_yield</span>
</span></pre></div>


            <div class="docstring"><p>Compute peak yield numerically from the fitted curve.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>dim:</strong>  DIM values.</li>
<li><strong>milkrecordings:</strong>  Milk recordings (kg).</li>
<li><strong>model:</strong>  Model name.</li>
<li><strong>fitting:</strong>  'frequentist' or 'bayesian'.</li>
<li><strong>key:</strong>  API key for MilkBot (Bayesian).</li>
<li><strong>parity:</strong>  Parity for Bayesian fitting.</li>
<li><strong>breed:</strong>  Breed for Bayesian fitting ('H' or 'J').</li>
<li><strong>continent:</strong>  Prior source for Bayesian ('USA', 'EU', 'CHEN').</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>float: Maximum predicted milk yield.</p>
</blockquote>
</div>


                </section>
                <section id="numeric_time_to_peak">
                            <input id="numeric_time_to_peak-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">numeric_time_to_peak</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dim</span>,</span><span class="param">	<span class="n">milkrecordings</span>,</span><span class="param">	<span class="n">model</span>,</span><span class="param">	<span class="n">fitting</span><span class="o">=</span><span class="s1">&#39;frequentist&#39;</span>,</span><span class="param">	<span class="n">key</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">parity</span><span class="o">=</span><span class="mi">3</span>,</span><span class="param">	<span class="n">breed</span><span class="o">=</span><span class="s1">&#39;H&#39;</span>,</span><span class="param">	<span class="n">continent</span><span class="o">=</span><span class="s1">&#39;USA&#39;</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="numeric_time_to_peak-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#numeric_time_to_peak"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="numeric_time_to_peak-441"><a href="#numeric_time_to_peak-441"><span class="linenos">441</span></a><span class="k">def</span><span class="w"> </span><span class="nf">numeric_time_to_peak</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fitting</span><span class="o">=</span><span class="s1">&#39;frequentist&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parity</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="numeric_time_to_peak-442"><a href="#numeric_time_to_peak-442"><span class="linenos">442</span></a>                         <span class="n">breed</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">continent</span><span class="o">=</span><span class="s1">&#39;USA&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="numeric_time_to_peak-443"><a href="#numeric_time_to_peak-443"><span class="linenos">443</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute time to peak using a numeric approach.</span>
</span><span id="numeric_time_to_peak-444"><a href="#numeric_time_to_peak-444"><span class="linenos">444</span></a>
</span><span id="numeric_time_to_peak-445"><a href="#numeric_time_to_peak-445"><span class="linenos">445</span></a><span class="sd">    Fits the curve (frequentist or Bayesian), evaluates the predicted yields,</span>
</span><span id="numeric_time_to_peak-446"><a href="#numeric_time_to_peak-446"><span class="linenos">446</span></a><span class="sd">    and returns the DIM corresponding to the maximum predicted yield.</span>
</span><span id="numeric_time_to_peak-447"><a href="#numeric_time_to_peak-447"><span class="linenos">447</span></a>
</span><span id="numeric_time_to_peak-448"><a href="#numeric_time_to_peak-448"><span class="linenos">448</span></a><span class="sd">    Args:</span>
</span><span id="numeric_time_to_peak-449"><a href="#numeric_time_to_peak-449"><span class="linenos">449</span></a><span class="sd">        dim: DIM values.</span>
</span><span id="numeric_time_to_peak-450"><a href="#numeric_time_to_peak-450"><span class="linenos">450</span></a><span class="sd">        milkrecordings: Milk recordings (kg).</span>
</span><span id="numeric_time_to_peak-451"><a href="#numeric_time_to_peak-451"><span class="linenos">451</span></a><span class="sd">        model: Model name.</span>
</span><span id="numeric_time_to_peak-452"><a href="#numeric_time_to_peak-452"><span class="linenos">452</span></a><span class="sd">        fitting: &#39;frequentist&#39; or &#39;bayesian&#39;.</span>
</span><span id="numeric_time_to_peak-453"><a href="#numeric_time_to_peak-453"><span class="linenos">453</span></a><span class="sd">        key: API key for MilkBot (Bayesian).</span>
</span><span id="numeric_time_to_peak-454"><a href="#numeric_time_to_peak-454"><span class="linenos">454</span></a><span class="sd">        parity: Parity for Bayesian fitting.</span>
</span><span id="numeric_time_to_peak-455"><a href="#numeric_time_to_peak-455"><span class="linenos">455</span></a><span class="sd">        breed: Breed for Bayesian fitting (&#39;H&#39; or &#39;J&#39;).</span>
</span><span id="numeric_time_to_peak-456"><a href="#numeric_time_to_peak-456"><span class="linenos">456</span></a><span class="sd">        continent: Prior source for Bayesian (&#39;USA&#39;, &#39;EU&#39;, &#39;CHEN&#39;).</span>
</span><span id="numeric_time_to_peak-457"><a href="#numeric_time_to_peak-457"><span class="linenos">457</span></a>
</span><span id="numeric_time_to_peak-458"><a href="#numeric_time_to_peak-458"><span class="linenos">458</span></a><span class="sd">    Returns:</span>
</span><span id="numeric_time_to_peak-459"><a href="#numeric_time_to_peak-459"><span class="linenos">459</span></a><span class="sd">        int: DIM at which the curve attains its maximum (1-indexed).</span>
</span><span id="numeric_time_to_peak-460"><a href="#numeric_time_to_peak-460"><span class="linenos">460</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="numeric_time_to_peak-461"><a href="#numeric_time_to_peak-461"><span class="linenos">461</span></a>    <span class="c1"># Fit the curve to get predicted milk yields</span>
</span><span id="numeric_time_to_peak-462"><a href="#numeric_time_to_peak-462"><span class="linenos">462</span></a>    <span class="n">yields</span> <span class="o">=</span> <span class="n">fit_lactation_curve</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fitting</span><span class="o">=</span><span class="n">fitting</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">parity</span><span class="o">=</span><span class="n">parity</span><span class="p">,</span> <span class="n">breed</span><span class="o">=</span><span class="n">breed</span><span class="p">,</span> <span class="n">continent</span><span class="o">=</span><span class="n">continent</span><span class="p">)</span>
</span><span id="numeric_time_to_peak-463"><a href="#numeric_time_to_peak-463"><span class="linenos">463</span></a>    <span class="c1"># Find the index of the peak yield</span>
</span><span id="numeric_time_to_peak-464"><a href="#numeric_time_to_peak-464"><span class="linenos">464</span></a>    <span class="n">peak_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">yields</span><span class="p">)</span>
</span><span id="numeric_time_to_peak-465"><a href="#numeric_time_to_peak-465"><span class="linenos">465</span></a>    <span class="c1"># Return the corresponding DIM</span>
</span><span id="numeric_time_to_peak-466"><a href="#numeric_time_to_peak-466"><span class="linenos">466</span></a>    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">peak_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># +1 because DIM starts at 1, not 0</span>
</span></pre></div>


            <div class="docstring"><p>Compute time to peak using a numeric approach.</p>

<p>Fits the curve (frequentist or Bayesian), evaluates the predicted yields,
and returns the DIM corresponding to the maximum predicted yield.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>dim:</strong>  DIM values.</li>
<li><strong>milkrecordings:</strong>  Milk recordings (kg).</li>
<li><strong>model:</strong>  Model name.</li>
<li><strong>fitting:</strong>  'frequentist' or 'bayesian'.</li>
<li><strong>key:</strong>  API key for MilkBot (Bayesian).</li>
<li><strong>parity:</strong>  Parity for Bayesian fitting.</li>
<li><strong>breed:</strong>  Breed for Bayesian fitting ('H' or 'J').</li>
<li><strong>continent:</strong>  Prior source for Bayesian ('USA', 'EU', 'CHEN').</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>int: DIM at which the curve attains its maximum (1-indexed).</p>
</blockquote>
</div>


                </section>
                <section id="persistency_fitted_curve">
                            <input id="persistency_fitted_curve-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">persistency_fitted_curve</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dim</span>,</span><span class="param">	<span class="n">milkrecordings</span>,</span><span class="param">	<span class="n">model</span>,</span><span class="param">	<span class="n">fitting</span><span class="o">=</span><span class="s1">&#39;frequentist&#39;</span>,</span><span class="param">	<span class="n">key</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">parity</span><span class="o">=</span><span class="mi">3</span>,</span><span class="param">	<span class="n">breed</span><span class="o">=</span><span class="s1">&#39;H&#39;</span>,</span><span class="param">	<span class="n">continent</span><span class="o">=</span><span class="s1">&#39;USA&#39;</span>,</span><span class="param">	<span class="n">lactation_length</span><span class="o">=</span><span class="mi">305</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="persistency_fitted_curve-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#persistency_fitted_curve"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="persistency_fitted_curve-539"><a href="#persistency_fitted_curve-539"><span class="linenos">539</span></a><span class="k">def</span><span class="w"> </span><span class="nf">persistency_fitted_curve</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fitting</span><span class="o">=</span><span class="s1">&#39;frequentist&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parity</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="persistency_fitted_curve-540"><a href="#persistency_fitted_curve-540"><span class="linenos">540</span></a>                             <span class="n">breed</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">continent</span><span class="o">=</span><span class="s1">&#39;USA&#39;</span><span class="p">,</span> <span class="n">lactation_length</span><span class="o">=</span><span class="mi">305</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="persistency_fitted_curve-541"><a href="#persistency_fitted_curve-541"><span class="linenos">541</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Persistency as the average slope after peak until end of lactation (numeric).</span>
</span><span id="persistency_fitted_curve-542"><a href="#persistency_fitted_curve-542"><span class="linenos">542</span></a>
</span><span id="persistency_fitted_curve-543"><a href="#persistency_fitted_curve-543"><span class="linenos">543</span></a><span class="sd">    This is the default approach because symbolic derivation is not feasible for</span>
</span><span id="persistency_fitted_curve-544"><a href="#persistency_fitted_curve-544"><span class="linenos">544</span></a><span class="sd">    all models. It computes:</span>
</span><span id="persistency_fitted_curve-545"><a href="#persistency_fitted_curve-545"><span class="linenos">545</span></a><span class="sd">        `(yield_at_end - yield_at_peak) / (lactation_length - time_to_peak)`</span>
</span><span id="persistency_fitted_curve-546"><a href="#persistency_fitted_curve-546"><span class="linenos">546</span></a>
</span><span id="persistency_fitted_curve-547"><a href="#persistency_fitted_curve-547"><span class="linenos">547</span></a><span class="sd">    Args:</span>
</span><span id="persistency_fitted_curve-548"><a href="#persistency_fitted_curve-548"><span class="linenos">548</span></a><span class="sd">        dim: DIM values.</span>
</span><span id="persistency_fitted_curve-549"><a href="#persistency_fitted_curve-549"><span class="linenos">549</span></a><span class="sd">        milkrecordings: Milk recordings (kg).</span>
</span><span id="persistency_fitted_curve-550"><a href="#persistency_fitted_curve-550"><span class="linenos">550</span></a><span class="sd">        model: Model name. Options include &#39;milkbot&#39; (Bayesian or frequentist),</span>
</span><span id="persistency_fitted_curve-551"><a href="#persistency_fitted_curve-551"><span class="linenos">551</span></a><span class="sd">            &#39;wood&#39;, &#39;wilmink&#39;, &#39;ali_schaeffer&#39;, &#39;fischer&#39;.</span>
</span><span id="persistency_fitted_curve-552"><a href="#persistency_fitted_curve-552"><span class="linenos">552</span></a><span class="sd">        fitting: &#39;frequentist&#39; or &#39;bayesian&#39;.</span>
</span><span id="persistency_fitted_curve-553"><a href="#persistency_fitted_curve-553"><span class="linenos">553</span></a><span class="sd">        key: API key (only for Bayesian fitting).</span>
</span><span id="persistency_fitted_curve-554"><a href="#persistency_fitted_curve-554"><span class="linenos">554</span></a><span class="sd">        parity: Parity of the cow; values above 3 treated as 3 (Bayesian).</span>
</span><span id="persistency_fitted_curve-555"><a href="#persistency_fitted_curve-555"><span class="linenos">555</span></a><span class="sd">        breed: &#39;H&#39; or &#39;J&#39; (Bayesian).</span>
</span><span id="persistency_fitted_curve-556"><a href="#persistency_fitted_curve-556"><span class="linenos">556</span></a><span class="sd">        continent: &#39;USA&#39;, &#39;EU&#39;, or &#39;CHEN&#39; (Bayesian).</span>
</span><span id="persistency_fitted_curve-557"><a href="#persistency_fitted_curve-557"><span class="linenos">557</span></a><span class="sd">        lactation_length (int | str): 305 (default), &#39;max&#39; (use max DIM), or integer.</span>
</span><span id="persistency_fitted_curve-558"><a href="#persistency_fitted_curve-558"><span class="linenos">558</span></a>
</span><span id="persistency_fitted_curve-559"><a href="#persistency_fitted_curve-559"><span class="linenos">559</span></a><span class="sd">    Returns:</span>
</span><span id="persistency_fitted_curve-560"><a href="#persistency_fitted_curve-560"><span class="linenos">560</span></a><span class="sd">        float: Average slope after the peak until end of lactation.</span>
</span><span id="persistency_fitted_curve-561"><a href="#persistency_fitted_curve-561"><span class="linenos">561</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="persistency_fitted_curve-562"><a href="#persistency_fitted_curve-562"><span class="linenos">562</span></a>    <span class="c1"># calculate time to peak</span>
</span><span id="persistency_fitted_curve-563"><a href="#persistency_fitted_curve-563"><span class="linenos">563</span></a>    <span class="n">t_peak</span> <span class="o">=</span> <span class="n">numeric_time_to_peak</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fitting</span><span class="o">=</span><span class="n">fitting</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">parity</span><span class="o">=</span><span class="n">parity</span><span class="p">,</span> <span class="n">breed</span><span class="o">=</span><span class="n">breed</span><span class="p">,</span> <span class="n">continent</span><span class="o">=</span><span class="n">continent</span><span class="p">)</span>
</span><span id="persistency_fitted_curve-564"><a href="#persistency_fitted_curve-564"><span class="linenos">564</span></a>
</span><span id="persistency_fitted_curve-565"><a href="#persistency_fitted_curve-565"><span class="linenos">565</span></a>    <span class="c1"># determine lactation length</span>
</span><span id="persistency_fitted_curve-566"><a href="#persistency_fitted_curve-566"><span class="linenos">566</span></a>    <span class="k">if</span> <span class="n">lactation_length</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
</span><span id="persistency_fitted_curve-567"><a href="#persistency_fitted_curve-567"><span class="linenos">567</span></a>        <span class="n">lactation_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
</span><span id="persistency_fitted_curve-568"><a href="#persistency_fitted_curve-568"><span class="linenos">568</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lactation_length</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="persistency_fitted_curve-569"><a href="#persistency_fitted_curve-569"><span class="linenos">569</span></a>        <span class="n">lactation_length</span> <span class="o">=</span> <span class="n">lactation_length</span>
</span><span id="persistency_fitted_curve-570"><a href="#persistency_fitted_curve-570"><span class="linenos">570</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="persistency_fitted_curve-571"><a href="#persistency_fitted_curve-571"><span class="linenos">571</span></a>        <span class="n">lactation_length</span> <span class="o">=</span> <span class="mi">305</span>
</span><span id="persistency_fitted_curve-572"><a href="#persistency_fitted_curve-572"><span class="linenos">572</span></a>
</span><span id="persistency_fitted_curve-573"><a href="#persistency_fitted_curve-573"><span class="linenos">573</span></a>    <span class="c1"># calculate milk yield at peak</span>
</span><span id="persistency_fitted_curve-574"><a href="#persistency_fitted_curve-574"><span class="linenos">574</span></a>    <span class="n">yields</span> <span class="o">=</span> <span class="n">fit_lactation_curve</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fitting</span><span class="o">=</span><span class="n">fitting</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">parity</span><span class="o">=</span><span class="n">parity</span><span class="p">,</span> <span class="n">breed</span><span class="o">=</span><span class="n">breed</span><span class="p">,</span> <span class="n">continent</span><span class="o">=</span><span class="n">continent</span><span class="p">)</span>
</span><span id="persistency_fitted_curve-575"><a href="#persistency_fitted_curve-575"><span class="linenos">575</span></a>    <span class="n">peak_yield</span> <span class="o">=</span> <span class="n">yields</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">t_peak</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># -1 to prevent index error</span>
</span><span id="persistency_fitted_curve-576"><a href="#persistency_fitted_curve-576"><span class="linenos">576</span></a>    <span class="c1"># calculate milk yield at end of lactation</span>
</span><span id="persistency_fitted_curve-577"><a href="#persistency_fitted_curve-577"><span class="linenos">577</span></a>    <span class="n">end_yield</span> <span class="o">=</span> <span class="n">yields</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">lactation_length</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># -1 to prevent index error</span>
</span><span id="persistency_fitted_curve-578"><a href="#persistency_fitted_curve-578"><span class="linenos">578</span></a>
</span><span id="persistency_fitted_curve-579"><a href="#persistency_fitted_curve-579"><span class="linenos">579</span></a>    <span class="c1"># calculate persistency</span>
</span><span id="persistency_fitted_curve-580"><a href="#persistency_fitted_curve-580"><span class="linenos">580</span></a>    <span class="n">persistency</span> <span class="o">=</span> <span class="p">(</span><span class="n">end_yield</span> <span class="o">-</span> <span class="n">peak_yield</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">lactation_length</span> <span class="o">-</span> <span class="n">t_peak</span><span class="p">)</span>
</span><span id="persistency_fitted_curve-581"><a href="#persistency_fitted_curve-581"><span class="linenos">581</span></a>    <span class="k">return</span> <span class="n">persistency</span>
</span></pre></div>


            <div class="docstring"><p>Persistency as the average slope after peak until end of lactation (numeric).</p>

<p>This is the default approach because symbolic derivation is not feasible for
all models. It computes:
    <code>(yield_at_end - yield_at_peak) / (lactation_length - time_to_peak)</code></p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>dim:</strong>  DIM values.</li>
<li><strong>milkrecordings:</strong>  Milk recordings (kg).</li>
<li><strong>model:</strong>  Model name. Options include 'milkbot' (Bayesian or frequentist),
'wood', 'wilmink', 'ali_schaeffer', 'fischer'.</li>
<li><strong>fitting:</strong>  'frequentist' or 'bayesian'.</li>
<li><strong>key:</strong>  API key (only for Bayesian fitting).</li>
<li><strong>parity:</strong>  Parity of the cow; values above 3 treated as 3 (Bayesian).</li>
<li><strong>breed:</strong>  'H' or 'J' (Bayesian).</li>
<li><strong>continent:</strong>  'USA', 'EU', or 'CHEN' (Bayesian).</li>
<li><strong>lactation_length (int | str):</strong>  305 (default), 'max' (use max DIM), or integer.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>float: Average slope after the peak until end of lactation.</p>
</blockquote>
</div>


                </section>
                <section id="persistency_milkbot">
                            <input id="persistency_milkbot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">persistency_milkbot</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">d</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="persistency_milkbot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#persistency_milkbot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="persistency_milkbot-527"><a href="#persistency_milkbot-527"><span class="linenos">527</span></a><span class="k">def</span><span class="w"> </span><span class="nf">persistency_milkbot</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="persistency_milkbot-528"><a href="#persistency_milkbot-528"><span class="linenos">528</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Persistency from the MilkBot model (Ehrlich, 2013): `Persistency = 0.693 / d`.</span>
</span><span id="persistency_milkbot-529"><a href="#persistency_milkbot-529"><span class="linenos">529</span></a>
</span><span id="persistency_milkbot-530"><a href="#persistency_milkbot-530"><span class="linenos">530</span></a><span class="sd">    Args:</span>
</span><span id="persistency_milkbot-531"><a href="#persistency_milkbot-531"><span class="linenos">531</span></a><span class="sd">        d (float): Parameter `d` of the MilkBot model.</span>
</span><span id="persistency_milkbot-532"><a href="#persistency_milkbot-532"><span class="linenos">532</span></a>
</span><span id="persistency_milkbot-533"><a href="#persistency_milkbot-533"><span class="linenos">533</span></a><span class="sd">    Returns:</span>
</span><span id="persistency_milkbot-534"><a href="#persistency_milkbot-534"><span class="linenos">534</span></a><span class="sd">        float: Persistency value from the MilkBot formula.</span>
</span><span id="persistency_milkbot-535"><a href="#persistency_milkbot-535"><span class="linenos">535</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="persistency_milkbot-536"><a href="#persistency_milkbot-536"><span class="linenos">536</span></a>    <span class="k">return</span> <span class="mf">0.693</span> <span class="o">/</span> <span class="n">d</span>
</span></pre></div>


            <div class="docstring"><p>Persistency from the MilkBot model (Ehrlich, 2013): <code>Persistency = 0.693 / d</code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>d (float):</strong>  Parameter <code>d</code> of the MilkBot model.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>float: Persistency value from the MilkBot formula.</p>
</blockquote>
</div>


                </section>
                <section id="persistency_wood">
                            <input id="persistency_wood-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">persistency_wood</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">b</span>, </span><span class="param"><span class="n">c</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="persistency_wood-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#persistency_wood"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="persistency_wood-514"><a href="#persistency_wood-514"><span class="linenos">514</span></a><span class="k">def</span><span class="w"> </span><span class="nf">persistency_wood</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="persistency_wood-515"><a href="#persistency_wood-515"><span class="linenos">515</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Persistency from Wood et al. (1984): `Persistency = -(b + 1) * ln(c)`.</span>
</span><span id="persistency_wood-516"><a href="#persistency_wood-516"><span class="linenos">516</span></a>
</span><span id="persistency_wood-517"><a href="#persistency_wood-517"><span class="linenos">517</span></a><span class="sd">    Args:</span>
</span><span id="persistency_wood-518"><a href="#persistency_wood-518"><span class="linenos">518</span></a><span class="sd">        b (float): Parameter `b` of the Wood model.</span>
</span><span id="persistency_wood-519"><a href="#persistency_wood-519"><span class="linenos">519</span></a><span class="sd">        c (float): Parameter `c` of the Wood model.</span>
</span><span id="persistency_wood-520"><a href="#persistency_wood-520"><span class="linenos">520</span></a>
</span><span id="persistency_wood-521"><a href="#persistency_wood-521"><span class="linenos">521</span></a><span class="sd">    Returns:</span>
</span><span id="persistency_wood-522"><a href="#persistency_wood-522"><span class="linenos">522</span></a><span class="sd">        float: Persistency value from the Wood formula.</span>
</span><span id="persistency_wood-523"><a href="#persistency_wood-523"><span class="linenos">523</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="persistency_wood-524"><a href="#persistency_wood-524"><span class="linenos">524</span></a>    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">ln</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Persistency from Wood et al. (1984): <code>Persistency = -(b + 1) * ln(c)</code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>b (float):</strong>  Parameter <code>b</code> of the Wood model.</li>
<li><strong>c (float):</strong>  Parameter <code>c</code> of the Wood model.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>float: Persistency value from the Wood formula.</p>
</blockquote>
</div>


                </section>
                <section id="test_interval_method">
                            <input id="test_interval_method-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">

        <span class="def">def</span>
        <span class="name">test_interval_method</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">df</span>,</span><span class="param">	<span class="n">days_in_milk_col</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">milking_yield_col</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">test_id_col</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">default_test_id</span><span class="o">=</span><span class="mi">1</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="test_interval_method-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#test_interval_method"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="test_interval_method-39"><a href="#test_interval_method-39"><span class="linenos"> 39</span></a><span class="k">def</span><span class="w"> </span><span class="nf">test_interval_method</span><span class="p">(</span>
</span><span id="test_interval_method-40"><a href="#test_interval_method-40"><span class="linenos"> 40</span></a>    <span class="n">df</span><span class="p">,</span>
</span><span id="test_interval_method-41"><a href="#test_interval_method-41"><span class="linenos"> 41</span></a>    <span class="n">days_in_milk_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="test_interval_method-42"><a href="#test_interval_method-42"><span class="linenos"> 42</span></a>    <span class="n">milking_yield_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="test_interval_method-43"><a href="#test_interval_method-43"><span class="linenos"> 43</span></a>    <span class="n">test_id_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="test_interval_method-44"><a href="#test_interval_method-44"><span class="linenos"> 44</span></a>    <span class="n">default_test_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="test_interval_method-45"><a href="#test_interval_method-45"><span class="linenos"> 45</span></a><span class="p">):</span>
</span><span id="test_interval_method-46"><a href="#test_interval_method-46"><span class="linenos"> 46</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute 305-day total milk yield using the ICAR Test Interval Method.</span>
</span><span id="test_interval_method-47"><a href="#test_interval_method-47"><span class="linenos"> 47</span></a>
</span><span id="test_interval_method-48"><a href="#test_interval_method-48"><span class="linenos"> 48</span></a><span class="sd">    The method applies:</span>
</span><span id="test_interval_method-49"><a href="#test_interval_method-49"><span class="linenos"> 49</span></a><span class="sd">    - Linear projection from calving to the first test day,</span>
</span><span id="test_interval_method-50"><a href="#test_interval_method-50"><span class="linenos"> 50</span></a><span class="sd">    - Trapezoidal integration between consecutive test days,</span>
</span><span id="test_interval_method-51"><a href="#test_interval_method-51"><span class="linenos"> 51</span></a><span class="sd">    - Linear projection from the last test day to DIM=305.</span>
</span><span id="test_interval_method-52"><a href="#test_interval_method-52"><span class="linenos"> 52</span></a>
</span><span id="test_interval_method-53"><a href="#test_interval_method-53"><span class="linenos"> 53</span></a><span class="sd">    Args:</span>
</span><span id="test_interval_method-54"><a href="#test_interval_method-54"><span class="linenos"> 54</span></a><span class="sd">        df (pd.DataFrame): Input DataFrame with at least DaysInMilk, MilkingYield,</span>
</span><span id="test_interval_method-55"><a href="#test_interval_method-55"><span class="linenos"> 55</span></a><span class="sd">            and (optionally) TestId columns (names can be provided via arguments</span>
</span><span id="test_interval_method-56"><a href="#test_interval_method-56"><span class="linenos"> 56</span></a><span class="sd">            or matched via known aliases, case-insensitive).</span>
</span><span id="test_interval_method-57"><a href="#test_interval_method-57"><span class="linenos"> 57</span></a><span class="sd">        days_in_milk_col (str | None): Optional column name override for DaysInMilk.</span>
</span><span id="test_interval_method-58"><a href="#test_interval_method-58"><span class="linenos"> 58</span></a><span class="sd">        milking_yield_col (str | None): Optional column name override for MilkingYield.</span>
</span><span id="test_interval_method-59"><a href="#test_interval_method-59"><span class="linenos"> 59</span></a><span class="sd">        test_id_col (str | None): Optional column name override for TestId.</span>
</span><span id="test_interval_method-60"><a href="#test_interval_method-60"><span class="linenos"> 60</span></a><span class="sd">        default_test_id (Any): If TestId is missing, a new `TestId` column is created</span>
</span><span id="test_interval_method-61"><a href="#test_interval_method-61"><span class="linenos"> 61</span></a><span class="sd">            with this value.</span>
</span><span id="test_interval_method-62"><a href="#test_interval_method-62"><span class="linenos"> 62</span></a>
</span><span id="test_interval_method-63"><a href="#test_interval_method-63"><span class="linenos"> 63</span></a><span class="sd">    Returns:</span>
</span><span id="test_interval_method-64"><a href="#test_interval_method-64"><span class="linenos"> 64</span></a><span class="sd">        pd.DataFrame: Two-column DataFrame with</span>
</span><span id="test_interval_method-65"><a href="#test_interval_method-65"><span class="linenos"> 65</span></a><span class="sd">            - &quot;TestId&quot;: identifier per lactation,</span>
</span><span id="test_interval_method-66"><a href="#test_interval_method-66"><span class="linenos"> 66</span></a><span class="sd">            - &quot;Total305Yield&quot;: computed total milk yield over 305 days.</span>
</span><span id="test_interval_method-67"><a href="#test_interval_method-67"><span class="linenos"> 67</span></a>
</span><span id="test_interval_method-68"><a href="#test_interval_method-68"><span class="linenos"> 68</span></a><span class="sd">    Raises:</span>
</span><span id="test_interval_method-69"><a href="#test_interval_method-69"><span class="linenos"> 69</span></a><span class="sd">        ValueError: If required columns (DaysInMilk or MilkingYield) cannot be found.</span>
</span><span id="test_interval_method-70"><a href="#test_interval_method-70"><span class="linenos"> 70</span></a>
</span><span id="test_interval_method-71"><a href="#test_interval_method-71"><span class="linenos"> 71</span></a><span class="sd">    Notes:</span>
</span><span id="test_interval_method-72"><a href="#test_interval_method-72"><span class="linenos"> 72</span></a><span class="sd">        - Records with DIM &gt; 305 are dropped before computation.</span>
</span><span id="test_interval_method-73"><a href="#test_interval_method-73"><span class="linenos"> 73</span></a><span class="sd">        - At least two data points per TestId are required for trapezoidal integration;</span>
</span><span id="test_interval_method-74"><a href="#test_interval_method-74"><span class="linenos"> 74</span></a><span class="sd">          otherwise the lactation is skipped.</span>
</span><span id="test_interval_method-75"><a href="#test_interval_method-75"><span class="linenos"> 75</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="test_interval_method-76"><a href="#test_interval_method-76"><span class="linenos"> 76</span></a>
</span><span id="test_interval_method-77"><a href="#test_interval_method-77"><span class="linenos"> 77</span></a>    <span class="c1"># Standardize columns and filter DIM &lt;= 305</span>
</span><span id="test_interval_method-78"><a href="#test_interval_method-78"><span class="linenos"> 78</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">standardize_lactation_columns</span><span class="p">(</span>
</span><span id="test_interval_method-79"><a href="#test_interval_method-79"><span class="linenos"> 79</span></a>        <span class="n">df</span><span class="p">,</span>
</span><span id="test_interval_method-80"><a href="#test_interval_method-80"><span class="linenos"> 80</span></a>        <span class="n">days_in_milk_col</span><span class="o">=</span><span class="n">days_in_milk_col</span><span class="p">,</span>
</span><span id="test_interval_method-81"><a href="#test_interval_method-81"><span class="linenos"> 81</span></a>        <span class="n">milking_yield_col</span><span class="o">=</span><span class="n">milking_yield_col</span><span class="p">,</span>
</span><span id="test_interval_method-82"><a href="#test_interval_method-82"><span class="linenos"> 82</span></a>        <span class="n">test_id_col</span><span class="o">=</span><span class="n">test_id_col</span><span class="p">,</span>
</span><span id="test_interval_method-83"><a href="#test_interval_method-83"><span class="linenos"> 83</span></a>        <span class="n">default_test_id</span><span class="o">=</span><span class="n">default_test_id</span><span class="p">,</span>
</span><span id="test_interval_method-84"><a href="#test_interval_method-84"><span class="linenos"> 84</span></a>        <span class="n">max_dim</span><span class="o">=</span><span class="mi">305</span><span class="p">,</span>
</span><span id="test_interval_method-85"><a href="#test_interval_method-85"><span class="linenos"> 85</span></a>    <span class="p">)</span>
</span><span id="test_interval_method-86"><a href="#test_interval_method-86"><span class="linenos"> 86</span></a>
</span><span id="test_interval_method-87"><a href="#test_interval_method-87"><span class="linenos"> 87</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="test_interval_method-88"><a href="#test_interval_method-88"><span class="linenos"> 88</span></a>
</span><span id="test_interval_method-89"><a href="#test_interval_method-89"><span class="linenos"> 89</span></a>    <span class="c1"># Iterate over each lactation</span>
</span><span id="test_interval_method-90"><a href="#test_interval_method-90"><span class="linenos"> 90</span></a>    <span class="k">for</span> <span class="n">lactation</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;TestId&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="test_interval_method-91"><a href="#test_interval_method-91"><span class="linenos"> 91</span></a>        <span class="n">lactation_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;TestId&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">lactation</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="test_interval_method-92"><a href="#test_interval_method-92"><span class="linenos"> 92</span></a>
</span><span id="test_interval_method-93"><a href="#test_interval_method-93"><span class="linenos"> 93</span></a>        <span class="c1"># Sort by DaysInMilk ascending</span>
</span><span id="test_interval_method-94"><a href="#test_interval_method-94"><span class="linenos"> 94</span></a>        <span class="n">lactation_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;DaysInMilk&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="test_interval_method-95"><a href="#test_interval_method-95"><span class="linenos"> 95</span></a>
</span><span id="test_interval_method-96"><a href="#test_interval_method-96"><span class="linenos"> 96</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lactation_df</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="test_interval_method-97"><a href="#test_interval_method-97"><span class="linenos"> 97</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="test_interval_method-98"><a href="#test_interval_method-98"><span class="linenos"> 98</span></a>                <span class="sa">f</span><span class="s2">&quot;Skipping TestId </span><span class="si">{</span><span class="n">lactation</span><span class="si">}</span><span class="s2">: not enough data points for interpolation.&quot;</span>
</span><span id="test_interval_method-99"><a href="#test_interval_method-99"><span class="linenos"> 99</span></a>            <span class="p">)</span>
</span><span id="test_interval_method-100"><a href="#test_interval_method-100"><span class="linenos">100</span></a>            <span class="k">continue</span>
</span><span id="test_interval_method-101"><a href="#test_interval_method-101"><span class="linenos">101</span></a>
</span><span id="test_interval_method-102"><a href="#test_interval_method-102"><span class="linenos">102</span></a>        <span class="c1"># Start and end points</span>
</span><span id="test_interval_method-103"><a href="#test_interval_method-103"><span class="linenos">103</span></a>        <span class="n">start</span> <span class="o">=</span> <span class="n">lactation_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="test_interval_method-104"><a href="#test_interval_method-104"><span class="linenos">104</span></a>        <span class="n">end</span> <span class="o">=</span> <span class="n">lactation_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="test_interval_method-105"><a href="#test_interval_method-105"><span class="linenos">105</span></a>
</span><span id="test_interval_method-106"><a href="#test_interval_method-106"><span class="linenos">106</span></a>        <span class="c1"># Start contribution</span>
</span><span id="test_interval_method-107"><a href="#test_interval_method-107"><span class="linenos">107</span></a>        <span class="n">MY0</span> <span class="o">=</span> <span class="n">start</span><span class="p">[</span><span class="s2">&quot;DaysInMilk&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">start</span><span class="p">[</span><span class="s2">&quot;MilkingYield&quot;</span><span class="p">]</span>
</span><span id="test_interval_method-108"><a href="#test_interval_method-108"><span class="linenos">108</span></a>
</span><span id="test_interval_method-109"><a href="#test_interval_method-109"><span class="linenos">109</span></a>        <span class="c1"># End contribution</span>
</span><span id="test_interval_method-110"><a href="#test_interval_method-110"><span class="linenos">110</span></a>        <span class="n">MYend</span> <span class="o">=</span> <span class="p">(</span><span class="mi">306</span> <span class="o">-</span> <span class="n">end</span><span class="p">[</span><span class="s2">&quot;DaysInMilk&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">end</span><span class="p">[</span><span class="s2">&quot;MilkingYield&quot;</span><span class="p">]</span>
</span><span id="test_interval_method-111"><a href="#test_interval_method-111"><span class="linenos">111</span></a>
</span><span id="test_interval_method-112"><a href="#test_interval_method-112"><span class="linenos">112</span></a>        <span class="c1"># Intermediate trapezoidal contributions</span>
</span><span id="test_interval_method-113"><a href="#test_interval_method-113"><span class="linenos">113</span></a>        <span class="n">lactation_df</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lactation_df</span><span class="p">[</span><span class="s2">&quot;DaysInMilk&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="test_interval_method-114"><a href="#test_interval_method-114"><span class="linenos">114</span></a>        <span class="n">lactation_df</span><span class="p">[</span><span class="s2">&quot;avg_yield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="test_interval_method-115"><a href="#test_interval_method-115"><span class="linenos">115</span></a>            <span class="n">lactation_df</span><span class="p">[</span><span class="s2">&quot;MilkingYield&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">lactation_df</span><span class="p">[</span><span class="s2">&quot;MilkingYield&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="test_interval_method-116"><a href="#test_interval_method-116"><span class="linenos">116</span></a>        <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="test_interval_method-117"><a href="#test_interval_method-117"><span class="linenos">117</span></a>        <span class="n">lactation_df</span><span class="p">[</span><span class="s2">&quot;trapezoid_area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="test_interval_method-118"><a href="#test_interval_method-118"><span class="linenos">118</span></a>            <span class="n">lactation_df</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">lactation_df</span><span class="p">[</span><span class="s2">&quot;avg_yield&quot;</span><span class="p">]</span>
</span><span id="test_interval_method-119"><a href="#test_interval_method-119"><span class="linenos">119</span></a>        <span class="p">)</span>
</span><span id="test_interval_method-120"><a href="#test_interval_method-120"><span class="linenos">120</span></a>
</span><span id="test_interval_method-121"><a href="#test_interval_method-121"><span class="linenos">121</span></a>        <span class="n">total_intermediate</span> <span class="o">=</span> <span class="n">lactation_df</span><span class="p">[</span><span class="s2">&quot;trapezoid_area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="test_interval_method-122"><a href="#test_interval_method-122"><span class="linenos">122</span></a>
</span><span id="test_interval_method-123"><a href="#test_interval_method-123"><span class="linenos">123</span></a>        <span class="n">total_yield</span> <span class="o">=</span> <span class="n">MY0</span> <span class="o">+</span> <span class="n">total_intermediate</span> <span class="o">+</span> <span class="n">MYend</span>
</span><span id="test_interval_method-124"><a href="#test_interval_method-124"><span class="linenos">124</span></a>        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">lactation</span><span class="p">,</span> <span class="n">total_yield</span><span class="p">))</span>
</span><span id="test_interval_method-125"><a href="#test_interval_method-125"><span class="linenos">125</span></a>
</span><span id="test_interval_method-126"><a href="#test_interval_method-126"><span class="linenos">126</span></a>    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;TestId&quot;</span><span class="p">,</span> <span class="s2">&quot;Total305Yield&quot;</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Compute 305-day total milk yield using the ICAR Test Interval Method.</p>

<p>The method applies:</p>

<ul>
<li>Linear projection from calving to the first test day,</li>
<li>Trapezoidal integration between consecutive test days,</li>
<li>Linear projection from the last test day to DIM=305.</li>
</ul>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>df (pd.DataFrame):</strong>  Input DataFrame with at least DaysInMilk, MilkingYield,
and (optionally) TestId columns (names can be provided via arguments
or matched via known aliases, case-insensitive).</li>
<li><strong>days_in_milk_col (str | None):</strong>  Optional column name override for DaysInMilk.</li>
<li><strong>milking_yield_col (str | None):</strong>  Optional column name override for MilkingYield.</li>
<li><strong>test_id_col (str | None):</strong>  Optional column name override for TestId.</li>
<li><strong>default_test_id (Any):</strong>  If TestId is missing, a new <code>TestId</code> column is created
with this value.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>pd.DataFrame: Two-column DataFrame with
      - "TestId": identifier per lactation,
      - "Total305Yield": computed total milk yield over 305 days.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>ValueError:</strong>  If required columns (DaysInMilk or MilkingYield) cannot be found.</li>
</ul>

<h6 id="notes">Notes:</h6>

<blockquote>
  <ul>
  <li>Records with DIM &gt; 305 are dropped before computation.</li>
  <li>At least two data points per TestId are required for trapezoidal integration;
  otherwise the lactation is skipped.</li>
  </ul>
</blockquote>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>
