<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>lactationcurve API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#PreparedInputs">PreparedInputs</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#PreparedInputs.__init__">PreparedInputs</a>
                        </li>
                        <li>
                                <a class="variable" href="#PreparedInputs.dim">dim</a>
                        </li>
                        <li>
                                <a class="variable" href="#PreparedInputs.milkrecordings">milkrecordings</a>
                        </li>
                        <li>
                                <a class="variable" href="#PreparedInputs.model">model</a>
                        </li>
                        <li>
                                <a class="variable" href="#PreparedInputs.fitting">fitting</a>
                        </li>
                        <li>
                                <a class="variable" href="#PreparedInputs.breed">breed</a>
                        </li>
                        <li>
                                <a class="variable" href="#PreparedInputs.parity">parity</a>
                        </li>
                        <li>
                                <a class="variable" href="#PreparedInputs.continent">continent</a>
                        </li>
                        <li>
                                <a class="variable" href="#PreparedInputs.persistency_method">persistency_method</a>
                        </li>
                        <li>
                                <a class="variable" href="#PreparedInputs.lactation_length">lactation_length</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#standardize_lactation_columns">standardize_lactation_columns</a>
            </li>
            <li>
                    <a class="function" href="#validate_and_prepare_inputs">validate_and_prepare_inputs</a>
            </li>
            <li>
                    <a class="function" href="#ali_schaeffer_model">ali_schaeffer_model</a>
            </li>
            <li>
                    <a class="function" href="#bayesian_fit_milkbot_single_lactation">bayesian_fit_milkbot_single_lactation</a>
            </li>
            <li>
                    <a class="function" href="#brody_model">brody_model</a>
            </li>
            <li>
                    <a class="function" href="#dhanoa_model">dhanoa_model</a>
            </li>
            <li>
                    <a class="function" href="#dijkstra_model">dijkstra_model</a>
            </li>
            <li>
                    <a class="function" href="#emmans_model">emmans_model</a>
            </li>
            <li>
                    <a class="function" href="#fischer_model">fischer_model</a>
            </li>
            <li>
                    <a class="function" href="#fit_lactation_curve">fit_lactation_curve</a>
            </li>
            <li>
                    <a class="function" href="#get_chen_priors">get_chen_priors</a>
            </li>
            <li>
                    <a class="function" href="#get_lc_parameters">get_lc_parameters</a>
            </li>
            <li>
                    <a class="function" href="#get_lc_parameters_least_squares">get_lc_parameters_least_squares</a>
            </li>
            <li>
                    <a class="function" href="#hayashi_model">hayashi_model</a>
            </li>
            <li>
                    <a class="function" href="#milkbot_model">milkbot_model</a>
            </li>
            <li>
                    <a class="function" href="#nelder_model">nelder_model</a>
            </li>
            <li>
                    <a class="function" href="#prasad_model">prasad_model</a>
            </li>
            <li>
                    <a class="function" href="#rook_model">rook_model</a>
            </li>
            <li>
                    <a class="function" href="#sikka_model">sikka_model</a>
            </li>
            <li>
                    <a class="function" href="#wilmink_model">wilmink_model</a>
            </li>
            <li>
                    <a class="function" href="#wood_model">wood_model</a>
            </li>
            <li>
                    <a class="function" href="#calculate_characteristic">calculate_characteristic</a>
            </li>
            <li>
                    <a class="function" href="#lactation_curve_characteristic_function">lactation_curve_characteristic_function</a>
            </li>
            <li>
                    <a class="function" href="#numeric_cumulative_yield">numeric_cumulative_yield</a>
            </li>
            <li>
                    <a class="function" href="#numeric_peak_yield">numeric_peak_yield</a>
            </li>
            <li>
                    <a class="function" href="#numeric_time_to_peak">numeric_time_to_peak</a>
            </li>
            <li>
                    <a class="function" href="#persistency_fitted_curve">persistency_fitted_curve</a>
            </li>
            <li>
                    <a class="function" href="#persistency_milkbot">persistency_milkbot</a>
            </li>
            <li>
                    <a class="function" href="#persistency_wood">persistency_wood</a>
            </li>
            <li>
                    <a class="function" href="#test_interval_method">test_interval_method</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
lactationcurve    </h1>

                
                        <input id="mod-lactationcurve-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-lactationcurve-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.characteristics</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a>    <span class="n">calculate_characteristic</span><span class="p">,</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a>    <span class="n">lactation_curve_characteristic_function</span><span class="p">,</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a>    <span class="n">numeric_cumulative_yield</span><span class="p">,</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a>    <span class="n">numeric_peak_yield</span><span class="p">,</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a>    <span class="n">numeric_time_to_peak</span><span class="p">,</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a>    <span class="n">persistency_fitted_curve</span><span class="p">,</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a>    <span class="n">persistency_milkbot</span><span class="p">,</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a>    <span class="n">persistency_wood</span><span class="p">,</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a>    <span class="n">test_interval_method</span><span class="p">,</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a><span class="p">)</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.fitting</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a>    <span class="n">ali_schaeffer_model</span><span class="p">,</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a>    <span class="n">bayesian_fit_milkbot_single_lactation</span><span class="p">,</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a>    <span class="n">brody_model</span><span class="p">,</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a>    <span class="n">dhanoa_model</span><span class="p">,</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a>    <span class="n">dijkstra_model</span><span class="p">,</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a>    <span class="n">emmans_model</span><span class="p">,</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">19</span></a>    <span class="n">fischer_model</span><span class="p">,</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">20</span></a>    <span class="n">fit_lactation_curve</span><span class="p">,</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">21</span></a>    <span class="n">get_chen_priors</span><span class="p">,</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">22</span></a>    <span class="n">get_lc_parameters</span><span class="p">,</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">23</span></a>    <span class="n">get_lc_parameters_least_squares</span><span class="p">,</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">24</span></a>    <span class="n">hayashi_model</span><span class="p">,</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">25</span></a>    <span class="n">milkbot_model</span><span class="p">,</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">26</span></a>    <span class="n">nelder_model</span><span class="p">,</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">27</span></a>    <span class="n">prasad_model</span><span class="p">,</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">28</span></a>    <span class="n">rook_model</span><span class="p">,</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">29</span></a>    <span class="n">sikka_model</span><span class="p">,</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">30</span></a>    <span class="n">wilmink_model</span><span class="p">,</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">31</span></a>    <span class="n">wood_model</span><span class="p">,</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">32</span></a><span class="p">)</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">33</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">34</span></a>    <span class="n">PreparedInputs</span><span class="p">,</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">35</span></a>    <span class="n">standardize_lactation_columns</span><span class="p">,</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">36</span></a>    <span class="n">validate_and_prepare_inputs</span><span class="p">,</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">37</span></a><span class="p">)</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">38</span></a>
</span><span id="L-39"><a href="#L-39"><span class="linenos">39</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">40</span></a>    <span class="c1"># Preprocessing</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">41</span></a>    <span class="s2">&quot;PreparedInputs&quot;</span><span class="p">,</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">42</span></a>    <span class="s2">&quot;standardize_lactation_columns&quot;</span><span class="p">,</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">43</span></a>    <span class="s2">&quot;validate_and_prepare_inputs&quot;</span><span class="p">,</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">44</span></a>    <span class="c1"># Fitting</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">45</span></a>    <span class="s2">&quot;ali_schaeffer_model&quot;</span><span class="p">,</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">46</span></a>    <span class="s2">&quot;bayesian_fit_milkbot_single_lactation&quot;</span><span class="p">,</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">47</span></a>    <span class="s2">&quot;brody_model&quot;</span><span class="p">,</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">48</span></a>    <span class="s2">&quot;dhanoa_model&quot;</span><span class="p">,</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">49</span></a>    <span class="s2">&quot;dijkstra_model&quot;</span><span class="p">,</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">50</span></a>    <span class="s2">&quot;emmans_model&quot;</span><span class="p">,</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">51</span></a>    <span class="s2">&quot;fischer_model&quot;</span><span class="p">,</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">52</span></a>    <span class="s2">&quot;fit_lactation_curve&quot;</span><span class="p">,</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">53</span></a>    <span class="s2">&quot;get_chen_priors&quot;</span><span class="p">,</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">54</span></a>    <span class="s2">&quot;get_lc_parameters&quot;</span><span class="p">,</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">55</span></a>    <span class="s2">&quot;get_lc_parameters_least_squares&quot;</span><span class="p">,</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">56</span></a>    <span class="s2">&quot;hayashi_model&quot;</span><span class="p">,</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">57</span></a>    <span class="s2">&quot;milkbot_model&quot;</span><span class="p">,</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">58</span></a>    <span class="s2">&quot;nelder_model&quot;</span><span class="p">,</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">59</span></a>    <span class="s2">&quot;prasad_model&quot;</span><span class="p">,</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">60</span></a>    <span class="s2">&quot;rook_model&quot;</span><span class="p">,</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">61</span></a>    <span class="s2">&quot;sikka_model&quot;</span><span class="p">,</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">62</span></a>    <span class="s2">&quot;wilmink_model&quot;</span><span class="p">,</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">63</span></a>    <span class="s2">&quot;wood_model&quot;</span><span class="p">,</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">64</span></a>    <span class="c1"># Characteristics</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">65</span></a>    <span class="s2">&quot;calculate_characteristic&quot;</span><span class="p">,</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">66</span></a>    <span class="s2">&quot;lactation_curve_characteristic_function&quot;</span><span class="p">,</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">67</span></a>    <span class="s2">&quot;numeric_cumulative_yield&quot;</span><span class="p">,</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">68</span></a>    <span class="s2">&quot;numeric_peak_yield&quot;</span><span class="p">,</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">69</span></a>    <span class="s2">&quot;numeric_time_to_peak&quot;</span><span class="p">,</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">70</span></a>    <span class="s2">&quot;persistency_fitted_curve&quot;</span><span class="p">,</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">71</span></a>    <span class="s2">&quot;persistency_milkbot&quot;</span><span class="p">,</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">72</span></a>    <span class="s2">&quot;persistency_wood&quot;</span><span class="p">,</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">73</span></a>    <span class="s2">&quot;test_interval_method&quot;</span><span class="p">,</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">74</span></a><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="PreparedInputs">
                            <input id="PreparedInputs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator decorator-dataclass">@dataclass</div>

    <span class="def">class</span>
    <span class="name">PreparedInputs</span>:

                <label class="view-source-button" for="PreparedInputs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PreparedInputs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PreparedInputs-12"><a href="#PreparedInputs-12"><span class="linenos">12</span></a><span class="nd">@dataclass</span>
</span><span id="PreparedInputs-13"><a href="#PreparedInputs-13"><span class="linenos">13</span></a><span class="k">class</span><span class="w"> </span><span class="nc">PreparedInputs</span><span class="p">:</span>
</span><span id="PreparedInputs-14"><a href="#PreparedInputs-14"><span class="linenos">14</span></a>    <span class="n">dim</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
</span><span id="PreparedInputs-15"><a href="#PreparedInputs-15"><span class="linenos">15</span></a>    <span class="n">milkrecordings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
</span><span id="PreparedInputs-16"><a href="#PreparedInputs-16"><span class="linenos">16</span></a>    <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PreparedInputs-17"><a href="#PreparedInputs-17"><span class="linenos">17</span></a>    <span class="n">fitting</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PreparedInputs-18"><a href="#PreparedInputs-18"><span class="linenos">18</span></a>    <span class="n">breed</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PreparedInputs-19"><a href="#PreparedInputs-19"><span class="linenos">19</span></a>    <span class="n">parity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PreparedInputs-20"><a href="#PreparedInputs-20"><span class="linenos">20</span></a>    <span class="n">continent</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PreparedInputs-21"><a href="#PreparedInputs-21"><span class="linenos">21</span></a>    <span class="n">persistency_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PreparedInputs-22"><a href="#PreparedInputs-22"><span class="linenos">22</span></a>    <span class="n">lactation_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


    

                            <div id="PreparedInputs.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">PreparedInputs</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dim</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">milkrecordings</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">fitting</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">breed</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">parity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">continent</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">persistency_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">lactation_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#PreparedInputs.__init__"></a>
    
    

                            </div>
                            <div id="PreparedInputs.dim" class="classattr">
                                <div class="attr variable">
            <span class="name">dim</span><span class="annotation">: numpy.ndarray</span>

        
    </div>
    <a class="headerlink" href="#PreparedInputs.dim"></a>
    
    

                            </div>
                            <div id="PreparedInputs.milkrecordings" class="classattr">
                                <div class="attr variable">
            <span class="name">milkrecordings</span><span class="annotation">: numpy.ndarray</span>

        
    </div>
    <a class="headerlink" href="#PreparedInputs.milkrecordings"></a>
    
    

                            </div>
                            <div id="PreparedInputs.model" class="classattr">
                                <div class="attr variable">
            <span class="name">model</span><span class="annotation">: str | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#PreparedInputs.model"></a>
    
    

                            </div>
                            <div id="PreparedInputs.fitting" class="classattr">
                                <div class="attr variable">
            <span class="name">fitting</span><span class="annotation">: str | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#PreparedInputs.fitting"></a>
    
    

                            </div>
                            <div id="PreparedInputs.breed" class="classattr">
                                <div class="attr variable">
            <span class="name">breed</span><span class="annotation">: str | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#PreparedInputs.breed"></a>
    
    

                            </div>
                            <div id="PreparedInputs.parity" class="classattr">
                                <div class="attr variable">
            <span class="name">parity</span><span class="annotation">: int | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#PreparedInputs.parity"></a>
    
    

                            </div>
                            <div id="PreparedInputs.continent" class="classattr">
                                <div class="attr variable">
            <span class="name">continent</span><span class="annotation">: str | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#PreparedInputs.continent"></a>
    
    

                            </div>
                            <div id="PreparedInputs.persistency_method" class="classattr">
                                <div class="attr variable">
            <span class="name">persistency_method</span><span class="annotation">: str | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#PreparedInputs.persistency_method"></a>
    
    

                            </div>
                            <div id="PreparedInputs.lactation_length" class="classattr">
                                <div class="attr variable">
            <span class="name">lactation_length</span><span class="annotation">: int | str | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#PreparedInputs.lactation_length"></a>
    
    

                            </div>
                </section>
                <section id="standardize_lactation_columns">
                            <input id="standardize_lactation_columns-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">standardize_lactation_columns</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">days_in_milk_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">milking_yield_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">test_id_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">default_test_id</span><span class="o">=</span><span class="mi">0</span>,</span><span class="param">	<span class="n">max_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">305</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="standardize_lactation_columns-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#standardize_lactation_columns"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="standardize_lactation_columns-148"><a href="#standardize_lactation_columns-148"><span class="linenos">148</span></a><span class="k">def</span><span class="w"> </span><span class="nf">standardize_lactation_columns</span><span class="p">(</span>
</span><span id="standardize_lactation_columns-149"><a href="#standardize_lactation_columns-149"><span class="linenos">149</span></a>    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="standardize_lactation_columns-150"><a href="#standardize_lactation_columns-150"><span class="linenos">150</span></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="standardize_lactation_columns-151"><a href="#standardize_lactation_columns-151"><span class="linenos">151</span></a>    <span class="n">days_in_milk_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="standardize_lactation_columns-152"><a href="#standardize_lactation_columns-152"><span class="linenos">152</span></a>    <span class="n">milking_yield_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="standardize_lactation_columns-153"><a href="#standardize_lactation_columns-153"><span class="linenos">153</span></a>    <span class="n">test_id_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="standardize_lactation_columns-154"><a href="#standardize_lactation_columns-154"><span class="linenos">154</span></a>    <span class="n">default_test_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="standardize_lactation_columns-155"><a href="#standardize_lactation_columns-155"><span class="linenos">155</span></a>    <span class="n">max_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">305</span><span class="p">,</span>
</span><span id="standardize_lactation_columns-156"><a href="#standardize_lactation_columns-156"><span class="linenos">156</span></a><span class="p">):</span>
</span><span id="standardize_lactation_columns-157"><a href="#standardize_lactation_columns-157"><span class="linenos">157</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="standardize_lactation_columns-158"><a href="#standardize_lactation_columns-158"><span class="linenos">158</span></a><span class="sd">    Standardize column names and structure for lactation data.</span>
</span><span id="standardize_lactation_columns-159"><a href="#standardize_lactation_columns-159"><span class="linenos">159</span></a>
</span><span id="standardize_lactation_columns-160"><a href="#standardize_lactation_columns-160"><span class="linenos">160</span></a><span class="sd">    Returns</span>
</span><span id="standardize_lactation_columns-161"><a href="#standardize_lactation_columns-161"><span class="linenos">161</span></a><span class="sd">    -------</span>
</span><span id="standardize_lactation_columns-162"><a href="#standardize_lactation_columns-162"><span class="linenos">162</span></a><span class="sd">    df_out : pd.DataFrame</span>
</span><span id="standardize_lactation_columns-163"><a href="#standardize_lactation_columns-163"><span class="linenos">163</span></a><span class="sd">        Copy of df with standardized columns:</span>
</span><span id="standardize_lactation_columns-164"><a href="#standardize_lactation_columns-164"><span class="linenos">164</span></a><span class="sd">        - DaysInMilk</span>
</span><span id="standardize_lactation_columns-165"><a href="#standardize_lactation_columns-165"><span class="linenos">165</span></a><span class="sd">        - MilkingYield</span>
</span><span id="standardize_lactation_columns-166"><a href="#standardize_lactation_columns-166"><span class="linenos">166</span></a><span class="sd">        - TestId</span>
</span><span id="standardize_lactation_columns-167"><a href="#standardize_lactation_columns-167"><span class="linenos">167</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="standardize_lactation_columns-168"><a href="#standardize_lactation_columns-168"><span class="linenos">168</span></a>
</span><span id="standardize_lactation_columns-169"><a href="#standardize_lactation_columns-169"><span class="linenos">169</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="standardize_lactation_columns-170"><a href="#standardize_lactation_columns-170"><span class="linenos">170</span></a>
</span><span id="standardize_lactation_columns-171"><a href="#standardize_lactation_columns-171"><span class="linenos">171</span></a>    <span class="c1"># Accepted aliases (case-insensitive)</span>
</span><span id="standardize_lactation_columns-172"><a href="#standardize_lactation_columns-172"><span class="linenos">172</span></a>    <span class="n">aliases</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="standardize_lactation_columns-173"><a href="#standardize_lactation_columns-173"><span class="linenos">173</span></a>        <span class="s2">&quot;DaysInMilk&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;daysinmilk&quot;</span><span class="p">,</span> <span class="s2">&quot;dim&quot;</span><span class="p">,</span> <span class="s2">&quot;testday&quot;</span><span class="p">],</span>
</span><span id="standardize_lactation_columns-174"><a href="#standardize_lactation_columns-174"><span class="linenos">174</span></a>        <span class="s2">&quot;MilkingYield&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="standardize_lactation_columns-175"><a href="#standardize_lactation_columns-175"><span class="linenos">175</span></a>            <span class="s2">&quot;milkingyield&quot;</span><span class="p">,</span>
</span><span id="standardize_lactation_columns-176"><a href="#standardize_lactation_columns-176"><span class="linenos">176</span></a>            <span class="s2">&quot;testdaymilkyield&quot;</span><span class="p">,</span>
</span><span id="standardize_lactation_columns-177"><a href="#standardize_lactation_columns-177"><span class="linenos">177</span></a>            <span class="s2">&quot;milkyield&quot;</span><span class="p">,</span>
</span><span id="standardize_lactation_columns-178"><a href="#standardize_lactation_columns-178"><span class="linenos">178</span></a>            <span class="s2">&quot;yield&quot;</span><span class="p">,</span>
</span><span id="standardize_lactation_columns-179"><a href="#standardize_lactation_columns-179"><span class="linenos">179</span></a>            <span class="s2">&quot;milkproduction&quot;</span><span class="p">,</span>
</span><span id="standardize_lactation_columns-180"><a href="#standardize_lactation_columns-180"><span class="linenos">180</span></a>            <span class="s2">&quot;milk_yield&quot;</span><span class="p">,</span>
</span><span id="standardize_lactation_columns-181"><a href="#standardize_lactation_columns-181"><span class="linenos">181</span></a>        <span class="p">],</span>
</span><span id="standardize_lactation_columns-182"><a href="#standardize_lactation_columns-182"><span class="linenos">182</span></a>        <span class="s2">&quot;TestId&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;testid&quot;</span><span class="p">,</span> <span class="s2">&quot;animalid&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">],</span>
</span><span id="standardize_lactation_columns-183"><a href="#standardize_lactation_columns-183"><span class="linenos">183</span></a>    <span class="p">}</span>
</span><span id="standardize_lactation_columns-184"><a href="#standardize_lactation_columns-184"><span class="linenos">184</span></a>
</span><span id="standardize_lactation_columns-185"><a href="#standardize_lactation_columns-185"><span class="linenos">185</span></a>    <span class="c1"># Lowercase lookup  actual column name</span>
</span><span id="standardize_lactation_columns-186"><a href="#standardize_lactation_columns-186"><span class="linenos">186</span></a>    <span class="n">col_lookup</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">}</span>
</span><span id="standardize_lactation_columns-187"><a href="#standardize_lactation_columns-187"><span class="linenos">187</span></a>
</span><span id="standardize_lactation_columns-188"><a href="#standardize_lactation_columns-188"><span class="linenos">188</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">resolve_col</span><span class="p">(</span><span class="n">override</span><span class="p">,</span> <span class="n">possible_names</span><span class="p">):</span>
</span><span id="standardize_lactation_columns-189"><a href="#standardize_lactation_columns-189"><span class="linenos">189</span></a>        <span class="k">if</span> <span class="n">override</span><span class="p">:</span>
</span><span id="standardize_lactation_columns-190"><a href="#standardize_lactation_columns-190"><span class="linenos">190</span></a>            <span class="k">return</span> <span class="n">col_lookup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">override</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="standardize_lactation_columns-191"><a href="#standardize_lactation_columns-191"><span class="linenos">191</span></a>        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">possible_names</span><span class="p">:</span>
</span><span id="standardize_lactation_columns-192"><a href="#standardize_lactation_columns-192"><span class="linenos">192</span></a>            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">col_lookup</span><span class="p">:</span>
</span><span id="standardize_lactation_columns-193"><a href="#standardize_lactation_columns-193"><span class="linenos">193</span></a>                <span class="k">return</span> <span class="n">col_lookup</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</span><span id="standardize_lactation_columns-194"><a href="#standardize_lactation_columns-194"><span class="linenos">194</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="standardize_lactation_columns-195"><a href="#standardize_lactation_columns-195"><span class="linenos">195</span></a>
</span><span id="standardize_lactation_columns-196"><a href="#standardize_lactation_columns-196"><span class="linenos">196</span></a>    <span class="c1"># Resolve columns</span>
</span><span id="standardize_lactation_columns-197"><a href="#standardize_lactation_columns-197"><span class="linenos">197</span></a>    <span class="n">dim_col</span> <span class="o">=</span> <span class="n">resolve_col</span><span class="p">(</span><span class="n">days_in_milk_col</span><span class="p">,</span> <span class="n">aliases</span><span class="p">[</span><span class="s2">&quot;DaysInMilk&quot;</span><span class="p">])</span>
</span><span id="standardize_lactation_columns-198"><a href="#standardize_lactation_columns-198"><span class="linenos">198</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">dim_col</span><span class="p">:</span>
</span><span id="standardize_lactation_columns-199"><a href="#standardize_lactation_columns-199"><span class="linenos">199</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No DaysInMilk column found.&quot;</span><span class="p">)</span>
</span><span id="standardize_lactation_columns-200"><a href="#standardize_lactation_columns-200"><span class="linenos">200</span></a>
</span><span id="standardize_lactation_columns-201"><a href="#standardize_lactation_columns-201"><span class="linenos">201</span></a>    <span class="n">yield_col</span> <span class="o">=</span> <span class="n">resolve_col</span><span class="p">(</span><span class="n">milking_yield_col</span><span class="p">,</span> <span class="n">aliases</span><span class="p">[</span><span class="s2">&quot;MilkingYield&quot;</span><span class="p">])</span>
</span><span id="standardize_lactation_columns-202"><a href="#standardize_lactation_columns-202"><span class="linenos">202</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">yield_col</span><span class="p">:</span>
</span><span id="standardize_lactation_columns-203"><a href="#standardize_lactation_columns-203"><span class="linenos">203</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No MilkingYield column found.&quot;</span><span class="p">)</span>
</span><span id="standardize_lactation_columns-204"><a href="#standardize_lactation_columns-204"><span class="linenos">204</span></a>
</span><span id="standardize_lactation_columns-205"><a href="#standardize_lactation_columns-205"><span class="linenos">205</span></a>    <span class="n">id_col</span> <span class="o">=</span> <span class="n">resolve_col</span><span class="p">(</span><span class="n">test_id_col</span><span class="p">,</span> <span class="n">aliases</span><span class="p">[</span><span class="s2">&quot;TestId&quot;</span><span class="p">])</span>
</span><span id="standardize_lactation_columns-206"><a href="#standardize_lactation_columns-206"><span class="linenos">206</span></a>
</span><span id="standardize_lactation_columns-207"><a href="#standardize_lactation_columns-207"><span class="linenos">207</span></a>    <span class="c1"># Create TestId if missing</span>
</span><span id="standardize_lactation_columns-208"><a href="#standardize_lactation_columns-208"><span class="linenos">208</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">id_col</span><span class="p">:</span>
</span><span id="standardize_lactation_columns-209"><a href="#standardize_lactation_columns-209"><span class="linenos">209</span></a>        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;TestId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_test_id</span>
</span><span id="standardize_lactation_columns-210"><a href="#standardize_lactation_columns-210"><span class="linenos">210</span></a>        <span class="n">id_col</span> <span class="o">=</span> <span class="s2">&quot;TestId&quot;</span>
</span><span id="standardize_lactation_columns-211"><a href="#standardize_lactation_columns-211"><span class="linenos">211</span></a>
</span><span id="standardize_lactation_columns-212"><a href="#standardize_lactation_columns-212"><span class="linenos">212</span></a>    <span class="c1"># Rename to standardized names</span>
</span><span id="standardize_lactation_columns-213"><a href="#standardize_lactation_columns-213"><span class="linenos">213</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="standardize_lactation_columns-214"><a href="#standardize_lactation_columns-214"><span class="linenos">214</span></a>        <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
</span><span id="standardize_lactation_columns-215"><a href="#standardize_lactation_columns-215"><span class="linenos">215</span></a>            <span class="n">dim_col</span><span class="p">:</span> <span class="s2">&quot;DaysInMilk&quot;</span><span class="p">,</span>
</span><span id="standardize_lactation_columns-216"><a href="#standardize_lactation_columns-216"><span class="linenos">216</span></a>            <span class="n">yield_col</span><span class="p">:</span> <span class="s2">&quot;MilkingYield&quot;</span><span class="p">,</span>
</span><span id="standardize_lactation_columns-217"><a href="#standardize_lactation_columns-217"><span class="linenos">217</span></a>            <span class="n">id_col</span><span class="p">:</span> <span class="s2">&quot;TestId&quot;</span><span class="p">,</span>
</span><span id="standardize_lactation_columns-218"><a href="#standardize_lactation_columns-218"><span class="linenos">218</span></a>        <span class="p">}</span>
</span><span id="standardize_lactation_columns-219"><a href="#standardize_lactation_columns-219"><span class="linenos">219</span></a>    <span class="p">)</span>
</span><span id="standardize_lactation_columns-220"><a href="#standardize_lactation_columns-220"><span class="linenos">220</span></a>
</span><span id="standardize_lactation_columns-221"><a href="#standardize_lactation_columns-221"><span class="linenos">221</span></a>    <span class="c1"># Filter DIM</span>
</span><span id="standardize_lactation_columns-222"><a href="#standardize_lactation_columns-222"><span class="linenos">222</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;DaysInMilk&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">max_dim</span><span class="p">]</span>
</span><span id="standardize_lactation_columns-223"><a href="#standardize_lactation_columns-223"><span class="linenos">223</span></a>
</span><span id="standardize_lactation_columns-224"><a href="#standardize_lactation_columns-224"><span class="linenos">224</span></a>    <span class="k">return</span> <span class="n">df</span>
</span></pre></div>


            <div class="docstring"><p>Standardize column names and structure for lactation data.</p>

<h2 id="returns">Returns</h2>

<p>df_out : pd.DataFrame
    Copy of df with standardized columns:
    - DaysInMilk
    - MilkingYield
    - TestId</p>
</div>


                </section>
                <section id="validate_and_prepare_inputs">
                            <input id="validate_and_prepare_inputs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate_and_prepare_inputs</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dim</span>,</span><span class="param">	<span class="n">milkrecordings</span>,</span><span class="param">	<span class="n">model</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">fitting</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">breed</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">parity</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">continent</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">persistency_method</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">lactation_length</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#PreparedInputs">PreparedInputs</a></span>:</span></span>

                <label class="view-source-button" for="validate_and_prepare_inputs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#validate_and_prepare_inputs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="validate_and_prepare_inputs-25"><a href="#validate_and_prepare_inputs-25"><span class="linenos"> 25</span></a><span class="k">def</span><span class="w"> </span><span class="nf">validate_and_prepare_inputs</span><span class="p">(</span>
</span><span id="validate_and_prepare_inputs-26"><a href="#validate_and_prepare_inputs-26"><span class="linenos"> 26</span></a>    <span class="n">dim</span><span class="p">,</span>
</span><span id="validate_and_prepare_inputs-27"><a href="#validate_and_prepare_inputs-27"><span class="linenos"> 27</span></a>    <span class="n">milkrecordings</span><span class="p">,</span>
</span><span id="validate_and_prepare_inputs-28"><a href="#validate_and_prepare_inputs-28"><span class="linenos"> 28</span></a>    <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="validate_and_prepare_inputs-29"><a href="#validate_and_prepare_inputs-29"><span class="linenos"> 29</span></a>    <span class="n">fitting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="validate_and_prepare_inputs-30"><a href="#validate_and_prepare_inputs-30"><span class="linenos"> 30</span></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="validate_and_prepare_inputs-31"><a href="#validate_and_prepare_inputs-31"><span class="linenos"> 31</span></a>    <span class="n">breed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="validate_and_prepare_inputs-32"><a href="#validate_and_prepare_inputs-32"><span class="linenos"> 32</span></a>    <span class="n">parity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="validate_and_prepare_inputs-33"><a href="#validate_and_prepare_inputs-33"><span class="linenos"> 33</span></a>    <span class="n">continent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="validate_and_prepare_inputs-34"><a href="#validate_and_prepare_inputs-34"><span class="linenos"> 34</span></a>    <span class="n">persistency_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="validate_and_prepare_inputs-35"><a href="#validate_and_prepare_inputs-35"><span class="linenos"> 35</span></a>    <span class="n">lactation_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="validate_and_prepare_inputs-36"><a href="#validate_and_prepare_inputs-36"><span class="linenos"> 36</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PreparedInputs</span><span class="p">:</span>
</span><span id="validate_and_prepare_inputs-37"><a href="#validate_and_prepare_inputs-37"><span class="linenos"> 37</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="validate_and_prepare_inputs-38"><a href="#validate_and_prepare_inputs-38"><span class="linenos"> 38</span></a><span class="sd">    Validate, normalize, and clean input data for lactation curve fitting.</span>
</span><span id="validate_and_prepare_inputs-39"><a href="#validate_and_prepare_inputs-39"><span class="linenos"> 39</span></a>
</span><span id="validate_and_prepare_inputs-40"><a href="#validate_and_prepare_inputs-40"><span class="linenos"> 40</span></a><span class="sd">    This function performs basic consistency checks on the provided</span>
</span><span id="validate_and_prepare_inputs-41"><a href="#validate_and_prepare_inputs-41"><span class="linenos"> 41</span></a><span class="sd">    days-in-milk (DIM) and milk recording data, normalizes optional</span>
</span><span id="validate_and_prepare_inputs-42"><a href="#validate_and_prepare_inputs-42"><span class="linenos"> 42</span></a><span class="sd">    categorical parameters, and removes observations with missing or</span>
</span><span id="validate_and_prepare_inputs-43"><a href="#validate_and_prepare_inputs-43"><span class="linenos"> 43</span></a><span class="sd">    non-finite values. The cleaned and validated inputs are returned</span>
</span><span id="validate_and_prepare_inputs-44"><a href="#validate_and_prepare_inputs-44"><span class="linenos"> 44</span></a><span class="sd">    in a structured :class:`PreparedInputs` object.</span>
</span><span id="validate_and_prepare_inputs-45"><a href="#validate_and_prepare_inputs-45"><span class="linenos"> 45</span></a>
</span><span id="validate_and_prepare_inputs-46"><a href="#validate_and_prepare_inputs-46"><span class="linenos"> 46</span></a><span class="sd">    Parameters</span>
</span><span id="validate_and_prepare_inputs-47"><a href="#validate_and_prepare_inputs-47"><span class="linenos"> 47</span></a><span class="sd">    ----------</span>
</span><span id="validate_and_prepare_inputs-48"><a href="#validate_and_prepare_inputs-48"><span class="linenos"> 48</span></a><span class="sd">    dim : array-like</span>
</span><span id="validate_and_prepare_inputs-49"><a href="#validate_and_prepare_inputs-49"><span class="linenos"> 49</span></a><span class="sd">        Days in milk corresponding to each milk recording.</span>
</span><span id="validate_and_prepare_inputs-50"><a href="#validate_and_prepare_inputs-50"><span class="linenos"> 50</span></a><span class="sd">    milkrecordings : array-like</span>
</span><span id="validate_and_prepare_inputs-51"><a href="#validate_and_prepare_inputs-51"><span class="linenos"> 51</span></a><span class="sd">        Milk yield measurements corresponding to `dim`.</span>
</span><span id="validate_and_prepare_inputs-52"><a href="#validate_and_prepare_inputs-52"><span class="linenos"> 52</span></a><span class="sd">    model : str or None, optional</span>
</span><span id="validate_and_prepare_inputs-53"><a href="#validate_and_prepare_inputs-53"><span class="linenos"> 53</span></a><span class="sd">        Name of the lactation curve model. If provided, the name is</span>
</span><span id="validate_and_prepare_inputs-54"><a href="#validate_and_prepare_inputs-54"><span class="linenos"> 54</span></a><span class="sd">        stripped of whitespace and converted to lowercase.</span>
</span><span id="validate_and_prepare_inputs-55"><a href="#validate_and_prepare_inputs-55"><span class="linenos"> 55</span></a><span class="sd">    fitting : str or None, optional</span>
</span><span id="validate_and_prepare_inputs-56"><a href="#validate_and_prepare_inputs-56"><span class="linenos"> 56</span></a><span class="sd">        Fitting approach to be used. Must be either ``&quot;frequentist&quot;``</span>
</span><span id="validate_and_prepare_inputs-57"><a href="#validate_and_prepare_inputs-57"><span class="linenos"> 57</span></a><span class="sd">        or ``&quot;bayesian&quot;`` if provided.</span>
</span><span id="validate_and_prepare_inputs-58"><a href="#validate_and_prepare_inputs-58"><span class="linenos"> 58</span></a><span class="sd">    breed : str or None, optional</span>
</span><span id="validate_and_prepare_inputs-59"><a href="#validate_and_prepare_inputs-59"><span class="linenos"> 59</span></a><span class="sd">        Cow breed identifier. Must be ``&quot;H&quot;`` (Holstein) or ``&quot;J&quot;``</span>
</span><span id="validate_and_prepare_inputs-60"><a href="#validate_and_prepare_inputs-60"><span class="linenos"> 60</span></a><span class="sd">        (Jersey) if provided. Case-insensitive.</span>
</span><span id="validate_and_prepare_inputs-61"><a href="#validate_and_prepare_inputs-61"><span class="linenos"> 61</span></a><span class="sd">    parity : int or None, optional</span>
</span><span id="validate_and_prepare_inputs-62"><a href="#validate_and_prepare_inputs-62"><span class="linenos"> 62</span></a><span class="sd">        Lactation number (parity). If provided, it is coerced to an</span>
</span><span id="validate_and_prepare_inputs-63"><a href="#validate_and_prepare_inputs-63"><span class="linenos"> 63</span></a><span class="sd">        integer.</span>
</span><span id="validate_and_prepare_inputs-64"><a href="#validate_and_prepare_inputs-64"><span class="linenos"> 64</span></a><span class="sd">    continent : str or None, optional</span>
</span><span id="validate_and_prepare_inputs-65"><a href="#validate_and_prepare_inputs-65"><span class="linenos"> 65</span></a><span class="sd">        Geographic region identifier. Must be one of ``&quot;USA&quot;``,</span>
</span><span id="validate_and_prepare_inputs-66"><a href="#validate_and_prepare_inputs-66"><span class="linenos"> 66</span></a><span class="sd">        ``&quot;EU&quot;``, or ``&quot;CHEN&quot;`` if provided. Case-insensitive.</span>
</span><span id="validate_and_prepare_inputs-67"><a href="#validate_and_prepare_inputs-67"><span class="linenos"> 67</span></a>
</span><span id="validate_and_prepare_inputs-68"><a href="#validate_and_prepare_inputs-68"><span class="linenos"> 68</span></a><span class="sd">    Extra input for persistency calculation:</span>
</span><span id="validate_and_prepare_inputs-69"><a href="#validate_and_prepare_inputs-69"><span class="linenos"> 69</span></a><span class="sd">        persistency_method (String): way of calculating persistency, options: &#39;derived&#39; which gives the average slope of the lactation after the peak until the end of lactation (default) or &#39;literature&#39; for the wood and milkbot model.</span>
</span><span id="validate_and_prepare_inputs-70"><a href="#validate_and_prepare_inputs-70"><span class="linenos"> 70</span></a><span class="sd">        Lactation_length: string or int: length of the lactation in days to calculate persistency over, options: 305 = default or &#39;max&#39;  uses the maximum DIM in the data, or an integer value to set the desired lactation length.</span>
</span><span id="validate_and_prepare_inputs-71"><a href="#validate_and_prepare_inputs-71"><span class="linenos"> 71</span></a>
</span><span id="validate_and_prepare_inputs-72"><a href="#validate_and_prepare_inputs-72"><span class="linenos"> 72</span></a><span class="sd">    Returns</span>
</span><span id="validate_and_prepare_inputs-73"><a href="#validate_and_prepare_inputs-73"><span class="linenos"> 73</span></a><span class="sd">    -------</span>
</span><span id="validate_and_prepare_inputs-74"><a href="#validate_and_prepare_inputs-74"><span class="linenos"> 74</span></a><span class="sd">    PreparedInputs</span>
</span><span id="validate_and_prepare_inputs-75"><a href="#validate_and_prepare_inputs-75"><span class="linenos"> 75</span></a><span class="sd">        A dataclass containing the cleaned numeric arrays (`dim`,</span>
</span><span id="validate_and_prepare_inputs-76"><a href="#validate_and_prepare_inputs-76"><span class="linenos"> 76</span></a><span class="sd">        `milkrecordings`) and the normalized optional parameters.</span>
</span><span id="validate_and_prepare_inputs-77"><a href="#validate_and_prepare_inputs-77"><span class="linenos"> 77</span></a>
</span><span id="validate_and_prepare_inputs-78"><a href="#validate_and_prepare_inputs-78"><span class="linenos"> 78</span></a><span class="sd">    Raises</span>
</span><span id="validate_and_prepare_inputs-79"><a href="#validate_and_prepare_inputs-79"><span class="linenos"> 79</span></a><span class="sd">    ------</span>
</span><span id="validate_and_prepare_inputs-80"><a href="#validate_and_prepare_inputs-80"><span class="linenos"> 80</span></a><span class="sd">    ValueError</span>
</span><span id="validate_and_prepare_inputs-81"><a href="#validate_and_prepare_inputs-81"><span class="linenos"> 81</span></a><span class="sd">        If input arrays have different lengths, contain insufficient</span>
</span><span id="validate_and_prepare_inputs-82"><a href="#validate_and_prepare_inputs-82"><span class="linenos"> 82</span></a><span class="sd">        valid observations, or if categorical parameters are invalid.</span>
</span><span id="validate_and_prepare_inputs-83"><a href="#validate_and_prepare_inputs-83"><span class="linenos"> 83</span></a>
</span><span id="validate_and_prepare_inputs-84"><a href="#validate_and_prepare_inputs-84"><span class="linenos"> 84</span></a><span class="sd">    Notes</span>
</span><span id="validate_and_prepare_inputs-85"><a href="#validate_and_prepare_inputs-85"><span class="linenos"> 85</span></a><span class="sd">    -----</span>
</span><span id="validate_and_prepare_inputs-86"><a href="#validate_and_prepare_inputs-86"><span class="linenos"> 86</span></a><span class="sd">    Observations with missing or non-finite values in either `dim` or</span>
</span><span id="validate_and_prepare_inputs-87"><a href="#validate_and_prepare_inputs-87"><span class="linenos"> 87</span></a><span class="sd">    `milkrecordings` are removed prior to model fitting. At least two</span>
</span><span id="validate_and_prepare_inputs-88"><a href="#validate_and_prepare_inputs-88"><span class="linenos"> 88</span></a><span class="sd">    valid observations are required to proceed.</span>
</span><span id="validate_and_prepare_inputs-89"><a href="#validate_and_prepare_inputs-89"><span class="linenos"> 89</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="validate_and_prepare_inputs-90"><a href="#validate_and_prepare_inputs-90"><span class="linenos"> 90</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">milkrecordings</span><span class="p">):</span>
</span><span id="validate_and_prepare_inputs-91"><a href="#validate_and_prepare_inputs-91"><span class="linenos"> 91</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;dim and milkrecordings must have the same length&quot;</span><span class="p">)</span>
</span><span id="validate_and_prepare_inputs-92"><a href="#validate_and_prepare_inputs-92"><span class="linenos"> 92</span></a>
</span><span id="validate_and_prepare_inputs-93"><a href="#validate_and_prepare_inputs-93"><span class="linenos"> 93</span></a>    <span class="n">model</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="validate_and_prepare_inputs-94"><a href="#validate_and_prepare_inputs-94"><span class="linenos"> 94</span></a>
</span><span id="validate_and_prepare_inputs-95"><a href="#validate_and_prepare_inputs-95"><span class="linenos"> 95</span></a>    <span class="k">if</span> <span class="n">parity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="validate_and_prepare_inputs-96"><a href="#validate_and_prepare_inputs-96"><span class="linenos"> 96</span></a>        <span class="n">parity</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parity</span><span class="p">)</span>
</span><span id="validate_and_prepare_inputs-97"><a href="#validate_and_prepare_inputs-97"><span class="linenos"> 97</span></a>
</span><span id="validate_and_prepare_inputs-98"><a href="#validate_and_prepare_inputs-98"><span class="linenos"> 98</span></a>    <span class="k">if</span> <span class="n">fitting</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="validate_and_prepare_inputs-99"><a href="#validate_and_prepare_inputs-99"><span class="linenos"> 99</span></a>        <span class="n">fitting</span> <span class="o">=</span> <span class="n">fitting</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="validate_and_prepare_inputs-100"><a href="#validate_and_prepare_inputs-100"><span class="linenos">100</span></a>        <span class="k">if</span> <span class="n">fitting</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;frequentist&quot;</span><span class="p">,</span> <span class="s2">&quot;bayesian&quot;</span><span class="p">}:</span>
</span><span id="validate_and_prepare_inputs-101"><a href="#validate_and_prepare_inputs-101"><span class="linenos">101</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Fitting method must be either frequentist or bayesian&quot;</span><span class="p">)</span>
</span><span id="validate_and_prepare_inputs-102"><a href="#validate_and_prepare_inputs-102"><span class="linenos">102</span></a>
</span><span id="validate_and_prepare_inputs-103"><a href="#validate_and_prepare_inputs-103"><span class="linenos">103</span></a>    <span class="k">if</span> <span class="n">breed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="validate_and_prepare_inputs-104"><a href="#validate_and_prepare_inputs-104"><span class="linenos">104</span></a>        <span class="n">breed</span> <span class="o">=</span> <span class="n">breed</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span id="validate_and_prepare_inputs-105"><a href="#validate_and_prepare_inputs-105"><span class="linenos">105</span></a>        <span class="k">if</span> <span class="n">breed</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;J&quot;</span><span class="p">}:</span>
</span><span id="validate_and_prepare_inputs-106"><a href="#validate_and_prepare_inputs-106"><span class="linenos">106</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Breed must be either Holstein = &#39;H&#39; or Jersey &#39;J&#39;&quot;</span><span class="p">)</span>
</span><span id="validate_and_prepare_inputs-107"><a href="#validate_and_prepare_inputs-107"><span class="linenos">107</span></a>
</span><span id="validate_and_prepare_inputs-108"><a href="#validate_and_prepare_inputs-108"><span class="linenos">108</span></a>    <span class="k">if</span> <span class="n">continent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="validate_and_prepare_inputs-109"><a href="#validate_and_prepare_inputs-109"><span class="linenos">109</span></a>        <span class="n">continent</span> <span class="o">=</span> <span class="n">continent</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span id="validate_and_prepare_inputs-110"><a href="#validate_and_prepare_inputs-110"><span class="linenos">110</span></a>        <span class="k">if</span> <span class="n">continent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;USA&quot;</span><span class="p">,</span> <span class="s2">&quot;EU&quot;</span><span class="p">,</span> <span class="s2">&quot;CHEN&quot;</span><span class="p">}:</span>
</span><span id="validate_and_prepare_inputs-111"><a href="#validate_and_prepare_inputs-111"><span class="linenos">111</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;continent must be &#39;USA&#39;, &#39;EU&#39;, or &#39;CHEN&#39;&quot;</span><span class="p">)</span>
</span><span id="validate_and_prepare_inputs-112"><a href="#validate_and_prepare_inputs-112"><span class="linenos">112</span></a>
</span><span id="validate_and_prepare_inputs-113"><a href="#validate_and_prepare_inputs-113"><span class="linenos">113</span></a>    <span class="n">dim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
</span><span id="validate_and_prepare_inputs-114"><a href="#validate_and_prepare_inputs-114"><span class="linenos">114</span></a>    <span class="n">milkrecordings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">milkrecordings</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
</span><span id="validate_and_prepare_inputs-115"><a href="#validate_and_prepare_inputs-115"><span class="linenos">115</span></a>
</span><span id="validate_and_prepare_inputs-116"><a href="#validate_and_prepare_inputs-116"><span class="linenos">116</span></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">milkrecordings</span><span class="p">)</span>
</span><span id="validate_and_prepare_inputs-117"><a href="#validate_and_prepare_inputs-117"><span class="linenos">117</span></a>    <span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</span><span id="validate_and_prepare_inputs-118"><a href="#validate_and_prepare_inputs-118"><span class="linenos">118</span></a>    <span class="n">milkrecordings</span> <span class="o">=</span> <span class="n">milkrecordings</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</span><span id="validate_and_prepare_inputs-119"><a href="#validate_and_prepare_inputs-119"><span class="linenos">119</span></a>
</span><span id="validate_and_prepare_inputs-120"><a href="#validate_and_prepare_inputs-120"><span class="linenos">120</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="validate_and_prepare_inputs-121"><a href="#validate_and_prepare_inputs-121"><span class="linenos">121</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;At least two non missing points are required to fit a lactation curve&quot;</span><span class="p">)</span>
</span><span id="validate_and_prepare_inputs-122"><a href="#validate_and_prepare_inputs-122"><span class="linenos">122</span></a>
</span><span id="validate_and_prepare_inputs-123"><a href="#validate_and_prepare_inputs-123"><span class="linenos">123</span></a>    <span class="k">if</span> <span class="n">persistency_method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="validate_and_prepare_inputs-124"><a href="#validate_and_prepare_inputs-124"><span class="linenos">124</span></a>        <span class="n">persistency_method</span> <span class="o">=</span> <span class="n">persistency_method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="validate_and_prepare_inputs-125"><a href="#validate_and_prepare_inputs-125"><span class="linenos">125</span></a>        <span class="k">if</span> <span class="n">persistency_method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;derived&quot;</span><span class="p">,</span> <span class="s2">&quot;literature&quot;</span><span class="p">}:</span>
</span><span id="validate_and_prepare_inputs-126"><a href="#validate_and_prepare_inputs-126"><span class="linenos">126</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;persistency_method must be either &#39;derived&#39; or &#39;literature&#39;&quot;</span><span class="p">)</span>
</span><span id="validate_and_prepare_inputs-127"><a href="#validate_and_prepare_inputs-127"><span class="linenos">127</span></a>
</span><span id="validate_and_prepare_inputs-128"><a href="#validate_and_prepare_inputs-128"><span class="linenos">128</span></a>    <span class="k">if</span> <span class="n">lactation_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="validate_and_prepare_inputs-129"><a href="#validate_and_prepare_inputs-129"><span class="linenos">129</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lactation_length</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="validate_and_prepare_inputs-130"><a href="#validate_and_prepare_inputs-130"><span class="linenos">130</span></a>            <span class="k">if</span> <span class="n">lactation_length</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span>
</span><span id="validate_and_prepare_inputs-131"><a href="#validate_and_prepare_inputs-131"><span class="linenos">131</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;lactation_length string option must be &#39;max&#39;&quot;</span><span class="p">)</span>
</span><span id="validate_and_prepare_inputs-132"><a href="#validate_and_prepare_inputs-132"><span class="linenos">132</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="validate_and_prepare_inputs-133"><a href="#validate_and_prepare_inputs-133"><span class="linenos">133</span></a>            <span class="n">lactation_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lactation_length</span><span class="p">)</span>
</span><span id="validate_and_prepare_inputs-134"><a href="#validate_and_prepare_inputs-134"><span class="linenos">134</span></a>
</span><span id="validate_and_prepare_inputs-135"><a href="#validate_and_prepare_inputs-135"><span class="linenos">135</span></a>    <span class="k">return</span> <span class="n">PreparedInputs</span><span class="p">(</span>
</span><span id="validate_and_prepare_inputs-136"><a href="#validate_and_prepare_inputs-136"><span class="linenos">136</span></a>        <span class="n">dim</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span>
</span><span id="validate_and_prepare_inputs-137"><a href="#validate_and_prepare_inputs-137"><span class="linenos">137</span></a>        <span class="n">milkrecordings</span><span class="o">=</span><span class="n">milkrecordings</span><span class="p">,</span>
</span><span id="validate_and_prepare_inputs-138"><a href="#validate_and_prepare_inputs-138"><span class="linenos">138</span></a>        <span class="n">model</span><span class="o">=</span><span class="n">model</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="validate_and_prepare_inputs-139"><a href="#validate_and_prepare_inputs-139"><span class="linenos">139</span></a>        <span class="n">fitting</span><span class="o">=</span><span class="n">fitting</span><span class="p">,</span>
</span><span id="validate_and_prepare_inputs-140"><a href="#validate_and_prepare_inputs-140"><span class="linenos">140</span></a>        <span class="n">breed</span><span class="o">=</span><span class="n">breed</span><span class="p">,</span>
</span><span id="validate_and_prepare_inputs-141"><a href="#validate_and_prepare_inputs-141"><span class="linenos">141</span></a>        <span class="n">parity</span><span class="o">=</span><span class="n">parity</span><span class="p">,</span>
</span><span id="validate_and_prepare_inputs-142"><a href="#validate_and_prepare_inputs-142"><span class="linenos">142</span></a>        <span class="n">continent</span><span class="o">=</span><span class="n">continent</span><span class="p">,</span>
</span><span id="validate_and_prepare_inputs-143"><a href="#validate_and_prepare_inputs-143"><span class="linenos">143</span></a>        <span class="n">persistency_method</span><span class="o">=</span><span class="n">persistency_method</span><span class="p">,</span>
</span><span id="validate_and_prepare_inputs-144"><a href="#validate_and_prepare_inputs-144"><span class="linenos">144</span></a>        <span class="n">lactation_length</span><span class="o">=</span><span class="n">lactation_length</span><span class="p">,</span>
</span><span id="validate_and_prepare_inputs-145"><a href="#validate_and_prepare_inputs-145"><span class="linenos">145</span></a>    <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Validate, normalize, and clean input data for lactation curve fitting.</p>

<p>This function performs basic consistency checks on the provided
days-in-milk (DIM) and milk recording data, normalizes optional
categorical parameters, and removes observations with missing or
non-finite values. The cleaned and validated inputs are returned
in a structured <code><a href="#PreparedInputs">PreparedInputs</a></code> object.</p>

<h2 id="parameters">Parameters</h2>

<p>dim : array-like
    Days in milk corresponding to each milk recording.
milkrecordings : array-like
    Milk yield measurements corresponding to <code>dim</code>.
model : str or None, optional
    Name of the lactation curve model. If provided, the name is
    stripped of whitespace and converted to lowercase.
fitting : str or None, optional
    Fitting approach to be used. Must be either <code>"frequentist"</code>
    or <code>"bayesian"</code> if provided.
breed : str or None, optional
    Cow breed identifier. Must be <code>"H"</code> (Holstein) or <code>"J"</code>
    (Jersey) if provided. Case-insensitive.
parity : int or None, optional
    Lactation number (parity). If provided, it is coerced to an
    integer.
continent : str or None, optional
    Geographic region identifier. Must be one of <code>"USA"</code>,
    <code>"EU"</code>, or <code>"CHEN"</code> if provided. Case-insensitive.</p>

<p>Extra input for persistency calculation:
    persistency_method (String): way of calculating persistency, options: 'derived' which gives the average slope of the lactation after the peak until the end of lactation (default) or 'literature' for the wood and milkbot model.
    Lactation_length: string or int: length of the lactation in days to calculate persistency over, options: 305 = default or 'max'  uses the maximum DIM in the data, or an integer value to set the desired lactation length.</p>

<h2 id="returns">Returns</h2>

<p>PreparedInputs
    A dataclass containing the cleaned numeric arrays (<code>dim</code>,
    <code>milkrecordings</code>) and the normalized optional parameters.</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If input arrays have different lengths, contain insufficient
    valid observations, or if categorical parameters are invalid.</p>

<h2 id="notes">Notes</h2>

<p>Observations with missing or non-finite values in either <code>dim</code> or
<code>milkrecordings</code> are removed prior to model fitting. At least two
valid observations are required to proceed.</p>
</div>


                </section>
                <section id="ali_schaeffer_model">
                            <input id="ali_schaeffer_model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ali_schaeffer_model</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">t</span>, </span><span class="param"><span class="n">a</span>, </span><span class="param"><span class="n">b</span>, </span><span class="param"><span class="n">c</span>, </span><span class="param"><span class="n">d</span>, </span><span class="param"><span class="n">k</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ali_schaeffer_model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ali_schaeffer_model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ali_schaeffer_model-128"><a href="#ali_schaeffer_model-128"><span class="linenos">128</span></a><span class="k">def</span><span class="w"> </span><span class="nf">ali_schaeffer_model</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
</span><span id="ali_schaeffer_model-129"><a href="#ali_schaeffer_model-129"><span class="linenos">129</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Ali &amp; Schaeffer lactation curve model.</span>
</span><span id="ali_schaeffer_model-130"><a href="#ali_schaeffer_model-130"><span class="linenos">130</span></a>
</span><span id="ali_schaeffer_model-131"><a href="#ali_schaeffer_model-131"><span class="linenos">131</span></a><span class="sd">    Args:</span>
</span><span id="ali_schaeffer_model-132"><a href="#ali_schaeffer_model-132"><span class="linenos">132</span></a><span class="sd">        t: Time since calving in days (DIM). Use `t &gt;= 1` to avoid `log(0)`.</span>
</span><span id="ali_schaeffer_model-133"><a href="#ali_schaeffer_model-133"><span class="linenos">133</span></a><span class="sd">        a: Intercept-like parameter (numerical).</span>
</span><span id="ali_schaeffer_model-134"><a href="#ali_schaeffer_model-134"><span class="linenos">134</span></a><span class="sd">        b: Linear coefficient on scaled time `t/340` (numerical).</span>
</span><span id="ali_schaeffer_model-135"><a href="#ali_schaeffer_model-135"><span class="linenos">135</span></a><span class="sd">        c: Quadratic coefficient on scaled time `t/340` (numerical).</span>
</span><span id="ali_schaeffer_model-136"><a href="#ali_schaeffer_model-136"><span class="linenos">136</span></a><span class="sd">        d: Coefficient on `log(340/t)` (numerical).</span>
</span><span id="ali_schaeffer_model-137"><a href="#ali_schaeffer_model-137"><span class="linenos">137</span></a><span class="sd">        k: Coefficient on `[log(340/t)]^2` (numerical).</span>
</span><span id="ali_schaeffer_model-138"><a href="#ali_schaeffer_model-138"><span class="linenos">138</span></a>
</span><span id="ali_schaeffer_model-139"><a href="#ali_schaeffer_model-139"><span class="linenos">139</span></a><span class="sd">    Returns:</span>
</span><span id="ali_schaeffer_model-140"><a href="#ali_schaeffer_model-140"><span class="linenos">140</span></a><span class="sd">        Predicted milk yield at `t`.</span>
</span><span id="ali_schaeffer_model-141"><a href="#ali_schaeffer_model-141"><span class="linenos">141</span></a>
</span><span id="ali_schaeffer_model-142"><a href="#ali_schaeffer_model-142"><span class="linenos">142</span></a><span class="sd">    Notes:</span>
</span><span id="ali_schaeffer_model-143"><a href="#ali_schaeffer_model-143"><span class="linenos">143</span></a><span class="sd">        Uses `t_scaled = t / 340` and `log_term = ln(340 / t)`.</span>
</span><span id="ali_schaeffer_model-144"><a href="#ali_schaeffer_model-144"><span class="linenos">144</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ali_schaeffer_model-145"><a href="#ali_schaeffer_model-145"><span class="linenos">145</span></a>    <span class="n">t_scaled</span> <span class="o">=</span> <span class="n">t</span> <span class="o">/</span> <span class="mi">340</span>
</span><span id="ali_schaeffer_model-146"><a href="#ali_schaeffer_model-146"><span class="linenos">146</span></a>    <span class="n">log_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">340</span> <span class="o">/</span> <span class="n">t</span><span class="p">)</span>
</span><span id="ali_schaeffer_model-147"><a href="#ali_schaeffer_model-147"><span class="linenos">147</span></a>    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">t_scaled</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="n">t_scaled</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">log_term</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="n">log_term</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Ali &amp; Schaeffer lactation curve model.</p>

<p>Args:
    t: Time since calving in days (DIM). Use <code>t &gt;= 1</code> to avoid <code>log(0)</code>.
    a: Intercept-like parameter (numerical).
    b: Linear coefficient on scaled time <code>t/340</code> (numerical).
    c: Quadratic coefficient on scaled time <code>t/340</code> (numerical).
    d: Coefficient on <code>log(340/t)</code> (numerical).
    k: Coefficient on <code>[log(340/t)]^2</code> (numerical).</p>

<p>Returns:
    Predicted milk yield at <code>t</code>.</p>

<p>Notes:
    Uses <code>t_scaled = t / 340</code> and <code>log_term = ln(340 / t)</code>.</p>
</div>


                </section>
                <section id="bayesian_fit_milkbot_single_lactation">
                            <input id="bayesian_fit_milkbot_single_lactation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">bayesian_fit_milkbot_single_lactation</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dim</span>,</span><span class="param">	<span class="n">milkrecordings</span>,</span><span class="param">	<span class="n">key</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">parity</span><span class="o">=</span><span class="mi">3</span>,</span><span class="param">	<span class="n">breed</span><span class="o">=</span><span class="s1">&#39;H&#39;</span>,</span><span class="param">	<span class="n">continent</span><span class="o">=</span><span class="s1">&#39;USA&#39;</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="bayesian_fit_milkbot_single_lactation-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#bayesian_fit_milkbot_single_lactation"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="bayesian_fit_milkbot_single_lactation-708"><a href="#bayesian_fit_milkbot_single_lactation-708"><span class="linenos">708</span></a><span class="k">def</span><span class="w"> </span><span class="nf">bayesian_fit_milkbot_single_lactation</span><span class="p">(</span>
</span><span id="bayesian_fit_milkbot_single_lactation-709"><a href="#bayesian_fit_milkbot_single_lactation-709"><span class="linenos">709</span></a>    <span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">parity</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">breed</span><span class="o">=</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="n">continent</span><span class="o">=</span><span class="s2">&quot;USA&quot;</span>
</span><span id="bayesian_fit_milkbot_single_lactation-710"><a href="#bayesian_fit_milkbot_single_lactation-710"><span class="linenos">710</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="bayesian_fit_milkbot_single_lactation-711"><a href="#bayesian_fit_milkbot_single_lactation-711"><span class="linenos">711</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="bayesian_fit_milkbot_single_lactation-712"><a href="#bayesian_fit_milkbot_single_lactation-712"><span class="linenos">712</span></a><span class="sd">    Fit a single lactation using the MilkBot API (v2.0).</span>
</span><span id="bayesian_fit_milkbot_single_lactation-713"><a href="#bayesian_fit_milkbot_single_lactation-713"><span class="linenos">713</span></a>
</span><span id="bayesian_fit_milkbot_single_lactation-714"><a href="#bayesian_fit_milkbot_single_lactation-714"><span class="linenos">714</span></a><span class="sd">    Args:</span>
</span><span id="bayesian_fit_milkbot_single_lactation-715"><a href="#bayesian_fit_milkbot_single_lactation-715"><span class="linenos">715</span></a><span class="sd">        dim: List/array of DIM values.</span>
</span><span id="bayesian_fit_milkbot_single_lactation-716"><a href="#bayesian_fit_milkbot_single_lactation-716"><span class="linenos">716</span></a><span class="sd">        milkrecordings: List/array of milk recordings (kg).</span>
</span><span id="bayesian_fit_milkbot_single_lactation-717"><a href="#bayesian_fit_milkbot_single_lactation-717"><span class="linenos">717</span></a><span class="sd">        key: API key for MilkBot.</span>
</span><span id="bayesian_fit_milkbot_single_lactation-718"><a href="#bayesian_fit_milkbot_single_lactation-718"><span class="linenos">718</span></a><span class="sd">        parity: Lactation number; values &gt;= 3 are treated as one group in priors.</span>
</span><span id="bayesian_fit_milkbot_single_lactation-719"><a href="#bayesian_fit_milkbot_single_lactation-719"><span class="linenos">719</span></a><span class="sd">        breed: &quot;H&quot; (Holstein) or &quot;J&quot; (Jersey).</span>
</span><span id="bayesian_fit_milkbot_single_lactation-720"><a href="#bayesian_fit_milkbot_single_lactation-720"><span class="linenos">720</span></a><span class="sd">        continent: Prior source:</span>
</span><span id="bayesian_fit_milkbot_single_lactation-721"><a href="#bayesian_fit_milkbot_single_lactation-721"><span class="linenos">721</span></a><span class="sd">            - &quot;USA&quot;    MilkBot USA priors</span>
</span><span id="bayesian_fit_milkbot_single_lactation-722"><a href="#bayesian_fit_milkbot_single_lactation-722"><span class="linenos">722</span></a><span class="sd">            - &quot;EU&quot;     MilkBot EU priors</span>
</span><span id="bayesian_fit_milkbot_single_lactation-723"><a href="#bayesian_fit_milkbot_single_lactation-723"><span class="linenos">723</span></a><span class="sd">            - &quot;CHEN&quot;   Chen et al. published priors</span>
</span><span id="bayesian_fit_milkbot_single_lactation-724"><a href="#bayesian_fit_milkbot_single_lactation-724"><span class="linenos">724</span></a>
</span><span id="bayesian_fit_milkbot_single_lactation-725"><a href="#bayesian_fit_milkbot_single_lactation-725"><span class="linenos">725</span></a><span class="sd">    Returns:</span>
</span><span id="bayesian_fit_milkbot_single_lactation-726"><a href="#bayesian_fit_milkbot_single_lactation-726"><span class="linenos">726</span></a><span class="sd">        Dictionary with fitted parameters and metadata:</span>
</span><span id="bayesian_fit_milkbot_single_lactation-727"><a href="#bayesian_fit_milkbot_single_lactation-727"><span class="linenos">727</span></a><span class="sd">            {</span>
</span><span id="bayesian_fit_milkbot_single_lactation-728"><a href="#bayesian_fit_milkbot_single_lactation-728"><span class="linenos">728</span></a><span class="sd">                &quot;scale&quot;: float,</span>
</span><span id="bayesian_fit_milkbot_single_lactation-729"><a href="#bayesian_fit_milkbot_single_lactation-729"><span class="linenos">729</span></a><span class="sd">                &quot;ramp&quot;: float,</span>
</span><span id="bayesian_fit_milkbot_single_lactation-730"><a href="#bayesian_fit_milkbot_single_lactation-730"><span class="linenos">730</span></a><span class="sd">                &quot;decay&quot;: float,</span>
</span><span id="bayesian_fit_milkbot_single_lactation-731"><a href="#bayesian_fit_milkbot_single_lactation-731"><span class="linenos">731</span></a><span class="sd">                &quot;offset&quot;: float,</span>
</span><span id="bayesian_fit_milkbot_single_lactation-732"><a href="#bayesian_fit_milkbot_single_lactation-732"><span class="linenos">732</span></a><span class="sd">                &quot;nPoints&quot;: int</span>
</span><span id="bayesian_fit_milkbot_single_lactation-733"><a href="#bayesian_fit_milkbot_single_lactation-733"><span class="linenos">733</span></a><span class="sd">            }</span>
</span><span id="bayesian_fit_milkbot_single_lactation-734"><a href="#bayesian_fit_milkbot_single_lactation-734"><span class="linenos">734</span></a>
</span><span id="bayesian_fit_milkbot_single_lactation-735"><a href="#bayesian_fit_milkbot_single_lactation-735"><span class="linenos">735</span></a><span class="sd">    Raises:</span>
</span><span id="bayesian_fit_milkbot_single_lactation-736"><a href="#bayesian_fit_milkbot_single_lactation-736"><span class="linenos">736</span></a><span class="sd">        requests.HTTPError: For unsuccessful HTTP response codes.</span>
</span><span id="bayesian_fit_milkbot_single_lactation-737"><a href="#bayesian_fit_milkbot_single_lactation-737"><span class="linenos">737</span></a><span class="sd">        RuntimeError: If the response format is unexpected.</span>
</span><span id="bayesian_fit_milkbot_single_lactation-738"><a href="#bayesian_fit_milkbot_single_lactation-738"><span class="linenos">738</span></a>
</span><span id="bayesian_fit_milkbot_single_lactation-739"><a href="#bayesian_fit_milkbot_single_lactation-739"><span class="linenos">739</span></a><span class="sd">    Notes:</span>
</span><span id="bayesian_fit_milkbot_single_lactation-740"><a href="#bayesian_fit_milkbot_single_lactation-740"><span class="linenos">740</span></a><span class="sd">        - When `continent == &quot;CHEN&quot;`, Chen et al. priors are included in the request payload.</span>
</span><span id="bayesian_fit_milkbot_single_lactation-741"><a href="#bayesian_fit_milkbot_single_lactation-741"><span class="linenos">741</span></a><span class="sd">        - EU calls use the GCP EU endpoint; others use `milkbot.com`.</span>
</span><span id="bayesian_fit_milkbot_single_lactation-742"><a href="#bayesian_fit_milkbot_single_lactation-742"><span class="linenos">742</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="bayesian_fit_milkbot_single_lactation-743"><a href="#bayesian_fit_milkbot_single_lactation-743"><span class="linenos">743</span></a>    <span class="c1"># check and prepare input</span>
</span><span id="bayesian_fit_milkbot_single_lactation-744"><a href="#bayesian_fit_milkbot_single_lactation-744"><span class="linenos">744</span></a>    <span class="n">inputs</span> <span class="o">=</span> <span class="n">validate_and_prepare_inputs</span><span class="p">(</span>
</span><span id="bayesian_fit_milkbot_single_lactation-745"><a href="#bayesian_fit_milkbot_single_lactation-745"><span class="linenos">745</span></a>        <span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">breed</span><span class="o">=</span><span class="n">breed</span><span class="p">,</span> <span class="n">parity</span><span class="o">=</span><span class="n">parity</span><span class="p">,</span> <span class="n">continent</span><span class="o">=</span><span class="n">continent</span>
</span><span id="bayesian_fit_milkbot_single_lactation-746"><a href="#bayesian_fit_milkbot_single_lactation-746"><span class="linenos">746</span></a>    <span class="p">)</span>
</span><span id="bayesian_fit_milkbot_single_lactation-747"><a href="#bayesian_fit_milkbot_single_lactation-747"><span class="linenos">747</span></a>
</span><span id="bayesian_fit_milkbot_single_lactation-748"><a href="#bayesian_fit_milkbot_single_lactation-748"><span class="linenos">748</span></a>    <span class="n">dim</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">dim</span>
</span><span id="bayesian_fit_milkbot_single_lactation-749"><a href="#bayesian_fit_milkbot_single_lactation-749"><span class="linenos">749</span></a>    <span class="n">milkrecordings</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">milkrecordings</span>
</span><span id="bayesian_fit_milkbot_single_lactation-750"><a href="#bayesian_fit_milkbot_single_lactation-750"><span class="linenos">750</span></a>    <span class="n">breed</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">breed</span>
</span><span id="bayesian_fit_milkbot_single_lactation-751"><a href="#bayesian_fit_milkbot_single_lactation-751"><span class="linenos">751</span></a>    <span class="n">parity</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">parity</span>
</span><span id="bayesian_fit_milkbot_single_lactation-752"><a href="#bayesian_fit_milkbot_single_lactation-752"><span class="linenos">752</span></a>    <span class="n">continent</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">continent</span>
</span><span id="bayesian_fit_milkbot_single_lactation-753"><a href="#bayesian_fit_milkbot_single_lactation-753"><span class="linenos">753</span></a>
</span><span id="bayesian_fit_milkbot_single_lactation-754"><a href="#bayesian_fit_milkbot_single_lactation-754"><span class="linenos">754</span></a>    <span class="c1"># -----------------------------</span>
</span><span id="bayesian_fit_milkbot_single_lactation-755"><a href="#bayesian_fit_milkbot_single_lactation-755"><span class="linenos">755</span></a>    <span class="c1"># Select server (USA vs EU)</span>
</span><span id="bayesian_fit_milkbot_single_lactation-756"><a href="#bayesian_fit_milkbot_single_lactation-756"><span class="linenos">756</span></a>    <span class="c1"># -----------------------------</span>
</span><span id="bayesian_fit_milkbot_single_lactation-757"><a href="#bayesian_fit_milkbot_single_lactation-757"><span class="linenos">757</span></a>    <span class="k">if</span> <span class="n">continent</span> <span class="o">==</span> <span class="s2">&quot;EU&quot;</span><span class="p">:</span>
</span><span id="bayesian_fit_milkbot_single_lactation-758"><a href="#bayesian_fit_milkbot_single_lactation-758"><span class="linenos">758</span></a>        <span class="n">base_url</span> <span class="o">=</span> <span class="s2">&quot;https://europe-west1-numeric-analogy-337601.cloudfunctions.net/milkBot-fitter&quot;</span>
</span><span id="bayesian_fit_milkbot_single_lactation-759"><a href="#bayesian_fit_milkbot_single_lactation-759"><span class="linenos">759</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="bayesian_fit_milkbot_single_lactation-760"><a href="#bayesian_fit_milkbot_single_lactation-760"><span class="linenos">760</span></a>        <span class="n">base_url</span> <span class="o">=</span> <span class="s2">&quot;https://milkbot.com&quot;</span>
</span><span id="bayesian_fit_milkbot_single_lactation-761"><a href="#bayesian_fit_milkbot_single_lactation-761"><span class="linenos">761</span></a>
</span><span id="bayesian_fit_milkbot_single_lactation-762"><a href="#bayesian_fit_milkbot_single_lactation-762"><span class="linenos">762</span></a>    <span class="c1"># -----------------------------</span>
</span><span id="bayesian_fit_milkbot_single_lactation-763"><a href="#bayesian_fit_milkbot_single_lactation-763"><span class="linenos">763</span></a>    <span class="c1"># Prepare headers</span>
</span><span id="bayesian_fit_milkbot_single_lactation-764"><a href="#bayesian_fit_milkbot_single_lactation-764"><span class="linenos">764</span></a>    <span class="c1"># -----------------------------</span>
</span><span id="bayesian_fit_milkbot_single_lactation-765"><a href="#bayesian_fit_milkbot_single_lactation-765"><span class="linenos">765</span></a>    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span> <span class="s2">&quot;X-API-KEY&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">}</span>
</span><span id="bayesian_fit_milkbot_single_lactation-766"><a href="#bayesian_fit_milkbot_single_lactation-766"><span class="linenos">766</span></a>
</span><span id="bayesian_fit_milkbot_single_lactation-767"><a href="#bayesian_fit_milkbot_single_lactation-767"><span class="linenos">767</span></a>    <span class="c1"># -----------------------------</span>
</span><span id="bayesian_fit_milkbot_single_lactation-768"><a href="#bayesian_fit_milkbot_single_lactation-768"><span class="linenos">768</span></a>    <span class="c1"># Prepare milk points</span>
</span><span id="bayesian_fit_milkbot_single_lactation-769"><a href="#bayesian_fit_milkbot_single_lactation-769"><span class="linenos">769</span></a>    <span class="c1"># -----------------------------</span>
</span><span id="bayesian_fit_milkbot_single_lactation-770"><a href="#bayesian_fit_milkbot_single_lactation-770"><span class="linenos">770</span></a>    <span class="n">points</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="bayesian_fit_milkbot_single_lactation-771"><a href="#bayesian_fit_milkbot_single_lactation-771"><span class="linenos">771</span></a>        <span class="p">({</span><span class="s2">&quot;dim&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="s2">&quot;milk&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="p">)}</span> <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">)),</span>
</span><span id="bayesian_fit_milkbot_single_lactation-772"><a href="#bayesian_fit_milkbot_single_lactation-772"><span class="linenos">772</span></a>        <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;dim&quot;</span><span class="p">],</span>
</span><span id="bayesian_fit_milkbot_single_lactation-773"><a href="#bayesian_fit_milkbot_single_lactation-773"><span class="linenos">773</span></a>    <span class="p">)</span>
</span><span id="bayesian_fit_milkbot_single_lactation-774"><a href="#bayesian_fit_milkbot_single_lactation-774"><span class="linenos">774</span></a>
</span><span id="bayesian_fit_milkbot_single_lactation-775"><a href="#bayesian_fit_milkbot_single_lactation-775"><span class="linenos">775</span></a>    <span class="c1"># -----------------------------</span>
</span><span id="bayesian_fit_milkbot_single_lactation-776"><a href="#bayesian_fit_milkbot_single_lactation-776"><span class="linenos">776</span></a>    <span class="c1"># Lactation metadata</span>
</span><span id="bayesian_fit_milkbot_single_lactation-777"><a href="#bayesian_fit_milkbot_single_lactation-777"><span class="linenos">777</span></a>    <span class="c1"># -----------------------------</span>
</span><span id="bayesian_fit_milkbot_single_lactation-778"><a href="#bayesian_fit_milkbot_single_lactation-778"><span class="linenos">778</span></a>    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="bayesian_fit_milkbot_single_lactation-779"><a href="#bayesian_fit_milkbot_single_lactation-779"><span class="linenos">779</span></a>        <span class="s2">&quot;lactation&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="bayesian_fit_milkbot_single_lactation-780"><a href="#bayesian_fit_milkbot_single_lactation-780"><span class="linenos">780</span></a>            <span class="s2">&quot;lacKey&quot;</span><span class="p">:</span> <span class="s2">&quot;single_lactation_fit&quot;</span><span class="p">,</span>
</span><span id="bayesian_fit_milkbot_single_lactation-781"><a href="#bayesian_fit_milkbot_single_lactation-781"><span class="linenos">781</span></a>            <span class="s2">&quot;breed&quot;</span><span class="p">:</span> <span class="n">breed</span><span class="p">,</span>
</span><span id="bayesian_fit_milkbot_single_lactation-782"><a href="#bayesian_fit_milkbot_single_lactation-782"><span class="linenos">782</span></a>            <span class="s2">&quot;parity&quot;</span><span class="p">:</span> <span class="n">parity</span><span class="p">,</span>
</span><span id="bayesian_fit_milkbot_single_lactation-783"><a href="#bayesian_fit_milkbot_single_lactation-783"><span class="linenos">783</span></a>            <span class="s2">&quot;points&quot;</span><span class="p">:</span> <span class="n">points</span><span class="p">,</span>
</span><span id="bayesian_fit_milkbot_single_lactation-784"><a href="#bayesian_fit_milkbot_single_lactation-784"><span class="linenos">784</span></a>        <span class="p">},</span>
</span><span id="bayesian_fit_milkbot_single_lactation-785"><a href="#bayesian_fit_milkbot_single_lactation-785"><span class="linenos">785</span></a>        <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="bayesian_fit_milkbot_single_lactation-786"><a href="#bayesian_fit_milkbot_single_lactation-786"><span class="linenos">786</span></a>            <span class="s2">&quot;returnInputData&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="bayesian_fit_milkbot_single_lactation-787"><a href="#bayesian_fit_milkbot_single_lactation-787"><span class="linenos">787</span></a>            <span class="s2">&quot;returnPath&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="bayesian_fit_milkbot_single_lactation-788"><a href="#bayesian_fit_milkbot_single_lactation-788"><span class="linenos">788</span></a>            <span class="s2">&quot;returnDiscriminatorPath&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="bayesian_fit_milkbot_single_lactation-789"><a href="#bayesian_fit_milkbot_single_lactation-789"><span class="linenos">789</span></a>            <span class="s2">&quot;fitEngine&quot;</span><span class="p">:</span> <span class="s2">&quot;AnnealingFitter@2.0&quot;</span><span class="p">,</span>
</span><span id="bayesian_fit_milkbot_single_lactation-790"><a href="#bayesian_fit_milkbot_single_lactation-790"><span class="linenos">790</span></a>            <span class="s2">&quot;fitObjective&quot;</span><span class="p">:</span> <span class="s2">&quot;MB2@1.0&quot;</span><span class="p">,</span>
</span><span id="bayesian_fit_milkbot_single_lactation-791"><a href="#bayesian_fit_milkbot_single_lactation-791"><span class="linenos">791</span></a>            <span class="s2">&quot;preferredMilkUnit&quot;</span><span class="p">:</span> <span class="s2">&quot;kg&quot;</span><span class="p">,</span>
</span><span id="bayesian_fit_milkbot_single_lactation-792"><a href="#bayesian_fit_milkbot_single_lactation-792"><span class="linenos">792</span></a>        <span class="p">},</span>
</span><span id="bayesian_fit_milkbot_single_lactation-793"><a href="#bayesian_fit_milkbot_single_lactation-793"><span class="linenos">793</span></a>    <span class="p">}</span>
</span><span id="bayesian_fit_milkbot_single_lactation-794"><a href="#bayesian_fit_milkbot_single_lactation-794"><span class="linenos">794</span></a>
</span><span id="bayesian_fit_milkbot_single_lactation-795"><a href="#bayesian_fit_milkbot_single_lactation-795"><span class="linenos">795</span></a>    <span class="c1"># -----------------------------</span>
</span><span id="bayesian_fit_milkbot_single_lactation-796"><a href="#bayesian_fit_milkbot_single_lactation-796"><span class="linenos">796</span></a>    <span class="c1"># Add priors only if Chen</span>
</span><span id="bayesian_fit_milkbot_single_lactation-797"><a href="#bayesian_fit_milkbot_single_lactation-797"><span class="linenos">797</span></a>    <span class="c1"># -----------------------------</span>
</span><span id="bayesian_fit_milkbot_single_lactation-798"><a href="#bayesian_fit_milkbot_single_lactation-798"><span class="linenos">798</span></a>    <span class="k">if</span> <span class="n">continent</span> <span class="o">==</span> <span class="s2">&quot;CHEN&quot;</span><span class="p">:</span>
</span><span id="bayesian_fit_milkbot_single_lactation-799"><a href="#bayesian_fit_milkbot_single_lactation-799"><span class="linenos">799</span></a>        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;priors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_chen_priors</span><span class="p">(</span><span class="n">parity</span><span class="p">)</span>
</span><span id="bayesian_fit_milkbot_single_lactation-800"><a href="#bayesian_fit_milkbot_single_lactation-800"><span class="linenos">800</span></a>
</span><span id="bayesian_fit_milkbot_single_lactation-801"><a href="#bayesian_fit_milkbot_single_lactation-801"><span class="linenos">801</span></a>    <span class="c1"># -----------------------------</span>
</span><span id="bayesian_fit_milkbot_single_lactation-802"><a href="#bayesian_fit_milkbot_single_lactation-802"><span class="linenos">802</span></a>    <span class="c1"># Call API</span>
</span><span id="bayesian_fit_milkbot_single_lactation-803"><a href="#bayesian_fit_milkbot_single_lactation-803"><span class="linenos">803</span></a>    <span class="c1"># -----------------------------</span>
</span><span id="bayesian_fit_milkbot_single_lactation-804"><a href="#bayesian_fit_milkbot_single_lactation-804"><span class="linenos">804</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/fitLactation&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
</span><span id="bayesian_fit_milkbot_single_lactation-805"><a href="#bayesian_fit_milkbot_single_lactation-805"><span class="linenos">805</span></a>    <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
</span><span id="bayesian_fit_milkbot_single_lactation-806"><a href="#bayesian_fit_milkbot_single_lactation-806"><span class="linenos">806</span></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="bayesian_fit_milkbot_single_lactation-807"><a href="#bayesian_fit_milkbot_single_lactation-807"><span class="linenos">807</span></a>
</span><span id="bayesian_fit_milkbot_single_lactation-808"><a href="#bayesian_fit_milkbot_single_lactation-808"><span class="linenos">808</span></a>    <span class="c1"># -----------------------------</span>
</span><span id="bayesian_fit_milkbot_single_lactation-809"><a href="#bayesian_fit_milkbot_single_lactation-809"><span class="linenos">809</span></a>    <span class="c1"># Normalize response (USA vs EU)</span>
</span><span id="bayesian_fit_milkbot_single_lactation-810"><a href="#bayesian_fit_milkbot_single_lactation-810"><span class="linenos">810</span></a>    <span class="c1"># -----------------------------</span>
</span><span id="bayesian_fit_milkbot_single_lactation-811"><a href="#bayesian_fit_milkbot_single_lactation-811"><span class="linenos">811</span></a>    <span class="k">if</span> <span class="s2">&quot;fittedParams&quot;</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
</span><span id="bayesian_fit_milkbot_single_lactation-812"><a href="#bayesian_fit_milkbot_single_lactation-812"><span class="linenos">812</span></a>        <span class="c1"># USA-style response</span>
</span><span id="bayesian_fit_milkbot_single_lactation-813"><a href="#bayesian_fit_milkbot_single_lactation-813"><span class="linenos">813</span></a>        <span class="n">fitted</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;fittedParams&quot;</span><span class="p">]</span>
</span><span id="bayesian_fit_milkbot_single_lactation-814"><a href="#bayesian_fit_milkbot_single_lactation-814"><span class="linenos">814</span></a>    <span class="k">elif</span> <span class="s2">&quot;params&quot;</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
</span><span id="bayesian_fit_milkbot_single_lactation-815"><a href="#bayesian_fit_milkbot_single_lactation-815"><span class="linenos">815</span></a>        <span class="n">fitted</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span>
</span><span id="bayesian_fit_milkbot_single_lactation-816"><a href="#bayesian_fit_milkbot_single_lactation-816"><span class="linenos">816</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="bayesian_fit_milkbot_single_lactation-817"><a href="#bayesian_fit_milkbot_single_lactation-817"><span class="linenos">817</span></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected MilkBot response format: </span><span class="si">{</span><span class="n">res</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="bayesian_fit_milkbot_single_lactation-818"><a href="#bayesian_fit_milkbot_single_lactation-818"><span class="linenos">818</span></a>
</span><span id="bayesian_fit_milkbot_single_lactation-819"><a href="#bayesian_fit_milkbot_single_lactation-819"><span class="linenos">819</span></a>    <span class="c1"># -----------------------------</span>
</span><span id="bayesian_fit_milkbot_single_lactation-820"><a href="#bayesian_fit_milkbot_single_lactation-820"><span class="linenos">820</span></a>    <span class="c1"># Parse result</span>
</span><span id="bayesian_fit_milkbot_single_lactation-821"><a href="#bayesian_fit_milkbot_single_lactation-821"><span class="linenos">821</span></a>    <span class="c1"># -----------------------------</span>
</span><span id="bayesian_fit_milkbot_single_lactation-822"><a href="#bayesian_fit_milkbot_single_lactation-822"><span class="linenos">822</span></a>
</span><span id="bayesian_fit_milkbot_single_lactation-823"><a href="#bayesian_fit_milkbot_single_lactation-823"><span class="linenos">823</span></a>    <span class="k">return</span> <span class="p">{</span>
</span><span id="bayesian_fit_milkbot_single_lactation-824"><a href="#bayesian_fit_milkbot_single_lactation-824"><span class="linenos">824</span></a>        <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="n">fitted</span><span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">],</span>
</span><span id="bayesian_fit_milkbot_single_lactation-825"><a href="#bayesian_fit_milkbot_single_lactation-825"><span class="linenos">825</span></a>        <span class="s2">&quot;ramp&quot;</span><span class="p">:</span> <span class="n">fitted</span><span class="p">[</span><span class="s2">&quot;ramp&quot;</span><span class="p">],</span>
</span><span id="bayesian_fit_milkbot_single_lactation-826"><a href="#bayesian_fit_milkbot_single_lactation-826"><span class="linenos">826</span></a>        <span class="s2">&quot;decay&quot;</span><span class="p">:</span> <span class="n">fitted</span><span class="p">[</span><span class="s2">&quot;decay&quot;</span><span class="p">],</span>
</span><span id="bayesian_fit_milkbot_single_lactation-827"><a href="#bayesian_fit_milkbot_single_lactation-827"><span class="linenos">827</span></a>        <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="n">fitted</span><span class="p">[</span><span class="s2">&quot;offset&quot;</span><span class="p">],</span>
</span><span id="bayesian_fit_milkbot_single_lactation-828"><a href="#bayesian_fit_milkbot_single_lactation-828"><span class="linenos">828</span></a>        <span class="s2">&quot;nPoints&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">),</span>
</span><span id="bayesian_fit_milkbot_single_lactation-829"><a href="#bayesian_fit_milkbot_single_lactation-829"><span class="linenos">829</span></a>    <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Fit a single lactation using the MilkBot API (v2.0).</p>

<p>Args:
    dim: List/array of DIM values.
    milkrecordings: List/array of milk recordings (kg).
    key: API key for MilkBot.
    parity: Lactation number; values &gt;= 3 are treated as one group in priors.
    breed: "H" (Holstein) or "J" (Jersey).
    continent: Prior source:
        - "USA"    MilkBot USA priors
        - "EU"     MilkBot EU priors
        - "CHEN"   Chen et al. published priors</p>

<p>Returns:
    Dictionary with fitted parameters and metadata:
        {
            "scale": float,
            "ramp": float,
            "decay": float,
            "offset": float,
            "nPoints": int
        }</p>

<p>Raises:
    requests.HTTPError: For unsuccessful HTTP response codes.
    RuntimeError: If the response format is unexpected.</p>

<p>Notes:
    - When <code>continent == "CHEN"</code>, Chen et al. priors are included in the request payload.
    - EU calls use the GCP EU endpoint; others use <code>milkbot.com</code>.</p>
</div>


                </section>
                <section id="brody_model">
                            <input id="brody_model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">brody_model</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">t</span>, </span><span class="param"><span class="n">a</span>, </span><span class="param"><span class="n">k</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="brody_model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#brody_model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="brody_model-165"><a href="#brody_model-165"><span class="linenos">165</span></a><span class="k">def</span><span class="w"> </span><span class="nf">brody_model</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
</span><span id="brody_model-166"><a href="#brody_model-166"><span class="linenos">166</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Brody lactation curve model.</span>
</span><span id="brody_model-167"><a href="#brody_model-167"><span class="linenos">167</span></a>
</span><span id="brody_model-168"><a href="#brody_model-168"><span class="linenos">168</span></a><span class="sd">    Args:</span>
</span><span id="brody_model-169"><a href="#brody_model-169"><span class="linenos">169</span></a><span class="sd">        t: Time since calving in days (DIM).</span>
</span><span id="brody_model-170"><a href="#brody_model-170"><span class="linenos">170</span></a><span class="sd">        a: Scale parameter (numerical).</span>
</span><span id="brody_model-171"><a href="#brody_model-171"><span class="linenos">171</span></a><span class="sd">        k: Decay parameter (numerical).</span>
</span><span id="brody_model-172"><a href="#brody_model-172"><span class="linenos">172</span></a>
</span><span id="brody_model-173"><a href="#brody_model-173"><span class="linenos">173</span></a><span class="sd">    Returns:</span>
</span><span id="brody_model-174"><a href="#brody_model-174"><span class="linenos">174</span></a><span class="sd">        Predicted milk yield at `t`.</span>
</span><span id="brody_model-175"><a href="#brody_model-175"><span class="linenos">175</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="brody_model-176"><a href="#brody_model-176"><span class="linenos">176</span></a>    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Brody lactation curve model.</p>

<p>Args:
    t: Time since calving in days (DIM).
    a: Scale parameter (numerical).
    k: Decay parameter (numerical).</p>

<p>Returns:
    Predicted milk yield at <code>t</code>.</p>
</div>


                </section>
                <section id="dhanoa_model">
                            <input id="dhanoa_model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">dhanoa_model</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">t</span>, </span><span class="param"><span class="n">a</span>, </span><span class="param"><span class="n">b</span>, </span><span class="param"><span class="n">c</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="dhanoa_model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#dhanoa_model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="dhanoa_model-212"><a href="#dhanoa_model-212"><span class="linenos">212</span></a><span class="k">def</span><span class="w"> </span><span class="nf">dhanoa_model</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
</span><span id="dhanoa_model-213"><a href="#dhanoa_model-213"><span class="linenos">213</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Dhanoa lactation curve model.</span>
</span><span id="dhanoa_model-214"><a href="#dhanoa_model-214"><span class="linenos">214</span></a>
</span><span id="dhanoa_model-215"><a href="#dhanoa_model-215"><span class="linenos">215</span></a><span class="sd">    Args:</span>
</span><span id="dhanoa_model-216"><a href="#dhanoa_model-216"><span class="linenos">216</span></a><span class="sd">        t: Time since calving in days (DIM).</span>
</span><span id="dhanoa_model-217"><a href="#dhanoa_model-217"><span class="linenos">217</span></a><span class="sd">        a: Scale parameter (numerical).</span>
</span><span id="dhanoa_model-218"><a href="#dhanoa_model-218"><span class="linenos">218</span></a><span class="sd">        b: Shape parameter (numerical).</span>
</span><span id="dhanoa_model-219"><a href="#dhanoa_model-219"><span class="linenos">219</span></a><span class="sd">        c: Decay parameter (numerical).</span>
</span><span id="dhanoa_model-220"><a href="#dhanoa_model-220"><span class="linenos">220</span></a>
</span><span id="dhanoa_model-221"><a href="#dhanoa_model-221"><span class="linenos">221</span></a><span class="sd">    Returns:</span>
</span><span id="dhanoa_model-222"><a href="#dhanoa_model-222"><span class="linenos">222</span></a><span class="sd">        Predicted milk yield at `t`.</span>
</span><span id="dhanoa_model-223"><a href="#dhanoa_model-223"><span class="linenos">223</span></a>
</span><span id="dhanoa_model-224"><a href="#dhanoa_model-224"><span class="linenos">224</span></a><span class="sd">    Notes:</span>
</span><span id="dhanoa_model-225"><a href="#dhanoa_model-225"><span class="linenos">225</span></a><span class="sd">        Formula: `y(t) = a * t ** (b * c) * exp(-c * t)`.</span>
</span><span id="dhanoa_model-226"><a href="#dhanoa_model-226"><span class="linenos">226</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="dhanoa_model-227"><a href="#dhanoa_model-227"><span class="linenos">227</span></a>    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">t</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">c</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Dhanoa lactation curve model.</p>

<p>Args:
    t: Time since calving in days (DIM).
    a: Scale parameter (numerical).
    b: Shape parameter (numerical).
    c: Decay parameter (numerical).</p>

<p>Returns:
    Predicted milk yield at <code>t</code>.</p>

<p>Notes:
    Formula: <code>y(t) = a * t ** (b * c) * exp(-c * t)</code>.</p>
</div>


                </section>
                <section id="dijkstra_model">
                            <input id="dijkstra_model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">dijkstra_model</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">t</span>, </span><span class="param"><span class="n">a</span>, </span><span class="param"><span class="n">b</span>, </span><span class="param"><span class="n">c</span>, </span><span class="param"><span class="n">d</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="dijkstra_model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#dijkstra_model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="dijkstra_model-287"><a href="#dijkstra_model-287"><span class="linenos">287</span></a><span class="k">def</span><span class="w"> </span><span class="nf">dijkstra_model</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
</span><span id="dijkstra_model-288"><a href="#dijkstra_model-288"><span class="linenos">288</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Dijkstra lactation curve model.</span>
</span><span id="dijkstra_model-289"><a href="#dijkstra_model-289"><span class="linenos">289</span></a>
</span><span id="dijkstra_model-290"><a href="#dijkstra_model-290"><span class="linenos">290</span></a><span class="sd">    Args:</span>
</span><span id="dijkstra_model-291"><a href="#dijkstra_model-291"><span class="linenos">291</span></a><span class="sd">        t: Time since calving in days (DIM).</span>
</span><span id="dijkstra_model-292"><a href="#dijkstra_model-292"><span class="linenos">292</span></a><span class="sd">        a: Scale parameter (numerical).</span>
</span><span id="dijkstra_model-293"><a href="#dijkstra_model-293"><span class="linenos">293</span></a><span class="sd">        b: Growth parameter (numerical).</span>
</span><span id="dijkstra_model-294"><a href="#dijkstra_model-294"><span class="linenos">294</span></a><span class="sd">        c: Saturation rate parameter (numerical).</span>
</span><span id="dijkstra_model-295"><a href="#dijkstra_model-295"><span class="linenos">295</span></a><span class="sd">        d: Decay parameter (numerical).</span>
</span><span id="dijkstra_model-296"><a href="#dijkstra_model-296"><span class="linenos">296</span></a>
</span><span id="dijkstra_model-297"><a href="#dijkstra_model-297"><span class="linenos">297</span></a><span class="sd">    Returns:</span>
</span><span id="dijkstra_model-298"><a href="#dijkstra_model-298"><span class="linenos">298</span></a><span class="sd">        Predicted milk yield at `t`.</span>
</span><span id="dijkstra_model-299"><a href="#dijkstra_model-299"><span class="linenos">299</span></a>
</span><span id="dijkstra_model-300"><a href="#dijkstra_model-300"><span class="linenos">300</span></a><span class="sd">    Notes:</span>
</span><span id="dijkstra_model-301"><a href="#dijkstra_model-301"><span class="linenos">301</span></a><span class="sd">        Formula: `y(t) = a * exp((b * (1 - exp(-c * t)) / c) - d * t)`.</span>
</span><span id="dijkstra_model-302"><a href="#dijkstra_model-302"><span class="linenos">302</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="dijkstra_model-303"><a href="#dijkstra_model-303"><span class="linenos">303</span></a>    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">c</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span> <span class="o">/</span> <span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="n">d</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Dijkstra lactation curve model.</p>

<p>Args:
    t: Time since calving in days (DIM).
    a: Scale parameter (numerical).
    b: Growth parameter (numerical).
    c: Saturation rate parameter (numerical).
    d: Decay parameter (numerical).</p>

<p>Returns:
    Predicted milk yield at <code>t</code>.</p>

<p>Notes:
    Formula: <code>y(t) = a * exp((b * (1 - exp(-c * t)) / c) - d * t)</code>.</p>
</div>


                </section>
                <section id="emmans_model">
                            <input id="emmans_model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">emmans_model</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">t</span>, </span><span class="param"><span class="n">a</span>, </span><span class="param"><span class="n">b</span>, </span><span class="param"><span class="n">c</span>, </span><span class="param"><span class="n">d</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="emmans_model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#emmans_model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="emmans_model-230"><a href="#emmans_model-230"><span class="linenos">230</span></a><span class="k">def</span><span class="w"> </span><span class="nf">emmans_model</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
</span><span id="emmans_model-231"><a href="#emmans_model-231"><span class="linenos">231</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Emmans lactation curve model.</span>
</span><span id="emmans_model-232"><a href="#emmans_model-232"><span class="linenos">232</span></a>
</span><span id="emmans_model-233"><a href="#emmans_model-233"><span class="linenos">233</span></a><span class="sd">    Args:</span>
</span><span id="emmans_model-234"><a href="#emmans_model-234"><span class="linenos">234</span></a><span class="sd">        t: Time since calving in days (DIM).</span>
</span><span id="emmans_model-235"><a href="#emmans_model-235"><span class="linenos">235</span></a><span class="sd">        a: Scale parameter (numerical).</span>
</span><span id="emmans_model-236"><a href="#emmans_model-236"><span class="linenos">236</span></a><span class="sd">        b: Growth parameter (numerical).</span>
</span><span id="emmans_model-237"><a href="#emmans_model-237"><span class="linenos">237</span></a><span class="sd">        c: Decay parameter (numerical).</span>
</span><span id="emmans_model-238"><a href="#emmans_model-238"><span class="linenos">238</span></a><span class="sd">        d: Location parameter in nested exponential (numerical).</span>
</span><span id="emmans_model-239"><a href="#emmans_model-239"><span class="linenos">239</span></a>
</span><span id="emmans_model-240"><a href="#emmans_model-240"><span class="linenos">240</span></a><span class="sd">    Returns:</span>
</span><span id="emmans_model-241"><a href="#emmans_model-241"><span class="linenos">241</span></a><span class="sd">        Predicted milk yield at `t`.</span>
</span><span id="emmans_model-242"><a href="#emmans_model-242"><span class="linenos">242</span></a>
</span><span id="emmans_model-243"><a href="#emmans_model-243"><span class="linenos">243</span></a><span class="sd">    Notes:</span>
</span><span id="emmans_model-244"><a href="#emmans_model-244"><span class="linenos">244</span></a><span class="sd">        Formula: `y(t) = a * exp(-exp(d - b*t)) * exp(-c*t)`.</span>
</span><span id="emmans_model-245"><a href="#emmans_model-245"><span class="linenos">245</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="emmans_model-246"><a href="#emmans_model-246"><span class="linenos">246</span></a>    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">b</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">c</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Emmans lactation curve model.</p>

<p>Args:
    t: Time since calving in days (DIM).
    a: Scale parameter (numerical).
    b: Growth parameter (numerical).
    c: Decay parameter (numerical).
    d: Location parameter in nested exponential (numerical).</p>

<p>Returns:
    Predicted milk yield at <code>t</code>.</p>

<p>Notes:
    Formula: <code>y(t) = a * exp(-exp(d - b*t)) * exp(-c*t)</code>.</p>
</div>


                </section>
                <section id="fischer_model">
                            <input id="fischer_model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fischer_model</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">t</span>, </span><span class="param"><span class="n">a</span>, </span><span class="param"><span class="n">b</span>, </span><span class="param"><span class="n">c</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="fischer_model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#fischer_model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="fischer_model-150"><a href="#fischer_model-150"><span class="linenos">150</span></a><span class="k">def</span><span class="w"> </span><span class="nf">fischer_model</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
</span><span id="fischer_model-151"><a href="#fischer_model-151"><span class="linenos">151</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Fischer lactation curve model.</span>
</span><span id="fischer_model-152"><a href="#fischer_model-152"><span class="linenos">152</span></a>
</span><span id="fischer_model-153"><a href="#fischer_model-153"><span class="linenos">153</span></a><span class="sd">    Args:</span>
</span><span id="fischer_model-154"><a href="#fischer_model-154"><span class="linenos">154</span></a><span class="sd">        t: Time since calving in days (DIM).</span>
</span><span id="fischer_model-155"><a href="#fischer_model-155"><span class="linenos">155</span></a><span class="sd">        a: Scale parameter (numerical).</span>
</span><span id="fischer_model-156"><a href="#fischer_model-156"><span class="linenos">156</span></a><span class="sd">        b: Linear decline parameter (numerical).</span>
</span><span id="fischer_model-157"><a href="#fischer_model-157"><span class="linenos">157</span></a><span class="sd">        c: Exponential decay parameter (numerical).</span>
</span><span id="fischer_model-158"><a href="#fischer_model-158"><span class="linenos">158</span></a>
</span><span id="fischer_model-159"><a href="#fischer_model-159"><span class="linenos">159</span></a><span class="sd">    Returns:</span>
</span><span id="fischer_model-160"><a href="#fischer_model-160"><span class="linenos">160</span></a><span class="sd">        Predicted milk yield at `t`.</span>
</span><span id="fischer_model-161"><a href="#fischer_model-161"><span class="linenos">161</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="fischer_model-162"><a href="#fischer_model-162"><span class="linenos">162</span></a>    <span class="k">return</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span> <span class="o">*</span> <span class="n">t</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">c</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Fischer lactation curve model.</p>

<p>Args:
    t: Time since calving in days (DIM).
    a: Scale parameter (numerical).
    b: Linear decline parameter (numerical).
    c: Exponential decay parameter (numerical).</p>

<p>Returns:
    Predicted milk yield at <code>t</code>.</p>
</div>


                </section>
                <section id="fit_lactation_curve">
                            <input id="fit_lactation_curve-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fit_lactation_curve</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dim</span>,</span><span class="param">	<span class="n">milkrecordings</span>,</span><span class="param">	<span class="n">model</span><span class="o">=</span><span class="s1">&#39;wood&#39;</span>,</span><span class="param">	<span class="n">fitting</span><span class="o">=</span><span class="s1">&#39;frequentist&#39;</span>,</span><span class="param">	<span class="n">breed</span><span class="o">=</span><span class="s1">&#39;H&#39;</span>,</span><span class="param">	<span class="n">parity</span><span class="o">=</span><span class="mi">3</span>,</span><span class="param">	<span class="n">continent</span><span class="o">=</span><span class="s1">&#39;USA&#39;</span>,</span><span class="param">	<span class="n">key</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="fit_lactation_curve-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#fit_lactation_curve"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="fit_lactation_curve-383"><a href="#fit_lactation_curve-383"><span class="linenos">383</span></a><span class="k">def</span><span class="w"> </span><span class="nf">fit_lactation_curve</span><span class="p">(</span>
</span><span id="fit_lactation_curve-384"><a href="#fit_lactation_curve-384"><span class="linenos">384</span></a>    <span class="n">dim</span><span class="p">,</span>
</span><span id="fit_lactation_curve-385"><a href="#fit_lactation_curve-385"><span class="linenos">385</span></a>    <span class="n">milkrecordings</span><span class="p">,</span>
</span><span id="fit_lactation_curve-386"><a href="#fit_lactation_curve-386"><span class="linenos">386</span></a>    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;wood&quot;</span><span class="p">,</span>
</span><span id="fit_lactation_curve-387"><a href="#fit_lactation_curve-387"><span class="linenos">387</span></a>    <span class="n">fitting</span><span class="o">=</span><span class="s2">&quot;frequentist&quot;</span><span class="p">,</span>
</span><span id="fit_lactation_curve-388"><a href="#fit_lactation_curve-388"><span class="linenos">388</span></a>    <span class="n">breed</span><span class="o">=</span><span class="s2">&quot;H&quot;</span><span class="p">,</span>
</span><span id="fit_lactation_curve-389"><a href="#fit_lactation_curve-389"><span class="linenos">389</span></a>    <span class="n">parity</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="fit_lactation_curve-390"><a href="#fit_lactation_curve-390"><span class="linenos">390</span></a>    <span class="n">continent</span><span class="o">=</span><span class="s2">&quot;USA&quot;</span><span class="p">,</span>
</span><span id="fit_lactation_curve-391"><a href="#fit_lactation_curve-391"><span class="linenos">391</span></a>    <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="fit_lactation_curve-392"><a href="#fit_lactation_curve-392"><span class="linenos">392</span></a><span class="p">):</span>
</span><span id="fit_lactation_curve-393"><a href="#fit_lactation_curve-393"><span class="linenos">393</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Fit lactation data to a lactation curve model and return predictions.</span>
</span><span id="fit_lactation_curve-394"><a href="#fit_lactation_curve-394"><span class="linenos">394</span></a>
</span><span id="fit_lactation_curve-395"><a href="#fit_lactation_curve-395"><span class="linenos">395</span></a><span class="sd">    Depending on `fitting`:</span>
</span><span id="fit_lactation_curve-396"><a href="#fit_lactation_curve-396"><span class="linenos">396</span></a><span class="sd">    - **frequentist**: Fits parameters using `minimize` and/or `curve_fit`</span>
</span><span id="fit_lactation_curve-397"><a href="#fit_lactation_curve-397"><span class="linenos">397</span></a><span class="sd">      for the specified `model`, then predicts over DIM 1305 (or up to `max(dim)` if greater).</span>
</span><span id="fit_lactation_curve-398"><a href="#fit_lactation_curve-398"><span class="linenos">398</span></a><span class="sd">    - **bayesian**: (MilkBot only) Calls the MilkBot Bayesian fitting API and</span>
</span><span id="fit_lactation_curve-399"><a href="#fit_lactation_curve-399"><span class="linenos">399</span></a><span class="sd">      returns predictions using the fitted parameters.</span>
</span><span id="fit_lactation_curve-400"><a href="#fit_lactation_curve-400"><span class="linenos">400</span></a>
</span><span id="fit_lactation_curve-401"><a href="#fit_lactation_curve-401"><span class="linenos">401</span></a><span class="sd">    Args:</span>
</span><span id="fit_lactation_curve-402"><a href="#fit_lactation_curve-402"><span class="linenos">402</span></a><span class="sd">        dim (Int): List/array of days in milk (DIM).</span>
</span><span id="fit_lactation_curve-403"><a href="#fit_lactation_curve-403"><span class="linenos">403</span></a><span class="sd">        milkrecordings (Float): List/array of milk recordings (kg).</span>
</span><span id="fit_lactation_curve-404"><a href="#fit_lactation_curve-404"><span class="linenos">404</span></a><span class="sd">        model (Str): Model name (lowercase), default &quot;wood&quot;.</span>
</span><span id="fit_lactation_curve-405"><a href="#fit_lactation_curve-405"><span class="linenos">405</span></a><span class="sd">            Supported for frequentist: &quot;wood&quot;, &quot;wilmink&quot;, &quot;ali_schaeffer&quot;, &quot;fischer&quot;, &quot;milkbot&quot;.</span>
</span><span id="fit_lactation_curve-406"><a href="#fit_lactation_curve-406"><span class="linenos">406</span></a><span class="sd">        fitting (Str): &quot;frequentist&quot; (default) or &quot;bayesian&quot;.</span>
</span><span id="fit_lactation_curve-407"><a href="#fit_lactation_curve-407"><span class="linenos">407</span></a><span class="sd">            Bayesian fitting is currently implemented only for &quot;milkbot&quot;.</span>
</span><span id="fit_lactation_curve-408"><a href="#fit_lactation_curve-408"><span class="linenos">408</span></a><span class="sd">        breed (Str): &quot;H&quot; (Holstein, default) or &quot;J&quot; (Jersey). Only used for Bayesian.</span>
</span><span id="fit_lactation_curve-409"><a href="#fit_lactation_curve-409"><span class="linenos">409</span></a><span class="sd">        parity (Int): Lactation number; all parities &gt;= 3 considered one group in priors (Bayesian).</span>
</span><span id="fit_lactation_curve-410"><a href="#fit_lactation_curve-410"><span class="linenos">410</span></a><span class="sd">        continent (Str): Prior source for Bayesian, &quot;USA&quot; (default), &quot;EU&quot;, or &quot;CHEN&quot;.</span>
</span><span id="fit_lactation_curve-411"><a href="#fit_lactation_curve-411"><span class="linenos">411</span></a><span class="sd">        key (Str | None): API key for MilkBot (required when `fitting == &quot;bayesian&quot;`).</span>
</span><span id="fit_lactation_curve-412"><a href="#fit_lactation_curve-412"><span class="linenos">412</span></a>
</span><span id="fit_lactation_curve-413"><a href="#fit_lactation_curve-413"><span class="linenos">413</span></a><span class="sd">    Returns:</span>
</span><span id="fit_lactation_curve-414"><a href="#fit_lactation_curve-414"><span class="linenos">414</span></a><span class="sd">        List/array of predicted milk yield for DIM 1305 (or up to the maximum DIM if &gt; 305).</span>
</span><span id="fit_lactation_curve-415"><a href="#fit_lactation_curve-415"><span class="linenos">415</span></a>
</span><span id="fit_lactation_curve-416"><a href="#fit_lactation_curve-416"><span class="linenos">416</span></a><span class="sd">    Raises:</span>
</span><span id="fit_lactation_curve-417"><a href="#fit_lactation_curve-417"><span class="linenos">417</span></a><span class="sd">        Exception: If an unknown model is requested (frequentist),</span>
</span><span id="fit_lactation_curve-418"><a href="#fit_lactation_curve-418"><span class="linenos">418</span></a><span class="sd">            or Bayesian is requested for a non-MilkBot model,</span>
</span><span id="fit_lactation_curve-419"><a href="#fit_lactation_curve-419"><span class="linenos">419</span></a><span class="sd">            or `key` is missing when Bayesian fitting is requested.</span>
</span><span id="fit_lactation_curve-420"><a href="#fit_lactation_curve-420"><span class="linenos">420</span></a>
</span><span id="fit_lactation_curve-421"><a href="#fit_lactation_curve-421"><span class="linenos">421</span></a><span class="sd">    Notes:</span>
</span><span id="fit_lactation_curve-422"><a href="#fit_lactation_curve-422"><span class="linenos">422</span></a><span class="sd">        Uses `validate_and_prepare_inputs` for input checking and normalization.</span>
</span><span id="fit_lactation_curve-423"><a href="#fit_lactation_curve-423"><span class="linenos">423</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="fit_lactation_curve-424"><a href="#fit_lactation_curve-424"><span class="linenos">424</span></a>    <span class="c1"># check and prepare input</span>
</span><span id="fit_lactation_curve-425"><a href="#fit_lactation_curve-425"><span class="linenos">425</span></a>    <span class="n">inputs</span> <span class="o">=</span> <span class="n">validate_and_prepare_inputs</span><span class="p">(</span>
</span><span id="fit_lactation_curve-426"><a href="#fit_lactation_curve-426"><span class="linenos">426</span></a>        <span class="n">dim</span><span class="p">,</span>
</span><span id="fit_lactation_curve-427"><a href="#fit_lactation_curve-427"><span class="linenos">427</span></a>        <span class="n">milkrecordings</span><span class="p">,</span>
</span><span id="fit_lactation_curve-428"><a href="#fit_lactation_curve-428"><span class="linenos">428</span></a>        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
</span><span id="fit_lactation_curve-429"><a href="#fit_lactation_curve-429"><span class="linenos">429</span></a>        <span class="n">fitting</span><span class="o">=</span><span class="n">fitting</span><span class="p">,</span>
</span><span id="fit_lactation_curve-430"><a href="#fit_lactation_curve-430"><span class="linenos">430</span></a>        <span class="n">breed</span><span class="o">=</span><span class="n">breed</span><span class="p">,</span>
</span><span id="fit_lactation_curve-431"><a href="#fit_lactation_curve-431"><span class="linenos">431</span></a>        <span class="n">parity</span><span class="o">=</span><span class="n">parity</span><span class="p">,</span>
</span><span id="fit_lactation_curve-432"><a href="#fit_lactation_curve-432"><span class="linenos">432</span></a>        <span class="n">continent</span><span class="o">=</span><span class="n">continent</span><span class="p">,</span>
</span><span id="fit_lactation_curve-433"><a href="#fit_lactation_curve-433"><span class="linenos">433</span></a>    <span class="p">)</span>
</span><span id="fit_lactation_curve-434"><a href="#fit_lactation_curve-434"><span class="linenos">434</span></a>
</span><span id="fit_lactation_curve-435"><a href="#fit_lactation_curve-435"><span class="linenos">435</span></a>    <span class="n">dim</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">dim</span>
</span><span id="fit_lactation_curve-436"><a href="#fit_lactation_curve-436"><span class="linenos">436</span></a>    <span class="n">milkrecordings</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">milkrecordings</span>
</span><span id="fit_lactation_curve-437"><a href="#fit_lactation_curve-437"><span class="linenos">437</span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">model</span>
</span><span id="fit_lactation_curve-438"><a href="#fit_lactation_curve-438"><span class="linenos">438</span></a>    <span class="n">fitting</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">fitting</span>
</span><span id="fit_lactation_curve-439"><a href="#fit_lactation_curve-439"><span class="linenos">439</span></a>    <span class="n">breed</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">breed</span>
</span><span id="fit_lactation_curve-440"><a href="#fit_lactation_curve-440"><span class="linenos">440</span></a>    <span class="n">parity</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">parity</span>
</span><span id="fit_lactation_curve-441"><a href="#fit_lactation_curve-441"><span class="linenos">441</span></a>    <span class="n">continent</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">continent</span>
</span><span id="fit_lactation_curve-442"><a href="#fit_lactation_curve-442"><span class="linenos">442</span></a>
</span><span id="fit_lactation_curve-443"><a href="#fit_lactation_curve-443"><span class="linenos">443</span></a>    <span class="k">if</span> <span class="n">fitting</span> <span class="o">==</span> <span class="s2">&quot;frequentist&quot;</span><span class="p">:</span>
</span><span id="fit_lactation_curve-444"><a href="#fit_lactation_curve-444"><span class="linenos">444</span></a>        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;wood&quot;</span><span class="p">:</span>
</span><span id="fit_lactation_curve-445"><a href="#fit_lactation_curve-445"><span class="linenos">445</span></a>            <span class="n">a_w</span><span class="p">,</span> <span class="n">b_w</span><span class="p">,</span> <span class="n">c_w</span> <span class="o">=</span> <span class="n">get_lc_parameters</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
</span><span id="fit_lactation_curve-446"><a href="#fit_lactation_curve-446"><span class="linenos">446</span></a>            <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">305</span><span class="p">:</span>
</span><span id="fit_lactation_curve-447"><a href="#fit_lactation_curve-447"><span class="linenos">447</span></a>                <span class="n">t_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="fit_lactation_curve-448"><a href="#fit_lactation_curve-448"><span class="linenos">448</span></a>                <span class="n">y_w</span> <span class="o">=</span> <span class="n">wood_model</span><span class="p">(</span><span class="n">t_range</span><span class="p">,</span> <span class="n">a_w</span><span class="p">,</span> <span class="n">b_w</span><span class="p">,</span> <span class="n">c_w</span><span class="p">)</span>
</span><span id="fit_lactation_curve-449"><a href="#fit_lactation_curve-449"><span class="linenos">449</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="fit_lactation_curve-450"><a href="#fit_lactation_curve-450"><span class="linenos">450</span></a>                <span class="n">t_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">306</span><span class="p">)</span>
</span><span id="fit_lactation_curve-451"><a href="#fit_lactation_curve-451"><span class="linenos">451</span></a>                <span class="n">y_w</span> <span class="o">=</span> <span class="n">wood_model</span><span class="p">(</span><span class="n">t_range</span><span class="p">,</span> <span class="n">a_w</span><span class="p">,</span> <span class="n">b_w</span><span class="p">,</span> <span class="n">c_w</span><span class="p">)</span>
</span><span id="fit_lactation_curve-452"><a href="#fit_lactation_curve-452"><span class="linenos">452</span></a>            <span class="k">return</span> <span class="n">y_w</span>
</span><span id="fit_lactation_curve-453"><a href="#fit_lactation_curve-453"><span class="linenos">453</span></a>
</span><span id="fit_lactation_curve-454"><a href="#fit_lactation_curve-454"><span class="linenos">454</span></a>        <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;wilmink&quot;</span><span class="p">:</span>
</span><span id="fit_lactation_curve-455"><a href="#fit_lactation_curve-455"><span class="linenos">455</span></a>            <span class="n">a_wil</span><span class="p">,</span> <span class="n">b_wil</span><span class="p">,</span> <span class="n">c_wil</span><span class="p">,</span> <span class="n">k_wil</span> <span class="o">=</span> <span class="n">get_lc_parameters</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
</span><span id="fit_lactation_curve-456"><a href="#fit_lactation_curve-456"><span class="linenos">456</span></a>            <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">305</span><span class="p">:</span>
</span><span id="fit_lactation_curve-457"><a href="#fit_lactation_curve-457"><span class="linenos">457</span></a>                <span class="n">t_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="fit_lactation_curve-458"><a href="#fit_lactation_curve-458"><span class="linenos">458</span></a>                <span class="n">y_wil</span> <span class="o">=</span> <span class="n">wilmink_model</span><span class="p">(</span><span class="n">t_range</span><span class="p">,</span> <span class="n">a_wil</span><span class="p">,</span> <span class="n">b_wil</span><span class="p">,</span> <span class="n">c_wil</span><span class="p">,</span> <span class="n">k_wil</span><span class="p">)</span>
</span><span id="fit_lactation_curve-459"><a href="#fit_lactation_curve-459"><span class="linenos">459</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="fit_lactation_curve-460"><a href="#fit_lactation_curve-460"><span class="linenos">460</span></a>                <span class="n">t_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">306</span><span class="p">)</span>
</span><span id="fit_lactation_curve-461"><a href="#fit_lactation_curve-461"><span class="linenos">461</span></a>                <span class="n">y_wil</span> <span class="o">=</span> <span class="n">wilmink_model</span><span class="p">(</span><span class="n">t_range</span><span class="p">,</span> <span class="n">a_wil</span><span class="p">,</span> <span class="n">b_wil</span><span class="p">,</span> <span class="n">c_wil</span><span class="p">,</span> <span class="n">k_wil</span><span class="p">)</span>
</span><span id="fit_lactation_curve-462"><a href="#fit_lactation_curve-462"><span class="linenos">462</span></a>            <span class="k">return</span> <span class="n">y_wil</span>
</span><span id="fit_lactation_curve-463"><a href="#fit_lactation_curve-463"><span class="linenos">463</span></a>
</span><span id="fit_lactation_curve-464"><a href="#fit_lactation_curve-464"><span class="linenos">464</span></a>        <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;ali_schaeffer&quot;</span><span class="p">:</span>
</span><span id="fit_lactation_curve-465"><a href="#fit_lactation_curve-465"><span class="linenos">465</span></a>            <span class="n">a_as</span><span class="p">,</span> <span class="n">b_as</span><span class="p">,</span> <span class="n">c_as</span><span class="p">,</span> <span class="n">d_as</span><span class="p">,</span> <span class="n">k_as</span> <span class="o">=</span> <span class="n">get_lc_parameters</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
</span><span id="fit_lactation_curve-466"><a href="#fit_lactation_curve-466"><span class="linenos">466</span></a>            <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">305</span><span class="p">:</span>
</span><span id="fit_lactation_curve-467"><a href="#fit_lactation_curve-467"><span class="linenos">467</span></a>                <span class="n">t_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="fit_lactation_curve-468"><a href="#fit_lactation_curve-468"><span class="linenos">468</span></a>                <span class="n">y_as</span> <span class="o">=</span> <span class="n">ali_schaeffer_model</span><span class="p">(</span><span class="n">t_range</span><span class="p">,</span> <span class="n">a_as</span><span class="p">,</span> <span class="n">b_as</span><span class="p">,</span> <span class="n">c_as</span><span class="p">,</span> <span class="n">d_as</span><span class="p">,</span> <span class="n">k_as</span><span class="p">)</span>
</span><span id="fit_lactation_curve-469"><a href="#fit_lactation_curve-469"><span class="linenos">469</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="fit_lactation_curve-470"><a href="#fit_lactation_curve-470"><span class="linenos">470</span></a>                <span class="n">t_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">306</span><span class="p">)</span>
</span><span id="fit_lactation_curve-471"><a href="#fit_lactation_curve-471"><span class="linenos">471</span></a>                <span class="n">y_as</span> <span class="o">=</span> <span class="n">ali_schaeffer_model</span><span class="p">(</span><span class="n">t_range</span><span class="p">,</span> <span class="n">a_as</span><span class="p">,</span> <span class="n">b_as</span><span class="p">,</span> <span class="n">c_as</span><span class="p">,</span> <span class="n">d_as</span><span class="p">,</span> <span class="n">k_as</span><span class="p">)</span>
</span><span id="fit_lactation_curve-472"><a href="#fit_lactation_curve-472"><span class="linenos">472</span></a>            <span class="k">return</span> <span class="n">y_as</span>
</span><span id="fit_lactation_curve-473"><a href="#fit_lactation_curve-473"><span class="linenos">473</span></a>
</span><span id="fit_lactation_curve-474"><a href="#fit_lactation_curve-474"><span class="linenos">474</span></a>        <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;fischer&quot;</span><span class="p">:</span>
</span><span id="fit_lactation_curve-475"><a href="#fit_lactation_curve-475"><span class="linenos">475</span></a>            <span class="n">a_f</span><span class="p">,</span> <span class="n">b_f</span><span class="p">,</span> <span class="n">c_f</span> <span class="o">=</span> <span class="n">get_lc_parameters</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
</span><span id="fit_lactation_curve-476"><a href="#fit_lactation_curve-476"><span class="linenos">476</span></a>            <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">305</span><span class="p">:</span>
</span><span id="fit_lactation_curve-477"><a href="#fit_lactation_curve-477"><span class="linenos">477</span></a>                <span class="n">t_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="fit_lactation_curve-478"><a href="#fit_lactation_curve-478"><span class="linenos">478</span></a>                <span class="n">y_f</span> <span class="o">=</span> <span class="n">fischer_model</span><span class="p">(</span><span class="n">t_range</span><span class="p">,</span> <span class="n">a_f</span><span class="p">,</span> <span class="n">b_f</span><span class="p">,</span> <span class="n">c_f</span><span class="p">)</span>
</span><span id="fit_lactation_curve-479"><a href="#fit_lactation_curve-479"><span class="linenos">479</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="fit_lactation_curve-480"><a href="#fit_lactation_curve-480"><span class="linenos">480</span></a>                <span class="n">t_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">306</span><span class="p">)</span>
</span><span id="fit_lactation_curve-481"><a href="#fit_lactation_curve-481"><span class="linenos">481</span></a>                <span class="n">y_f</span> <span class="o">=</span> <span class="n">fischer_model</span><span class="p">(</span><span class="n">t_range</span><span class="p">,</span> <span class="n">a_f</span><span class="p">,</span> <span class="n">b_f</span><span class="p">,</span> <span class="n">c_f</span><span class="p">)</span>
</span><span id="fit_lactation_curve-482"><a href="#fit_lactation_curve-482"><span class="linenos">482</span></a>            <span class="k">return</span> <span class="n">y_f</span>
</span><span id="fit_lactation_curve-483"><a href="#fit_lactation_curve-483"><span class="linenos">483</span></a>
</span><span id="fit_lactation_curve-484"><a href="#fit_lactation_curve-484"><span class="linenos">484</span></a>        <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;milkbot&quot;</span><span class="p">:</span>
</span><span id="fit_lactation_curve-485"><a href="#fit_lactation_curve-485"><span class="linenos">485</span></a>            <span class="n">a_mb</span><span class="p">,</span> <span class="n">b_mb</span><span class="p">,</span> <span class="n">c_mb</span><span class="p">,</span> <span class="n">d_mb</span> <span class="o">=</span> <span class="n">get_lc_parameters</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
</span><span id="fit_lactation_curve-486"><a href="#fit_lactation_curve-486"><span class="linenos">486</span></a>            <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">305</span><span class="p">:</span>
</span><span id="fit_lactation_curve-487"><a href="#fit_lactation_curve-487"><span class="linenos">487</span></a>                <span class="n">t_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="fit_lactation_curve-488"><a href="#fit_lactation_curve-488"><span class="linenos">488</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="fit_lactation_curve-489"><a href="#fit_lactation_curve-489"><span class="linenos">489</span></a>                <span class="n">t_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">306</span><span class="p">)</span>
</span><span id="fit_lactation_curve-490"><a href="#fit_lactation_curve-490"><span class="linenos">490</span></a>
</span><span id="fit_lactation_curve-491"><a href="#fit_lactation_curve-491"><span class="linenos">491</span></a>            <span class="n">y_mb</span> <span class="o">=</span> <span class="n">milkbot_model</span><span class="p">(</span><span class="n">t_range</span><span class="p">,</span> <span class="n">a_mb</span><span class="p">,</span> <span class="n">b_mb</span><span class="p">,</span> <span class="n">c_mb</span><span class="p">,</span> <span class="n">d_mb</span><span class="p">)</span>
</span><span id="fit_lactation_curve-492"><a href="#fit_lactation_curve-492"><span class="linenos">492</span></a>            <span class="k">return</span> <span class="n">y_mb</span>
</span><span id="fit_lactation_curve-493"><a href="#fit_lactation_curve-493"><span class="linenos">493</span></a>
</span><span id="fit_lactation_curve-494"><a href="#fit_lactation_curve-494"><span class="linenos">494</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="fit_lactation_curve-495"><a href="#fit_lactation_curve-495"><span class="linenos">495</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unknown model&quot;</span><span class="p">)</span>
</span><span id="fit_lactation_curve-496"><a href="#fit_lactation_curve-496"><span class="linenos">496</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="fit_lactation_curve-497"><a href="#fit_lactation_curve-497"><span class="linenos">497</span></a>        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;milkbot&quot;</span><span class="p">:</span>
</span><span id="fit_lactation_curve-498"><a href="#fit_lactation_curve-498"><span class="linenos">498</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="fit_lactation_curve-499"><a href="#fit_lactation_curve-499"><span class="linenos">499</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Key needed to use Bayesian fitting engine milkbot&quot;</span><span class="p">)</span>
</span><span id="fit_lactation_curve-500"><a href="#fit_lactation_curve-500"><span class="linenos">500</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="fit_lactation_curve-501"><a href="#fit_lactation_curve-501"><span class="linenos">501</span></a>                <span class="n">parameters</span> <span class="o">=</span> <span class="n">bayesian_fit_milkbot_single_lactation</span><span class="p">(</span>
</span><span id="fit_lactation_curve-502"><a href="#fit_lactation_curve-502"><span class="linenos">502</span></a>                    <span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">parity</span><span class="p">,</span> <span class="n">breed</span><span class="p">,</span> <span class="n">continent</span>
</span><span id="fit_lactation_curve-503"><a href="#fit_lactation_curve-503"><span class="linenos">503</span></a>                <span class="p">)</span>
</span><span id="fit_lactation_curve-504"><a href="#fit_lactation_curve-504"><span class="linenos">504</span></a>                <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">305</span><span class="p">:</span>
</span><span id="fit_lactation_curve-505"><a href="#fit_lactation_curve-505"><span class="linenos">505</span></a>                    <span class="n">t_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="fit_lactation_curve-506"><a href="#fit_lactation_curve-506"><span class="linenos">506</span></a>                    <span class="n">y_mb_bay</span> <span class="o">=</span> <span class="n">milkbot_model</span><span class="p">(</span>
</span><span id="fit_lactation_curve-507"><a href="#fit_lactation_curve-507"><span class="linenos">507</span></a>                        <span class="n">t_range</span><span class="p">,</span>
</span><span id="fit_lactation_curve-508"><a href="#fit_lactation_curve-508"><span class="linenos">508</span></a>                        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">],</span>
</span><span id="fit_lactation_curve-509"><a href="#fit_lactation_curve-509"><span class="linenos">509</span></a>                        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;ramp&quot;</span><span class="p">],</span>
</span><span id="fit_lactation_curve-510"><a href="#fit_lactation_curve-510"><span class="linenos">510</span></a>                        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;offset&quot;</span><span class="p">],</span>
</span><span id="fit_lactation_curve-511"><a href="#fit_lactation_curve-511"><span class="linenos">511</span></a>                        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;decay&quot;</span><span class="p">],</span>
</span><span id="fit_lactation_curve-512"><a href="#fit_lactation_curve-512"><span class="linenos">512</span></a>                    <span class="p">)</span>
</span><span id="fit_lactation_curve-513"><a href="#fit_lactation_curve-513"><span class="linenos">513</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="fit_lactation_curve-514"><a href="#fit_lactation_curve-514"><span class="linenos">514</span></a>                    <span class="n">t_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">306</span><span class="p">)</span>
</span><span id="fit_lactation_curve-515"><a href="#fit_lactation_curve-515"><span class="linenos">515</span></a>                    <span class="n">y_mb_bay</span> <span class="o">=</span> <span class="n">milkbot_model</span><span class="p">(</span>
</span><span id="fit_lactation_curve-516"><a href="#fit_lactation_curve-516"><span class="linenos">516</span></a>                        <span class="n">t_range</span><span class="p">,</span>
</span><span id="fit_lactation_curve-517"><a href="#fit_lactation_curve-517"><span class="linenos">517</span></a>                        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">],</span>
</span><span id="fit_lactation_curve-518"><a href="#fit_lactation_curve-518"><span class="linenos">518</span></a>                        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;ramp&quot;</span><span class="p">],</span>
</span><span id="fit_lactation_curve-519"><a href="#fit_lactation_curve-519"><span class="linenos">519</span></a>                        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;offset&quot;</span><span class="p">],</span>
</span><span id="fit_lactation_curve-520"><a href="#fit_lactation_curve-520"><span class="linenos">520</span></a>                        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;decay&quot;</span><span class="p">],</span>
</span><span id="fit_lactation_curve-521"><a href="#fit_lactation_curve-521"><span class="linenos">521</span></a>                    <span class="p">)</span>
</span><span id="fit_lactation_curve-522"><a href="#fit_lactation_curve-522"><span class="linenos">522</span></a>                <span class="k">return</span> <span class="n">y_mb_bay</span>
</span><span id="fit_lactation_curve-523"><a href="#fit_lactation_curve-523"><span class="linenos">523</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="fit_lactation_curve-524"><a href="#fit_lactation_curve-524"><span class="linenos">524</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Bayesian fitting is currently only implemented for milkbot models&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Fit lactation data to a lactation curve model and return predictions.</p>

<p>Depending on <code>fitting</code>:</p>

<ul>
<li><strong>frequentist</strong>: Fits parameters using <code>minimize</code> and/or <code>curve_fit</code>
for the specified <code>model</code>, then predicts over DIM 1305 (or up to <code>max(dim)</code> if greater).</li>
<li><strong>bayesian</strong>: (MilkBot only) Calls the MilkBot Bayesian fitting API and
returns predictions using the fitted parameters.</li>
</ul>

<p>Args:
    dim (Int): List/array of days in milk (DIM).
    milkrecordings (Float): List/array of milk recordings (kg).
    model (Str): Model name (lowercase), default "wood".
        Supported for frequentist: "wood", "wilmink", "ali_schaeffer", "fischer", "milkbot".
    fitting (Str): "frequentist" (default) or "bayesian".
        Bayesian fitting is currently implemented only for "milkbot".
    breed (Str): "H" (Holstein, default) or "J" (Jersey). Only used for Bayesian.
    parity (Int): Lactation number; all parities &gt;= 3 considered one group in priors (Bayesian).
    continent (Str): Prior source for Bayesian, "USA" (default), "EU", or "CHEN".
    key (Str | None): API key for MilkBot (required when <code>fitting == "bayesian"</code>).</p>

<p>Returns:
    List/array of predicted milk yield for DIM 1305 (or up to the maximum DIM if &gt; 305).</p>

<p>Raises:
    Exception: If an unknown model is requested (frequentist),
        or Bayesian is requested for a non-MilkBot model,
        or <code>key</code> is missing when Bayesian fitting is requested.</p>

<p>Notes:
    Uses <code><a href="#validate_and_prepare_inputs">validate_and_prepare_inputs</a></code> for input checking and normalization.</p>
</div>


                </section>
                <section id="get_chen_priors">
                            <input id="get_chen_priors-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_chen_priors</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">parity</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="get_chen_priors-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_chen_priors"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_chen_priors-661"><a href="#get_chen_priors-661"><span class="linenos">661</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_chen_priors</span><span class="p">(</span><span class="n">parity</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="get_chen_priors-662"><a href="#get_chen_priors-662"><span class="linenos">662</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_chen_priors-663"><a href="#get_chen_priors-663"><span class="linenos">663</span></a><span class="sd">    Return Chen et al. priors in MilkBot v2.0 ND format.</span>
</span><span id="get_chen_priors-664"><a href="#get_chen_priors-664"><span class="linenos">664</span></a>
</span><span id="get_chen_priors-665"><a href="#get_chen_priors-665"><span class="linenos">665</span></a><span class="sd">    Args:</span>
</span><span id="get_chen_priors-666"><a href="#get_chen_priors-666"><span class="linenos">666</span></a><span class="sd">        parity: Lactation number (1, 2, or &gt;= 3).</span>
</span><span id="get_chen_priors-667"><a href="#get_chen_priors-667"><span class="linenos">667</span></a>
</span><span id="get_chen_priors-668"><a href="#get_chen_priors-668"><span class="linenos">668</span></a><span class="sd">    Returns:</span>
</span><span id="get_chen_priors-669"><a href="#get_chen_priors-669"><span class="linenos">669</span></a><span class="sd">        Dictionary with parameter priors:</span>
</span><span id="get_chen_priors-670"><a href="#get_chen_priors-670"><span class="linenos">670</span></a><span class="sd">        - &quot;scale&quot;: {&quot;mean&quot;, &quot;sd&quot;}</span>
</span><span id="get_chen_priors-671"><a href="#get_chen_priors-671"><span class="linenos">671</span></a><span class="sd">        - &quot;ramp&quot;: {&quot;mean&quot;, &quot;sd&quot;}</span>
</span><span id="get_chen_priors-672"><a href="#get_chen_priors-672"><span class="linenos">672</span></a><span class="sd">        - &quot;decay&quot;: {&quot;mean&quot;, &quot;sd&quot;}</span>
</span><span id="get_chen_priors-673"><a href="#get_chen_priors-673"><span class="linenos">673</span></a><span class="sd">        - &quot;offset&quot;: {&quot;mean&quot;, &quot;sd&quot;}</span>
</span><span id="get_chen_priors-674"><a href="#get_chen_priors-674"><span class="linenos">674</span></a><span class="sd">        - &quot;seMilk&quot;: Standard error of milk measurement.</span>
</span><span id="get_chen_priors-675"><a href="#get_chen_priors-675"><span class="linenos">675</span></a><span class="sd">        - &quot;milkUnit&quot;: Unit string (e.g., &quot;kg&quot;).</span>
</span><span id="get_chen_priors-676"><a href="#get_chen_priors-676"><span class="linenos">676</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_chen_priors-677"><a href="#get_chen_priors-677"><span class="linenos">677</span></a>    <span class="k">if</span> <span class="n">parity</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="get_chen_priors-678"><a href="#get_chen_priors-678"><span class="linenos">678</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="get_chen_priors-679"><a href="#get_chen_priors-679"><span class="linenos">679</span></a>            <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="mf">34.11</span><span class="p">,</span> <span class="s2">&quot;sd&quot;</span><span class="p">:</span> <span class="mf">6.891</span><span class="p">},</span>
</span><span id="get_chen_priors-680"><a href="#get_chen_priors-680"><span class="linenos">680</span></a>            <span class="s2">&quot;ramp&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="mf">29.96</span><span class="p">,</span> <span class="s2">&quot;sd&quot;</span><span class="p">:</span> <span class="mf">1.53</span><span class="p">},</span>
</span><span id="get_chen_priors-681"><a href="#get_chen_priors-681"><span class="linenos">681</span></a>            <span class="s2">&quot;decay&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="mf">0.001835</span><span class="p">,</span> <span class="s2">&quot;sd&quot;</span><span class="p">:</span> <span class="mf">0.000738</span><span class="p">},</span>
</span><span id="get_chen_priors-682"><a href="#get_chen_priors-682"><span class="linenos">682</span></a>            <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;sd&quot;</span><span class="p">:</span> <span class="mf">0.002</span><span class="p">},</span>
</span><span id="get_chen_priors-683"><a href="#get_chen_priors-683"><span class="linenos">683</span></a>            <span class="s2">&quot;seMilk&quot;</span><span class="p">:</span> <span class="mf">1.91</span><span class="p">,</span>
</span><span id="get_chen_priors-684"><a href="#get_chen_priors-684"><span class="linenos">684</span></a>            <span class="s2">&quot;milkUnit&quot;</span><span class="p">:</span> <span class="s2">&quot;kg&quot;</span><span class="p">,</span>
</span><span id="get_chen_priors-685"><a href="#get_chen_priors-685"><span class="linenos">685</span></a>        <span class="p">}</span>
</span><span id="get_chen_priors-686"><a href="#get_chen_priors-686"><span class="linenos">686</span></a>
</span><span id="get_chen_priors-687"><a href="#get_chen_priors-687"><span class="linenos">687</span></a>    <span class="k">if</span> <span class="n">parity</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="get_chen_priors-688"><a href="#get_chen_priors-688"><span class="linenos">688</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="get_chen_priors-689"><a href="#get_chen_priors-689"><span class="linenos">689</span></a>            <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="mf">44.26</span><span class="p">,</span> <span class="s2">&quot;sd&quot;</span><span class="p">:</span> <span class="mf">9.57</span><span class="p">},</span>
</span><span id="get_chen_priors-690"><a href="#get_chen_priors-690"><span class="linenos">690</span></a>            <span class="s2">&quot;ramp&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="mf">22.52</span><span class="p">,</span> <span class="s2">&quot;sd&quot;</span><span class="p">:</span> <span class="mf">0.9999</span><span class="p">},</span>
</span><span id="get_chen_priors-691"><a href="#get_chen_priors-691"><span class="linenos">691</span></a>            <span class="s2">&quot;decay&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="mf">0.002745</span><span class="p">,</span> <span class="s2">&quot;sd&quot;</span><span class="p">:</span> <span class="mf">0.000979</span><span class="p">},</span>
</span><span id="get_chen_priors-692"><a href="#get_chen_priors-692"><span class="linenos">692</span></a>            <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.78</span><span class="p">,</span> <span class="s2">&quot;sd&quot;</span><span class="p">:</span> <span class="mf">0.007</span><span class="p">},</span>
</span><span id="get_chen_priors-693"><a href="#get_chen_priors-693"><span class="linenos">693</span></a>            <span class="s2">&quot;seMilk&quot;</span><span class="p">:</span> <span class="mf">2.19</span><span class="p">,</span>
</span><span id="get_chen_priors-694"><a href="#get_chen_priors-694"><span class="linenos">694</span></a>            <span class="s2">&quot;milkUnit&quot;</span><span class="p">:</span> <span class="s2">&quot;kg&quot;</span><span class="p">,</span>
</span><span id="get_chen_priors-695"><a href="#get_chen_priors-695"><span class="linenos">695</span></a>        <span class="p">}</span>
</span><span id="get_chen_priors-696"><a href="#get_chen_priors-696"><span class="linenos">696</span></a>
</span><span id="get_chen_priors-697"><a href="#get_chen_priors-697"><span class="linenos">697</span></a>    <span class="c1"># parity &gt;= 3</span>
</span><span id="get_chen_priors-698"><a href="#get_chen_priors-698"><span class="linenos">698</span></a>    <span class="k">return</span> <span class="p">{</span>
</span><span id="get_chen_priors-699"><a href="#get_chen_priors-699"><span class="linenos">699</span></a>        <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="mf">48.41</span><span class="p">,</span> <span class="s2">&quot;sd&quot;</span><span class="p">:</span> <span class="mf">10.66</span><span class="p">},</span>
</span><span id="get_chen_priors-700"><a href="#get_chen_priors-700"><span class="linenos">700</span></a>        <span class="s2">&quot;ramp&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="mf">22.54</span><span class="p">,</span> <span class="s2">&quot;sd&quot;</span><span class="p">:</span> <span class="mf">8.724</span><span class="p">},</span>
</span><span id="get_chen_priors-701"><a href="#get_chen_priors-701"><span class="linenos">701</span></a>        <span class="s2">&quot;decay&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="mf">0.002997</span><span class="p">,</span> <span class="s2">&quot;sd&quot;</span><span class="p">:</span> <span class="mf">0.000972</span><span class="p">},</span>
</span><span id="get_chen_priors-702"><a href="#get_chen_priors-702"><span class="linenos">702</span></a>        <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s2">&quot;sd&quot;</span><span class="p">:</span> <span class="mf">0.03</span><span class="p">},</span>
</span><span id="get_chen_priors-703"><a href="#get_chen_priors-703"><span class="linenos">703</span></a>        <span class="s2">&quot;seMilk&quot;</span><span class="p">:</span> <span class="mf">2.14</span><span class="p">,</span>
</span><span id="get_chen_priors-704"><a href="#get_chen_priors-704"><span class="linenos">704</span></a>        <span class="s2">&quot;milkUnit&quot;</span><span class="p">:</span> <span class="s2">&quot;kg&quot;</span><span class="p">,</span>
</span><span id="get_chen_priors-705"><a href="#get_chen_priors-705"><span class="linenos">705</span></a>    <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Return Chen et al. priors in MilkBot v2.0 ND format.</p>

<p>Args:
    parity: Lactation number (1, 2, or &gt;= 3).</p>

<p>Returns:
    Dictionary with parameter priors:
    - "scale": {"mean", "sd"}
    - "ramp": {"mean", "sd"}
    - "decay": {"mean", "sd"}
    - "offset": {"mean", "sd"}
    - "seMilk": Standard error of milk measurement.
    - "milkUnit": Unit string (e.g., "kg").</p>
</div>


                </section>
                <section id="get_lc_parameters">
                            <input id="get_lc_parameters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_lc_parameters</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">dim</span>, </span><span class="param"><span class="n">milkrecordings</span>, </span><span class="param"><span class="n">model</span><span class="o">=</span><span class="s1">&#39;wood&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_lc_parameters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_lc_parameters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_lc_parameters-584"><a href="#get_lc_parameters-584"><span class="linenos">584</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_lc_parameters</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;wood&quot;</span><span class="p">):</span>
</span><span id="get_lc_parameters-585"><a href="#get_lc_parameters-585"><span class="linenos">585</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Fit lactation data to a model and return fitted parameters (frequentist).</span>
</span><span id="get_lc_parameters-586"><a href="#get_lc_parameters-586"><span class="linenos">586</span></a>
</span><span id="get_lc_parameters-587"><a href="#get_lc_parameters-587"><span class="linenos">587</span></a><span class="sd">    Depending on `model`, this uses `scipy.optimize.minimize` and/or</span>
</span><span id="get_lc_parameters-588"><a href="#get_lc_parameters-588"><span class="linenos">588</span></a><span class="sd">    `scipy.optimize.curve_fit` with model-specific starting values and bounds.</span>
</span><span id="get_lc_parameters-589"><a href="#get_lc_parameters-589"><span class="linenos">589</span></a>
</span><span id="get_lc_parameters-590"><a href="#get_lc_parameters-590"><span class="linenos">590</span></a><span class="sd">    Args:</span>
</span><span id="get_lc_parameters-591"><a href="#get_lc_parameters-591"><span class="linenos">591</span></a><span class="sd">        dim (int): List/array of DIM values.</span>
</span><span id="get_lc_parameters-592"><a href="#get_lc_parameters-592"><span class="linenos">592</span></a><span class="sd">        milkrecordings (float): List/array of milk recordings (kg).</span>
</span><span id="get_lc_parameters-593"><a href="#get_lc_parameters-593"><span class="linenos">593</span></a><span class="sd">        model (str): One of &quot;wood&quot;, &quot;wilmink&quot;, &quot;ali_schaeffer&quot;, &quot;fischer&quot;, &quot;milkbot&quot;.</span>
</span><span id="get_lc_parameters-594"><a href="#get_lc_parameters-594"><span class="linenos">594</span></a>
</span><span id="get_lc_parameters-595"><a href="#get_lc_parameters-595"><span class="linenos">595</span></a><span class="sd">    Returns:</span>
</span><span id="get_lc_parameters-596"><a href="#get_lc_parameters-596"><span class="linenos">596</span></a><span class="sd">        Fitted parameters as floats, in alphabetical order by parameter name:</span>
</span><span id="get_lc_parameters-597"><a href="#get_lc_parameters-597"><span class="linenos">597</span></a><span class="sd">            - wood: (a, b, c)</span>
</span><span id="get_lc_parameters-598"><a href="#get_lc_parameters-598"><span class="linenos">598</span></a><span class="sd">            - wilmink: (a, b, c, k) with k fixed at -0.05</span>
</span><span id="get_lc_parameters-599"><a href="#get_lc_parameters-599"><span class="linenos">599</span></a><span class="sd">            - ali_schaeffer: (a, b, c, d, k)</span>
</span><span id="get_lc_parameters-600"><a href="#get_lc_parameters-600"><span class="linenos">600</span></a><span class="sd">            - fischer: (a, b, c)</span>
</span><span id="get_lc_parameters-601"><a href="#get_lc_parameters-601"><span class="linenos">601</span></a><span class="sd">            - milkbot: (a, b, c, d)</span>
</span><span id="get_lc_parameters-602"><a href="#get_lc_parameters-602"><span class="linenos">602</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_lc_parameters-603"><a href="#get_lc_parameters-603"><span class="linenos">603</span></a>    <span class="c1"># check and prepare input</span>
</span><span id="get_lc_parameters-604"><a href="#get_lc_parameters-604"><span class="linenos">604</span></a>    <span class="c1"># check and prepare input</span>
</span><span id="get_lc_parameters-605"><a href="#get_lc_parameters-605"><span class="linenos">605</span></a>    <span class="n">inputs</span> <span class="o">=</span> <span class="n">validate_and_prepare_inputs</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
</span><span id="get_lc_parameters-606"><a href="#get_lc_parameters-606"><span class="linenos">606</span></a>
</span><span id="get_lc_parameters-607"><a href="#get_lc_parameters-607"><span class="linenos">607</span></a>    <span class="n">dim</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">dim</span>
</span><span id="get_lc_parameters-608"><a href="#get_lc_parameters-608"><span class="linenos">608</span></a>    <span class="n">milkrecordings</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">milkrecordings</span>
</span><span id="get_lc_parameters-609"><a href="#get_lc_parameters-609"><span class="linenos">609</span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">model</span>
</span><span id="get_lc_parameters-610"><a href="#get_lc_parameters-610"><span class="linenos">610</span></a>
</span><span id="get_lc_parameters-611"><a href="#get_lc_parameters-611"><span class="linenos">611</span></a>    <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;wood&quot;</span><span class="p">:</span>
</span><span id="get_lc_parameters-612"><a href="#get_lc_parameters-612"><span class="linenos">612</span></a>        <span class="n">wood_guess</span> <span class="o">=</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
</span><span id="get_lc_parameters-613"><a href="#get_lc_parameters-613"><span class="linenos">613</span></a>        <span class="n">wood_bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)]</span>
</span><span id="get_lc_parameters-614"><a href="#get_lc_parameters-614"><span class="linenos">614</span></a>        <span class="n">wood_res</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
</span><span id="get_lc_parameters-615"><a href="#get_lc_parameters-615"><span class="linenos">615</span></a>            <span class="n">wood_objective</span><span class="p">,</span> <span class="n">wood_guess</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">),</span> <span class="n">bounds</span><span class="o">=</span><span class="n">wood_bounds</span>
</span><span id="get_lc_parameters-616"><a href="#get_lc_parameters-616"><span class="linenos">616</span></a>        <span class="p">)</span>
</span><span id="get_lc_parameters-617"><a href="#get_lc_parameters-617"><span class="linenos">617</span></a>        <span class="n">a_w</span><span class="p">,</span> <span class="n">b_w</span><span class="p">,</span> <span class="n">c_w</span> <span class="o">=</span> <span class="n">wood_res</span><span class="o">.</span><span class="n">x</span>
</span><span id="get_lc_parameters-618"><a href="#get_lc_parameters-618"><span class="linenos">618</span></a>        <span class="k">return</span> <span class="n">a_w</span><span class="p">,</span> <span class="n">b_w</span><span class="p">,</span> <span class="n">c_w</span>
</span><span id="get_lc_parameters-619"><a href="#get_lc_parameters-619"><span class="linenos">619</span></a>
</span><span id="get_lc_parameters-620"><a href="#get_lc_parameters-620"><span class="linenos">620</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;wilmink&quot;</span><span class="p">:</span>
</span><span id="get_lc_parameters-621"><a href="#get_lc_parameters-621"><span class="linenos">621</span></a>        <span class="n">wil_guess</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>
</span><span id="get_lc_parameters-622"><a href="#get_lc_parameters-622"><span class="linenos">622</span></a>        <span class="n">wil_params</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">wilmink_model</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">wil_guess</span><span class="p">)</span>
</span><span id="get_lc_parameters-623"><a href="#get_lc_parameters-623"><span class="linenos">623</span></a>        <span class="n">a_wil</span><span class="p">,</span> <span class="n">b_wil</span><span class="p">,</span> <span class="n">c_wil</span> <span class="o">=</span> <span class="n">wil_params</span>
</span><span id="get_lc_parameters-624"><a href="#get_lc_parameters-624"><span class="linenos">624</span></a>        <span class="n">k_wil</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="c1"># set fixed</span>
</span><span id="get_lc_parameters-625"><a href="#get_lc_parameters-625"><span class="linenos">625</span></a>        <span class="k">return</span> <span class="n">a_wil</span><span class="p">,</span> <span class="n">b_wil</span><span class="p">,</span> <span class="n">c_wil</span><span class="p">,</span> <span class="n">k_wil</span>
</span><span id="get_lc_parameters-626"><a href="#get_lc_parameters-626"><span class="linenos">626</span></a>
</span><span id="get_lc_parameters-627"><a href="#get_lc_parameters-627"><span class="linenos">627</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;ali_schaeffer&quot;</span><span class="p">:</span>
</span><span id="get_lc_parameters-628"><a href="#get_lc_parameters-628"><span class="linenos">628</span></a>        <span class="n">ali_schaeffer_guess</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="get_lc_parameters-629"><a href="#get_lc_parameters-629"><span class="linenos">629</span></a>        <span class="n">ali_schaeffer_params</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span>
</span><span id="get_lc_parameters-630"><a href="#get_lc_parameters-630"><span class="linenos">630</span></a>            <span class="n">ali_schaeffer_model</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">ali_schaeffer_guess</span>
</span><span id="get_lc_parameters-631"><a href="#get_lc_parameters-631"><span class="linenos">631</span></a>        <span class="p">)</span>
</span><span id="get_lc_parameters-632"><a href="#get_lc_parameters-632"><span class="linenos">632</span></a>        <span class="n">a_as</span><span class="p">,</span> <span class="n">b_as</span><span class="p">,</span> <span class="n">c_as</span><span class="p">,</span> <span class="n">d_as</span><span class="p">,</span> <span class="n">k_as</span> <span class="o">=</span> <span class="n">ali_schaeffer_params</span>
</span><span id="get_lc_parameters-633"><a href="#get_lc_parameters-633"><span class="linenos">633</span></a>        <span class="k">return</span> <span class="n">a_as</span><span class="p">,</span> <span class="n">b_as</span><span class="p">,</span> <span class="n">c_as</span><span class="p">,</span> <span class="n">d_as</span><span class="p">,</span> <span class="n">k_as</span>
</span><span id="get_lc_parameters-634"><a href="#get_lc_parameters-634"><span class="linenos">634</span></a>
</span><span id="get_lc_parameters-635"><a href="#get_lc_parameters-635"><span class="linenos">635</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;fischer&quot;</span><span class="p">:</span>
</span><span id="get_lc_parameters-636"><a href="#get_lc_parameters-636"><span class="linenos">636</span></a>        <span class="n">fischer_guess</span> <span class="o">=</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">milkrecordings</span><span class="p">),</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
</span><span id="get_lc_parameters-637"><a href="#get_lc_parameters-637"><span class="linenos">637</span></a>        <span class="n">fischer_bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0001</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="get_lc_parameters-638"><a href="#get_lc_parameters-638"><span class="linenos">638</span></a>        <span class="n">fischer_params</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span>
</span><span id="get_lc_parameters-639"><a href="#get_lc_parameters-639"><span class="linenos">639</span></a>            <span class="n">fischer_model</span><span class="p">,</span>
</span><span id="get_lc_parameters-640"><a href="#get_lc_parameters-640"><span class="linenos">640</span></a>            <span class="n">dim</span><span class="p">,</span>
</span><span id="get_lc_parameters-641"><a href="#get_lc_parameters-641"><span class="linenos">641</span></a>            <span class="n">milkrecordings</span><span class="p">,</span>
</span><span id="get_lc_parameters-642"><a href="#get_lc_parameters-642"><span class="linenos">642</span></a>            <span class="n">p0</span><span class="o">=</span><span class="n">fischer_guess</span><span class="p">,</span>
</span><span id="get_lc_parameters-643"><a href="#get_lc_parameters-643"><span class="linenos">643</span></a>            <span class="n">bounds</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">fischer_bounds</span><span class="p">),</span>
</span><span id="get_lc_parameters-644"><a href="#get_lc_parameters-644"><span class="linenos">644</span></a>        <span class="p">)</span>
</span><span id="get_lc_parameters-645"><a href="#get_lc_parameters-645"><span class="linenos">645</span></a>        <span class="n">a_f</span><span class="p">,</span> <span class="n">b_f</span><span class="p">,</span> <span class="n">c_f</span> <span class="o">=</span> <span class="n">fischer_params</span>
</span><span id="get_lc_parameters-646"><a href="#get_lc_parameters-646"><span class="linenos">646</span></a>        <span class="k">return</span> <span class="n">a_f</span><span class="p">,</span> <span class="n">b_f</span><span class="p">,</span> <span class="n">c_f</span>
</span><span id="get_lc_parameters-647"><a href="#get_lc_parameters-647"><span class="linenos">647</span></a>
</span><span id="get_lc_parameters-648"><a href="#get_lc_parameters-648"><span class="linenos">648</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;milkbot&quot;</span><span class="p">:</span>
</span><span id="get_lc_parameters-649"><a href="#get_lc_parameters-649"><span class="linenos">649</span></a>        <span class="n">mb_guess</span> <span class="o">=</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">milkrecordings</span><span class="p">),</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
</span><span id="get_lc_parameters-650"><a href="#get_lc_parameters-650"><span class="linenos">650</span></a>        <span class="n">mb_bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">600</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)]</span>
</span><span id="get_lc_parameters-651"><a href="#get_lc_parameters-651"><span class="linenos">651</span></a>        <span class="c1"># constraint = {</span>
</span><span id="get_lc_parameters-652"><a href="#get_lc_parameters-652"><span class="linenos">652</span></a>        <span class="c1"># &#39;type&#39;: &#39;ineq&#39;,</span>
</span><span id="get_lc_parameters-653"><a href="#get_lc_parameters-653"><span class="linenos">653</span></a>        <span class="c1"># &#39;fun&#39;: lambda p: milkbot_constraint(p, dim)</span>
</span><span id="get_lc_parameters-654"><a href="#get_lc_parameters-654"><span class="linenos">654</span></a>        <span class="c1"># }</span>
</span><span id="get_lc_parameters-655"><a href="#get_lc_parameters-655"><span class="linenos">655</span></a>        <span class="n">mb_res</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">milkbot_objective</span><span class="p">,</span> <span class="n">mb_guess</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">),</span> <span class="n">bounds</span><span class="o">=</span><span class="n">mb_bounds</span><span class="p">)</span>
</span><span id="get_lc_parameters-656"><a href="#get_lc_parameters-656"><span class="linenos">656</span></a>        <span class="c1">#   constraints = constraint, method=&#39;SLSQP&#39;)</span>
</span><span id="get_lc_parameters-657"><a href="#get_lc_parameters-657"><span class="linenos">657</span></a>        <span class="n">a_mb</span><span class="p">,</span> <span class="n">b_mb</span><span class="p">,</span> <span class="n">c_mb</span><span class="p">,</span> <span class="n">d_mb</span> <span class="o">=</span> <span class="n">mb_res</span><span class="o">.</span><span class="n">x</span>
</span><span id="get_lc_parameters-658"><a href="#get_lc_parameters-658"><span class="linenos">658</span></a>        <span class="k">return</span> <span class="n">a_mb</span><span class="p">,</span> <span class="n">b_mb</span><span class="p">,</span> <span class="n">c_mb</span><span class="p">,</span> <span class="n">d_mb</span>
</span></pre></div>


            <div class="docstring"><p>Fit lactation data to a model and return fitted parameters (frequentist).</p>

<p>Depending on <code>model</code>, this uses <code>scipy.optimize.minimize</code> and/or
<code>scipy.optimize.curve_fit</code> with model-specific starting values and bounds.</p>

<p>Args:
    dim (int): List/array of DIM values.
    milkrecordings (float): List/array of milk recordings (kg).
    model (str): One of "wood", "wilmink", "ali_schaeffer", "fischer", "milkbot".</p>

<p>Returns:
    Fitted parameters as floats, in alphabetical order by parameter name:
        - wood: (a, b, c)
        - wilmink: (a, b, c, k) with k fixed at -0.05
        - ali_schaeffer: (a, b, c, d, k)
        - fischer: (a, b, c)
        - milkbot: (a, b, c, d)</p>
</div>


                </section>
                <section id="get_lc_parameters_least_squares">
                            <input id="get_lc_parameters_least_squares-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_lc_parameters_least_squares</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">dim</span>, </span><span class="param"><span class="n">milkrecordings</span>, </span><span class="param"><span class="n">model</span><span class="o">=</span><span class="s1">&#39;milkbot&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_lc_parameters_least_squares-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_lc_parameters_least_squares"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_lc_parameters_least_squares-527"><a href="#get_lc_parameters_least_squares-527"><span class="linenos">527</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_lc_parameters_least_squares</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;milkbot&quot;</span><span class="p">):</span>
</span><span id="get_lc_parameters_least_squares-528"><a href="#get_lc_parameters_least_squares-528"><span class="linenos">528</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Fit lactation data and return model parameters (least squares; frequentist).</span>
</span><span id="get_lc_parameters_least_squares-529"><a href="#get_lc_parameters_least_squares-529"><span class="linenos">529</span></a>
</span><span id="get_lc_parameters_least_squares-530"><a href="#get_lc_parameters_least_squares-530"><span class="linenos">530</span></a><span class="sd">    This helper uses `scipy.optimize.least_squares` to fit the MilkBot model with bounds,</span>
</span><span id="get_lc_parameters_least_squares-531"><a href="#get_lc_parameters_least_squares-531"><span class="linenos">531</span></a><span class="sd">    and returns the fitted parameters.</span>
</span><span id="get_lc_parameters_least_squares-532"><a href="#get_lc_parameters_least_squares-532"><span class="linenos">532</span></a>
</span><span id="get_lc_parameters_least_squares-533"><a href="#get_lc_parameters_least_squares-533"><span class="linenos">533</span></a><span class="sd">    Args:</span>
</span><span id="get_lc_parameters_least_squares-534"><a href="#get_lc_parameters_least_squares-534"><span class="linenos">534</span></a><span class="sd">        dim (int): List/array of DIM values.</span>
</span><span id="get_lc_parameters_least_squares-535"><a href="#get_lc_parameters_least_squares-535"><span class="linenos">535</span></a><span class="sd">        milkrecordings (float): List/array of milk recordings (kg).</span>
</span><span id="get_lc_parameters_least_squares-536"><a href="#get_lc_parameters_least_squares-536"><span class="linenos">536</span></a><span class="sd">        model (str): Pre-defined model name; currently used with &quot;milkbot&quot;.</span>
</span><span id="get_lc_parameters_least_squares-537"><a href="#get_lc_parameters_least_squares-537"><span class="linenos">537</span></a>
</span><span id="get_lc_parameters_least_squares-538"><a href="#get_lc_parameters_least_squares-538"><span class="linenos">538</span></a><span class="sd">    Returns:</span>
</span><span id="get_lc_parameters_least_squares-539"><a href="#get_lc_parameters_least_squares-539"><span class="linenos">539</span></a><span class="sd">        Parameters `(a, b, c, d)` as `np.float` in alphabetic order.</span>
</span><span id="get_lc_parameters_least_squares-540"><a href="#get_lc_parameters_least_squares-540"><span class="linenos">540</span></a>
</span><span id="get_lc_parameters_least_squares-541"><a href="#get_lc_parameters_least_squares-541"><span class="linenos">541</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_lc_parameters_least_squares-542"><a href="#get_lc_parameters_least_squares-542"><span class="linenos">542</span></a>    <span class="c1"># check and prep input</span>
</span><span id="get_lc_parameters_least_squares-543"><a href="#get_lc_parameters_least_squares-543"><span class="linenos">543</span></a>    <span class="c1"># check and prepare input</span>
</span><span id="get_lc_parameters_least_squares-544"><a href="#get_lc_parameters_least_squares-544"><span class="linenos">544</span></a>    <span class="n">inputs</span> <span class="o">=</span> <span class="n">validate_and_prepare_inputs</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
</span><span id="get_lc_parameters_least_squares-545"><a href="#get_lc_parameters_least_squares-545"><span class="linenos">545</span></a>
</span><span id="get_lc_parameters_least_squares-546"><a href="#get_lc_parameters_least_squares-546"><span class="linenos">546</span></a>    <span class="n">dim</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">dim</span>
</span><span id="get_lc_parameters_least_squares-547"><a href="#get_lc_parameters_least_squares-547"><span class="linenos">547</span></a>    <span class="n">milkrecordings</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">milkrecordings</span>
</span><span id="get_lc_parameters_least_squares-548"><a href="#get_lc_parameters_least_squares-548"><span class="linenos">548</span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">model</span>
</span><span id="get_lc_parameters_least_squares-549"><a href="#get_lc_parameters_least_squares-549"><span class="linenos">549</span></a>
</span><span id="get_lc_parameters_least_squares-550"><a href="#get_lc_parameters_least_squares-550"><span class="linenos">550</span></a>    <span class="c1"># ------------------------------</span>
</span><span id="get_lc_parameters_least_squares-551"><a href="#get_lc_parameters_least_squares-551"><span class="linenos">551</span></a>    <span class="c1"># Initial guess</span>
</span><span id="get_lc_parameters_least_squares-552"><a href="#get_lc_parameters_least_squares-552"><span class="linenos">552</span></a>    <span class="c1"># ------------------------------</span>
</span><span id="get_lc_parameters_least_squares-553"><a href="#get_lc_parameters_least_squares-553"><span class="linenos">553</span></a>    <span class="n">a0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">milkrecordings</span><span class="p">)</span>
</span><span id="get_lc_parameters_least_squares-554"><a href="#get_lc_parameters_least_squares-554"><span class="linenos">554</span></a>    <span class="n">b0</span> <span class="o">=</span> <span class="mf">50.0</span>
</span><span id="get_lc_parameters_least_squares-555"><a href="#get_lc_parameters_least_squares-555"><span class="linenos">555</span></a>    <span class="n">c0</span> <span class="o">=</span> <span class="mf">30.0</span>
</span><span id="get_lc_parameters_least_squares-556"><a href="#get_lc_parameters_least_squares-556"><span class="linenos">556</span></a>    <span class="n">d0</span> <span class="o">=</span> <span class="mf">0.01</span>
</span><span id="get_lc_parameters_least_squares-557"><a href="#get_lc_parameters_least_squares-557"><span class="linenos">557</span></a>    <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">d0</span><span class="p">]</span>
</span><span id="get_lc_parameters_least_squares-558"><a href="#get_lc_parameters_least_squares-558"><span class="linenos">558</span></a>
</span><span id="get_lc_parameters_least_squares-559"><a href="#get_lc_parameters_least_squares-559"><span class="linenos">559</span></a>    <span class="c1"># ------------------------------</span>
</span><span id="get_lc_parameters_least_squares-560"><a href="#get_lc_parameters_least_squares-560"><span class="linenos">560</span></a>    <span class="c1"># Parameter bounds</span>
</span><span id="get_lc_parameters_least_squares-561"><a href="#get_lc_parameters_least_squares-561"><span class="linenos">561</span></a>    <span class="c1"># ------------------------------</span>
</span><span id="get_lc_parameters_least_squares-562"><a href="#get_lc_parameters_least_squares-562"><span class="linenos">562</span></a>    <span class="n">lower</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">milkrecordings</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">300.0</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">]</span>
</span><span id="get_lc_parameters_least_squares-563"><a href="#get_lc_parameters_least_squares-563"><span class="linenos">563</span></a>    <span class="n">upper</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">milkrecordings</span><span class="p">)</span> <span class="o">*</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">400.0</span><span class="p">,</span> <span class="mf">300.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
</span><span id="get_lc_parameters_least_squares-564"><a href="#get_lc_parameters_least_squares-564"><span class="linenos">564</span></a>
</span><span id="get_lc_parameters_least_squares-565"><a href="#get_lc_parameters_least_squares-565"><span class="linenos">565</span></a>    <span class="c1"># ------------------------------</span>
</span><span id="get_lc_parameters_least_squares-566"><a href="#get_lc_parameters_least_squares-566"><span class="linenos">566</span></a>    <span class="c1"># Fit using least-squares</span>
</span><span id="get_lc_parameters_least_squares-567"><a href="#get_lc_parameters_least_squares-567"><span class="linenos">567</span></a>    <span class="c1"># ------------------------------</span>
</span><span id="get_lc_parameters_least_squares-568"><a href="#get_lc_parameters_least_squares-568"><span class="linenos">568</span></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">least_squares</span><span class="p">(</span>
</span><span id="get_lc_parameters_least_squares-569"><a href="#get_lc_parameters_least_squares-569"><span class="linenos">569</span></a>        <span class="n">residuals_milkbot</span><span class="p">,</span>
</span><span id="get_lc_parameters_least_squares-570"><a href="#get_lc_parameters_least_squares-570"><span class="linenos">570</span></a>        <span class="n">p0</span><span class="p">,</span>
</span><span id="get_lc_parameters_least_squares-571"><a href="#get_lc_parameters_least_squares-571"><span class="linenos">571</span></a>        <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">),</span>
</span><span id="get_lc_parameters_least_squares-572"><a href="#get_lc_parameters_least_squares-572"><span class="linenos">572</span></a>        <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">),</span>
</span><span id="get_lc_parameters_least_squares-573"><a href="#get_lc_parameters_least_squares-573"><span class="linenos">573</span></a>        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;trf&quot;</span><span class="p">,</span>  <span class="c1"># trust region reflective, works well with bounds</span>
</span><span id="get_lc_parameters_least_squares-574"><a href="#get_lc_parameters_least_squares-574"><span class="linenos">574</span></a>    <span class="p">)</span>
</span><span id="get_lc_parameters_least_squares-575"><a href="#get_lc_parameters_least_squares-575"><span class="linenos">575</span></a>
</span><span id="get_lc_parameters_least_squares-576"><a href="#get_lc_parameters_least_squares-576"><span class="linenos">576</span></a>    <span class="c1"># ------------------------------</span>
</span><span id="get_lc_parameters_least_squares-577"><a href="#get_lc_parameters_least_squares-577"><span class="linenos">577</span></a>    <span class="c1"># Extract parameters</span>
</span><span id="get_lc_parameters_least_squares-578"><a href="#get_lc_parameters_least_squares-578"><span class="linenos">578</span></a>    <span class="c1"># ------------------------------</span>
</span><span id="get_lc_parameters_least_squares-579"><a href="#get_lc_parameters_least_squares-579"><span class="linenos">579</span></a>    <span class="n">a_mb</span><span class="p">,</span> <span class="n">b_mb</span><span class="p">,</span> <span class="n">c_mb</span><span class="p">,</span> <span class="n">d_mb</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span>
</span><span id="get_lc_parameters_least_squares-580"><a href="#get_lc_parameters_least_squares-580"><span class="linenos">580</span></a>
</span><span id="get_lc_parameters_least_squares-581"><a href="#get_lc_parameters_least_squares-581"><span class="linenos">581</span></a>    <span class="k">return</span> <span class="n">a_mb</span><span class="p">,</span> <span class="n">b_mb</span><span class="p">,</span> <span class="n">c_mb</span><span class="p">,</span> <span class="n">d_mb</span>
</span></pre></div>


            <div class="docstring"><p>Fit lactation data and return model parameters (least squares; frequentist).</p>

<p>This helper uses <code>scipy.optimize.least_squares</code> to fit the MilkBot model with bounds,
and returns the fitted parameters.</p>

<p>Args:
    dim (int): List/array of DIM values.
    milkrecordings (float): List/array of milk recordings (kg).
    model (str): Pre-defined model name; currently used with "milkbot".</p>

<p>Returns:
    Parameters <code>(a, b, c, d)</code> as <code>np.float</code> in alphabetic order.</p>
</div>


                </section>
                <section id="hayashi_model">
                            <input id="hayashi_model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">hayashi_model</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">t</span>, </span><span class="param"><span class="n">a</span>, </span><span class="param"><span class="n">b</span>, </span><span class="param"><span class="n">c</span>, </span><span class="param"><span class="n">d</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="hayashi_model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#hayashi_model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="hayashi_model-249"><a href="#hayashi_model-249"><span class="linenos">249</span></a><span class="k">def</span><span class="w"> </span><span class="nf">hayashi_model</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
</span><span id="hayashi_model-250"><a href="#hayashi_model-250"><span class="linenos">250</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Hayashi lactation curve model.</span>
</span><span id="hayashi_model-251"><a href="#hayashi_model-251"><span class="linenos">251</span></a>
</span><span id="hayashi_model-252"><a href="#hayashi_model-252"><span class="linenos">252</span></a><span class="sd">    Args:</span>
</span><span id="hayashi_model-253"><a href="#hayashi_model-253"><span class="linenos">253</span></a><span class="sd">        t: Time since calving in days (DIM).</span>
</span><span id="hayashi_model-254"><a href="#hayashi_model-254"><span class="linenos">254</span></a><span class="sd">        a: Ratio parameter (&gt; 0) (numerical).</span>
</span><span id="hayashi_model-255"><a href="#hayashi_model-255"><span class="linenos">255</span></a><span class="sd">        b: Scale parameter (numerical).</span>
</span><span id="hayashi_model-256"><a href="#hayashi_model-256"><span class="linenos">256</span></a><span class="sd">        c: Time constant for the first exponential term (numerical).</span>
</span><span id="hayashi_model-257"><a href="#hayashi_model-257"><span class="linenos">257</span></a><span class="sd">        d: Parameter retained for compatibility with literature (unused in this expression).</span>
</span><span id="hayashi_model-258"><a href="#hayashi_model-258"><span class="linenos">258</span></a>
</span><span id="hayashi_model-259"><a href="#hayashi_model-259"><span class="linenos">259</span></a><span class="sd">    Returns:</span>
</span><span id="hayashi_model-260"><a href="#hayashi_model-260"><span class="linenos">260</span></a><span class="sd">        Predicted milk yield at `t`.</span>
</span><span id="hayashi_model-261"><a href="#hayashi_model-261"><span class="linenos">261</span></a>
</span><span id="hayashi_model-262"><a href="#hayashi_model-262"><span class="linenos">262</span></a><span class="sd">    Notes:</span>
</span><span id="hayashi_model-263"><a href="#hayashi_model-263"><span class="linenos">263</span></a><span class="sd">        Formula: `y(t) = b * (exp(-t / c) - exp(-t / (a * c)))`.</span>
</span><span id="hayashi_model-264"><a href="#hayashi_model-264"><span class="linenos">264</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="hayashi_model-265"><a href="#hayashi_model-265"><span class="linenos">265</span></a>    <span class="k">return</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span> <span class="o">/</span> <span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">c</span><span class="p">)))</span>
</span></pre></div>


            <div class="docstring"><p>Hayashi lactation curve model.</p>

<p>Args:
    t: Time since calving in days (DIM).
    a: Ratio parameter (&gt; 0) (numerical).
    b: Scale parameter (numerical).
    c: Time constant for the first exponential term (numerical).
    d: Parameter retained for compatibility with literature (unused in this expression).</p>

<p>Returns:
    Predicted milk yield at <code>t</code>.</p>

<p>Notes:
    Formula: <code>y(t) = b * (exp(-t / c) - exp(-t / (a * c)))</code>.</p>
</div>


                </section>
                <section id="milkbot_model">
                            <input id="milkbot_model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">milkbot_model</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">t</span>, </span><span class="param"><span class="n">a</span>, </span><span class="param"><span class="n">b</span>, </span><span class="param"><span class="n">c</span>, </span><span class="param"><span class="n">d</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="milkbot_model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#milkbot_model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="milkbot_model-71"><a href="#milkbot_model-71"><span class="linenos">71</span></a><span class="k">def</span><span class="w"> </span><span class="nf">milkbot_model</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
</span><span id="milkbot_model-72"><a href="#milkbot_model-72"><span class="linenos">72</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;MilkBot lactation curve model.</span>
</span><span id="milkbot_model-73"><a href="#milkbot_model-73"><span class="linenos">73</span></a>
</span><span id="milkbot_model-74"><a href="#milkbot_model-74"><span class="linenos">74</span></a><span class="sd">    Args:</span>
</span><span id="milkbot_model-75"><a href="#milkbot_model-75"><span class="linenos">75</span></a><span class="sd">        t: Time since calving in days (DIM), scalar or array-like.</span>
</span><span id="milkbot_model-76"><a href="#milkbot_model-76"><span class="linenos">76</span></a><span class="sd">        a: Scale; overall level of milk production.</span>
</span><span id="milkbot_model-77"><a href="#milkbot_model-77"><span class="linenos">77</span></a><span class="sd">        b: Ramp; governs the rate of rise in early lactation.</span>
</span><span id="milkbot_model-78"><a href="#milkbot_model-78"><span class="linenos">78</span></a><span class="sd">        c: Offset; small (usually minor) correction around the theoretical start of lactation.</span>
</span><span id="milkbot_model-79"><a href="#milkbot_model-79"><span class="linenos">79</span></a><span class="sd">        d: Decay; exponential decline rate, evident in late lactation.</span>
</span><span id="milkbot_model-80"><a href="#milkbot_model-80"><span class="linenos">80</span></a>
</span><span id="milkbot_model-81"><a href="#milkbot_model-81"><span class="linenos">81</span></a><span class="sd">    Returns:</span>
</span><span id="milkbot_model-82"><a href="#milkbot_model-82"><span class="linenos">82</span></a><span class="sd">        Predicted milk yield at `t` (same shape as `t`).</span>
</span><span id="milkbot_model-83"><a href="#milkbot_model-83"><span class="linenos">83</span></a>
</span><span id="milkbot_model-84"><a href="#milkbot_model-84"><span class="linenos">84</span></a><span class="sd">    Notes:</span>
</span><span id="milkbot_model-85"><a href="#milkbot_model-85"><span class="linenos">85</span></a><span class="sd">        Formula: `y(t) = a * (1 - exp((c - t) / b) / 2) * exp(-d * t)`.</span>
</span><span id="milkbot_model-86"><a href="#milkbot_model-86"><span class="linenos">86</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="milkbot_model-87"><a href="#milkbot_model-87"><span class="linenos">87</span></a>    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">c</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">d</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>MilkBot lactation curve model.</p>

<p>Args:
    t: Time since calving in days (DIM), scalar or array-like.
    a: Scale; overall level of milk production.
    b: Ramp; governs the rate of rise in early lactation.
    c: Offset; small (usually minor) correction around the theoretical start of lactation.
    d: Decay; exponential decline rate, evident in late lactation.</p>

<p>Returns:
    Predicted milk yield at <code>t</code> (same shape as <code>t</code>).</p>

<p>Notes:
    Formula: <code>y(t) = a * (1 - exp((c - t) / b) / 2) * exp(-d * t)</code>.</p>
</div>


                </section>
                <section id="nelder_model">
                            <input id="nelder_model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">nelder_model</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">t</span>, </span><span class="param"><span class="n">a</span>, </span><span class="param"><span class="n">b</span>, </span><span class="param"><span class="n">c</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="nelder_model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#nelder_model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="nelder_model-194"><a href="#nelder_model-194"><span class="linenos">194</span></a><span class="k">def</span><span class="w"> </span><span class="nf">nelder_model</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
</span><span id="nelder_model-195"><a href="#nelder_model-195"><span class="linenos">195</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Nelder lactation curve model.</span>
</span><span id="nelder_model-196"><a href="#nelder_model-196"><span class="linenos">196</span></a>
</span><span id="nelder_model-197"><a href="#nelder_model-197"><span class="linenos">197</span></a><span class="sd">    Args:</span>
</span><span id="nelder_model-198"><a href="#nelder_model-198"><span class="linenos">198</span></a><span class="sd">        t: Time since calving in days (DIM).</span>
</span><span id="nelder_model-199"><a href="#nelder_model-199"><span class="linenos">199</span></a><span class="sd">        a: Denominator intercept (numerical).</span>
</span><span id="nelder_model-200"><a href="#nelder_model-200"><span class="linenos">200</span></a><span class="sd">        b: Denominator linear coefficient (numerical).</span>
</span><span id="nelder_model-201"><a href="#nelder_model-201"><span class="linenos">201</span></a><span class="sd">        c: Denominator quadratic coefficient (numerical).</span>
</span><span id="nelder_model-202"><a href="#nelder_model-202"><span class="linenos">202</span></a>
</span><span id="nelder_model-203"><a href="#nelder_model-203"><span class="linenos">203</span></a><span class="sd">    Returns:</span>
</span><span id="nelder_model-204"><a href="#nelder_model-204"><span class="linenos">204</span></a><span class="sd">        Predicted milk yield at `t`.</span>
</span><span id="nelder_model-205"><a href="#nelder_model-205"><span class="linenos">205</span></a>
</span><span id="nelder_model-206"><a href="#nelder_model-206"><span class="linenos">206</span></a><span class="sd">    Notes:</span>
</span><span id="nelder_model-207"><a href="#nelder_model-207"><span class="linenos">207</span></a><span class="sd">        Formula: `y(t) = t / (a + b*t + c*t**2)`.</span>
</span><span id="nelder_model-208"><a href="#nelder_model-208"><span class="linenos">208</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="nelder_model-209"><a href="#nelder_model-209"><span class="linenos">209</span></a>    <span class="k">return</span> <span class="n">t</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Nelder lactation curve model.</p>

<p>Args:
    t: Time since calving in days (DIM).
    a: Denominator intercept (numerical).
    b: Denominator linear coefficient (numerical).
    c: Denominator quadratic coefficient (numerical).</p>

<p>Returns:
    Predicted milk yield at <code>t</code>.</p>

<p>Notes:
    Formula: <code>y(t) = t / (a + b*t + c*t**2)</code>.</p>
</div>


                </section>
                <section id="prasad_model">
                            <input id="prasad_model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">prasad_model</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">t</span>, </span><span class="param"><span class="n">a</span>, </span><span class="param"><span class="n">b</span>, </span><span class="param"><span class="n">c</span>, </span><span class="param"><span class="n">d</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="prasad_model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#prasad_model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="prasad_model-306"><a href="#prasad_model-306"><span class="linenos">306</span></a><span class="k">def</span><span class="w"> </span><span class="nf">prasad_model</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
</span><span id="prasad_model-307"><a href="#prasad_model-307"><span class="linenos">307</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Prasad lactation curve model.</span>
</span><span id="prasad_model-308"><a href="#prasad_model-308"><span class="linenos">308</span></a>
</span><span id="prasad_model-309"><a href="#prasad_model-309"><span class="linenos">309</span></a><span class="sd">    Args:</span>
</span><span id="prasad_model-310"><a href="#prasad_model-310"><span class="linenos">310</span></a><span class="sd">        t: Time since calving in days (DIM).</span>
</span><span id="prasad_model-311"><a href="#prasad_model-311"><span class="linenos">311</span></a><span class="sd">        a: Intercept-like parameter (numerical).</span>
</span><span id="prasad_model-312"><a href="#prasad_model-312"><span class="linenos">312</span></a><span class="sd">        b: Linear coefficient (numerical).</span>
</span><span id="prasad_model-313"><a href="#prasad_model-313"><span class="linenos">313</span></a><span class="sd">        c: Quadratic coefficient (numerical).</span>
</span><span id="prasad_model-314"><a href="#prasad_model-314"><span class="linenos">314</span></a><span class="sd">        d: Inverse-time coefficient (numerical).</span>
</span><span id="prasad_model-315"><a href="#prasad_model-315"><span class="linenos">315</span></a>
</span><span id="prasad_model-316"><a href="#prasad_model-316"><span class="linenos">316</span></a><span class="sd">    Returns:</span>
</span><span id="prasad_model-317"><a href="#prasad_model-317"><span class="linenos">317</span></a><span class="sd">        Predicted milk yield at `t`.</span>
</span><span id="prasad_model-318"><a href="#prasad_model-318"><span class="linenos">318</span></a>
</span><span id="prasad_model-319"><a href="#prasad_model-319"><span class="linenos">319</span></a><span class="sd">    Notes:</span>
</span><span id="prasad_model-320"><a href="#prasad_model-320"><span class="linenos">320</span></a><span class="sd">        Formula: `y(t) = a + b*t + c*t**2 + d/t`.</span>
</span><span id="prasad_model-321"><a href="#prasad_model-321"><span class="linenos">321</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="prasad_model-322"><a href="#prasad_model-322"><span class="linenos">322</span></a>    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">d</span> <span class="o">/</span> <span class="n">t</span>
</span></pre></div>


            <div class="docstring"><p>Prasad lactation curve model.</p>

<p>Args:
    t: Time since calving in days (DIM).
    a: Intercept-like parameter (numerical).
    b: Linear coefficient (numerical).
    c: Quadratic coefficient (numerical).
    d: Inverse-time coefficient (numerical).</p>

<p>Returns:
    Predicted milk yield at <code>t</code>.</p>

<p>Notes:
    Formula: <code>y(t) = a + b*t + c*t**2 + d/t</code>.</p>
</div>


                </section>
                <section id="rook_model">
                            <input id="rook_model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rook_model</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">t</span>, </span><span class="param"><span class="n">a</span>, </span><span class="param"><span class="n">b</span>, </span><span class="param"><span class="n">c</span>, </span><span class="param"><span class="n">d</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="rook_model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#rook_model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="rook_model-268"><a href="#rook_model-268"><span class="linenos">268</span></a><span class="k">def</span><span class="w"> </span><span class="nf">rook_model</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
</span><span id="rook_model-269"><a href="#rook_model-269"><span class="linenos">269</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Rook lactation curve model.</span>
</span><span id="rook_model-270"><a href="#rook_model-270"><span class="linenos">270</span></a>
</span><span id="rook_model-271"><a href="#rook_model-271"><span class="linenos">271</span></a><span class="sd">    Args:</span>
</span><span id="rook_model-272"><a href="#rook_model-272"><span class="linenos">272</span></a><span class="sd">        t: Time since calving in days (DIM).</span>
</span><span id="rook_model-273"><a href="#rook_model-273"><span class="linenos">273</span></a><span class="sd">        a: Scale parameter (numerical).</span>
</span><span id="rook_model-274"><a href="#rook_model-274"><span class="linenos">274</span></a><span class="sd">        b: Shape parameter in rational term (numerical).</span>
</span><span id="rook_model-275"><a href="#rook_model-275"><span class="linenos">275</span></a><span class="sd">        c: Offset parameter in rational term (numerical).</span>
</span><span id="rook_model-276"><a href="#rook_model-276"><span class="linenos">276</span></a><span class="sd">        d: Exponential decay parameter (numerical).</span>
</span><span id="rook_model-277"><a href="#rook_model-277"><span class="linenos">277</span></a>
</span><span id="rook_model-278"><a href="#rook_model-278"><span class="linenos">278</span></a><span class="sd">    Returns:</span>
</span><span id="rook_model-279"><a href="#rook_model-279"><span class="linenos">279</span></a><span class="sd">        Predicted milk yield at `t`.</span>
</span><span id="rook_model-280"><a href="#rook_model-280"><span class="linenos">280</span></a>
</span><span id="rook_model-281"><a href="#rook_model-281"><span class="linenos">281</span></a><span class="sd">    Notes:</span>
</span><span id="rook_model-282"><a href="#rook_model-282"><span class="linenos">282</span></a><span class="sd">        Formula: `y(t) = a * (1 / (1 + b / (c + t))) * exp(-d * t)`.</span>
</span><span id="rook_model-283"><a href="#rook_model-283"><span class="linenos">283</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="rook_model-284"><a href="#rook_model-284"><span class="linenos">284</span></a>    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">b</span> <span class="o">/</span> <span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="n">t</span><span class="p">)))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">d</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Rook lactation curve model.</p>

<p>Args:
    t: Time since calving in days (DIM).
    a: Scale parameter (numerical).
    b: Shape parameter in rational term (numerical).
    c: Offset parameter in rational term (numerical).
    d: Exponential decay parameter (numerical).</p>

<p>Returns:
    Predicted milk yield at <code>t</code>.</p>

<p>Notes:
    Formula: <code>y(t) = a * (1 / (1 + b / (c + t))) * exp(-d * t)</code>.</p>
</div>


                </section>
                <section id="sikka_model">
                            <input id="sikka_model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sikka_model</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">t</span>, </span><span class="param"><span class="n">a</span>, </span><span class="param"><span class="n">b</span>, </span><span class="param"><span class="n">c</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="sikka_model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#sikka_model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="sikka_model-179"><a href="#sikka_model-179"><span class="linenos">179</span></a><span class="k">def</span><span class="w"> </span><span class="nf">sikka_model</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
</span><span id="sikka_model-180"><a href="#sikka_model-180"><span class="linenos">180</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Sikka lactation curve model.</span>
</span><span id="sikka_model-181"><a href="#sikka_model-181"><span class="linenos">181</span></a>
</span><span id="sikka_model-182"><a href="#sikka_model-182"><span class="linenos">182</span></a><span class="sd">    Args:</span>
</span><span id="sikka_model-183"><a href="#sikka_model-183"><span class="linenos">183</span></a><span class="sd">        t: Time since calving in days (DIM).</span>
</span><span id="sikka_model-184"><a href="#sikka_model-184"><span class="linenos">184</span></a><span class="sd">        a: Scale parameter (numerical).</span>
</span><span id="sikka_model-185"><a href="#sikka_model-185"><span class="linenos">185</span></a><span class="sd">        b: Growth parameter (numerical).</span>
</span><span id="sikka_model-186"><a href="#sikka_model-186"><span class="linenos">186</span></a><span class="sd">        c: Quadratic decay parameter (numerical).</span>
</span><span id="sikka_model-187"><a href="#sikka_model-187"><span class="linenos">187</span></a>
</span><span id="sikka_model-188"><a href="#sikka_model-188"><span class="linenos">188</span></a><span class="sd">    Returns:</span>
</span><span id="sikka_model-189"><a href="#sikka_model-189"><span class="linenos">189</span></a><span class="sd">        Predicted milk yield at `t`.</span>
</span><span id="sikka_model-190"><a href="#sikka_model-190"><span class="linenos">190</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="sikka_model-191"><a href="#sikka_model-191"><span class="linenos">191</span></a>    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">t</span> <span class="o">-</span> <span class="n">c</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Sikka lactation curve model.</p>

<p>Args:
    t: Time since calving in days (DIM).
    a: Scale parameter (numerical).
    b: Growth parameter (numerical).
    c: Quadratic decay parameter (numerical).</p>

<p>Returns:
    Predicted milk yield at <code>t</code>.</p>
</div>


                </section>
                <section id="wilmink_model">
                            <input id="wilmink_model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">wilmink_model</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">t</span>, </span><span class="param"><span class="n">a</span>, </span><span class="param"><span class="n">b</span>, </span><span class="param"><span class="n">c</span>, </span><span class="param"><span class="n">k</span><span class="o">=-</span><span class="mf">0.05</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="wilmink_model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#wilmink_model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="wilmink_model-108"><a href="#wilmink_model-108"><span class="linenos">108</span></a><span class="k">def</span><span class="w"> </span><span class="nf">wilmink_model</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="o">=-</span><span class="mf">0.05</span><span class="p">):</span>
</span><span id="wilmink_model-109"><a href="#wilmink_model-109"><span class="linenos">109</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Wilmink lactation curve model.</span>
</span><span id="wilmink_model-110"><a href="#wilmink_model-110"><span class="linenos">110</span></a>
</span><span id="wilmink_model-111"><a href="#wilmink_model-111"><span class="linenos">111</span></a><span class="sd">    Args:</span>
</span><span id="wilmink_model-112"><a href="#wilmink_model-112"><span class="linenos">112</span></a><span class="sd">        t: Time since calving in days (DIM), scalar or array-like.</span>
</span><span id="wilmink_model-113"><a href="#wilmink_model-113"><span class="linenos">113</span></a><span class="sd">        a: Intercept-like parameter (numerical).</span>
</span><span id="wilmink_model-114"><a href="#wilmink_model-114"><span class="linenos">114</span></a><span class="sd">        b: Linear trend coefficient (numerical).</span>
</span><span id="wilmink_model-115"><a href="#wilmink_model-115"><span class="linenos">115</span></a><span class="sd">        c: Exponential-term scale (numerical).</span>
</span><span id="wilmink_model-116"><a href="#wilmink_model-116"><span class="linenos">116</span></a><span class="sd">        k: Fixed exponential rate (numerical), default -0.05.</span>
</span><span id="wilmink_model-117"><a href="#wilmink_model-117"><span class="linenos">117</span></a>
</span><span id="wilmink_model-118"><a href="#wilmink_model-118"><span class="linenos">118</span></a><span class="sd">    Returns:</span>
</span><span id="wilmink_model-119"><a href="#wilmink_model-119"><span class="linenos">119</span></a><span class="sd">        Predicted milk yield at `t`.</span>
</span><span id="wilmink_model-120"><a href="#wilmink_model-120"><span class="linenos">120</span></a>
</span><span id="wilmink_model-121"><a href="#wilmink_model-121"><span class="linenos">121</span></a><span class="sd">    Notes:</span>
</span><span id="wilmink_model-122"><a href="#wilmink_model-122"><span class="linenos">122</span></a><span class="sd">        Formula: `y(t) = a + b * t + c * exp(k * t)`.</span>
</span><span id="wilmink_model-123"><a href="#wilmink_model-123"><span class="linenos">123</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="wilmink_model-124"><a href="#wilmink_model-124"><span class="linenos">124</span></a>    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="wilmink_model-125"><a href="#wilmink_model-125"><span class="linenos">125</span></a>    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Wilmink lactation curve model.</p>

<p>Args:
    t: Time since calving in days (DIM), scalar or array-like.
    a: Intercept-like parameter (numerical).
    b: Linear trend coefficient (numerical).
    c: Exponential-term scale (numerical).
    k: Fixed exponential rate (numerical), default -0.05.</p>

<p>Returns:
    Predicted milk yield at <code>t</code>.</p>

<p>Notes:
    Formula: <code>y(t) = a + b * t + c * exp(k * t)</code>.</p>
</div>


                </section>
                <section id="wood_model">
                            <input id="wood_model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">wood_model</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">t</span>, </span><span class="param"><span class="n">a</span>, </span><span class="param"><span class="n">b</span>, </span><span class="param"><span class="n">c</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="wood_model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#wood_model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="wood_model-90"><a href="#wood_model-90"><span class="linenos"> 90</span></a><span class="k">def</span><span class="w"> </span><span class="nf">wood_model</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
</span><span id="wood_model-91"><a href="#wood_model-91"><span class="linenos"> 91</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Wood lactation curve model.</span>
</span><span id="wood_model-92"><a href="#wood_model-92"><span class="linenos"> 92</span></a>
</span><span id="wood_model-93"><a href="#wood_model-93"><span class="linenos"> 93</span></a><span class="sd">    Args:</span>
</span><span id="wood_model-94"><a href="#wood_model-94"><span class="linenos"> 94</span></a><span class="sd">        t: Time since calving in days (DIM), scalar or array-like.</span>
</span><span id="wood_model-95"><a href="#wood_model-95"><span class="linenos"> 95</span></a><span class="sd">        a: Scale parameter (numerical).</span>
</span><span id="wood_model-96"><a href="#wood_model-96"><span class="linenos"> 96</span></a><span class="sd">        b: Shape parameter controlling rise (numerical).</span>
</span><span id="wood_model-97"><a href="#wood_model-97"><span class="linenos"> 97</span></a><span class="sd">        c: Decay parameter (numerical).</span>
</span><span id="wood_model-98"><a href="#wood_model-98"><span class="linenos"> 98</span></a>
</span><span id="wood_model-99"><a href="#wood_model-99"><span class="linenos"> 99</span></a><span class="sd">    Returns:</span>
</span><span id="wood_model-100"><a href="#wood_model-100"><span class="linenos">100</span></a><span class="sd">        Predicted milk yield at `t`.</span>
</span><span id="wood_model-101"><a href="#wood_model-101"><span class="linenos">101</span></a>
</span><span id="wood_model-102"><a href="#wood_model-102"><span class="linenos">102</span></a><span class="sd">    Notes:</span>
</span><span id="wood_model-103"><a href="#wood_model-103"><span class="linenos">103</span></a><span class="sd">        Formula: `y(t) = a * t**b * exp(-c * t)`.</span>
</span><span id="wood_model-104"><a href="#wood_model-104"><span class="linenos">104</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="wood_model-105"><a href="#wood_model-105"><span class="linenos">105</span></a>    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span><span class="o">**</span><span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">c</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Wood lactation curve model.</p>

<p>Args:
    t: Time since calving in days (DIM), scalar or array-like.
    a: Scale parameter (numerical).
    b: Shape parameter controlling rise (numerical).
    c: Decay parameter (numerical).</p>

<p>Returns:
    Predicted milk yield at <code>t</code>.</p>

<p>Notes:
    Formula: <code>y(t) = a * t**b * exp(-c * t)</code>.</p>
</div>


                </section>
                <section id="calculate_characteristic">
                            <input id="calculate_characteristic-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">calculate_characteristic</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dim</span>,</span><span class="param">	<span class="n">milkrecordings</span>,</span><span class="param">	<span class="n">model</span><span class="o">=</span><span class="s1">&#39;wood&#39;</span>,</span><span class="param">	<span class="n">characteristic</span><span class="o">=</span><span class="s1">&#39;cumulative_milk_yield&#39;</span>,</span><span class="param">	<span class="n">fitting</span><span class="o">=</span><span class="s1">&#39;frequentist&#39;</span>,</span><span class="param">	<span class="n">key</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">parity</span><span class="o">=</span><span class="mi">3</span>,</span><span class="param">	<span class="n">breed</span><span class="o">=</span><span class="s1">&#39;H&#39;</span>,</span><span class="param">	<span class="n">continent</span><span class="o">=</span><span class="s1">&#39;USA&#39;</span>,</span><span class="param">	<span class="n">persistency_method</span><span class="o">=</span><span class="s1">&#39;derived&#39;</span>,</span><span class="param">	<span class="n">lactation_length</span><span class="o">=</span><span class="mi">305</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="calculate_characteristic-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#calculate_characteristic"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="calculate_characteristic-292"><a href="#calculate_characteristic-292"><span class="linenos">292</span></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_characteristic</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;wood&#39;</span><span class="p">,</span> <span class="n">characteristic</span><span class="o">=</span><span class="s1">&#39;cumulative_milk_yield&#39;</span><span class="p">,</span>
</span><span id="calculate_characteristic-293"><a href="#calculate_characteristic-293"><span class="linenos">293</span></a>                             <span class="n">fitting</span><span class="o">=</span><span class="s1">&#39;frequentist&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parity</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">breed</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">continent</span><span class="o">=</span><span class="s1">&#39;USA&#39;</span><span class="p">,</span>
</span><span id="calculate_characteristic-294"><a href="#calculate_characteristic-294"><span class="linenos">294</span></a>                             <span class="n">persistency_method</span><span class="o">=</span><span class="s1">&#39;derived&#39;</span><span class="p">,</span> <span class="n">lactation_length</span><span class="o">=</span><span class="mi">305</span><span class="p">):</span>
</span><span id="calculate_characteristic-295"><a href="#calculate_characteristic-295"><span class="linenos">295</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluate a lactation curve characteristic from observed test-day data.</span>
</span><span id="calculate_characteristic-296"><a href="#calculate_characteristic-296"><span class="linenos">296</span></a>
</span><span id="calculate_characteristic-297"><a href="#calculate_characteristic-297"><span class="linenos">297</span></a><span class="sd">    This function fits the requested model (frequentist or Bayesian via MilkBot),</span>
</span><span id="calculate_characteristic-298"><a href="#calculate_characteristic-298"><span class="linenos">298</span></a><span class="sd">    retrieves model parameters, and evaluates the requested characteristic using the</span>
</span><span id="calculate_characteristic-299"><a href="#calculate_characteristic-299"><span class="linenos">299</span></a><span class="sd">    symbolic expression (if available), falling back to numeric methods when needed.</span>
</span><span id="calculate_characteristic-300"><a href="#calculate_characteristic-300"><span class="linenos">300</span></a>
</span><span id="calculate_characteristic-301"><a href="#calculate_characteristic-301"><span class="linenos">301</span></a><span class="sd">    Args:</span>
</span><span id="calculate_characteristic-302"><a href="#calculate_characteristic-302"><span class="linenos">302</span></a><span class="sd">        dim (Int): Days in milk (DIM).</span>
</span><span id="calculate_characteristic-303"><a href="#calculate_characteristic-303"><span class="linenos">303</span></a><span class="sd">        milkrecordings (Float): Milk recordings (kg or lbs) for each DIM.</span>
</span><span id="calculate_characteristic-304"><a href="#calculate_characteristic-304"><span class="linenos">304</span></a><span class="sd">        model (str): Model name. Supported for this function:</span>
</span><span id="calculate_characteristic-305"><a href="#calculate_characteristic-305"><span class="linenos">305</span></a><span class="sd">            &#39;milkbot&#39;, &#39;wood&#39;, &#39;wilmink&#39;, &#39;ali_schaeffer&#39;, &#39;fischer&#39;.</span>
</span><span id="calculate_characteristic-306"><a href="#calculate_characteristic-306"><span class="linenos">306</span></a><span class="sd">        characteristic (str): One of &#39;time_to_peak&#39;, &#39;peak_yield&#39;, &#39;cumulative_milk_yield&#39;, &#39;persistency&#39;.</span>
</span><span id="calculate_characteristic-307"><a href="#calculate_characteristic-307"><span class="linenos">307</span></a><span class="sd">        fitting (str): &#39;frequentist&#39; (default) or &#39;bayesian&#39;.</span>
</span><span id="calculate_characteristic-308"><a href="#calculate_characteristic-308"><span class="linenos">308</span></a><span class="sd">        key (str | None): API key for MilkBot Bayesian fitting.</span>
</span><span id="calculate_characteristic-309"><a href="#calculate_characteristic-309"><span class="linenos">309</span></a><span class="sd">        parity (Int): Parity of the cow; values above 3 are considered as 3 (Bayesian).</span>
</span><span id="calculate_characteristic-310"><a href="#calculate_characteristic-310"><span class="linenos">310</span></a><span class="sd">        breed (str): &#39;H&#39; (Holstein) or &#39;J&#39; (Jersey) (Bayesian).</span>
</span><span id="calculate_characteristic-311"><a href="#calculate_characteristic-311"><span class="linenos">311</span></a><span class="sd">        continent (str): &#39;USA&#39;, &#39;EU&#39;, or &#39;CHEN&#39; (Bayesian).</span>
</span><span id="calculate_characteristic-312"><a href="#calculate_characteristic-312"><span class="linenos">312</span></a><span class="sd">        persistency_method (str): &#39;derived&#39; (average slope after peak; default) or &#39;literature&#39;</span>
</span><span id="calculate_characteristic-313"><a href="#calculate_characteristic-313"><span class="linenos">313</span></a><span class="sd">            (only for Wood and MilkBot).</span>
</span><span id="calculate_characteristic-314"><a href="#calculate_characteristic-314"><span class="linenos">314</span></a><span class="sd">        lactation_length (Int | str): Horizon for persistency calculation:</span>
</span><span id="calculate_characteristic-315"><a href="#calculate_characteristic-315"><span class="linenos">315</span></a><span class="sd">            305 (default), &#39;max&#39; (use max DIM in data), or an integer.</span>
</span><span id="calculate_characteristic-316"><a href="#calculate_characteristic-316"><span class="linenos">316</span></a>
</span><span id="calculate_characteristic-317"><a href="#calculate_characteristic-317"><span class="linenos">317</span></a><span class="sd">    Returns:</span>
</span><span id="calculate_characteristic-318"><a href="#calculate_characteristic-318"><span class="linenos">318</span></a><span class="sd">        float: The requested characteristic value.</span>
</span><span id="calculate_characteristic-319"><a href="#calculate_characteristic-319"><span class="linenos">319</span></a>
</span><span id="calculate_characteristic-320"><a href="#calculate_characteristic-320"><span class="linenos">320</span></a><span class="sd">    Raises:</span>
</span><span id="calculate_characteristic-321"><a href="#calculate_characteristic-321"><span class="linenos">321</span></a><span class="sd">        Exception: If inputs are invalid, the model/characteristic is unsupported,</span>
</span><span id="calculate_characteristic-322"><a href="#calculate_characteristic-322"><span class="linenos">322</span></a><span class="sd">            an API key is missing for Bayesian fitting, or the characteristic cannot be computed.</span>
</span><span id="calculate_characteristic-323"><a href="#calculate_characteristic-323"><span class="linenos">323</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="calculate_characteristic-324"><a href="#calculate_characteristic-324"><span class="linenos">324</span></a>    <span class="c1"># check and prepare input</span>
</span><span id="calculate_characteristic-325"><a href="#calculate_characteristic-325"><span class="linenos">325</span></a>    <span class="n">inputs</span> <span class="o">=</span> <span class="n">validate_and_prepare_inputs</span><span class="p">(</span>
</span><span id="calculate_characteristic-326"><a href="#calculate_characteristic-326"><span class="linenos">326</span></a>        <span class="n">dim</span><span class="p">,</span>
</span><span id="calculate_characteristic-327"><a href="#calculate_characteristic-327"><span class="linenos">327</span></a>        <span class="n">milkrecordings</span><span class="p">,</span>
</span><span id="calculate_characteristic-328"><a href="#calculate_characteristic-328"><span class="linenos">328</span></a>        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
</span><span id="calculate_characteristic-329"><a href="#calculate_characteristic-329"><span class="linenos">329</span></a>        <span class="n">fitting</span><span class="o">=</span><span class="n">fitting</span><span class="p">,</span>
</span><span id="calculate_characteristic-330"><a href="#calculate_characteristic-330"><span class="linenos">330</span></a>        <span class="n">breed</span><span class="o">=</span><span class="n">breed</span><span class="p">,</span>
</span><span id="calculate_characteristic-331"><a href="#calculate_characteristic-331"><span class="linenos">331</span></a>        <span class="n">parity</span><span class="o">=</span><span class="n">parity</span><span class="p">,</span>
</span><span id="calculate_characteristic-332"><a href="#calculate_characteristic-332"><span class="linenos">332</span></a>        <span class="n">continent</span><span class="o">=</span><span class="n">continent</span><span class="p">,</span>
</span><span id="calculate_characteristic-333"><a href="#calculate_characteristic-333"><span class="linenos">333</span></a>        <span class="n">persistency_method</span><span class="o">=</span><span class="n">persistency_method</span><span class="p">,</span>
</span><span id="calculate_characteristic-334"><a href="#calculate_characteristic-334"><span class="linenos">334</span></a>        <span class="n">lactation_length</span><span class="o">=</span><span class="n">lactation_length</span>
</span><span id="calculate_characteristic-335"><a href="#calculate_characteristic-335"><span class="linenos">335</span></a>    <span class="p">)</span>
</span><span id="calculate_characteristic-336"><a href="#calculate_characteristic-336"><span class="linenos">336</span></a>
</span><span id="calculate_characteristic-337"><a href="#calculate_characteristic-337"><span class="linenos">337</span></a>    <span class="n">dim</span><span class="p">:</span> <span class="n">ndarray</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">dim</span>
</span><span id="calculate_characteristic-338"><a href="#calculate_characteristic-338"><span class="linenos">338</span></a>    <span class="n">milkrecordings</span><span class="p">:</span> <span class="n">ndarray</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">milkrecordings</span>
</span><span id="calculate_characteristic-339"><a href="#calculate_characteristic-339"><span class="linenos">339</span></a>    <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">model</span>
</span><span id="calculate_characteristic-340"><a href="#calculate_characteristic-340"><span class="linenos">340</span></a>    <span class="n">fitting</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">fitting</span>
</span><span id="calculate_characteristic-341"><a href="#calculate_characteristic-341"><span class="linenos">341</span></a>    <span class="n">breed</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">breed</span>
</span><span id="calculate_characteristic-342"><a href="#calculate_characteristic-342"><span class="linenos">342</span></a>    <span class="n">parity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">parity</span>
</span><span id="calculate_characteristic-343"><a href="#calculate_characteristic-343"><span class="linenos">343</span></a>    <span class="n">continent</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">continent</span>
</span><span id="calculate_characteristic-344"><a href="#calculate_characteristic-344"><span class="linenos">344</span></a>    <span class="n">persistency_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">persistency_method</span>
</span><span id="calculate_characteristic-345"><a href="#calculate_characteristic-345"><span class="linenos">345</span></a>    <span class="n">lactation_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">lactation_length</span>
</span><span id="calculate_characteristic-346"><a href="#calculate_characteristic-346"><span class="linenos">346</span></a>
</span><span id="calculate_characteristic-347"><a href="#calculate_characteristic-347"><span class="linenos">347</span></a>    <span class="k">if</span> <span class="n">model</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;milkbot&#39;</span><span class="p">,</span> <span class="s1">&#39;wood&#39;</span><span class="p">,</span> <span class="s1">&#39;wilmink&#39;</span><span class="p">,</span> <span class="s1">&#39;ali_schaeffer&#39;</span><span class="p">,</span> <span class="s1">&#39;fischer&#39;</span><span class="p">]:</span>
</span><span id="calculate_characteristic-348"><a href="#calculate_characteristic-348"><span class="linenos">348</span></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;this function currently only works for the milkbot, wood, wilmink, ali_schaeffer and fischer models&#39;</span><span class="p">)</span>
</span><span id="calculate_characteristic-349"><a href="#calculate_characteristic-349"><span class="linenos">349</span></a>
</span><span id="calculate_characteristic-350"><a href="#calculate_characteristic-350"><span class="linenos">350</span></a>    <span class="n">characteristic_options</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;time_to_peak&quot;</span><span class="p">,</span> <span class="s2">&quot;peak_yield&quot;</span><span class="p">,</span> <span class="s2">&quot;cumulative_milk_yield&quot;</span><span class="p">,</span> <span class="s2">&quot;persistency&quot;</span><span class="p">]</span>
</span><span id="calculate_characteristic-351"><a href="#calculate_characteristic-351"><span class="linenos">351</span></a>
</span><span id="calculate_characteristic-352"><a href="#calculate_characteristic-352"><span class="linenos">352</span></a>    <span class="k">if</span> <span class="n">characteristic</span> <span class="ow">in</span> <span class="n">characteristic_options</span><span class="p">:</span>
</span><span id="calculate_characteristic-353"><a href="#calculate_characteristic-353"><span class="linenos">353</span></a>        <span class="k">if</span> <span class="n">fitting</span> <span class="o">==</span> <span class="s1">&#39;frequentist&#39;</span><span class="p">:</span>
</span><span id="calculate_characteristic-354"><a href="#calculate_characteristic-354"><span class="linenos">354</span></a>
</span><span id="calculate_characteristic-355"><a href="#calculate_characteristic-355"><span class="linenos">355</span></a>            <span class="c1"># Get fitted parameters from your fitting function</span>
</span><span id="calculate_characteristic-356"><a href="#calculate_characteristic-356"><span class="linenos">356</span></a>            <span class="n">fitted_params</span> <span class="o">=</span> <span class="n">get_lc_parameters</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
</span><span id="calculate_characteristic-357"><a href="#calculate_characteristic-357"><span class="linenos">357</span></a>
</span><span id="calculate_characteristic-358"><a href="#calculate_characteristic-358"><span class="linenos">358</span></a>            <span class="k">if</span> <span class="n">characteristic</span> <span class="o">!=</span> <span class="s1">&#39;persistency&#39;</span><span class="p">:</span>
</span><span id="calculate_characteristic-359"><a href="#calculate_characteristic-359"><span class="linenos">359</span></a>                <span class="c1"># Try symbolic formula first</span>
</span><span id="calculate_characteristic-360"><a href="#calculate_characteristic-360"><span class="linenos">360</span></a>                <span class="n">expr</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span> <span class="n">lactation_curve_characteristic_function</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">characteristic</span><span class="p">,</span> <span class="n">lactation_length</span><span class="p">)</span>
</span><span id="calculate_characteristic-361"><a href="#calculate_characteristic-361"><span class="linenos">361</span></a>                <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>  <span class="c1"># get rid of warnings for invalid operations</span>
</span><span id="calculate_characteristic-362"><a href="#calculate_characteristic-362"><span class="linenos">362</span></a>                    <span class="n">value</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">fitted_params</span><span class="p">)</span>
</span><span id="calculate_characteristic-363"><a href="#calculate_characteristic-363"><span class="linenos">363</span></a>
</span><span id="calculate_characteristic-364"><a href="#calculate_characteristic-364"><span class="linenos">364</span></a>                <span class="c1"># If symbolic formula fails or is invalid (use numeric approach)</span>
</span><span id="calculate_characteristic-365"><a href="#calculate_characteristic-365"><span class="linenos">365</span></a>                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">characteristic</span> <span class="o">==</span> <span class="s1">&#39;time_to_peak&#39;</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="calculate_characteristic-366"><a href="#calculate_characteristic-366"><span class="linenos">366</span></a>                    <span class="k">if</span> <span class="n">characteristic</span> <span class="o">==</span> <span class="s1">&#39;time_to_peak&#39;</span><span class="p">:</span>
</span><span id="calculate_characteristic-367"><a href="#calculate_characteristic-367"><span class="linenos">367</span></a>                        <span class="n">value</span> <span class="o">=</span> <span class="n">numeric_time_to_peak</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fitting</span><span class="o">=</span><span class="n">fitting</span><span class="p">,</span>
</span><span id="calculate_characteristic-368"><a href="#calculate_characteristic-368"><span class="linenos">368</span></a>                                                     <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">parity</span><span class="o">=</span><span class="n">parity</span><span class="p">,</span> <span class="n">breed</span><span class="o">=</span><span class="n">breed</span><span class="p">,</span> <span class="n">continent</span><span class="o">=</span><span class="n">continent</span><span class="p">)</span>
</span><span id="calculate_characteristic-369"><a href="#calculate_characteristic-369"><span class="linenos">369</span></a>                    <span class="k">elif</span> <span class="n">characteristic</span> <span class="o">==</span> <span class="s1">&#39;peak_yield&#39;</span><span class="p">:</span>
</span><span id="calculate_characteristic-370"><a href="#calculate_characteristic-370"><span class="linenos">370</span></a>                        <span class="n">value</span> <span class="o">=</span> <span class="n">numeric_peak_yield</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fitting</span><span class="o">=</span><span class="n">fitting</span><span class="p">,</span>
</span><span id="calculate_characteristic-371"><a href="#calculate_characteristic-371"><span class="linenos">371</span></a>                                                   <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">parity</span><span class="o">=</span><span class="n">parity</span><span class="p">,</span> <span class="n">breed</span><span class="o">=</span><span class="n">breed</span><span class="p">,</span> <span class="n">continent</span><span class="o">=</span><span class="n">continent</span><span class="p">)</span>
</span><span id="calculate_characteristic-372"><a href="#calculate_characteristic-372"><span class="linenos">372</span></a>                    <span class="k">elif</span> <span class="n">characteristic</span> <span class="o">==</span> <span class="s1">&#39;cumulative_milk_yield&#39;</span><span class="p">:</span>
</span><span id="calculate_characteristic-373"><a href="#calculate_characteristic-373"><span class="linenos">373</span></a>                        <span class="n">value</span> <span class="o">=</span> <span class="n">numeric_cumulative_yield</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fitting</span><span class="o">=</span><span class="n">fitting</span><span class="p">,</span>
</span><span id="calculate_characteristic-374"><a href="#calculate_characteristic-374"><span class="linenos">374</span></a>                                                         <span class="n">lactation_length</span><span class="o">=</span><span class="n">lactation_length</span><span class="p">,</span>
</span><span id="calculate_characteristic-375"><a href="#calculate_characteristic-375"><span class="linenos">375</span></a>                                                         <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">parity</span><span class="o">=</span><span class="n">parity</span><span class="p">,</span> <span class="n">breed</span><span class="o">=</span><span class="n">breed</span><span class="p">,</span> <span class="n">continent</span><span class="o">=</span><span class="n">continent</span><span class="p">)</span>
</span><span id="calculate_characteristic-376"><a href="#calculate_characteristic-376"><span class="linenos">376</span></a>
</span><span id="calculate_characteristic-377"><a href="#calculate_characteristic-377"><span class="linenos">377</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="calculate_characteristic-378"><a href="#calculate_characteristic-378"><span class="linenos">378</span></a>                <span class="k">if</span> <span class="n">persistency_method</span> <span class="o">==</span> <span class="s1">&#39;derived&#39;</span><span class="p">:</span>
</span><span id="calculate_characteristic-379"><a href="#calculate_characteristic-379"><span class="linenos">379</span></a>                    <span class="c1"># find lactation length from data</span>
</span><span id="calculate_characteristic-380"><a href="#calculate_characteristic-380"><span class="linenos">380</span></a>                    <span class="k">if</span> <span class="n">lactation_length</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
</span><span id="calculate_characteristic-381"><a href="#calculate_characteristic-381"><span class="linenos">381</span></a>                        <span class="n">lactation_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
</span><span id="calculate_characteristic-382"><a href="#calculate_characteristic-382"><span class="linenos">382</span></a>                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lactation_length</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="calculate_characteristic-383"><a href="#calculate_characteristic-383"><span class="linenos">383</span></a>                        <span class="n">lactation_length</span> <span class="o">=</span> <span class="n">lactation_length</span>
</span><span id="calculate_characteristic-384"><a href="#calculate_characteristic-384"><span class="linenos">384</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="calculate_characteristic-385"><a href="#calculate_characteristic-385"><span class="linenos">385</span></a>                        <span class="n">lactation_length</span> <span class="o">=</span> <span class="mi">305</span>
</span><span id="calculate_characteristic-386"><a href="#calculate_characteristic-386"><span class="linenos">386</span></a>                    <span class="n">value</span> <span class="o">=</span> <span class="n">persistency_fitted_curve</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fitting</span><span class="o">=</span><span class="s1">&#39;frequentist&#39;</span><span class="p">,</span> <span class="n">lactation_length</span><span class="o">=</span><span class="n">lactation_length</span><span class="p">)</span>
</span><span id="calculate_characteristic-387"><a href="#calculate_characteristic-387"><span class="linenos">387</span></a>
</span><span id="calculate_characteristic-388"><a href="#calculate_characteristic-388"><span class="linenos">388</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="calculate_characteristic-389"><a href="#calculate_characteristic-389"><span class="linenos">389</span></a>                    <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;wood&#39;</span><span class="p">:</span>
</span><span id="calculate_characteristic-390"><a href="#calculate_characteristic-390"><span class="linenos">390</span></a>                        <span class="n">value</span> <span class="o">=</span> <span class="n">persistency_wood</span><span class="p">(</span><span class="n">fitted_params</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">fitted_params</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="calculate_characteristic-391"><a href="#calculate_characteristic-391"><span class="linenos">391</span></a>
</span><span id="calculate_characteristic-392"><a href="#calculate_characteristic-392"><span class="linenos">392</span></a>                    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;milkbot&#39;</span><span class="p">:</span>
</span><span id="calculate_characteristic-393"><a href="#calculate_characteristic-393"><span class="linenos">393</span></a>                        <span class="n">value</span> <span class="o">=</span> <span class="n">persistency_milkbot</span><span class="p">(</span><span class="n">fitted_params</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</span><span id="calculate_characteristic-394"><a href="#calculate_characteristic-394"><span class="linenos">394</span></a>
</span><span id="calculate_characteristic-395"><a href="#calculate_characteristic-395"><span class="linenos">395</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="calculate_characteristic-396"><a href="#calculate_characteristic-396"><span class="linenos">396</span></a>                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="calculate_characteristic-397"><a href="#calculate_characteristic-397"><span class="linenos">397</span></a>                            <span class="s1">&#39;Currently only the Wood model and MilkBot model have a separate model function from the literature integrated for persistency. if persistency=&quot;derived&quot; is selected, persistency can be calculated for every model as the average slope of the lactation after the peak.&#39;</span><span class="p">)</span>
</span><span id="calculate_characteristic-398"><a href="#calculate_characteristic-398"><span class="linenos">398</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="calculate_characteristic-399"><a href="#calculate_characteristic-399"><span class="linenos">399</span></a>                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="calculate_characteristic-400"><a href="#calculate_characteristic-400"><span class="linenos">400</span></a>            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="calculate_characteristic-401"><a href="#calculate_characteristic-401"><span class="linenos">401</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Could not compute characteristic, possibly due to invalid fitted parameters&#39;</span><span class="p">)</span>
</span><span id="calculate_characteristic-402"><a href="#calculate_characteristic-402"><span class="linenos">402</span></a>
</span><span id="calculate_characteristic-403"><a href="#calculate_characteristic-403"><span class="linenos">403</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="calculate_characteristic-404"><a href="#calculate_characteristic-404"><span class="linenos">404</span></a>            <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;milkbot&#39;</span><span class="p">:</span>
</span><span id="calculate_characteristic-405"><a href="#calculate_characteristic-405"><span class="linenos">405</span></a>                <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="calculate_characteristic-406"><a href="#calculate_characteristic-406"><span class="linenos">406</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Key needed to use Bayesian fitting engine MilkBot&#39;</span><span class="p">)</span>
</span><span id="calculate_characteristic-407"><a href="#calculate_characteristic-407"><span class="linenos">407</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="calculate_characteristic-408"><a href="#calculate_characteristic-408"><span class="linenos">408</span></a>                    <span class="n">fitted_params_bayes</span> <span class="o">=</span> <span class="n">bayesian_fit_milkbot_single_lactation</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">parity</span><span class="p">,</span> <span class="n">breed</span><span class="p">,</span> <span class="n">continent</span><span class="p">)</span>
</span><span id="calculate_characteristic-409"><a href="#calculate_characteristic-409"><span class="linenos">409</span></a>                    <span class="n">fitted_params_bayes</span> <span class="o">=</span> <span class="n">fitted_params_bayes</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">],</span> <span class="n">fitted_params_bayes</span><span class="p">[</span><span class="s1">&#39;ramp&#39;</span><span class="p">],</span> <span class="n">fitted_params_bayes</span><span class="p">[</span><span class="s1">&#39;offset&#39;</span><span class="p">],</span> <span class="n">fitted_params_bayes</span><span class="p">[</span><span class="s1">&#39;decay&#39;</span><span class="p">]</span>
</span><span id="calculate_characteristic-410"><a href="#calculate_characteristic-410"><span class="linenos">410</span></a>
</span><span id="calculate_characteristic-411"><a href="#calculate_characteristic-411"><span class="linenos">411</span></a>                    <span class="k">if</span> <span class="n">characteristic</span> <span class="o">!=</span> <span class="s1">&#39;persistency&#39;</span><span class="p">:</span>
</span><span id="calculate_characteristic-412"><a href="#calculate_characteristic-412"><span class="linenos">412</span></a>                        <span class="c1"># Get the symbolic expression and model parameters</span>
</span><span id="calculate_characteristic-413"><a href="#calculate_characteristic-413"><span class="linenos">413</span></a>                        <span class="n">expr</span><span class="p">,</span> <span class="n">param_symbols</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span> <span class="n">lactation_curve_characteristic_function</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">characteristic</span><span class="p">)</span>
</span><span id="calculate_characteristic-414"><a href="#calculate_characteristic-414"><span class="linenos">414</span></a>                        <span class="n">value</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">fitted_params_bayes</span><span class="p">)</span>
</span><span id="calculate_characteristic-415"><a href="#calculate_characteristic-415"><span class="linenos">415</span></a>
</span><span id="calculate_characteristic-416"><a href="#calculate_characteristic-416"><span class="linenos">416</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="calculate_characteristic-417"><a href="#calculate_characteristic-417"><span class="linenos">417</span></a>                        <span class="k">if</span> <span class="n">persistency_method</span> <span class="o">==</span> <span class="s1">&#39;derived&#39;</span><span class="p">:</span>
</span><span id="calculate_characteristic-418"><a href="#calculate_characteristic-418"><span class="linenos">418</span></a>                            <span class="c1"># find lactation length from data</span>
</span><span id="calculate_characteristic-419"><a href="#calculate_characteristic-419"><span class="linenos">419</span></a>                            <span class="k">if</span> <span class="n">lactation_length</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
</span><span id="calculate_characteristic-420"><a href="#calculate_characteristic-420"><span class="linenos">420</span></a>                                <span class="n">lactation_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
</span><span id="calculate_characteristic-421"><a href="#calculate_characteristic-421"><span class="linenos">421</span></a>                            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lactation_length</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="calculate_characteristic-422"><a href="#calculate_characteristic-422"><span class="linenos">422</span></a>                                <span class="n">lactation_length</span> <span class="o">=</span> <span class="n">lactation_length</span>
</span><span id="calculate_characteristic-423"><a href="#calculate_characteristic-423"><span class="linenos">423</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="calculate_characteristic-424"><a href="#calculate_characteristic-424"><span class="linenos">424</span></a>                                <span class="n">lactation_length</span> <span class="o">=</span> <span class="mi">305</span>
</span><span id="calculate_characteristic-425"><a href="#calculate_characteristic-425"><span class="linenos">425</span></a>                            <span class="n">value</span> <span class="o">=</span> <span class="n">persistency_fitted_curve</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fitting</span><span class="o">=</span><span class="s1">&#39;bayesian&#39;</span><span class="p">,</span>
</span><span id="calculate_characteristic-426"><a href="#calculate_characteristic-426"><span class="linenos">426</span></a>                                                             <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">parity</span><span class="o">=</span><span class="n">parity</span><span class="p">,</span> <span class="n">breed</span><span class="o">=</span><span class="n">breed</span><span class="p">,</span> <span class="n">continent</span><span class="o">=</span><span class="n">continent</span><span class="p">,</span>
</span><span id="calculate_characteristic-427"><a href="#calculate_characteristic-427"><span class="linenos">427</span></a>                                                             <span class="n">lactation_length</span><span class="o">=</span><span class="n">lactation_length</span><span class="p">)</span>
</span><span id="calculate_characteristic-428"><a href="#calculate_characteristic-428"><span class="linenos">428</span></a>
</span><span id="calculate_characteristic-429"><a href="#calculate_characteristic-429"><span class="linenos">429</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="calculate_characteristic-430"><a href="#calculate_characteristic-430"><span class="linenos">430</span></a>                            <span class="n">value</span> <span class="o">=</span> <span class="n">persistency_milkbot</span><span class="p">(</span><span class="n">fitted_params_bayes</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</span><span id="calculate_characteristic-431"><a href="#calculate_characteristic-431"><span class="linenos">431</span></a>
</span><span id="calculate_characteristic-432"><a href="#calculate_characteristic-432"><span class="linenos">432</span></a>                    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="calculate_characteristic-433"><a href="#calculate_characteristic-433"><span class="linenos">433</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="calculate_characteristic-434"><a href="#calculate_characteristic-434"><span class="linenos">434</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Bayesian fitting is currently only implemented for MilkBot models&#39;</span><span class="p">)</span>
</span><span id="calculate_characteristic-435"><a href="#calculate_characteristic-435"><span class="linenos">435</span></a>
</span><span id="calculate_characteristic-436"><a href="#calculate_characteristic-436"><span class="linenos">436</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="calculate_characteristic-437"><a href="#calculate_characteristic-437"><span class="linenos">437</span></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unknown characteristic&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Evaluate a lactation curve characteristic from observed test-day data.</p>

<p>This function fits the requested model (frequentist or Bayesian via MilkBot),
retrieves model parameters, and evaluates the requested characteristic using the
symbolic expression (if available), falling back to numeric methods when needed.</p>

<p>Args:
    dim (Int): Days in milk (DIM).
    milkrecordings (Float): Milk recordings (kg or lbs) for each DIM.
    model (str): Model name. Supported for this function:
        'milkbot', 'wood', 'wilmink', 'ali_schaeffer', 'fischer'.
    characteristic (str): One of 'time_to_peak', 'peak_yield', 'cumulative_milk_yield', 'persistency'.
    fitting (str): 'frequentist' (default) or 'bayesian'.
    key (str | None): API key for MilkBot Bayesian fitting.
    parity (Int): Parity of the cow; values above 3 are considered as 3 (Bayesian).
    breed (str): 'H' (Holstein) or 'J' (Jersey) (Bayesian).
    continent (str): 'USA', 'EU', or 'CHEN' (Bayesian).
    persistency_method (str): 'derived' (average slope after peak; default) or 'literature'
        (only for Wood and MilkBot).
    lactation_length (Int | str): Horizon for persistency calculation:
        305 (default), 'max' (use max DIM in data), or an integer.</p>

<p>Returns:
    float: The requested characteristic value.</p>

<p>Raises:
    Exception: If inputs are invalid, the model/characteristic is unsupported,
        an API key is missing for Bayesian fitting, or the characteristic cannot be computed.</p>
</div>


                </section>
                <section id="lactation_curve_characteristic_function">
                            <input id="lactation_curve_characteristic_function-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">lactation_curve_characteristic_function</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">model</span><span class="o">=</span><span class="s1">&#39;wood&#39;</span>, </span><span class="param"><span class="n">characteristic</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">lactation_length</span><span class="o">=</span><span class="mi">305</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="lactation_curve_characteristic_function-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#lactation_curve_characteristic_function"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="lactation_curve_characteristic_function-94"><a href="#lactation_curve_characteristic_function-94"><span class="linenos"> 94</span></a><span class="k">def</span><span class="w"> </span><span class="nf">lactation_curve_characteristic_function</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;wood&#39;</span><span class="p">,</span> <span class="n">characteristic</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lactation_length</span><span class="o">=</span><span class="mi">305</span><span class="p">):</span>
</span><span id="lactation_curve_characteristic_function-95"><a href="#lactation_curve_characteristic_function-95"><span class="linenos"> 95</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Build (or fetch from cache) a symbolic expression and fast numeric function for an LCC.</span>
</span><span id="lactation_curve_characteristic_function-96"><a href="#lactation_curve_characteristic_function-96"><span class="linenos"> 96</span></a>
</span><span id="lactation_curve_characteristic_function-97"><a href="#lactation_curve_characteristic_function-97"><span class="linenos"> 97</span></a><span class="sd">    This function derives the requested **lactation curve characteristic** for a given</span>
</span><span id="lactation_curve_characteristic_function-98"><a href="#lactation_curve_characteristic_function-98"><span class="linenos"> 98</span></a><span class="sd">    model using SymPy (derivative / root finding / integration). It returns the symbolic</span>
</span><span id="lactation_curve_characteristic_function-99"><a href="#lactation_curve_characteristic_function-99"><span class="linenos"> 99</span></a><span class="sd">    expression, the tuple of parameter symbols (argument order), and a lambdified</span>
</span><span id="lactation_curve_characteristic_function-100"><a href="#lactation_curve_characteristic_function-100"><span class="linenos">100</span></a><span class="sd">    numeric function that can be evaluated with numerical parameters.</span>
</span><span id="lactation_curve_characteristic_function-101"><a href="#lactation_curve_characteristic_function-101"><span class="linenos">101</span></a>
</span><span id="lactation_curve_characteristic_function-102"><a href="#lactation_curve_characteristic_function-102"><span class="linenos">102</span></a><span class="sd">    The symbolic derivation and integration are done only once per (model, characteristic)</span>
</span><span id="lactation_curve_characteristic_function-103"><a href="#lactation_curve_characteristic_function-103"><span class="linenos">103</span></a><span class="sd">    and then **cached** for reuse.</span>
</span><span id="lactation_curve_characteristic_function-104"><a href="#lactation_curve_characteristic_function-104"><span class="linenos">104</span></a>
</span><span id="lactation_curve_characteristic_function-105"><a href="#lactation_curve_characteristic_function-105"><span class="linenos">105</span></a><span class="sd">    Args:</span>
</span><span id="lactation_curve_characteristic_function-106"><a href="#lactation_curve_characteristic_function-106"><span class="linenos">106</span></a><span class="sd">        model (str): Model name. Options:</span>
</span><span id="lactation_curve_characteristic_function-107"><a href="#lactation_curve_characteristic_function-107"><span class="linenos">107</span></a><span class="sd">            &#39;milkbot&#39;, &#39;wood&#39;, &#39;wilmink&#39;, &#39;ali_schaeffer&#39;, &#39;fischer&#39;,</span>
</span><span id="lactation_curve_characteristic_function-108"><a href="#lactation_curve_characteristic_function-108"><span class="linenos">108</span></a><span class="sd">            &#39;brody&#39;, &#39;sikka&#39;, &#39;nelder&#39;, &#39;dhanoa&#39;, &#39;emmans&#39;, &#39;hayashi&#39;,</span>
</span><span id="lactation_curve_characteristic_function-109"><a href="#lactation_curve_characteristic_function-109"><span class="linenos">109</span></a><span class="sd">            &#39;rook&#39;, &#39;dijkstra&#39;, &#39;prasad&#39;.</span>
</span><span id="lactation_curve_characteristic_function-110"><a href="#lactation_curve_characteristic_function-110"><span class="linenos">110</span></a><span class="sd">        characteristic (str | None): Desired characteristic. Options:</span>
</span><span id="lactation_curve_characteristic_function-111"><a href="#lactation_curve_characteristic_function-111"><span class="linenos">111</span></a><span class="sd">            &#39;time_to_peak&#39;, &#39;peak_yield&#39;, &#39;cumulative_milk_yield&#39;, &#39;persistency&#39;.</span>
</span><span id="lactation_curve_characteristic_function-112"><a href="#lactation_curve_characteristic_function-112"><span class="linenos">112</span></a><span class="sd">            If `None` or unrecognized, a dict of all available characteristics is returned</span>
</span><span id="lactation_curve_characteristic_function-113"><a href="#lactation_curve_characteristic_function-113"><span class="linenos">113</span></a><span class="sd">            (with `persistency` possibly `None` if derivation is not feasible).</span>
</span><span id="lactation_curve_characteristic_function-114"><a href="#lactation_curve_characteristic_function-114"><span class="linenos">114</span></a><span class="sd">        lactation_length (int): Length of lactation in days used in persistency</span>
</span><span id="lactation_curve_characteristic_function-115"><a href="#lactation_curve_characteristic_function-115"><span class="linenos">115</span></a><span class="sd">            computation (default 305).</span>
</span><span id="lactation_curve_characteristic_function-116"><a href="#lactation_curve_characteristic_function-116"><span class="linenos">116</span></a>
</span><span id="lactation_curve_characteristic_function-117"><a href="#lactation_curve_characteristic_function-117"><span class="linenos">117</span></a><span class="sd">    Returns:</span>
</span><span id="lactation_curve_characteristic_function-118"><a href="#lactation_curve_characteristic_function-118"><span class="linenos">118</span></a><span class="sd">        tuple:</span>
</span><span id="lactation_curve_characteristic_function-119"><a href="#lactation_curve_characteristic_function-119"><span class="linenos">119</span></a><span class="sd">            expr: SymPy expression (or dict of expressions if `characteristic` is None).</span>
</span><span id="lactation_curve_characteristic_function-120"><a href="#lactation_curve_characteristic_function-120"><span class="linenos">120</span></a><span class="sd">            params: Tuple of SymPy symbols for model parameters (argument order).</span>
</span><span id="lactation_curve_characteristic_function-121"><a href="#lactation_curve_characteristic_function-121"><span class="linenos">121</span></a><span class="sd">            func: Lambdified numeric function `f(*params)` (or dict of functions).</span>
</span><span id="lactation_curve_characteristic_function-122"><a href="#lactation_curve_characteristic_function-122"><span class="linenos">122</span></a>
</span><span id="lactation_curve_characteristic_function-123"><a href="#lactation_curve_characteristic_function-123"><span class="linenos">123</span></a><span class="sd">    Raises:</span>
</span><span id="lactation_curve_characteristic_function-124"><a href="#lactation_curve_characteristic_function-124"><span class="linenos">124</span></a><span class="sd">        Exception: If the model is unknown, or if no positive real solution for</span>
</span><span id="lactation_curve_characteristic_function-125"><a href="#lactation_curve_characteristic_function-125"><span class="linenos">125</span></a><span class="sd">            peak timing/yield exists where required.</span>
</span><span id="lactation_curve_characteristic_function-126"><a href="#lactation_curve_characteristic_function-126"><span class="linenos">126</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="lactation_curve_characteristic_function-127"><a href="#lactation_curve_characteristic_function-127"><span class="linenos">127</span></a>    <span class="c1"># check the cache</span>
</span><span id="lactation_curve_characteristic_function-128"><a href="#lactation_curve_characteristic_function-128"><span class="linenos">128</span></a>    <span class="n">storage</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">characteristic</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-129"><a href="#lactation_curve_characteristic_function-129"><span class="linenos">129</span></a>    <span class="k">if</span> <span class="n">storage</span> <span class="ow">in</span> <span class="n">_LCC_CACHE</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-130"><a href="#lactation_curve_characteristic_function-130"><span class="linenos">130</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">_LCC_CACHE</span><span class="p">[</span><span class="n">storage</span><span class="p">][</span><span class="s2">&quot;expr&quot;</span><span class="p">],</span>
</span><span id="lactation_curve_characteristic_function-131"><a href="#lactation_curve_characteristic_function-131"><span class="linenos">131</span></a>                <span class="n">_LCC_CACHE</span><span class="p">[</span><span class="n">storage</span><span class="p">][</span><span class="s2">&quot;params&quot;</span><span class="p">],</span>
</span><span id="lactation_curve_characteristic_function-132"><a href="#lactation_curve_characteristic_function-132"><span class="linenos">132</span></a>                <span class="n">_LCC_CACHE</span><span class="p">[</span><span class="n">storage</span><span class="p">][</span><span class="s2">&quot;func&quot;</span><span class="p">])</span>
</span><span id="lactation_curve_characteristic_function-133"><a href="#lactation_curve_characteristic_function-133"><span class="linenos">133</span></a>
</span><span id="lactation_curve_characteristic_function-134"><a href="#lactation_curve_characteristic_function-134"><span class="linenos">134</span></a>    <span class="c1"># make sure model is all lowercase</span>
</span><span id="lactation_curve_characteristic_function-135"><a href="#lactation_curve_characteristic_function-135"><span class="linenos">135</span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="lactation_curve_characteristic_function-136"><a href="#lactation_curve_characteristic_function-136"><span class="linenos">136</span></a>
</span><span id="lactation_curve_characteristic_function-137"><a href="#lactation_curve_characteristic_function-137"><span class="linenos">137</span></a>    <span class="c1"># define functions</span>
</span><span id="lactation_curve_characteristic_function-138"><a href="#lactation_curve_characteristic_function-138"><span class="linenos">138</span></a>    <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;brody&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-139"><a href="#lactation_curve_characteristic_function-139"><span class="linenos">139</span></a>        <span class="c1"># === BRODY 1 ===</span>
</span><span id="lactation_curve_characteristic_function-140"><a href="#lactation_curve_characteristic_function-140"><span class="linenos">140</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a b k1 k2 t&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-141"><a href="#lactation_curve_characteristic_function-141"><span class="linenos">141</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k2</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-142"><a href="#lactation_curve_characteristic_function-142"><span class="linenos">142</span></a>
</span><span id="lactation_curve_characteristic_function-143"><a href="#lactation_curve_characteristic_function-143"><span class="linenos">143</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;sikka&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-144"><a href="#lactation_curve_characteristic_function-144"><span class="linenos">144</span></a>        <span class="c1"># === SIKKA ===</span>
</span><span id="lactation_curve_characteristic_function-145"><a href="#lactation_curve_characteristic_function-145"><span class="linenos">145</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a b c t&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-146"><a href="#lactation_curve_characteristic_function-146"><span class="linenos">146</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">t</span> <span class="o">-</span> <span class="n">c</span> <span class="o">*</span> <span class="n">t</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-147"><a href="#lactation_curve_characteristic_function-147"><span class="linenos">147</span></a>
</span><span id="lactation_curve_characteristic_function-148"><a href="#lactation_curve_characteristic_function-148"><span class="linenos">148</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;fischer&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-149"><a href="#lactation_curve_characteristic_function-149"><span class="linenos">149</span></a>        <span class="c1"># === FISCHER ===</span>
</span><span id="lactation_curve_characteristic_function-150"><a href="#lactation_curve_characteristic_function-150"><span class="linenos">150</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a b c t&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-151"><a href="#lactation_curve_characteristic_function-151"><span class="linenos">151</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span> <span class="o">*</span> <span class="n">t</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">c</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-152"><a href="#lactation_curve_characteristic_function-152"><span class="linenos">152</span></a>
</span><span id="lactation_curve_characteristic_function-153"><a href="#lactation_curve_characteristic_function-153"><span class="linenos">153</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;nelder&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-154"><a href="#lactation_curve_characteristic_function-154"><span class="linenos">154</span></a>        <span class="c1"># === NELDER ===</span>
</span><span id="lactation_curve_characteristic_function-155"><a href="#lactation_curve_characteristic_function-155"><span class="linenos">155</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a b c t&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-156"><a href="#lactation_curve_characteristic_function-156"><span class="linenos">156</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="n">t</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">t</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-157"><a href="#lactation_curve_characteristic_function-157"><span class="linenos">157</span></a>
</span><span id="lactation_curve_characteristic_function-158"><a href="#lactation_curve_characteristic_function-158"><span class="linenos">158</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;wood&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-159"><a href="#lactation_curve_characteristic_function-159"><span class="linenos">159</span></a>        <span class="c1"># === WOOD ===</span>
</span><span id="lactation_curve_characteristic_function-160"><a href="#lactation_curve_characteristic_function-160"><span class="linenos">160</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a b c t&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-161"><a href="#lactation_curve_characteristic_function-161"><span class="linenos">161</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">t</span> <span class="o">**</span> <span class="n">b</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">c</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-162"><a href="#lactation_curve_characteristic_function-162"><span class="linenos">162</span></a>
</span><span id="lactation_curve_characteristic_function-163"><a href="#lactation_curve_characteristic_function-163"><span class="linenos">163</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;dhanoa&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-164"><a href="#lactation_curve_characteristic_function-164"><span class="linenos">164</span></a>        <span class="c1"># === DHANOA ===</span>
</span><span id="lactation_curve_characteristic_function-165"><a href="#lactation_curve_characteristic_function-165"><span class="linenos">165</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a b c t&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-166"><a href="#lactation_curve_characteristic_function-166"><span class="linenos">166</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">t</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">c</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-167"><a href="#lactation_curve_characteristic_function-167"><span class="linenos">167</span></a>
</span><span id="lactation_curve_characteristic_function-168"><a href="#lactation_curve_characteristic_function-168"><span class="linenos">168</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;emmans&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-169"><a href="#lactation_curve_characteristic_function-169"><span class="linenos">169</span></a>        <span class="c1"># === EMMANS ===</span>
</span><span id="lactation_curve_characteristic_function-170"><a href="#lactation_curve_characteristic_function-170"><span class="linenos">170</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a b c d t&#39;</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-171"><a href="#lactation_curve_characteristic_function-171"><span class="linenos">171</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">exp</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">b</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">c</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-172"><a href="#lactation_curve_characteristic_function-172"><span class="linenos">172</span></a>
</span><span id="lactation_curve_characteristic_function-173"><a href="#lactation_curve_characteristic_function-173"><span class="linenos">173</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;ali_schaeffer&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-174"><a href="#lactation_curve_characteristic_function-174"><span class="linenos">174</span></a>        <span class="c1"># ====ALI=====</span>
</span><span id="lactation_curve_characteristic_function-175"><a href="#lactation_curve_characteristic_function-175"><span class="linenos">175</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a b c d k t&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-176"><a href="#lactation_curve_characteristic_function-176"><span class="linenos">176</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="lactation_curve_characteristic_function-177"><a href="#lactation_curve_characteristic_function-177"><span class="linenos">177</span></a>            <span class="n">a</span>
</span><span id="lactation_curve_characteristic_function-178"><a href="#lactation_curve_characteristic_function-178"><span class="linenos">178</span></a>            <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">/</span> <span class="mi">340</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-179"><a href="#lactation_curve_characteristic_function-179"><span class="linenos">179</span></a>            <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">/</span> <span class="mi">340</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="lactation_curve_characteristic_function-180"><a href="#lactation_curve_characteristic_function-180"><span class="linenos">180</span></a>            <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">t</span> <span class="o">/</span> <span class="mi">340</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-181"><a href="#lactation_curve_characteristic_function-181"><span class="linenos">181</span></a>            <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">log</span><span class="p">((</span><span class="mi">340</span> <span class="o">/</span> <span class="n">t</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-182"><a href="#lactation_curve_characteristic_function-182"><span class="linenos">182</span></a>        <span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-183"><a href="#lactation_curve_characteristic_function-183"><span class="linenos">183</span></a>
</span><span id="lactation_curve_characteristic_function-184"><a href="#lactation_curve_characteristic_function-184"><span class="linenos">184</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;wilmink&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-185"><a href="#lactation_curve_characteristic_function-185"><span class="linenos">185</span></a>        <span class="c1"># === WILMINK ===</span>
</span><span id="lactation_curve_characteristic_function-186"><a href="#lactation_curve_characteristic_function-186"><span class="linenos">186</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a b c k t&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-187"><a href="#lactation_curve_characteristic_function-187"><span class="linenos">187</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-188"><a href="#lactation_curve_characteristic_function-188"><span class="linenos">188</span></a>
</span><span id="lactation_curve_characteristic_function-189"><a href="#lactation_curve_characteristic_function-189"><span class="linenos">189</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;hayashi&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-190"><a href="#lactation_curve_characteristic_function-190"><span class="linenos">190</span></a>        <span class="c1"># === HAYASHI ===</span>
</span><span id="lactation_curve_characteristic_function-191"><a href="#lactation_curve_characteristic_function-191"><span class="linenos">191</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a b c d t&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-192"><a href="#lactation_curve_characteristic_function-192"><span class="linenos">192</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span> <span class="o">/</span> <span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">c</span><span class="p">)))</span>
</span><span id="lactation_curve_characteristic_function-193"><a href="#lactation_curve_characteristic_function-193"><span class="linenos">193</span></a>
</span><span id="lactation_curve_characteristic_function-194"><a href="#lactation_curve_characteristic_function-194"><span class="linenos">194</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;rook&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-195"><a href="#lactation_curve_characteristic_function-195"><span class="linenos">195</span></a>        <span class="c1"># === ROOK ===</span>
</span><span id="lactation_curve_characteristic_function-196"><a href="#lactation_curve_characteristic_function-196"><span class="linenos">196</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a b c d t&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-197"><a href="#lactation_curve_characteristic_function-197"><span class="linenos">197</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">b</span> <span class="o">/</span> <span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="n">t</span><span class="p">)))</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">d</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-198"><a href="#lactation_curve_characteristic_function-198"><span class="linenos">198</span></a>
</span><span id="lactation_curve_characteristic_function-199"><a href="#lactation_curve_characteristic_function-199"><span class="linenos">199</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;dijkstra&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-200"><a href="#lactation_curve_characteristic_function-200"><span class="linenos">200</span></a>        <span class="c1"># === DIJKSTRA ===</span>
</span><span id="lactation_curve_characteristic_function-201"><a href="#lactation_curve_characteristic_function-201"><span class="linenos">201</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a b c d t&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-202"><a href="#lactation_curve_characteristic_function-202"><span class="linenos">202</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">exp</span><span class="p">((</span><span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">c</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span> <span class="o">/</span> <span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="n">d</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-203"><a href="#lactation_curve_characteristic_function-203"><span class="linenos">203</span></a>
</span><span id="lactation_curve_characteristic_function-204"><a href="#lactation_curve_characteristic_function-204"><span class="linenos">204</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;prasad&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-205"><a href="#lactation_curve_characteristic_function-205"><span class="linenos">205</span></a>        <span class="c1"># === PRASAD ===</span>
</span><span id="lactation_curve_characteristic_function-206"><a href="#lactation_curve_characteristic_function-206"><span class="linenos">206</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a b c d t&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-207"><a href="#lactation_curve_characteristic_function-207"><span class="linenos">207</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">t</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">d</span> <span class="o">/</span> <span class="n">t</span>
</span><span id="lactation_curve_characteristic_function-208"><a href="#lactation_curve_characteristic_function-208"><span class="linenos">208</span></a>
</span><span id="lactation_curve_characteristic_function-209"><a href="#lactation_curve_characteristic_function-209"><span class="linenos">209</span></a>    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;milkbot&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-210"><a href="#lactation_curve_characteristic_function-210"><span class="linenos">210</span></a>        <span class="c1"># === MILKBOT ===</span>
</span><span id="lactation_curve_characteristic_function-211"><a href="#lactation_curve_characteristic_function-211"><span class="linenos">211</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a b c d t&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-212"><a href="#lactation_curve_characteristic_function-212"><span class="linenos">212</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">exp</span><span class="p">((</span><span class="n">c</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">d</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-213"><a href="#lactation_curve_characteristic_function-213"><span class="linenos">213</span></a>
</span><span id="lactation_curve_characteristic_function-214"><a href="#lactation_curve_characteristic_function-214"><span class="linenos">214</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-215"><a href="#lactation_curve_characteristic_function-215"><span class="linenos">215</span></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unknown model&quot;</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-216"><a href="#lactation_curve_characteristic_function-216"><span class="linenos">216</span></a>
</span><span id="lactation_curve_characteristic_function-217"><a href="#lactation_curve_characteristic_function-217"><span class="linenos">217</span></a>    <span class="c1"># find derivative</span>
</span><span id="lactation_curve_characteristic_function-218"><a href="#lactation_curve_characteristic_function-218"><span class="linenos">218</span></a>    <span class="n">fdiff</span> <span class="o">=</span> <span class="n">diff</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-219"><a href="#lactation_curve_characteristic_function-219"><span class="linenos">219</span></a>    <span class="c1"># solve derivative for when it is zero to find the function for time of peak</span>
</span><span id="lactation_curve_characteristic_function-220"><a href="#lactation_curve_characteristic_function-220"><span class="linenos">220</span></a>    <span class="n">tpeak</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">fdiff</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-221"><a href="#lactation_curve_characteristic_function-221"><span class="linenos">221</span></a>
</span><span id="lactation_curve_characteristic_function-222"><a href="#lactation_curve_characteristic_function-222"><span class="linenos">222</span></a>    <span class="c1"># define the end of lactation</span>
</span><span id="lactation_curve_characteristic_function-223"><a href="#lactation_curve_characteristic_function-223"><span class="linenos">223</span></a>    <span class="n">T</span> <span class="o">=</span> <span class="n">lactation_length</span>  <span class="c1"># days in milk</span>
</span><span id="lactation_curve_characteristic_function-224"><a href="#lactation_curve_characteristic_function-224"><span class="linenos">224</span></a>
</span><span id="lactation_curve_characteristic_function-225"><a href="#lactation_curve_characteristic_function-225"><span class="linenos">225</span></a>    <span class="c1"># Persistency = average slope after peak, does not work for all models so therefore try except</span>
</span><span id="lactation_curve_characteristic_function-226"><a href="#lactation_curve_characteristic_function-226"><span class="linenos">226</span></a>    <span class="n">persistency</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="lactation_curve_characteristic_function-227"><a href="#lactation_curve_characteristic_function-227"><span class="linenos">227</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-228"><a href="#lactation_curve_characteristic_function-228"><span class="linenos">228</span></a>        <span class="k">if</span> <span class="n">tpeak</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-229"><a href="#lactation_curve_characteristic_function-229"><span class="linenos">229</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span> <span class="o">-</span> <span class="n">function</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">tpeak</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">/</span> <span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="n">tpeak</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="lactation_curve_characteristic_function-230"><a href="#lactation_curve_characteristic_function-230"><span class="linenos">230</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>  <span class="c1"># light simplification</span>
</span><span id="lactation_curve_characteristic_function-231"><a href="#lactation_curve_characteristic_function-231"><span class="linenos">231</span></a>            <span class="k">if</span> <span class="n">is_valid_sympy_expr</span><span class="p">(</span><span class="n">tmp</span><span class="p">):</span>
</span><span id="lactation_curve_characteristic_function-232"><a href="#lactation_curve_characteristic_function-232"><span class="linenos">232</span></a>                <span class="n">persistency</span> <span class="o">=</span> <span class="n">tmp</span>
</span><span id="lactation_curve_characteristic_function-233"><a href="#lactation_curve_characteristic_function-233"><span class="linenos">233</span></a>    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-234"><a href="#lactation_curve_characteristic_function-234"><span class="linenos">234</span></a>        <span class="n">persistency</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="lactation_curve_characteristic_function-235"><a href="#lactation_curve_characteristic_function-235"><span class="linenos">235</span></a>
</span><span id="lactation_curve_characteristic_function-236"><a href="#lactation_curve_characteristic_function-236"><span class="linenos">236</span></a>    <span class="k">if</span> <span class="n">characteristic</span> <span class="o">!=</span> <span class="s1">&#39;cumulative_milk_yield&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-237"><a href="#lactation_curve_characteristic_function-237"><span class="linenos">237</span></a>        <span class="k">if</span> <span class="n">tpeak</span><span class="p">:</span>  <span class="c1"># Check if the list is not empty</span>
</span><span id="lactation_curve_characteristic_function-238"><a href="#lactation_curve_characteristic_function-238"><span class="linenos">238</span></a>            <span class="n">peak_expr</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">tpeak</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="lactation_curve_characteristic_function-239"><a href="#lactation_curve_characteristic_function-239"><span class="linenos">239</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-240"><a href="#lactation_curve_characteristic_function-240"><span class="linenos">240</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;No positive real solution for time to peak and peak yield found&#39;</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-241"><a href="#lactation_curve_characteristic_function-241"><span class="linenos">241</span></a>
</span><span id="lactation_curve_characteristic_function-242"><a href="#lactation_curve_characteristic_function-242"><span class="linenos">242</span></a>    <span class="c1"># find function for cumulative milk yield over the first 305 days of the lactation</span>
</span><span id="lactation_curve_characteristic_function-243"><a href="#lactation_curve_characteristic_function-243"><span class="linenos">243</span></a>    <span class="n">cum_my_expr</span> <span class="o">=</span> <span class="n">integrate</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">305</span><span class="p">))</span>
</span><span id="lactation_curve_characteristic_function-244"><a href="#lactation_curve_characteristic_function-244"><span class="linenos">244</span></a>
</span><span id="lactation_curve_characteristic_function-245"><a href="#lactation_curve_characteristic_function-245"><span class="linenos">245</span></a>    <span class="c1"># Sorted parameter list (exclude t)</span>
</span><span id="lactation_curve_characteristic_function-246"><a href="#lactation_curve_characteristic_function-246"><span class="linenos">246</span></a>    <span class="n">params</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">([</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">function</span><span class="o">.</span><span class="n">free_symbols</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;t&quot;</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</span><span id="lactation_curve_characteristic_function-247"><a href="#lactation_curve_characteristic_function-247"><span class="linenos">247</span></a>
</span><span id="lactation_curve_characteristic_function-248"><a href="#lactation_curve_characteristic_function-248"><span class="linenos">248</span></a>    <span class="c1"># ----------------------------------------------------</span>
</span><span id="lactation_curve_characteristic_function-249"><a href="#lactation_curve_characteristic_function-249"><span class="linenos">249</span></a>    <span class="c1"># Select requested characteristic</span>
</span><span id="lactation_curve_characteristic_function-250"><a href="#lactation_curve_characteristic_function-250"><span class="linenos">250</span></a>    <span class="c1"># ----------------------------------------------------</span>
</span><span id="lactation_curve_characteristic_function-251"><a href="#lactation_curve_characteristic_function-251"><span class="linenos">251</span></a>    <span class="k">if</span> <span class="n">characteristic</span> <span class="o">==</span> <span class="s2">&quot;time_to_peak&quot;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-252"><a href="#lactation_curve_characteristic_function-252"><span class="linenos">252</span></a>        <span class="n">expr</span> <span class="o">=</span> <span class="n">tpeak</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="lactation_curve_characteristic_function-253"><a href="#lactation_curve_characteristic_function-253"><span class="linenos">253</span></a>    <span class="k">elif</span> <span class="n">characteristic</span> <span class="o">==</span> <span class="s2">&quot;peak_yield&quot;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-254"><a href="#lactation_curve_characteristic_function-254"><span class="linenos">254</span></a>        <span class="n">expr</span> <span class="o">=</span> <span class="n">peak_expr</span>
</span><span id="lactation_curve_characteristic_function-255"><a href="#lactation_curve_characteristic_function-255"><span class="linenos">255</span></a>    <span class="k">elif</span> <span class="n">characteristic</span> <span class="o">==</span> <span class="s2">&quot;cumulative_milk_yield&quot;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-256"><a href="#lactation_curve_characteristic_function-256"><span class="linenos">256</span></a>        <span class="n">expr</span> <span class="o">=</span> <span class="n">cum_my_expr</span>
</span><span id="lactation_curve_characteristic_function-257"><a href="#lactation_curve_characteristic_function-257"><span class="linenos">257</span></a>    <span class="k">elif</span> <span class="n">characteristic</span> <span class="o">==</span> <span class="s1">&#39;persistency&#39;</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-258"><a href="#lactation_curve_characteristic_function-258"><span class="linenos">258</span></a>        <span class="k">if</span> <span class="n">persistency</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-259"><a href="#lactation_curve_characteristic_function-259"><span class="linenos">259</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Persistency could not be computed symbolically&quot;</span><span class="p">)</span>
</span><span id="lactation_curve_characteristic_function-260"><a href="#lactation_curve_characteristic_function-260"><span class="linenos">260</span></a>        <span class="n">expr</span> <span class="o">=</span> <span class="n">persistency</span>
</span><span id="lactation_curve_characteristic_function-261"><a href="#lactation_curve_characteristic_function-261"><span class="linenos">261</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-262"><a href="#lactation_curve_characteristic_function-262"><span class="linenos">262</span></a>        <span class="c1"># Return all four if None or &#39;all&#39;</span>
</span><span id="lactation_curve_characteristic_function-263"><a href="#lactation_curve_characteristic_function-263"><span class="linenos">263</span></a>        <span class="n">expr</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="lactation_curve_characteristic_function-264"><a href="#lactation_curve_characteristic_function-264"><span class="linenos">264</span></a>            <span class="s2">&quot;time_to_peak&quot;</span><span class="p">:</span> <span class="n">tpeak</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="lactation_curve_characteristic_function-265"><a href="#lactation_curve_characteristic_function-265"><span class="linenos">265</span></a>            <span class="s2">&quot;peak_yield&quot;</span><span class="p">:</span> <span class="n">peak_expr</span><span class="p">,</span>
</span><span id="lactation_curve_characteristic_function-266"><a href="#lactation_curve_characteristic_function-266"><span class="linenos">266</span></a>            <span class="s2">&quot;persistency&quot;</span><span class="p">:</span> <span class="n">persistency</span><span class="p">,</span>  <span class="c1"># possibly None</span>
</span><span id="lactation_curve_characteristic_function-267"><a href="#lactation_curve_characteristic_function-267"><span class="linenos">267</span></a>            <span class="s2">&quot;cumulative_milk_yield&quot;</span><span class="p">:</span> <span class="n">cum_my_expr</span><span class="p">,</span>
</span><span id="lactation_curve_characteristic_function-268"><a href="#lactation_curve_characteristic_function-268"><span class="linenos">268</span></a>        <span class="p">}</span>
</span><span id="lactation_curve_characteristic_function-269"><a href="#lactation_curve_characteristic_function-269"><span class="linenos">269</span></a>
</span><span id="lactation_curve_characteristic_function-270"><a href="#lactation_curve_characteristic_function-270"><span class="linenos">270</span></a>    <span class="c1"># ----------------------------------------------------</span>
</span><span id="lactation_curve_characteristic_function-271"><a href="#lactation_curve_characteristic_function-271"><span class="linenos">271</span></a>    <span class="c1"># Build fast numeric function with lambdify</span>
</span><span id="lactation_curve_characteristic_function-272"><a href="#lactation_curve_characteristic_function-272"><span class="linenos">272</span></a>    <span class="c1"># ----------------------------------------------------</span>
</span><span id="lactation_curve_characteristic_function-273"><a href="#lactation_curve_characteristic_function-273"><span class="linenos">273</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="lactation_curve_characteristic_function-274"><a href="#lactation_curve_characteristic_function-274"><span class="linenos">274</span></a>        <span class="n">func</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">lambdify</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">ex</span><span class="p">,</span> <span class="n">modules</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;numpy&quot;</span><span class="p">,</span> <span class="s1">&#39;scipy&#39;</span><span class="p">])</span>
</span><span id="lactation_curve_characteristic_function-275"><a href="#lactation_curve_characteristic_function-275"><span class="linenos">275</span></a>                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">ex</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="lactation_curve_characteristic_function-276"><a href="#lactation_curve_characteristic_function-276"><span class="linenos">276</span></a>                <span class="k">if</span> <span class="n">ex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
</span><span id="lactation_curve_characteristic_function-277"><a href="#lactation_curve_characteristic_function-277"><span class="linenos">277</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="lactation_curve_characteristic_function-278"><a href="#lactation_curve_characteristic_function-278"><span class="linenos">278</span></a>        <span class="n">func</span> <span class="o">=</span> <span class="n">lambdify</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">modules</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;numpy&quot;</span><span class="p">,</span> <span class="s1">&#39;scipy&#39;</span><span class="p">])</span>
</span><span id="lactation_curve_characteristic_function-279"><a href="#lactation_curve_characteristic_function-279"><span class="linenos">279</span></a>
</span><span id="lactation_curve_characteristic_function-280"><a href="#lactation_curve_characteristic_function-280"><span class="linenos">280</span></a>    <span class="c1"># ----------------------------------------------------</span>
</span><span id="lactation_curve_characteristic_function-281"><a href="#lactation_curve_characteristic_function-281"><span class="linenos">281</span></a>    <span class="c1"># Store in cache</span>
</span><span id="lactation_curve_characteristic_function-282"><a href="#lactation_curve_characteristic_function-282"><span class="linenos">282</span></a>    <span class="c1"># ----------------------------------------------------</span>
</span><span id="lactation_curve_characteristic_function-283"><a href="#lactation_curve_characteristic_function-283"><span class="linenos">283</span></a>    <span class="n">_LCC_CACHE</span><span class="p">[</span><span class="n">storage</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="lactation_curve_characteristic_function-284"><a href="#lactation_curve_characteristic_function-284"><span class="linenos">284</span></a>        <span class="s2">&quot;expr&quot;</span><span class="p">:</span> <span class="n">expr</span><span class="p">,</span>
</span><span id="lactation_curve_characteristic_function-285"><a href="#lactation_curve_characteristic_function-285"><span class="linenos">285</span></a>        <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">,</span>
</span><span id="lactation_curve_characteristic_function-286"><a href="#lactation_curve_characteristic_function-286"><span class="linenos">286</span></a>        <span class="s2">&quot;func&quot;</span><span class="p">:</span> <span class="n">func</span>
</span><span id="lactation_curve_characteristic_function-287"><a href="#lactation_curve_characteristic_function-287"><span class="linenos">287</span></a>    <span class="p">}</span>
</span><span id="lactation_curve_characteristic_function-288"><a href="#lactation_curve_characteristic_function-288"><span class="linenos">288</span></a>
</span><span id="lactation_curve_characteristic_function-289"><a href="#lactation_curve_characteristic_function-289"><span class="linenos">289</span></a>    <span class="k">return</span> <span class="n">expr</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">func</span>
</span></pre></div>


            <div class="docstring"><p>Build (or fetch from cache) a symbolic expression and fast numeric function for an LCC.</p>

<p>This function derives the requested <strong>lactation curve characteristic</strong> for a given
model using SymPy (derivative / root finding / integration). It returns the symbolic
expression, the tuple of parameter symbols (argument order), and a lambdified
numeric function that can be evaluated with numerical parameters.</p>

<p>The symbolic derivation and integration are done only once per (model, characteristic)
and then <strong>cached</strong> for reuse.</p>

<p>Args:
    model (str): Model name. Options:
        'milkbot', 'wood', 'wilmink', 'ali_schaeffer', 'fischer',
        'brody', 'sikka', 'nelder', 'dhanoa', 'emmans', 'hayashi',
        'rook', 'dijkstra', 'prasad'.
    characteristic (str | None): Desired characteristic. Options:
        'time_to_peak', 'peak_yield', 'cumulative_milk_yield', 'persistency'.
        If <code>None</code> or unrecognized, a dict of all available characteristics is returned
        (with <code>persistency</code> possibly <code>None</code> if derivation is not feasible).
    lactation_length (int): Length of lactation in days used in persistency
        computation (default 305).</p>

<p>Returns:
    tuple:
        expr: SymPy expression (or dict of expressions if <code>characteristic</code> is None).
        params: Tuple of SymPy symbols for model parameters (argument order).
        func: Lambdified numeric function <code>f(*params)</code> (or dict of functions).</p>

<p>Raises:
    Exception: If the model is unknown, or if no positive real solution for
        peak timing/yield exists where required.</p>
</div>


                </section>
                <section id="numeric_cumulative_yield">
                            <input id="numeric_cumulative_yield-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">numeric_cumulative_yield</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dim</span>,</span><span class="param">	<span class="n">milkrecordings</span>,</span><span class="param">	<span class="n">model</span>,</span><span class="param">	<span class="n">fitting</span><span class="o">=</span><span class="s1">&#39;frequentist&#39;</span>,</span><span class="param">	<span class="n">lactation_length</span><span class="o">=</span><span class="mi">305</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="numeric_cumulative_yield-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#numeric_cumulative_yield"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="numeric_cumulative_yield-469"><a href="#numeric_cumulative_yield-469"><span class="linenos">469</span></a><span class="k">def</span><span class="w"> </span><span class="nf">numeric_cumulative_yield</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fitting</span><span class="o">=</span><span class="s1">&#39;frequentist&#39;</span><span class="p">,</span> <span class="n">lactation_length</span><span class="o">=</span><span class="mi">305</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="numeric_cumulative_yield-470"><a href="#numeric_cumulative_yield-470"><span class="linenos">470</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute cumulative milk yield numerically over a given horizon.</span>
</span><span id="numeric_cumulative_yield-471"><a href="#numeric_cumulative_yield-471"><span class="linenos">471</span></a>
</span><span id="numeric_cumulative_yield-472"><a href="#numeric_cumulative_yield-472"><span class="linenos">472</span></a><span class="sd">    Adds up the fitted milk yield for the first `lactation_length` days of the</span>
</span><span id="numeric_cumulative_yield-473"><a href="#numeric_cumulative_yield-473"><span class="linenos">473</span></a><span class="sd">    predicted yield curve.</span>
</span><span id="numeric_cumulative_yield-474"><a href="#numeric_cumulative_yield-474"><span class="linenos">474</span></a>
</span><span id="numeric_cumulative_yield-475"><a href="#numeric_cumulative_yield-475"><span class="linenos">475</span></a><span class="sd">    Args:</span>
</span><span id="numeric_cumulative_yield-476"><a href="#numeric_cumulative_yield-476"><span class="linenos">476</span></a><span class="sd">        dim: DIM values.</span>
</span><span id="numeric_cumulative_yield-477"><a href="#numeric_cumulative_yield-477"><span class="linenos">477</span></a><span class="sd">        milkrecordings: Milk recordings (kg).</span>
</span><span id="numeric_cumulative_yield-478"><a href="#numeric_cumulative_yield-478"><span class="linenos">478</span></a><span class="sd">        model: Model name.</span>
</span><span id="numeric_cumulative_yield-479"><a href="#numeric_cumulative_yield-479"><span class="linenos">479</span></a><span class="sd">        fitting: &#39;frequentist&#39; or &#39;bayesian&#39;.</span>
</span><span id="numeric_cumulative_yield-480"><a href="#numeric_cumulative_yield-480"><span class="linenos">480</span></a><span class="sd">        lactation_length: Number of days to integrate (default 305).</span>
</span><span id="numeric_cumulative_yield-481"><a href="#numeric_cumulative_yield-481"><span class="linenos">481</span></a><span class="sd">        **kwargs: Additional arguments forwarded to `fit_lactation_curve`.</span>
</span><span id="numeric_cumulative_yield-482"><a href="#numeric_cumulative_yield-482"><span class="linenos">482</span></a>
</span><span id="numeric_cumulative_yield-483"><a href="#numeric_cumulative_yield-483"><span class="linenos">483</span></a><span class="sd">    Returns:</span>
</span><span id="numeric_cumulative_yield-484"><a href="#numeric_cumulative_yield-484"><span class="linenos">484</span></a><span class="sd">        float: Cumulative milk yield over the specified horizon.</span>
</span><span id="numeric_cumulative_yield-485"><a href="#numeric_cumulative_yield-485"><span class="linenos">485</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="numeric_cumulative_yield-486"><a href="#numeric_cumulative_yield-486"><span class="linenos">486</span></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">fit_lactation_curve</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fitting</span><span class="o">=</span><span class="n">fitting</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="numeric_cumulative_yield-487"><a href="#numeric_cumulative_yield-487"><span class="linenos">487</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">trapezoid</span><span class="p">(</span><span class="n">y</span><span class="p">[:</span><span class="n">lactation_length</span><span class="p">],</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Compute cumulative milk yield numerically over a given horizon.</p>

<p>Adds up the fitted milk yield for the first <code>lactation_length</code> days of the
predicted yield curve.</p>

<p>Args:
    dim: DIM values.
    milkrecordings: Milk recordings (kg).
    model: Model name.
    fitting: 'frequentist' or 'bayesian'.
    lactation_length: Number of days to integrate (default 305).
    **kwargs: Additional arguments forwarded to <code><a href="#fit_lactation_curve">fit_lactation_curve</a></code>.</p>

<p>Returns:
    float: Cumulative milk yield over the specified horizon.</p>
</div>


                </section>
                <section id="numeric_peak_yield">
                            <input id="numeric_peak_yield-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">numeric_peak_yield</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dim</span>,</span><span class="param">	<span class="n">milkrecordings</span>,</span><span class="param">	<span class="n">model</span>,</span><span class="param">	<span class="n">fitting</span><span class="o">=</span><span class="s1">&#39;frequentist&#39;</span>,</span><span class="param">	<span class="n">key</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">parity</span><span class="o">=</span><span class="mi">3</span>,</span><span class="param">	<span class="n">breed</span><span class="o">=</span><span class="s1">&#39;H&#39;</span>,</span><span class="param">	<span class="n">continent</span><span class="o">=</span><span class="s1">&#39;USA&#39;</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="numeric_peak_yield-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#numeric_peak_yield"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="numeric_peak_yield-490"><a href="#numeric_peak_yield-490"><span class="linenos">490</span></a><span class="k">def</span><span class="w"> </span><span class="nf">numeric_peak_yield</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fitting</span><span class="o">=</span><span class="s1">&#39;frequentist&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parity</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="numeric_peak_yield-491"><a href="#numeric_peak_yield-491"><span class="linenos">491</span></a>                       <span class="n">breed</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">continent</span><span class="o">=</span><span class="s1">&#39;USA&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="numeric_peak_yield-492"><a href="#numeric_peak_yield-492"><span class="linenos">492</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute peak yield numerically from the fitted curve.</span>
</span><span id="numeric_peak_yield-493"><a href="#numeric_peak_yield-493"><span class="linenos">493</span></a>
</span><span id="numeric_peak_yield-494"><a href="#numeric_peak_yield-494"><span class="linenos">494</span></a><span class="sd">    Args:</span>
</span><span id="numeric_peak_yield-495"><a href="#numeric_peak_yield-495"><span class="linenos">495</span></a><span class="sd">        dim: DIM values.</span>
</span><span id="numeric_peak_yield-496"><a href="#numeric_peak_yield-496"><span class="linenos">496</span></a><span class="sd">        milkrecordings: Milk recordings (kg).</span>
</span><span id="numeric_peak_yield-497"><a href="#numeric_peak_yield-497"><span class="linenos">497</span></a><span class="sd">        model: Model name.</span>
</span><span id="numeric_peak_yield-498"><a href="#numeric_peak_yield-498"><span class="linenos">498</span></a><span class="sd">        fitting: &#39;frequentist&#39; or &#39;bayesian&#39;.</span>
</span><span id="numeric_peak_yield-499"><a href="#numeric_peak_yield-499"><span class="linenos">499</span></a><span class="sd">        key: API key for MilkBot (Bayesian).</span>
</span><span id="numeric_peak_yield-500"><a href="#numeric_peak_yield-500"><span class="linenos">500</span></a><span class="sd">        parity: Parity for Bayesian fitting.</span>
</span><span id="numeric_peak_yield-501"><a href="#numeric_peak_yield-501"><span class="linenos">501</span></a><span class="sd">        breed: Breed for Bayesian fitting (&#39;H&#39; or &#39;J&#39;).</span>
</span><span id="numeric_peak_yield-502"><a href="#numeric_peak_yield-502"><span class="linenos">502</span></a><span class="sd">        continent: Prior source for Bayesian (&#39;USA&#39;, &#39;EU&#39;, &#39;CHEN&#39;).</span>
</span><span id="numeric_peak_yield-503"><a href="#numeric_peak_yield-503"><span class="linenos">503</span></a>
</span><span id="numeric_peak_yield-504"><a href="#numeric_peak_yield-504"><span class="linenos">504</span></a><span class="sd">    Returns:</span>
</span><span id="numeric_peak_yield-505"><a href="#numeric_peak_yield-505"><span class="linenos">505</span></a><span class="sd">        float: Maximum predicted milk yield.</span>
</span><span id="numeric_peak_yield-506"><a href="#numeric_peak_yield-506"><span class="linenos">506</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="numeric_peak_yield-507"><a href="#numeric_peak_yield-507"><span class="linenos">507</span></a>    <span class="c1"># Fit the curve to get predicted milk yields</span>
</span><span id="numeric_peak_yield-508"><a href="#numeric_peak_yield-508"><span class="linenos">508</span></a>    <span class="n">yields</span> <span class="o">=</span> <span class="n">fit_lactation_curve</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fitting</span><span class="o">=</span><span class="n">fitting</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">parity</span><span class="o">=</span><span class="n">parity</span><span class="p">,</span> <span class="n">breed</span><span class="o">=</span><span class="n">breed</span><span class="p">,</span> <span class="n">continent</span><span class="o">=</span><span class="n">continent</span><span class="p">)</span>
</span><span id="numeric_peak_yield-509"><a href="#numeric_peak_yield-509"><span class="linenos">509</span></a>    <span class="c1"># Find the peak yield</span>
</span><span id="numeric_peak_yield-510"><a href="#numeric_peak_yield-510"><span class="linenos">510</span></a>    <span class="n">peak_yield</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">yields</span><span class="p">)</span>
</span><span id="numeric_peak_yield-511"><a href="#numeric_peak_yield-511"><span class="linenos">511</span></a>    <span class="k">return</span> <span class="n">peak_yield</span>
</span></pre></div>


            <div class="docstring"><p>Compute peak yield numerically from the fitted curve.</p>

<p>Args:
    dim: DIM values.
    milkrecordings: Milk recordings (kg).
    model: Model name.
    fitting: 'frequentist' or 'bayesian'.
    key: API key for MilkBot (Bayesian).
    parity: Parity for Bayesian fitting.
    breed: Breed for Bayesian fitting ('H' or 'J').
    continent: Prior source for Bayesian ('USA', 'EU', 'CHEN').</p>

<p>Returns:
    float: Maximum predicted milk yield.</p>
</div>


                </section>
                <section id="numeric_time_to_peak">
                            <input id="numeric_time_to_peak-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">numeric_time_to_peak</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dim</span>,</span><span class="param">	<span class="n">milkrecordings</span>,</span><span class="param">	<span class="n">model</span>,</span><span class="param">	<span class="n">fitting</span><span class="o">=</span><span class="s1">&#39;frequentist&#39;</span>,</span><span class="param">	<span class="n">key</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">parity</span><span class="o">=</span><span class="mi">3</span>,</span><span class="param">	<span class="n">breed</span><span class="o">=</span><span class="s1">&#39;H&#39;</span>,</span><span class="param">	<span class="n">continent</span><span class="o">=</span><span class="s1">&#39;USA&#39;</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="numeric_time_to_peak-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#numeric_time_to_peak"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="numeric_time_to_peak-441"><a href="#numeric_time_to_peak-441"><span class="linenos">441</span></a><span class="k">def</span><span class="w"> </span><span class="nf">numeric_time_to_peak</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fitting</span><span class="o">=</span><span class="s1">&#39;frequentist&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parity</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="numeric_time_to_peak-442"><a href="#numeric_time_to_peak-442"><span class="linenos">442</span></a>                         <span class="n">breed</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">continent</span><span class="o">=</span><span class="s1">&#39;USA&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="numeric_time_to_peak-443"><a href="#numeric_time_to_peak-443"><span class="linenos">443</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute time to peak using a numeric approach.</span>
</span><span id="numeric_time_to_peak-444"><a href="#numeric_time_to_peak-444"><span class="linenos">444</span></a>
</span><span id="numeric_time_to_peak-445"><a href="#numeric_time_to_peak-445"><span class="linenos">445</span></a><span class="sd">    Fits the curve (frequentist or Bayesian), evaluates the predicted yields,</span>
</span><span id="numeric_time_to_peak-446"><a href="#numeric_time_to_peak-446"><span class="linenos">446</span></a><span class="sd">    and returns the DIM corresponding to the maximum predicted yield.</span>
</span><span id="numeric_time_to_peak-447"><a href="#numeric_time_to_peak-447"><span class="linenos">447</span></a>
</span><span id="numeric_time_to_peak-448"><a href="#numeric_time_to_peak-448"><span class="linenos">448</span></a><span class="sd">    Args:</span>
</span><span id="numeric_time_to_peak-449"><a href="#numeric_time_to_peak-449"><span class="linenos">449</span></a><span class="sd">        dim: DIM values.</span>
</span><span id="numeric_time_to_peak-450"><a href="#numeric_time_to_peak-450"><span class="linenos">450</span></a><span class="sd">        milkrecordings: Milk recordings (kg).</span>
</span><span id="numeric_time_to_peak-451"><a href="#numeric_time_to_peak-451"><span class="linenos">451</span></a><span class="sd">        model: Model name.</span>
</span><span id="numeric_time_to_peak-452"><a href="#numeric_time_to_peak-452"><span class="linenos">452</span></a><span class="sd">        fitting: &#39;frequentist&#39; or &#39;bayesian&#39;.</span>
</span><span id="numeric_time_to_peak-453"><a href="#numeric_time_to_peak-453"><span class="linenos">453</span></a><span class="sd">        key: API key for MilkBot (Bayesian).</span>
</span><span id="numeric_time_to_peak-454"><a href="#numeric_time_to_peak-454"><span class="linenos">454</span></a><span class="sd">        parity: Parity for Bayesian fitting.</span>
</span><span id="numeric_time_to_peak-455"><a href="#numeric_time_to_peak-455"><span class="linenos">455</span></a><span class="sd">        breed: Breed for Bayesian fitting (&#39;H&#39; or &#39;J&#39;).</span>
</span><span id="numeric_time_to_peak-456"><a href="#numeric_time_to_peak-456"><span class="linenos">456</span></a><span class="sd">        continent: Prior source for Bayesian (&#39;USA&#39;, &#39;EU&#39;, &#39;CHEN&#39;).</span>
</span><span id="numeric_time_to_peak-457"><a href="#numeric_time_to_peak-457"><span class="linenos">457</span></a>
</span><span id="numeric_time_to_peak-458"><a href="#numeric_time_to_peak-458"><span class="linenos">458</span></a><span class="sd">    Returns:</span>
</span><span id="numeric_time_to_peak-459"><a href="#numeric_time_to_peak-459"><span class="linenos">459</span></a><span class="sd">        int: DIM at which the curve attains its maximum (1-indexed).</span>
</span><span id="numeric_time_to_peak-460"><a href="#numeric_time_to_peak-460"><span class="linenos">460</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="numeric_time_to_peak-461"><a href="#numeric_time_to_peak-461"><span class="linenos">461</span></a>    <span class="c1"># Fit the curve to get predicted milk yields</span>
</span><span id="numeric_time_to_peak-462"><a href="#numeric_time_to_peak-462"><span class="linenos">462</span></a>    <span class="n">yields</span> <span class="o">=</span> <span class="n">fit_lactation_curve</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fitting</span><span class="o">=</span><span class="n">fitting</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">parity</span><span class="o">=</span><span class="n">parity</span><span class="p">,</span> <span class="n">breed</span><span class="o">=</span><span class="n">breed</span><span class="p">,</span> <span class="n">continent</span><span class="o">=</span><span class="n">continent</span><span class="p">)</span>
</span><span id="numeric_time_to_peak-463"><a href="#numeric_time_to_peak-463"><span class="linenos">463</span></a>    <span class="c1"># Find the index of the peak yield</span>
</span><span id="numeric_time_to_peak-464"><a href="#numeric_time_to_peak-464"><span class="linenos">464</span></a>    <span class="n">peak_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">yields</span><span class="p">)</span>
</span><span id="numeric_time_to_peak-465"><a href="#numeric_time_to_peak-465"><span class="linenos">465</span></a>    <span class="c1"># Return the corresponding DIM</span>
</span><span id="numeric_time_to_peak-466"><a href="#numeric_time_to_peak-466"><span class="linenos">466</span></a>    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">peak_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># +1 because DIM starts at 1, not 0</span>
</span></pre></div>


            <div class="docstring"><p>Compute time to peak using a numeric approach.</p>

<p>Fits the curve (frequentist or Bayesian), evaluates the predicted yields,
and returns the DIM corresponding to the maximum predicted yield.</p>

<p>Args:
    dim: DIM values.
    milkrecordings: Milk recordings (kg).
    model: Model name.
    fitting: 'frequentist' or 'bayesian'.
    key: API key for MilkBot (Bayesian).
    parity: Parity for Bayesian fitting.
    breed: Breed for Bayesian fitting ('H' or 'J').
    continent: Prior source for Bayesian ('USA', 'EU', 'CHEN').</p>

<p>Returns:
    int: DIM at which the curve attains its maximum (1-indexed).</p>
</div>


                </section>
                <section id="persistency_fitted_curve">
                            <input id="persistency_fitted_curve-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">persistency_fitted_curve</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dim</span>,</span><span class="param">	<span class="n">milkrecordings</span>,</span><span class="param">	<span class="n">model</span>,</span><span class="param">	<span class="n">fitting</span><span class="o">=</span><span class="s1">&#39;frequentist&#39;</span>,</span><span class="param">	<span class="n">key</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">parity</span><span class="o">=</span><span class="mi">3</span>,</span><span class="param">	<span class="n">breed</span><span class="o">=</span><span class="s1">&#39;H&#39;</span>,</span><span class="param">	<span class="n">continent</span><span class="o">=</span><span class="s1">&#39;USA&#39;</span>,</span><span class="param">	<span class="n">lactation_length</span><span class="o">=</span><span class="mi">305</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="persistency_fitted_curve-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#persistency_fitted_curve"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="persistency_fitted_curve-539"><a href="#persistency_fitted_curve-539"><span class="linenos">539</span></a><span class="k">def</span><span class="w"> </span><span class="nf">persistency_fitted_curve</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fitting</span><span class="o">=</span><span class="s1">&#39;frequentist&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parity</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="persistency_fitted_curve-540"><a href="#persistency_fitted_curve-540"><span class="linenos">540</span></a>                             <span class="n">breed</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">continent</span><span class="o">=</span><span class="s1">&#39;USA&#39;</span><span class="p">,</span> <span class="n">lactation_length</span><span class="o">=</span><span class="mi">305</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="persistency_fitted_curve-541"><a href="#persistency_fitted_curve-541"><span class="linenos">541</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Persistency as the average slope after peak until end of lactation (numeric).</span>
</span><span id="persistency_fitted_curve-542"><a href="#persistency_fitted_curve-542"><span class="linenos">542</span></a>
</span><span id="persistency_fitted_curve-543"><a href="#persistency_fitted_curve-543"><span class="linenos">543</span></a><span class="sd">    This is the default approach because symbolic derivation is not feasible for</span>
</span><span id="persistency_fitted_curve-544"><a href="#persistency_fitted_curve-544"><span class="linenos">544</span></a><span class="sd">    all models. It computes:</span>
</span><span id="persistency_fitted_curve-545"><a href="#persistency_fitted_curve-545"><span class="linenos">545</span></a><span class="sd">        `(yield_at_end - yield_at_peak) / (lactation_length - time_to_peak)`</span>
</span><span id="persistency_fitted_curve-546"><a href="#persistency_fitted_curve-546"><span class="linenos">546</span></a>
</span><span id="persistency_fitted_curve-547"><a href="#persistency_fitted_curve-547"><span class="linenos">547</span></a><span class="sd">    Args:</span>
</span><span id="persistency_fitted_curve-548"><a href="#persistency_fitted_curve-548"><span class="linenos">548</span></a><span class="sd">        dim: DIM values.</span>
</span><span id="persistency_fitted_curve-549"><a href="#persistency_fitted_curve-549"><span class="linenos">549</span></a><span class="sd">        milkrecordings: Milk recordings (kg).</span>
</span><span id="persistency_fitted_curve-550"><a href="#persistency_fitted_curve-550"><span class="linenos">550</span></a><span class="sd">        model: Model name. Options include &#39;milkbot&#39; (Bayesian or frequentist),</span>
</span><span id="persistency_fitted_curve-551"><a href="#persistency_fitted_curve-551"><span class="linenos">551</span></a><span class="sd">            &#39;wood&#39;, &#39;wilmink&#39;, &#39;ali_schaeffer&#39;, &#39;fischer&#39;.</span>
</span><span id="persistency_fitted_curve-552"><a href="#persistency_fitted_curve-552"><span class="linenos">552</span></a><span class="sd">        fitting: &#39;frequentist&#39; or &#39;bayesian&#39;.</span>
</span><span id="persistency_fitted_curve-553"><a href="#persistency_fitted_curve-553"><span class="linenos">553</span></a><span class="sd">        key: API key (only for Bayesian fitting).</span>
</span><span id="persistency_fitted_curve-554"><a href="#persistency_fitted_curve-554"><span class="linenos">554</span></a><span class="sd">        parity: Parity of the cow; values above 3 treated as 3 (Bayesian).</span>
</span><span id="persistency_fitted_curve-555"><a href="#persistency_fitted_curve-555"><span class="linenos">555</span></a><span class="sd">        breed: &#39;H&#39; or &#39;J&#39; (Bayesian).</span>
</span><span id="persistency_fitted_curve-556"><a href="#persistency_fitted_curve-556"><span class="linenos">556</span></a><span class="sd">        continent: &#39;USA&#39;, &#39;EU&#39;, or &#39;CHEN&#39; (Bayesian).</span>
</span><span id="persistency_fitted_curve-557"><a href="#persistency_fitted_curve-557"><span class="linenos">557</span></a><span class="sd">        lactation_length (int | str): 305 (default), &#39;max&#39; (use max DIM), or integer.</span>
</span><span id="persistency_fitted_curve-558"><a href="#persistency_fitted_curve-558"><span class="linenos">558</span></a>
</span><span id="persistency_fitted_curve-559"><a href="#persistency_fitted_curve-559"><span class="linenos">559</span></a><span class="sd">    Returns:</span>
</span><span id="persistency_fitted_curve-560"><a href="#persistency_fitted_curve-560"><span class="linenos">560</span></a><span class="sd">        float: Average slope after the peak until end of lactation.</span>
</span><span id="persistency_fitted_curve-561"><a href="#persistency_fitted_curve-561"><span class="linenos">561</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="persistency_fitted_curve-562"><a href="#persistency_fitted_curve-562"><span class="linenos">562</span></a>    <span class="c1"># calculate time to peak</span>
</span><span id="persistency_fitted_curve-563"><a href="#persistency_fitted_curve-563"><span class="linenos">563</span></a>    <span class="n">t_peak</span> <span class="o">=</span> <span class="n">numeric_time_to_peak</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fitting</span><span class="o">=</span><span class="n">fitting</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">parity</span><span class="o">=</span><span class="n">parity</span><span class="p">,</span> <span class="n">breed</span><span class="o">=</span><span class="n">breed</span><span class="p">,</span> <span class="n">continent</span><span class="o">=</span><span class="n">continent</span><span class="p">)</span>
</span><span id="persistency_fitted_curve-564"><a href="#persistency_fitted_curve-564"><span class="linenos">564</span></a>
</span><span id="persistency_fitted_curve-565"><a href="#persistency_fitted_curve-565"><span class="linenos">565</span></a>    <span class="c1"># determine lactation length</span>
</span><span id="persistency_fitted_curve-566"><a href="#persistency_fitted_curve-566"><span class="linenos">566</span></a>    <span class="k">if</span> <span class="n">lactation_length</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
</span><span id="persistency_fitted_curve-567"><a href="#persistency_fitted_curve-567"><span class="linenos">567</span></a>        <span class="n">lactation_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
</span><span id="persistency_fitted_curve-568"><a href="#persistency_fitted_curve-568"><span class="linenos">568</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lactation_length</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="persistency_fitted_curve-569"><a href="#persistency_fitted_curve-569"><span class="linenos">569</span></a>        <span class="n">lactation_length</span> <span class="o">=</span> <span class="n">lactation_length</span>
</span><span id="persistency_fitted_curve-570"><a href="#persistency_fitted_curve-570"><span class="linenos">570</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="persistency_fitted_curve-571"><a href="#persistency_fitted_curve-571"><span class="linenos">571</span></a>        <span class="n">lactation_length</span> <span class="o">=</span> <span class="mi">305</span>
</span><span id="persistency_fitted_curve-572"><a href="#persistency_fitted_curve-572"><span class="linenos">572</span></a>
</span><span id="persistency_fitted_curve-573"><a href="#persistency_fitted_curve-573"><span class="linenos">573</span></a>    <span class="c1"># calculate milk yield at peak</span>
</span><span id="persistency_fitted_curve-574"><a href="#persistency_fitted_curve-574"><span class="linenos">574</span></a>    <span class="n">yields</span> <span class="o">=</span> <span class="n">fit_lactation_curve</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">milkrecordings</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fitting</span><span class="o">=</span><span class="n">fitting</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">parity</span><span class="o">=</span><span class="n">parity</span><span class="p">,</span> <span class="n">breed</span><span class="o">=</span><span class="n">breed</span><span class="p">,</span> <span class="n">continent</span><span class="o">=</span><span class="n">continent</span><span class="p">)</span>
</span><span id="persistency_fitted_curve-575"><a href="#persistency_fitted_curve-575"><span class="linenos">575</span></a>    <span class="n">peak_yield</span> <span class="o">=</span> <span class="n">yields</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">t_peak</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># -1 to prevent index error</span>
</span><span id="persistency_fitted_curve-576"><a href="#persistency_fitted_curve-576"><span class="linenos">576</span></a>    <span class="c1"># calculate milk yield at end of lactation</span>
</span><span id="persistency_fitted_curve-577"><a href="#persistency_fitted_curve-577"><span class="linenos">577</span></a>    <span class="n">end_yield</span> <span class="o">=</span> <span class="n">yields</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">lactation_length</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># -1 to prevent index error</span>
</span><span id="persistency_fitted_curve-578"><a href="#persistency_fitted_curve-578"><span class="linenos">578</span></a>
</span><span id="persistency_fitted_curve-579"><a href="#persistency_fitted_curve-579"><span class="linenos">579</span></a>    <span class="c1"># calculate persistency</span>
</span><span id="persistency_fitted_curve-580"><a href="#persistency_fitted_curve-580"><span class="linenos">580</span></a>    <span class="n">persistency</span> <span class="o">=</span> <span class="p">(</span><span class="n">end_yield</span> <span class="o">-</span> <span class="n">peak_yield</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">lactation_length</span> <span class="o">-</span> <span class="n">t_peak</span><span class="p">)</span>
</span><span id="persistency_fitted_curve-581"><a href="#persistency_fitted_curve-581"><span class="linenos">581</span></a>    <span class="k">return</span> <span class="n">persistency</span>
</span></pre></div>


            <div class="docstring"><p>Persistency as the average slope after peak until end of lactation (numeric).</p>

<p>This is the default approach because symbolic derivation is not feasible for
all models. It computes:
    <code>(yield_at_end - yield_at_peak) / (lactation_length - time_to_peak)</code></p>

<p>Args:
    dim: DIM values.
    milkrecordings: Milk recordings (kg).
    model: Model name. Options include 'milkbot' (Bayesian or frequentist),
        'wood', 'wilmink', 'ali_schaeffer', 'fischer'.
    fitting: 'frequentist' or 'bayesian'.
    key: API key (only for Bayesian fitting).
    parity: Parity of the cow; values above 3 treated as 3 (Bayesian).
    breed: 'H' or 'J' (Bayesian).
    continent: 'USA', 'EU', or 'CHEN' (Bayesian).
    lactation_length (int | str): 305 (default), 'max' (use max DIM), or integer.</p>

<p>Returns:
    float: Average slope after the peak until end of lactation.</p>
</div>


                </section>
                <section id="persistency_milkbot">
                            <input id="persistency_milkbot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">persistency_milkbot</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">d</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="persistency_milkbot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#persistency_milkbot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="persistency_milkbot-527"><a href="#persistency_milkbot-527"><span class="linenos">527</span></a><span class="k">def</span><span class="w"> </span><span class="nf">persistency_milkbot</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="persistency_milkbot-528"><a href="#persistency_milkbot-528"><span class="linenos">528</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Persistency from the MilkBot model (Ehrlich, 2013): `Persistency = 0.693 / d`.</span>
</span><span id="persistency_milkbot-529"><a href="#persistency_milkbot-529"><span class="linenos">529</span></a>
</span><span id="persistency_milkbot-530"><a href="#persistency_milkbot-530"><span class="linenos">530</span></a><span class="sd">    Args:</span>
</span><span id="persistency_milkbot-531"><a href="#persistency_milkbot-531"><span class="linenos">531</span></a><span class="sd">        d (float): Parameter `d` of the MilkBot model.</span>
</span><span id="persistency_milkbot-532"><a href="#persistency_milkbot-532"><span class="linenos">532</span></a>
</span><span id="persistency_milkbot-533"><a href="#persistency_milkbot-533"><span class="linenos">533</span></a><span class="sd">    Returns:</span>
</span><span id="persistency_milkbot-534"><a href="#persistency_milkbot-534"><span class="linenos">534</span></a><span class="sd">        float: Persistency value from the MilkBot formula.</span>
</span><span id="persistency_milkbot-535"><a href="#persistency_milkbot-535"><span class="linenos">535</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="persistency_milkbot-536"><a href="#persistency_milkbot-536"><span class="linenos">536</span></a>    <span class="k">return</span> <span class="mf">0.693</span> <span class="o">/</span> <span class="n">d</span>
</span></pre></div>


            <div class="docstring"><p>Persistency from the MilkBot model (Ehrlich, 2013): <code>Persistency = 0.693 / d</code>.</p>

<p>Args:
    d (float): Parameter <code>d</code> of the MilkBot model.</p>

<p>Returns:
    float: Persistency value from the MilkBot formula.</p>
</div>


                </section>
                <section id="persistency_wood">
                            <input id="persistency_wood-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">persistency_wood</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">b</span>, </span><span class="param"><span class="n">c</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="persistency_wood-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#persistency_wood"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="persistency_wood-514"><a href="#persistency_wood-514"><span class="linenos">514</span></a><span class="k">def</span><span class="w"> </span><span class="nf">persistency_wood</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="persistency_wood-515"><a href="#persistency_wood-515"><span class="linenos">515</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Persistency from Wood et al. (1984): `Persistency = -(b + 1) * ln(c)`.</span>
</span><span id="persistency_wood-516"><a href="#persistency_wood-516"><span class="linenos">516</span></a>
</span><span id="persistency_wood-517"><a href="#persistency_wood-517"><span class="linenos">517</span></a><span class="sd">    Args:</span>
</span><span id="persistency_wood-518"><a href="#persistency_wood-518"><span class="linenos">518</span></a><span class="sd">        b (float): Parameter `b` of the Wood model.</span>
</span><span id="persistency_wood-519"><a href="#persistency_wood-519"><span class="linenos">519</span></a><span class="sd">        c (float): Parameter `c` of the Wood model.</span>
</span><span id="persistency_wood-520"><a href="#persistency_wood-520"><span class="linenos">520</span></a>
</span><span id="persistency_wood-521"><a href="#persistency_wood-521"><span class="linenos">521</span></a><span class="sd">    Returns:</span>
</span><span id="persistency_wood-522"><a href="#persistency_wood-522"><span class="linenos">522</span></a><span class="sd">        float: Persistency value from the Wood formula.</span>
</span><span id="persistency_wood-523"><a href="#persistency_wood-523"><span class="linenos">523</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="persistency_wood-524"><a href="#persistency_wood-524"><span class="linenos">524</span></a>    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">ln</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Persistency from Wood et al. (1984): <code>Persistency = -(b + 1) * ln(c)</code>.</p>

<p>Args:
    b (float): Parameter <code>b</code> of the Wood model.
    c (float): Parameter <code>c</code> of the Wood model.</p>

<p>Returns:
    float: Persistency value from the Wood formula.</p>
</div>


                </section>
                <section id="test_interval_method">
                            <input id="test_interval_method-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">test_interval_method</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">df</span>,</span><span class="param">	<span class="n">days_in_milk_col</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">milking_yield_col</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">test_id_col</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">default_test_id</span><span class="o">=</span><span class="mi">1</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="test_interval_method-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#test_interval_method"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="test_interval_method-39"><a href="#test_interval_method-39"><span class="linenos"> 39</span></a><span class="k">def</span><span class="w"> </span><span class="nf">test_interval_method</span><span class="p">(</span>
</span><span id="test_interval_method-40"><a href="#test_interval_method-40"><span class="linenos"> 40</span></a>    <span class="n">df</span><span class="p">,</span> <span class="n">days_in_milk_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">milking_yield_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">test_id_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default_test_id</span><span class="o">=</span><span class="mi">1</span>
</span><span id="test_interval_method-41"><a href="#test_interval_method-41"><span class="linenos"> 41</span></a><span class="p">):</span>
</span><span id="test_interval_method-42"><a href="#test_interval_method-42"><span class="linenos"> 42</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute 305-day total milk yield using the ICAR Test Interval Method.</span>
</span><span id="test_interval_method-43"><a href="#test_interval_method-43"><span class="linenos"> 43</span></a>
</span><span id="test_interval_method-44"><a href="#test_interval_method-44"><span class="linenos"> 44</span></a><span class="sd">    The method applies:</span>
</span><span id="test_interval_method-45"><a href="#test_interval_method-45"><span class="linenos"> 45</span></a><span class="sd">    - Linear projection from calving to the first test day,</span>
</span><span id="test_interval_method-46"><a href="#test_interval_method-46"><span class="linenos"> 46</span></a><span class="sd">    - Trapezoidal integration between consecutive test days,</span>
</span><span id="test_interval_method-47"><a href="#test_interval_method-47"><span class="linenos"> 47</span></a><span class="sd">    - Linear projection from the last test day to DIM=305.</span>
</span><span id="test_interval_method-48"><a href="#test_interval_method-48"><span class="linenos"> 48</span></a>
</span><span id="test_interval_method-49"><a href="#test_interval_method-49"><span class="linenos"> 49</span></a><span class="sd">    Args:</span>
</span><span id="test_interval_method-50"><a href="#test_interval_method-50"><span class="linenos"> 50</span></a><span class="sd">        df (pd.DataFrame): Input DataFrame with at least DaysInMilk, MilkingYield,</span>
</span><span id="test_interval_method-51"><a href="#test_interval_method-51"><span class="linenos"> 51</span></a><span class="sd">            and (optionally) TestId columns (names can be provided via arguments</span>
</span><span id="test_interval_method-52"><a href="#test_interval_method-52"><span class="linenos"> 52</span></a><span class="sd">            or matched via known aliases, case-insensitive).</span>
</span><span id="test_interval_method-53"><a href="#test_interval_method-53"><span class="linenos"> 53</span></a><span class="sd">        days_in_milk_col (str | None): Optional column name override for DaysInMilk.</span>
</span><span id="test_interval_method-54"><a href="#test_interval_method-54"><span class="linenos"> 54</span></a><span class="sd">        milking_yield_col (str | None): Optional column name override for MilkingYield.</span>
</span><span id="test_interval_method-55"><a href="#test_interval_method-55"><span class="linenos"> 55</span></a><span class="sd">        test_id_col (str | None): Optional column name override for TestId.</span>
</span><span id="test_interval_method-56"><a href="#test_interval_method-56"><span class="linenos"> 56</span></a><span class="sd">        default_test_id (Any): If TestId is missing, a new `TestId` column is created</span>
</span><span id="test_interval_method-57"><a href="#test_interval_method-57"><span class="linenos"> 57</span></a><span class="sd">            with this value.</span>
</span><span id="test_interval_method-58"><a href="#test_interval_method-58"><span class="linenos"> 58</span></a>
</span><span id="test_interval_method-59"><a href="#test_interval_method-59"><span class="linenos"> 59</span></a><span class="sd">    Returns:</span>
</span><span id="test_interval_method-60"><a href="#test_interval_method-60"><span class="linenos"> 60</span></a><span class="sd">        pd.DataFrame: Two-column DataFrame with</span>
</span><span id="test_interval_method-61"><a href="#test_interval_method-61"><span class="linenos"> 61</span></a><span class="sd">            - &quot;TestId&quot;: identifier per lactation,</span>
</span><span id="test_interval_method-62"><a href="#test_interval_method-62"><span class="linenos"> 62</span></a><span class="sd">            - &quot;Total305Yield&quot;: computed total milk yield over 305 days.</span>
</span><span id="test_interval_method-63"><a href="#test_interval_method-63"><span class="linenos"> 63</span></a>
</span><span id="test_interval_method-64"><a href="#test_interval_method-64"><span class="linenos"> 64</span></a><span class="sd">    Raises:</span>
</span><span id="test_interval_method-65"><a href="#test_interval_method-65"><span class="linenos"> 65</span></a><span class="sd">        ValueError: If required columns (DaysInMilk or MilkingYield) cannot be found.</span>
</span><span id="test_interval_method-66"><a href="#test_interval_method-66"><span class="linenos"> 66</span></a>
</span><span id="test_interval_method-67"><a href="#test_interval_method-67"><span class="linenos"> 67</span></a><span class="sd">    Notes:</span>
</span><span id="test_interval_method-68"><a href="#test_interval_method-68"><span class="linenos"> 68</span></a><span class="sd">        - Records with DIM &gt; 305 are dropped before computation.</span>
</span><span id="test_interval_method-69"><a href="#test_interval_method-69"><span class="linenos"> 69</span></a><span class="sd">        - At least two data points per TestId are required for trapezoidal integration;</span>
</span><span id="test_interval_method-70"><a href="#test_interval_method-70"><span class="linenos"> 70</span></a><span class="sd">          otherwise the lactation is skipped.</span>
</span><span id="test_interval_method-71"><a href="#test_interval_method-71"><span class="linenos"> 71</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="test_interval_method-72"><a href="#test_interval_method-72"><span class="linenos"> 72</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="test_interval_method-73"><a href="#test_interval_method-73"><span class="linenos"> 73</span></a>
</span><span id="test_interval_method-74"><a href="#test_interval_method-74"><span class="linenos"> 74</span></a>    <span class="c1"># create a bit more flexibility in naming the columns and when only one lactation is put in without a testid</span>
</span><span id="test_interval_method-75"><a href="#test_interval_method-75"><span class="linenos"> 75</span></a>
</span><span id="test_interval_method-76"><a href="#test_interval_method-76"><span class="linenos"> 76</span></a>    <span class="c1"># Define accepted variations for each logical column</span>
</span><span id="test_interval_method-77"><a href="#test_interval_method-77"><span class="linenos"> 77</span></a>    <span class="c1"># Accepted aliases (case-insensitive)</span>
</span><span id="test_interval_method-78"><a href="#test_interval_method-78"><span class="linenos"> 78</span></a>    <span class="n">aliases</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="test_interval_method-79"><a href="#test_interval_method-79"><span class="linenos"> 79</span></a>        <span class="s2">&quot;DaysInMilk&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;daysinmilk&quot;</span><span class="p">,</span> <span class="s2">&quot;dim&quot;</span><span class="p">,</span> <span class="s2">&quot;testday&quot;</span><span class="p">],</span>
</span><span id="test_interval_method-80"><a href="#test_interval_method-80"><span class="linenos"> 80</span></a>        <span class="s2">&quot;MilkingYield&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;milkingyield&quot;</span><span class="p">,</span> <span class="s2">&quot;testdaymilkyield&quot;</span><span class="p">,</span> <span class="s2">&quot;milkyield&quot;</span><span class="p">,</span> <span class="s2">&quot;yield&quot;</span><span class="p">],</span>
</span><span id="test_interval_method-81"><a href="#test_interval_method-81"><span class="linenos"> 81</span></a>        <span class="s2">&quot;TestId&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;animalid&quot;</span><span class="p">,</span> <span class="s2">&quot;testid&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">],</span>
</span><span id="test_interval_method-82"><a href="#test_interval_method-82"><span class="linenos"> 82</span></a>    <span class="p">}</span>
</span><span id="test_interval_method-83"><a href="#test_interval_method-83"><span class="linenos"> 83</span></a>
</span><span id="test_interval_method-84"><a href="#test_interval_method-84"><span class="linenos"> 84</span></a>    <span class="c1"># Create a mapping from lowercase to actual column names</span>
</span><span id="test_interval_method-85"><a href="#test_interval_method-85"><span class="linenos"> 85</span></a>    <span class="n">col_lookup</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">}</span>
</span><span id="test_interval_method-86"><a href="#test_interval_method-86"><span class="linenos"> 86</span></a>
</span><span id="test_interval_method-87"><a href="#test_interval_method-87"><span class="linenos"> 87</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_col_name</span><span class="p">(</span><span class="n">override</span><span class="p">,</span> <span class="n">possible_names</span><span class="p">):</span>
</span><span id="test_interval_method-88"><a href="#test_interval_method-88"><span class="linenos"> 88</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a matching actual column name from `df`, or `None` if not found.</span>
</span><span id="test_interval_method-89"><a href="#test_interval_method-89"><span class="linenos"> 89</span></a>
</span><span id="test_interval_method-90"><a href="#test_interval_method-90"><span class="linenos"> 90</span></a><span class="sd">        Args:</span>
</span><span id="test_interval_method-91"><a href="#test_interval_method-91"><span class="linenos"> 91</span></a><span class="sd">            override (str | None): Explicit column name provided by the user.</span>
</span><span id="test_interval_method-92"><a href="#test_interval_method-92"><span class="linenos"> 92</span></a><span class="sd">            possible_names (list[str]): List of acceptable aliases (lowercase).</span>
</span><span id="test_interval_method-93"><a href="#test_interval_method-93"><span class="linenos"> 93</span></a>
</span><span id="test_interval_method-94"><a href="#test_interval_method-94"><span class="linenos"> 94</span></a><span class="sd">        Returns:</span>
</span><span id="test_interval_method-95"><a href="#test_interval_method-95"><span class="linenos"> 95</span></a><span class="sd">            str | None: The actual column name present in `df`, or `None` if no match.</span>
</span><span id="test_interval_method-96"><a href="#test_interval_method-96"><span class="linenos"> 96</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="test_interval_method-97"><a href="#test_interval_method-97"><span class="linenos"> 97</span></a>        <span class="k">if</span> <span class="n">override</span><span class="p">:</span>
</span><span id="test_interval_method-98"><a href="#test_interval_method-98"><span class="linenos"> 98</span></a>            <span class="k">return</span> <span class="n">col_lookup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">override</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="test_interval_method-99"><a href="#test_interval_method-99"><span class="linenos"> 99</span></a>        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">possible_names</span><span class="p">:</span>
</span><span id="test_interval_method-100"><a href="#test_interval_method-100"><span class="linenos">100</span></a>            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">col_lookup</span><span class="p">:</span>
</span><span id="test_interval_method-101"><a href="#test_interval_method-101"><span class="linenos">101</span></a>                <span class="k">return</span> <span class="n">col_lookup</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</span><span id="test_interval_method-102"><a href="#test_interval_method-102"><span class="linenos">102</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="test_interval_method-103"><a href="#test_interval_method-103"><span class="linenos">103</span></a>
</span><span id="test_interval_method-104"><a href="#test_interval_method-104"><span class="linenos">104</span></a>    <span class="c1"># Resolve columns</span>
</span><span id="test_interval_method-105"><a href="#test_interval_method-105"><span class="linenos">105</span></a>    <span class="n">dim_col</span> <span class="o">=</span> <span class="n">get_col_name</span><span class="p">(</span><span class="n">days_in_milk_col</span><span class="p">,</span> <span class="n">aliases</span><span class="p">[</span><span class="s2">&quot;DaysInMilk&quot;</span><span class="p">])</span>
</span><span id="test_interval_method-106"><a href="#test_interval_method-106"><span class="linenos">106</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">dim_col</span><span class="p">:</span>
</span><span id="test_interval_method-107"><a href="#test_interval_method-107"><span class="linenos">107</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No DaysInMilk column found in DataFrame.&quot;</span><span class="p">)</span>
</span><span id="test_interval_method-108"><a href="#test_interval_method-108"><span class="linenos">108</span></a>
</span><span id="test_interval_method-109"><a href="#test_interval_method-109"><span class="linenos">109</span></a>    <span class="n">my_col</span> <span class="o">=</span> <span class="n">get_col_name</span><span class="p">(</span><span class="n">milking_yield_col</span><span class="p">,</span> <span class="n">aliases</span><span class="p">[</span><span class="s2">&quot;MilkingYield&quot;</span><span class="p">])</span>
</span><span id="test_interval_method-110"><a href="#test_interval_method-110"><span class="linenos">110</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">my_col</span><span class="p">:</span>
</span><span id="test_interval_method-111"><a href="#test_interval_method-111"><span class="linenos">111</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No MilkingYield column found in DataFrame.&quot;</span><span class="p">)</span>
</span><span id="test_interval_method-112"><a href="#test_interval_method-112"><span class="linenos">112</span></a>
</span><span id="test_interval_method-113"><a href="#test_interval_method-113"><span class="linenos">113</span></a>    <span class="n">id_col</span> <span class="o">=</span> <span class="n">get_col_name</span><span class="p">(</span><span class="n">test_id_col</span><span class="p">,</span> <span class="n">aliases</span><span class="p">[</span><span class="s2">&quot;TestId&quot;</span><span class="p">])</span>
</span><span id="test_interval_method-114"><a href="#test_interval_method-114"><span class="linenos">114</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">id_col</span><span class="p">:</span>
</span><span id="test_interval_method-115"><a href="#test_interval_method-115"><span class="linenos">115</span></a>        <span class="n">id_col</span> <span class="o">=</span> <span class="s2">&quot;TestId&quot;</span>
</span><span id="test_interval_method-116"><a href="#test_interval_method-116"><span class="linenos">116</span></a>        <span class="n">df</span><span class="p">[</span><span class="n">id_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_test_id</span>
</span><span id="test_interval_method-117"><a href="#test_interval_method-117"><span class="linenos">117</span></a>
</span><span id="test_interval_method-118"><a href="#test_interval_method-118"><span class="linenos">118</span></a>    <span class="c1"># Filter out records where Day &gt; 305</span>
</span><span id="test_interval_method-119"><a href="#test_interval_method-119"><span class="linenos">119</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">dim_col</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">305</span><span class="p">]</span>
</span><span id="test_interval_method-120"><a href="#test_interval_method-120"><span class="linenos">120</span></a>
</span><span id="test_interval_method-121"><a href="#test_interval_method-121"><span class="linenos">121</span></a>    <span class="c1"># Iterate over each lactation</span>
</span><span id="test_interval_method-122"><a href="#test_interval_method-122"><span class="linenos">122</span></a>    <span class="k">for</span> <span class="n">lactation</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">id_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="test_interval_method-123"><a href="#test_interval_method-123"><span class="linenos">123</span></a>        <span class="n">lactation_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">id_col</span><span class="p">]</span> <span class="o">==</span> <span class="n">lactation</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="test_interval_method-124"><a href="#test_interval_method-124"><span class="linenos">124</span></a>
</span><span id="test_interval_method-125"><a href="#test_interval_method-125"><span class="linenos">125</span></a>        <span class="c1"># Sort by DaysInMilk ascending</span>
</span><span id="test_interval_method-126"><a href="#test_interval_method-126"><span class="linenos">126</span></a>        <span class="n">lactation_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">dim_col</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="test_interval_method-127"><a href="#test_interval_method-127"><span class="linenos">127</span></a>
</span><span id="test_interval_method-128"><a href="#test_interval_method-128"><span class="linenos">128</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lactation_df</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="test_interval_method-129"><a href="#test_interval_method-129"><span class="linenos">129</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping TestId </span><span class="si">{</span><span class="n">lactation</span><span class="si">}</span><span class="s2">: not enough data points for interpolation.&quot;</span><span class="p">)</span>
</span><span id="test_interval_method-130"><a href="#test_interval_method-130"><span class="linenos">130</span></a>            <span class="k">continue</span>
</span><span id="test_interval_method-131"><a href="#test_interval_method-131"><span class="linenos">131</span></a>
</span><span id="test_interval_method-132"><a href="#test_interval_method-132"><span class="linenos">132</span></a>        <span class="c1"># Start and end points</span>
</span><span id="test_interval_method-133"><a href="#test_interval_method-133"><span class="linenos">133</span></a>        <span class="n">start</span> <span class="o">=</span> <span class="n">lactation_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="test_interval_method-134"><a href="#test_interval_method-134"><span class="linenos">134</span></a>        <span class="n">end</span> <span class="o">=</span> <span class="n">lactation_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="test_interval_method-135"><a href="#test_interval_method-135"><span class="linenos">135</span></a>
</span><span id="test_interval_method-136"><a href="#test_interval_method-136"><span class="linenos">136</span></a>        <span class="c1"># Start contribution</span>
</span><span id="test_interval_method-137"><a href="#test_interval_method-137"><span class="linenos">137</span></a>        <span class="n">MY0</span> <span class="o">=</span> <span class="n">start</span><span class="p">[</span><span class="n">dim_col</span><span class="p">]</span> <span class="o">*</span> <span class="n">start</span><span class="p">[</span><span class="n">my_col</span><span class="p">]</span>
</span><span id="test_interval_method-138"><a href="#test_interval_method-138"><span class="linenos">138</span></a>
</span><span id="test_interval_method-139"><a href="#test_interval_method-139"><span class="linenos">139</span></a>        <span class="c1"># End contribution</span>
</span><span id="test_interval_method-140"><a href="#test_interval_method-140"><span class="linenos">140</span></a>        <span class="n">MYend</span> <span class="o">=</span> <span class="p">(</span><span class="mi">306</span> <span class="o">-</span> <span class="n">end</span><span class="p">[</span><span class="n">dim_col</span><span class="p">])</span> <span class="o">*</span> <span class="n">end</span><span class="p">[</span><span class="n">my_col</span><span class="p">]</span>
</span><span id="test_interval_method-141"><a href="#test_interval_method-141"><span class="linenos">141</span></a>
</span><span id="test_interval_method-142"><a href="#test_interval_method-142"><span class="linenos">142</span></a>        <span class="c1"># Intermediate trapezoidal contributions</span>
</span><span id="test_interval_method-143"><a href="#test_interval_method-143"><span class="linenos">143</span></a>        <span class="n">lactation_df</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lactation_df</span><span class="p">[</span><span class="n">dim_col</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="test_interval_method-144"><a href="#test_interval_method-144"><span class="linenos">144</span></a>        <span class="n">lactation_df</span><span class="p">[</span><span class="s2">&quot;avg_yield&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lactation_df</span><span class="p">[</span><span class="n">my_col</span><span class="p">]</span> <span class="o">+</span> <span class="n">lactation_df</span><span class="p">[</span><span class="n">my_col</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="test_interval_method-145"><a href="#test_interval_method-145"><span class="linenos">145</span></a>        <span class="n">lactation_df</span><span class="p">[</span><span class="s2">&quot;trapezoid_area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lactation_df</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">lactation_df</span><span class="p">[</span><span class="s2">&quot;avg_yield&quot;</span><span class="p">]</span>
</span><span id="test_interval_method-146"><a href="#test_interval_method-146"><span class="linenos">146</span></a>
</span><span id="test_interval_method-147"><a href="#test_interval_method-147"><span class="linenos">147</span></a>        <span class="n">total_intermediate</span> <span class="o">=</span> <span class="n">lactation_df</span><span class="p">[</span><span class="s2">&quot;trapezoid_area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="test_interval_method-148"><a href="#test_interval_method-148"><span class="linenos">148</span></a>
</span><span id="test_interval_method-149"><a href="#test_interval_method-149"><span class="linenos">149</span></a>        <span class="n">total_yield</span> <span class="o">=</span> <span class="n">MY0</span> <span class="o">+</span> <span class="n">total_intermediate</span> <span class="o">+</span> <span class="n">MYend</span>
</span><span id="test_interval_method-150"><a href="#test_interval_method-150"><span class="linenos">150</span></a>        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">lactation</span><span class="p">,</span> <span class="n">total_yield</span><span class="p">))</span>
</span><span id="test_interval_method-151"><a href="#test_interval_method-151"><span class="linenos">151</span></a>
</span><span id="test_interval_method-152"><a href="#test_interval_method-152"><span class="linenos">152</span></a>    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;TestId&quot;</span><span class="p">,</span> <span class="s2">&quot;Total305Yield&quot;</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Compute 305-day total milk yield using the ICAR Test Interval Method.</p>

<p>The method applies:</p>

<ul>
<li>Linear projection from calving to the first test day,</li>
<li>Trapezoidal integration between consecutive test days,</li>
<li>Linear projection from the last test day to DIM=305.</li>
</ul>

<p>Args:
    df (pd.DataFrame): Input DataFrame with at least DaysInMilk, MilkingYield,
        and (optionally) TestId columns (names can be provided via arguments
        or matched via known aliases, case-insensitive).
    days_in_milk_col (str | None): Optional column name override for DaysInMilk.
    milking_yield_col (str | None): Optional column name override for MilkingYield.
    test_id_col (str | None): Optional column name override for TestId.
    default_test_id (Any): If TestId is missing, a new <code>TestId</code> column is created
        with this value.</p>

<p>Returns:
    pd.DataFrame: Two-column DataFrame with
        - "TestId": identifier per lactation,
        - "Total305Yield": computed total milk yield over 305 days.</p>

<p>Raises:
    ValueError: If required columns (DaysInMilk or MilkingYield) cannot be found.</p>

<p>Notes:
    - Records with DIM &gt; 305 are dropped before computation.
    - At least two data points per TestId are required for trapezoidal integration;
      otherwise the lactation is skipped.</p>
</div>


                </section>
    </main>
</body>
</html>