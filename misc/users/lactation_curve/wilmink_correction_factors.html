<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="pdoc 15.0.4" />
    <title>lactationcurve.WilminkCorrectionFactors API documentation</title>

    <style>
      /*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */
      *,
      ::after,
      ::before {
        box-sizing: border-box;
      }
      @media (prefers-reduced-motion: no-preference) {
        :root {
          scroll-behavior: smooth;
        }
      }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif,
          "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
          "Noto Color Emoji";
        font-size: 1rem;
        font-weight: 400;
        line-height: 1.5;
        color: #212529;
        background-color: #fff;
        -webkit-text-size-adjust: 100%;
        -webkit-tap-highlight-color: transparent;
      }
      hr {
        margin: 1rem 0;
        color: inherit;
        background-color: currentColor;
        border: 0;
        opacity: 0.25;
      }
      hr:not([size]) {
        height: 1px;
      }
      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        margin-top: 0;
        margin-bottom: 0.5rem;
        font-weight: 500;
        line-height: 1.2;
      }
      h1 {
        font-size: calc(1.375rem + 1.5vw);
      }
      @media (min-width: 1200px) {
        h1 {
          font-size: 2.5rem;
        }
      }
      h2 {
        font-size: calc(1.325rem + 0.9vw);
      }
      @media (min-width: 1200px) {
        h2 {
          font-size: 2rem;
        }
      }
      h3 {
        font-size: calc(1.3rem + 0.6vw);
      }
      @media (min-width: 1200px) {
        h3 {
          font-size: 1.75rem;
        }
      }
      h4 {
        font-size: calc(1.275rem + 0.3vw);
      }
      @media (min-width: 1200px) {
        h4 {
          font-size: 1.5rem;
        }
      }
      h5 {
        font-size: 1.25rem;
      }
      h6 {
        font-size: 1rem;
      }
      p {
        margin-top: 0;
        margin-bottom: 1rem;
      }
      abbr[data-bs-original-title],
      abbr[title] {
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
        cursor: help;
        -webkit-text-decoration-skip-ink: none;
        text-decoration-skip-ink: none;
      }
      address {
        margin-bottom: 1rem;
        font-style: normal;
        line-height: inherit;
      }
      ol,
      ul {
        padding-left: 2rem;
      }
      dl,
      ol,
      ul {
        margin-top: 0;
        margin-bottom: 1rem;
      }
      ol ol,
      ol ul,
      ul ol,
      ul ul {
        margin-bottom: 0;
      }
      dt {
        font-weight: 700;
      }
      dd {
        margin-bottom: 0.5rem;
        margin-left: 0;
      }
      blockquote {
        margin: 0 0 1rem;
      }
      b,
      strong {
        font-weight: bolder;
      }
      small {
        font-size: 0.875em;
      }
      mark {
        padding: 0.2em;
        background-color: #fcf8e3;
      }
      sub,
      sup {
        position: relative;
        font-size: 0.75em;
        line-height: 0;
        vertical-align: baseline;
      }
      sub {
        bottom: -0.25em;
      }
      sup {
        top: -0.5em;
      }
      a {
        color: #0d6efd;
        text-decoration: underline;
      }
      a:hover {
        color: #0a58ca;
      }
      a:not([href]):not([class]),
      a:not([href]):not([class]):hover {
        color: inherit;
        text-decoration: none;
      }
      code,
      kbd,
      pre,
      samp {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",
          "Courier New", monospace;
        font-size: 1em;
        direction: ltr;
        unicode-bidi: bidi-override;
      }
      pre {
        display: block;
        margin-top: 0;
        margin-bottom: 1rem;
        overflow: auto;
        font-size: 0.875em;
      }
      pre code {
        font-size: inherit;
        color: inherit;
        word-break: normal;
      }
      code {
        font-size: 0.875em;
        color: #d63384;
        word-wrap: break-word;
      }
      a > code {
        color: inherit;
      }
      kbd {
        padding: 0.2rem 0.4rem;
        font-size: 0.875em;
        color: #fff;
        background-color: #212529;
        border-radius: 0.2rem;
      }
      kbd kbd {
        padding: 0;
        font-size: 1em;
        font-weight: 700;
      }
      figure {
        margin: 0 0 1rem;
      }
      img,
      svg {
        vertical-align: middle;
      }
      table {
        caption-side: bottom;
        border-collapse: collapse;
      }
      caption {
        padding-top: 0.5rem;
        padding-bottom: 0.5rem;
        color: #6c757d;
        text-align: left;
      }
      th {
        text-align: inherit;
        text-align: -webkit-match-parent;
      }
      tbody,
      td,
      tfoot,
      th,
      thead,
      tr {
        border-color: inherit;
        border-style: solid;
        border-width: 0;
      }
      label {
        display: inline-block;
      }
      button {
        border-radius: 0;
      }
      button:focus:not(:focus-visible) {
        outline: 0;
      }
      button,
      input,
      optgroup,
      select,
      textarea {
        margin: 0;
        font-family: inherit;
        font-size: inherit;
        line-height: inherit;
      }
      button,
      select {
        text-transform: none;
      }
      [role="button"] {
        cursor: pointer;
      }
      select {
        word-wrap: normal;
      }
      select:disabled {
        opacity: 1;
      }
      [list]::-webkit-calendar-picker-indicator {
        display: none;
      }
      [type="button"],
      [type="reset"],
      [type="submit"],
      button {
        -webkit-appearance: button;
      }
      [type="button"]:not(:disabled),
      [type="reset"]:not(:disabled),
      [type="submit"]:not(:disabled),
      button:not(:disabled) {
        cursor: pointer;
      }
      ::-moz-focus-inner {
        padding: 0;
        border-style: none;
      }
      textarea {
        resize: vertical;
      }
      fieldset {
        min-width: 0;
        padding: 0;
        margin: 0;
        border: 0;
      }
      legend {
        float: left;
        width: 100%;
        padding: 0;
        margin-bottom: 0.5rem;
        font-size: calc(1.275rem + 0.3vw);
        line-height: inherit;
      }
      @media (min-width: 1200px) {
        legend {
          font-size: 1.5rem;
        }
      }
      legend + * {
        clear: left;
      }
      ::-webkit-datetime-edit-day-field,
      ::-webkit-datetime-edit-fields-wrapper,
      ::-webkit-datetime-edit-hour-field,
      ::-webkit-datetime-edit-minute,
      ::-webkit-datetime-edit-month-field,
      ::-webkit-datetime-edit-text,
      ::-webkit-datetime-edit-year-field {
        padding: 0;
      }
      ::-webkit-inner-spin-button {
        height: auto;
      }
      [type="search"] {
        outline-offset: -2px;
        -webkit-appearance: textfield;
      }
      ::-webkit-search-decoration {
        -webkit-appearance: none;
      }
      ::-webkit-color-swatch-wrapper {
        padding: 0;
      }
      ::file-selector-button {
        font: inherit;
      }
      ::-webkit-file-upload-button {
        font: inherit;
        -webkit-appearance: button;
      }
      output {
        display: inline-block;
      }
      iframe {
        border: 0;
      }
      summary {
        display: list-item;
        cursor: pointer;
      }
      progress {
        vertical-align: baseline;
      }
      [hidden] {
        display: none !important;
      }
    </style>
    <style>
      /*! syntax-highlighting.css */
      pre {
        line-height: 125%;
      }
      span.linenos {
        color: inherit;
        background-color: transparent;
        padding-left: 5px;
        padding-right: 20px;
      }
      .pdoc-code .hll {
        background-color: #ffffcc;
      }
      .pdoc-code {
        background: #f8f8f8;
      }
      .pdoc-code .c {
        color: #3d7b7b;
        font-style: italic;
      }
      .pdoc-code .err {
        border: 1px solid #ff0000;
      }
      .pdoc-code .k {
        color: #008000;
        font-weight: bold;
      }
      .pdoc-code .o {
        color: #666666;
      }
      .pdoc-code .ch {
        color: #3d7b7b;
        font-style: italic;
      }
      .pdoc-code .cm {
        color: #3d7b7b;
        font-style: italic;
      }
      .pdoc-code .cp {
        color: #9c6500;
      }
      .pdoc-code .cpf {
        color: #3d7b7b;
        font-style: italic;
      }
      .pdoc-code .c1 {
        color: #3d7b7b;
        font-style: italic;
      }
      .pdoc-code .cs {
        color: #3d7b7b;
        font-style: italic;
      }
      .pdoc-code .gd {
        color: #a00000;
      }
      .pdoc-code .ge {
        font-style: italic;
      }
      .pdoc-code .gr {
        color: #e40000;
      }
      .pdoc-code .gh {
        color: #000080;
        font-weight: bold;
      }
      .pdoc-code .gi {
        color: #008400;
      }
      .pdoc-code .go {
        color: #717171;
      }
      .pdoc-code .gp {
        color: #000080;
        font-weight: bold;
      }
      .pdoc-code .gs {
        font-weight: bold;
      }
      .pdoc-code .gu {
        color: #800080;
        font-weight: bold;
      }
      .pdoc-code .gt {
        color: #0044dd;
      }
      .pdoc-code .kc {
        color: #008000;
        font-weight: bold;
      }
      .pdoc-code .kd {
        color: #008000;
        font-weight: bold;
      }
      .pdoc-code .kn {
        color: #008000;
        font-weight: bold;
      }
      .pdoc-code .kp {
        color: #008000;
      }
      .pdoc-code .kr {
        color: #008000;
        font-weight: bold;
      }
      .pdoc-code .kt {
        color: #b00040;
      }
      .pdoc-code .m {
        color: #666666;
      }
      .pdoc-code .s {
        color: #ba2121;
      }
      .pdoc-code .na {
        color: #687822;
      }
      .pdoc-code .nb {
        color: #008000;
      }
      .pdoc-code .nc {
        color: #0000ff;
        font-weight: bold;
      }
      .pdoc-code .no {
        color: #880000;
      }
      .pdoc-code .nd {
        color: #aa22ff;
      }
      .pdoc-code .ni {
        color: #717171;
        font-weight: bold;
      }
      .pdoc-code .ne {
        color: #cb3f38;
        font-weight: bold;
      }
      .pdoc-code .nf {
        color: #0000ff;
      }
      .pdoc-code .nl {
        color: #767600;
      }
      .pdoc-code .nn {
        color: #0000ff;
        font-weight: bold;
      }
      .pdoc-code .nt {
        color: #008000;
        font-weight: bold;
      }
      .pdoc-code .nv {
        color: #19177c;
      }
      .pdoc-code .ow {
        color: #aa22ff;
        font-weight: bold;
      }
      .pdoc-code .w {
        color: #bbbbbb;
      }
      .pdoc-code .mb {
        color: #666666;
      }
      .pdoc-code .mf {
        color: #666666;
      }
      .pdoc-code .mh {
        color: #666666;
      }
      .pdoc-code .mi {
        color: #666666;
      }
      .pdoc-code .mo {
        color: #666666;
      }
      .pdoc-code .sa {
        color: #ba2121;
      }
      .pdoc-code .sb {
        color: #ba2121;
      }
      .pdoc-code .sc {
        color: #ba2121;
      }
      .pdoc-code .dl {
        color: #ba2121;
      }
      .pdoc-code .sd {
        color: #ba2121;
        font-style: italic;
      }
      .pdoc-code .s2 {
        color: #ba2121;
      }
      .pdoc-code .se {
        color: #aa5d1f;
        font-weight: bold;
      }
      .pdoc-code .sh {
        color: #ba2121;
      }
      .pdoc-code .si {
        color: #a45a77;
        font-weight: bold;
      }
      .pdoc-code .sx {
        color: #008000;
      }
      .pdoc-code .sr {
        color: #a45a77;
      }
      .pdoc-code .s1 {
        color: #ba2121;
      }
      .pdoc-code .ss {
        color: #19177c;
      }
      .pdoc-code .bp {
        color: #008000;
      }
      .pdoc-code .fm {
        color: #0000ff;
      }
      .pdoc-code .vc {
        color: #19177c;
      }
      .pdoc-code .vg {
        color: #19177c;
      }
      .pdoc-code .vi {
        color: #19177c;
      }
      .pdoc-code .vm {
        color: #19177c;
      }
      .pdoc-code .il {
        color: #666666;
      }
    </style>
    <style>
      /*! theme.css */
      :root {
        --pdoc-background: #fff;
      }
      .pdoc {
        --text: #212529;
        --muted: #6c757d;
        --link: #3660a5;
        --link-hover: #1659c5;
        --code: #f8f8f8;
        --active: #fff598;
        --accent: #eee;
        --accent2: #c1c1c1;
        --nav-hover: rgba(255, 255, 255, 0.5);
        --name: #0066bb;
        --def: #008800;
        --annotation: #007020;
      }
    </style>
    <style>
      /*! layout.css */
      html,
      body {
        width: 100%;
        height: 100%;
      }
      html,
      main {
        scroll-behavior: smooth;
      }
      body {
        background-color: var(--pdoc-background);
      }
      @media (max-width: 769px) {
        #navtoggle {
          cursor: pointer;
          position: absolute;
          width: 50px;
          height: 40px;
          top: 1rem;
          right: 1rem;
          border-color: var(--text);
          color: var(--text);
          display: flex;
          opacity: 0.8;
          z-index: 999;
        }
        #navtoggle:hover {
          opacity: 1;
        }
        #togglestate + div {
          display: none;
        }
        #togglestate:checked + div {
          display: inherit;
        }
        main,
        header {
          padding: 2rem 3vw;
        }
        header + main {
          margin-top: -3rem;
        }
        .git-button {
          display: none !important;
        }
        nav input[type="search"] {
          max-width: 77%;
        }
        nav input[type="search"]:first-child {
          margin-top: -6px;
        }
        nav input[type="search"]:valid ~ * {
          display: none !important;
        }
      }
      @media (min-width: 770px) {
        :root {
          --sidebar-width: clamp(12.5rem, 28vw, 22rem);
        }
        nav {
          position: fixed;
          overflow: auto;
          height: 100vh;
          width: var(--sidebar-width);
        }
        main,
        header {
          padding: 3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);
          width: calc(54rem + var(--sidebar-width));
          max-width: 100%;
        }
        header + main {
          margin-top: -4rem;
        }
        #navtoggle {
          display: none;
        }
      }
      #togglestate {
        position: absolute;
        height: 0;
        opacity: 0;
      }
      nav.pdoc {
        --pad: clamp(0.5rem, 2vw, 1.75rem);
        --indent: 1.5rem;
        background-color: var(--accent);
        border-right: 1px solid var(--accent2);
        box-shadow: 0 0 20px rgba(50, 50, 50, 0.2) inset;
        padding: 0 0 0 var(--pad);
        overflow-wrap: anywhere;
        scrollbar-width: thin;
        scrollbar-color: var(--accent2) transparent;
        z-index: 1;
      }
      nav.pdoc::-webkit-scrollbar {
        width: 0.4rem;
      }
      nav.pdoc::-webkit-scrollbar-thumb {
        background-color: var(--accent2);
      }
      nav.pdoc > div {
        padding: var(--pad) 0;
      }
      nav.pdoc .module-list-button {
        display: inline-flex;
        align-items: center;
        color: var(--text);
        border-color: var(--muted);
        margin-bottom: 1rem;
      }
      nav.pdoc .module-list-button:hover {
        border-color: var(--text);
      }
      nav.pdoc input[type="search"] {
        display: block;
        outline-offset: 0;
        width: calc(100% - var(--pad));
      }
      nav.pdoc .logo {
        max-width: calc(100% - var(--pad));
        max-height: 35vh;
        display: block;
        margin: 0 auto 1rem;
        transform: translate(calc(-0.5 * var(--pad)), 0);
      }
      nav.pdoc ul {
        list-style: none;
        padding-left: 0;
      }
      nav.pdoc > div > ul {
        margin-left: calc(0px - var(--pad));
      }
      nav.pdoc li a {
        padding: 0.2rem 0 0.2rem calc(var(--pad) + var(--indent));
      }
      nav.pdoc > div > ul > li > a {
        padding-left: var(--pad);
      }
      nav.pdoc li {
        transition: all 100ms;
      }
      nav.pdoc li:hover {
        background-color: var(--nav-hover);
      }
      nav.pdoc a,
      nav.pdoc a:hover {
        color: var(--text);
      }
      nav.pdoc a {
        display: block;
      }
      nav.pdoc > h2:first-of-type {
        margin-top: 1.5rem;
      }
      nav.pdoc .class:before {
        content: "class ";
        color: var(--muted);
      }
      nav.pdoc .function:after {
        content: "()";
        color: var(--muted);
      }
      nav.pdoc footer:before {
        content: "";
        display: block;
        width: calc(100% - var(--pad));
        border-top: solid var(--accent2) 1px;
        margin-top: 1.5rem;
        padding-top: 0.5rem;
      }
      nav.pdoc footer {
        font-size: small;
      }
    </style>
    <style>
      /*! content.css */
      .pdoc {
        color: var(--text);
        box-sizing: border-box;
        line-height: 1.5;
        background: none;
      }
      .pdoc .pdoc-button {
        cursor: pointer;
        display: inline-block;
        border: solid black 1px;
        border-radius: 2px;
        font-size: 0.75rem;
        padding: calc(0.5em - 1px) 1em;
        transition: 100ms all;
      }
      .pdoc .alert {
        padding: 1rem 1rem 1rem calc(1.5rem + 24px);
        border: 1px solid transparent;
        border-radius: 0.25rem;
        background-repeat: no-repeat;
        background-position: 0.75rem center;
        margin-bottom: 1rem;
      }
      .pdoc .alert > em {
        display: none;
      }
      .pdoc .alert > *:last-child {
        margin-bottom: 0;
      }
      .pdoc .alert.note {
        color: #084298;
        background-color: #cfe2ff;
        border-color: #b6d4fe;
        background-image: url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");
      }
      .pdoc .alert.tip {
        color: #0a3622;
        background-color: #d1e7dd;
        border-color: #a3cfbb;
        background-image: url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");
      }
      .pdoc .alert.important {
        color: #055160;
        background-color: #cff4fc;
        border-color: #9eeaf9;
        background-image: url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");
      }
      .pdoc .alert.warning {
        color: #664d03;
        background-color: #fff3cd;
        border-color: #ffecb5;
        background-image: url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");
      }
      .pdoc .alert.caution {
        color: #842029;
        background-color: #f8d7da;
        border-color: #f5c2c7;
        background-image: url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");
      }
      .pdoc .alert.danger {
        color: #842029;
        background-color: #f8d7da;
        border-color: #f5c2c7;
        background-image: url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");
      }
      .pdoc .visually-hidden {
        position: absolute !important;
        width: 1px !important;
        height: 1px !important;
        padding: 0 !important;
        margin: -1px !important;
        overflow: hidden !important;
        clip: rect(0, 0, 0, 0) !important;
        white-space: nowrap !important;
        border: 0 !important;
      }
      .pdoc h1,
      .pdoc h2,
      .pdoc h3 {
        font-weight: 300;
        margin: 0.3em 0;
        padding: 0.2em 0;
      }
      .pdoc > section:not(.module-info) h1 {
        font-size: 1.5rem;
        font-weight: 500;
      }
      .pdoc > section:not(.module-info) h2 {
        font-size: 1.4rem;
        font-weight: 500;
      }
      .pdoc > section:not(.module-info) h3 {
        font-size: 1.3rem;
        font-weight: 500;
      }
      .pdoc > section:not(.module-info) h4 {
        font-size: 1.2rem;
      }
      .pdoc > section:not(.module-info) h5 {
        font-size: 1.1rem;
      }
      .pdoc a {
        text-decoration: none;
        color: var(--link);
      }
      .pdoc a:hover {
        color: var(--link-hover);
      }
      .pdoc blockquote {
        margin-left: 2rem;
      }
      .pdoc pre {
        border-top: 1px solid var(--accent2);
        border-bottom: 1px solid var(--accent2);
        margin-top: 0;
        margin-bottom: 1em;
        padding: 0.5rem 0 0.5rem 0.5rem;
        overflow-x: auto;
        background-color: var(--code);
      }
      .pdoc code {
        color: var(--text);
        padding: 0.2em 0.4em;
        margin: 0;
        font-size: 85%;
        background-color: var(--accent);
        border-radius: 6px;
      }
      .pdoc a > code {
        color: inherit;
      }
      .pdoc pre > code {
        display: inline-block;
        font-size: inherit;
        background: none;
        border: none;
        padding: 0;
      }
      .pdoc > section:not(.module-info) {
        margin-bottom: 1.5rem;
      }
      .pdoc .modulename {
        margin-top: 0;
        font-weight: bold;
      }
      .pdoc .modulename a {
        color: var(--link);
        transition: 100ms all;
      }
      .pdoc .git-button {
        float: right;
        border: solid var(--link) 1px;
      }
      .pdoc .git-button:hover {
        background-color: var(--link);
        color: var(--pdoc-background);
      }
      .view-source-toggle-state,
      .view-source-toggle-state ~ .pdoc-code {
        display: none;
      }
      .view-source-toggle-state:checked ~ .pdoc-code {
        display: block;
      }
      .view-source-button {
        display: inline-block;
        float: right;
        font-size: 0.75rem;
        line-height: 1.5rem;
        color: var(--muted);
        padding: 0 0.4rem 0 1.3rem;
        cursor: pointer;
        text-indent: -2px;
      }
      .view-source-button > span {
        visibility: hidden;
      }
      .module-info .view-source-button {
        float: none;
        display: flex;
        justify-content: flex-end;
        margin: -1.2rem 0.4rem -0.2rem 0;
      }
      .view-source-button::before {
        position: absolute;
        content: "View Source";
        display: list-item;
        list-style-type: disclosure-closed;
      }
      .view-source-toggle-state:checked ~ .attr .view-source-button::before,
      .view-source-toggle-state:checked ~ .view-source-button::before {
        list-style-type: disclosure-open;
      }
      .pdoc .docstring {
        margin-bottom: 1.5rem;
      }
      .pdoc section:not(.module-info) .docstring {
        margin-left: clamp(0rem, 5vw - 2rem, 1rem);
      }
      .pdoc .docstring .pdoc-code {
        margin-left: 1em;
        margin-right: 1em;
      }
      .pdoc h1:target,
      .pdoc h2:target,
      .pdoc h3:target,
      .pdoc h4:target,
      .pdoc h5:target,
      .pdoc h6:target,
      .pdoc .pdoc-code > pre > span:target {
        background-color: var(--active);
        box-shadow: -1rem 0 0 0 var(--active);
      }
      .pdoc .pdoc-code > pre > span:target {
        display: block;
      }
      .pdoc div:target > .attr,
      .pdoc section:target > .attr,
      .pdoc dd:target > a {
        background-color: var(--active);
      }
      .pdoc * {
        scroll-margin: 2rem;
      }
      .pdoc .pdoc-code .linenos {
        user-select: none;
      }
      .pdoc .attr:hover {
        filter: contrast(0.95);
      }
      .pdoc section,
      .pdoc .classattr {
        position: relative;
      }
      .pdoc .headerlink {
        --width: clamp(1rem, 3vw, 2rem);
        position: absolute;
        top: 0;
        left: calc(0rem - var(--width));
        transition: all 100ms ease-in-out;
        opacity: 0;
      }
      .pdoc .headerlink::before {
        content: "#";
        display: block;
        text-align: center;
        width: var(--width);
        height: 2.3rem;
        line-height: 2.3rem;
        font-size: 1.5rem;
      }
      .pdoc .attr:hover ~ .headerlink,
      .pdoc *:target > .headerlink,
      .pdoc .headerlink:hover {
        opacity: 1;
      }
      .pdoc .attr {
        display: block;
        margin: 0.5rem 0 0.5rem;
        padding: 0.4rem 0.4rem 0.4rem 1rem;
        background-color: var(--accent);
        overflow-x: auto;
      }
      .pdoc .classattr {
        margin-left: 2rem;
      }
      .pdoc .decorator-deprecated {
        color: #842029;
      }
      .pdoc .decorator-deprecated ~ span {
        filter: grayscale(1) opacity(0.8);
      }
      .pdoc .name {
        color: var(--name);
        font-weight: bold;
      }
      .pdoc .def {
        color: var(--def);
        font-weight: bold;
      }
      .pdoc .signature {
        background-color: transparent;
      }
      .pdoc .param,
      .pdoc .return-annotation {
        white-space: pre;
      }
      .pdoc .signature.multiline .param {
        display: block;
      }
      .pdoc .signature.condensed .param {
        display: inline-block;
      }
      .pdoc .annotation {
        color: var(--annotation);
      }
      .pdoc .view-value-toggle-state,
      .pdoc .view-value-toggle-state ~ .default_value {
        display: none;
      }
      .pdoc .view-value-toggle-state:checked ~ .default_value {
        display: inherit;
      }
      .pdoc .view-value-button {
        font-size: 0.5rem;
        vertical-align: middle;
        border-style: dashed;
        margin-top: -0.1rem;
      }
      .pdoc .view-value-button:hover {
        background: white;
      }
      .pdoc .view-value-button::before {
        content: "show";
        text-align: center;
        width: 2.2em;
        display: inline-block;
      }
      .pdoc .view-value-toggle-state:checked ~ .view-value-button::before {
        content: "hide";
      }
      .pdoc .inherited {
        margin-left: 2rem;
      }
      .pdoc .inherited dt {
        font-weight: 700;
      }
      .pdoc .inherited dt,
      .pdoc .inherited dd {
        display: inline;
        margin-left: 0;
        margin-bottom: 0.5rem;
      }
      .pdoc .inherited dd:not(:last-child):after {
        content: ", ";
      }
      .pdoc .inherited .class:before {
        content: "class ";
      }
      .pdoc .inherited .function a:after {
        content: "()";
      }
      .pdoc .search-result .docstring {
        overflow: auto;
        max-height: 25vh;
      }
      .pdoc .search-result.focused > .attr {
        background-color: var(--active);
      }
      .pdoc .attribution {
        margin-top: 2rem;
        display: block;
        opacity: 0.5;
        transition: all 200ms;
        filter: grayscale(100%);
      }
      .pdoc .attribution:hover {
        opacity: 1;
        filter: grayscale(0%);
      }
      .pdoc .attribution img {
        margin-left: 5px;
        height: 35px;
        vertical-align: middle;
        width: 70px;
        transition: all 200ms;
      }
      .pdoc table {
        display: block;
        width: max-content;
        max-width: 100%;
        overflow: auto;
        margin-bottom: 1rem;
      }
      .pdoc table th {
        font-weight: 600;
      }
      .pdoc table th,
      .pdoc table td {
        padding: 6px 13px;
        border: 1px solid var(--accent2);
      }
    </style>
    <style>
      /*! custom.css */
    </style>
  </head>
  <body>
    <nav class="pdoc">
      <label id="navtoggle" for="togglestate" class="pdoc-button"
        ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30">
          <path
            stroke-linecap="round"
            stroke="currentColor"
            stroke-miterlimit="10"
            stroke-width="2"
            d="M4 7h22M4 15h22M4 23h22"
          /></svg
      ></label>
      <input
        id="togglestate"
        type="checkbox"
        aria-hidden="true"
        tabindex="-1"
      />
      <div>
        <a class="pdoc-button module-list-button" href="../lactationcurve.html">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            fill="currentColor"
            class="bi bi-box-arrow-in-left"
            viewBox="0 0 16 16"
          >
            <path
              fill-rule="evenodd"
              d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"
            />
            <path
              fill-rule="evenodd"
              d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"
            />
          </svg>
          &nbsp;lactationcurve</a
        >

        <input
          type="search"
          placeholder="Search..."
          role="searchbox"
          aria-label="search"
          pattern=".+"
          required
        />

        <h2>API Documentation</h2>
        <ul class="memberlist">
          <li>
            <a class="variable" href="#data_path">data_path</a>
          </li>
          <li>
            <a class="variable" href="#df">df</a>
          </li>
          <li>
            <a class="variable" href="#bin_edges">bin_edges</a>
          </li>
          <li>
            <a class="variable" href="#labels">labels</a>
          </li>
          <li>
            <a class="variable" href="#season_labels">season_labels</a>
          </li>
          <li>
            <a class="variable" href="#shifted_month">shifted_month</a>
          </li>
          <li>
            <a class="variable" href="#counts">counts</a>
          </li>
          <li>
            <a class="variable" href="#valid_ids">valid_ids</a>
          </li>
          <li>
            <a class="variable" href="#grid">grid</a>
          </li>
          <li>
            <a class="function" href="#interpolate_to_grid"
              >interpolate_to_grid</a
            >
          </li>
          <li>
            <a class="variable" href="#df_grid">df_grid</a>
          </li>
          <li>
            <a class="variable" href="#model">model</a>
          </li>
          <li>
            <a class="variable" href="#ageclass_coefs">ageclass_coefs</a>
          </li>
          <li>
            <a class="variable" href="#calving_season_coefs"
              >calving_season_coefs</a
            >
          </li>
          <li>
            <a class="variable" href="#results">results</a>
          </li>
          <li>
            <a class="variable" href="#df_adj">df_adj</a>
          </li>
          <li>
            <a class="function" href="#lc_model">lc_model</a>
          </li>
          <li>
            <a class="variable" href="#age_class_one">age_class_one</a>
          </li>
          <li>
            <a class="variable" href="#x">x</a>
          </li>
          <li>
            <a class="variable" href="#y">y</a>
          </li>
          <li>
            <a class="variable" href="#y_fit">y_fit</a>
          </li>
          <li>
            <a class="function" href="#dif_model">dif_model</a>
          </li>
          <li>
            <a class="variable" href="#age_class_not_one">age_class_not_one</a>
          </li>
          <li>
            <a class="variable" href="#a_t">a_t</a>
          </li>
          <li>
            <a class="variable" href="#b_t">b_t</a>
          </li>
          <li>
            <a class="variable" href="#c_t">c_t</a>
          </li>
          <li>
            <a class="variable" href="#age_classes_parity_one_two"
              >age_classes_parity_one_two</a
            >
          </li>
          <li>
            <a class="function" href="#model_param_t_low_par"
              >model_param_t_low_par</a
            >
          </li>
          <li>
            <a class="function" href="#subset_dict">subset_dict</a>
          </li>
          <li>
            <a class="variable" href="#a_par_one_two">a_par_one_two</a>
          </li>
          <li>
            <a class="variable" href="#b_par_one_two">b_par_one_two</a>
          </li>
          <li>
            <a class="variable" href="#c_par_one_two">c_par_one_two</a>
          </li>
          <li>
            <a class="variable" href="#averages">averages</a>
          </li>
          <li>
            <a class="variable" href="#age_classes_parity_three"
              >age_classes_parity_three</a
            >
          </li>
          <li>
            <a class="function" href="#model_param_t_high_par"
              >model_param_t_high_par</a
            >
          </li>
          <li>
            <a class="variable" href="#a_par_three">a_par_three</a>
          </li>
          <li>
            <a class="variable" href="#b_par_three">b_par_three</a>
          </li>
          <li>
            <a class="variable" href="#c_par_three">c_par_three</a>
          </li>
          <li>
            <a class="function" href="#correction_factor_age"
              >correction_factor_age</a
            >
          </li>
          <li>
            <a class="variable" href="#season_dict">season_dict</a>
          </li>
          <li>
            <a class="variable" href="#season_midpoints">season_midpoints</a>
          </li>
          <li>
            <a class="variable" href="#season_df">season_df</a>
          </li>
          <li>
            <a class="variable" href="#months_ext">months_ext</a>
          </li>
          <li>
            <a class="variable" href="#coef_ext">coef_ext</a>
          </li>
          <li>
            <a class="variable" href="#spl">spl</a>
          </li>
          <li>
            <a class="variable" href="#months_full">months_full</a>
          </li>
          <li>
            <a class="variable" href="#correction_factors"
              >correction_factors</a
            >
          </li>
          <li>
            <a class="variable" href="#correction_df">correction_df</a>
          </li>
        </ul>

        <a
          class="attribution"
          title="pdoc: Python API documentation generator"
          href="https://pdoc.dev"
          target="_blank"
        >
          built with <span class="visually-hidden">pdoc</span
          ><img
            alt="pdoc logo"
            src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"
          />
        </a>
      </div>
    </nav>
    <main class="pdoc">
      <section class="module-info">
        <h1 class="modulename">
          <a href="./../lactationcurve.html">lactationcurve</a
          ><wbr />.WilminkCorrectionFactors
        </h1>

        <input
          id="mod-WilminkCorrectionFactors-view-source"
          class="view-source-toggle-state"
          type="checkbox"
          aria-hidden="true"
          tabindex="-1"
        />

        <label
          class="view-source-button"
          for="mod-WilminkCorrectionFactors-view-source"
          ><span>View Source</span></label
        >

        <div class="pdoc-code codehilite">
          <pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="c1"># %% md</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="c1">#  Testing the different ICAR methods to calculate 305-d milk production based on Procedure 2 of Section 2 of ICAR Guidelines â€“ Computing of Accumulated Lactation Yield. With the use of the dataset of Yongyan</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="c1"># </span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="c1">#  The Wilmink method (1987): Interpolation using Standard Lactation Curves (ISLC) </span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="c1"># </span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="c1">#  Author: Meike  </span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="c1"># </span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="c1">#  Date: 6 may 2025, 19 august</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="c1"># </span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="c1"># %%</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="c1"># import packages</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">curve_fit</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.formula.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">smf</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.interpolate</span><span class="w"> </span><span class="kn">import</span> <span class="n">interp1d</span><span class="p">,</span> <span class="n">UnivariateSpline</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="c1"># %% md</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="c1"># # Load data and preprocessing</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="c1"># %%</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="c1"># Find the project root (the folder &quot;lactation-curves&quot;)</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="k">try</span><span class="p">:</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>    <span class="c1"># Works in .py scripts</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>    <span class="n">project_root</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>    <span class="c1"># Works in Jupyter notebooks</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>    <span class="n">project_root</span> <span class="o">=</span> <span class="n">Path</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="c1"># Now build the path to the CSV</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="n">data_path</span> <span class="o">=</span> <span class="n">project_root</span> <span class="o">/</span> <span class="s2">&quot;lactationcurve&quot;</span> <span class="o">/</span> <span class="s2">&quot;tests&quot;</span> <span class="o">/</span> <span class="s2">&quot;TestData&quot;</span> <span class="o">/</span> <span class="s2">&quot;MRtestFile.csv&quot;</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="c1"># Load the CSV</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="c1"># %%</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="c1"># correct datatypes</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="n">df</span><span class="p">[</span><span class="s1">&#39;BirthDate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;BirthDate&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="n">df</span><span class="p">[</span><span class="s1">&#39;TestDate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;TestDate&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="c1"># Calculate CalvingDate = TestDate - DaysInMilk</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="n">df</span><span class="p">[</span><span class="s1">&#39;CalvingDate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;TestDate&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;DaysInMilk&#39;</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="c1"># Age at calving (in days)</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="n">df</span><span class="p">[</span><span class="s1">&#39;AgeAtCalvingDays&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;CalvingDate&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;BirthDate&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">days</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="c1"># Convert to months (approx 30.44 days per month)</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="n">df</span><span class="p">[</span><span class="s1">&#39;AgeAtCalvingMonths&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;AgeAtCalvingDays&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">30.44</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="c1"># Flatten the bin edges</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="n">bin_edges</span> <span class="o">=</span> <span class="p">[</span><span class="mi">22</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">93</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="c1"># Labels as strings</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;22-24&quot;</span><span class="p">,</span> <span class="s2">&quot;25-27&quot;</span><span class="p">,</span> <span class="s2">&quot;28-32&quot;</span><span class="p">,</span> <span class="s2">&quot;33-37&quot;</span><span class="p">,</span> <span class="s2">&quot;38-44&quot;</span><span class="p">,</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>          <span class="s2">&quot;45-56&quot;</span><span class="p">,</span> <span class="s2">&quot;57-68&quot;</span><span class="p">,</span> <span class="s2">&quot;69-92&quot;</span><span class="p">,</span> <span class="s2">&quot;93-104&quot;</span><span class="p">,</span> <span class="s2">&quot;105+&quot;</span><span class="p">]</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="n">df</span><span class="p">[</span><span class="s1">&#39;AgeClass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;AgeAtCalvingMonths&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bin_edges</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="c1"># add calving season</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="n">season_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Aug-Sep&quot;</span><span class="p">,</span> <span class="s2">&quot;Oct-Nov&quot;</span><span class="p">,</span> <span class="s2">&quot;Dec-Jan&quot;</span><span class="p">,</span> <span class="s2">&quot;Feb-Mar&quot;</span><span class="p">,</span> <span class="s2">&quot;Apr-May&quot;</span><span class="p">,</span> <span class="s2">&quot;Jun-Jul&quot;</span><span class="p">]</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="n">shifted_month</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;CalvingDate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span> <span class="o">-</span> <span class="mi">8</span><span class="p">)</span> <span class="o">%</span> <span class="mi">12</span>  <span class="c1"># Aug becomes 0</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="c1"># Map to season index</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="n">df</span><span class="p">[</span><span class="s1">&#39;CalvingSeason&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">shifted_month</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">season_labels</span><span class="p">)))</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="c1"># drop rows without an age class &gt; in Wilminks analysis heifers that calved before 22 months of age were omitted from the analysis.</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;AgeClass&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="c1"># filter out records with only one measurement</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="c1"># Count records per TestId</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="n">counts</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;TestId&quot;</span><span class="p">)[</span><span class="s2">&quot;DaysInMilk&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="c1"># Keep only TestIds with at least 2 unique DaysInMilk values</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="n">valid_ids</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">counts</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;TestId&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">valid_ids</span><span class="p">)]</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="c1"># %%</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="n">df</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="c1"># %% md</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="c1"># # Define and use the grid</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="c1"># %%</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="c1"># the grid is very important, will be what will be used to calculate total milk yield</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="n">grid</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">170</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">290</span><span class="p">]</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="c1"># %%</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="c1"># Wilmink only uses milksamples from days of the grid. As milk samples are taken on random DIM, these measurements need to be interpolated to the grid days.</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="k">def</span><span class="w"> </span><span class="nf">interpolate_to_grid</span><span class="p">(</span><span class="n">group</span><span class="p">):</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>    <span class="c1"># Sort by DIM</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>    <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;DaysInMilk&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="s2">&quot;DaysInMilk&quot;</span><span class="p">)</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>    <span class="c1"># interpolation function with extrapolation allowed</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>    <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="s2">&quot;DaysInMilk&quot;</span><span class="p">],</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;MilkingYield&quot;</span><span class="p">],</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>                 <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;extrapolate&quot;</span><span class="p">)</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>    <span class="c1"># Build new df with grid</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>    <span class="n">new_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>        <span class="s2">&quot;TestId&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;TestId&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>        <span class="s2">&quot;GridDay&quot;</span><span class="p">:</span> <span class="n">grid</span><span class="p">,</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>        <span class="s2">&quot;MilkYieldInterp&quot;</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">grid</span><span class="p">),</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>        <span class="s2">&quot;AgeClass&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;AgeClass&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>        <span class="s2">&quot;CalvingSeason&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;CalvingSeason&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>    <span class="p">})</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>    <span class="k">return</span> <span class="n">new_df</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="c1"># Apply per TestId &gt; every testId will have all the values of the grid filled with a milk yield.</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="n">df_grid</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;TestId&quot;</span><span class="p">,</span> <span class="n">group_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">interpolate_to_grid</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="n">df_grid</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="c1"># %% md</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="c1"># # Calculate correction factors</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="c1"># %% md</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="c1"># Based on: _Wilmink, J.B.M., 1987. Adjustment of test-day milk, fat and protein yield for age, season and</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="c1"># stage of lactation. Livest. Prod. Sci., 16: 335-348._</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="c1"># </span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a><span class="c1"># %%</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="c1"># fit a linear model to see the impact of calving season and age on milk production</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="c1"># should be a linear mixed effect model that also includes lactation length and sire, but I do not have that information in my current df.</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="c1"># fit a model for each test day</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="n">model</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">gls</span><span class="p">(</span><span class="s2">&quot;MilkYieldInterp ~ C(AgeClass) + C(CalvingSeason)&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_grid</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="n">ageclass_coefs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s2">&quot;C(AgeClass)&quot;</span><span class="p">)</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="n">calving_season_coefs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s2">&quot;C(CalvingSeason)&quot;</span><span class="p">)</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="nb">print</span><span class="p">(</span><span class="n">calving_season_coefs</span><span class="p">)</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="c1"># %% md</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="c1"># ## Age at calving</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="c1"># %%</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="n">df_grid</span><span class="p">[</span><span class="s2">&quot;AgeClass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>    <span class="n">df_grid</span><span class="p">[</span><span class="s2">&quot;AgeClass&quot;</span><span class="p">],</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>    <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;22-24&quot;</span><span class="p">,</span> <span class="s2">&quot;25-27&quot;</span><span class="p">,</span> <span class="s2">&quot;28-32&quot;</span><span class="p">,</span> <span class="s2">&quot;33-37&quot;</span><span class="p">,</span> <span class="s2">&quot;38-44&quot;</span><span class="p">,</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>                <span class="s2">&quot;45-56&quot;</span><span class="p">,</span> <span class="s2">&quot;57-68&quot;</span><span class="p">,</span> <span class="s2">&quot;69-92&quot;</span><span class="p">,</span> <span class="s2">&quot;93-104&quot;</span><span class="p">,</span> <span class="s2">&quot;105+&quot;</span><span class="p">],</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>    <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="p">)</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">df_grid</span><span class="p">[</span><span class="s2">&quot;GridDay&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>    <span class="n">sub</span> <span class="o">=</span> <span class="n">df_grid</span><span class="p">[</span><span class="n">df_grid</span><span class="p">[</span><span class="s2">&quot;GridDay&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">g</span><span class="p">]</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">gls</span><span class="p">(</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>        <span class="s2">&quot;MilkYieldInterp ~ C(AgeClass) + C(CalvingSeason)&quot;</span><span class="p">,</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>        <span class="n">data</span><span class="o">=</span><span class="n">sub</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>    <span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>    <span class="c1"># Baseline (22-24)</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>    <span class="n">new_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>        <span class="s2">&quot;AgeClass&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;22-24&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">sub</span><span class="p">[</span><span class="s2">&quot;CalvingSeason&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">(),</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>        <span class="s2">&quot;CalvingSeason&quot;</span><span class="p">:</span> <span class="n">sub</span><span class="p">[</span><span class="s2">&quot;CalvingSeason&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>    <span class="p">})</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>    <span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">new_data</span><span class="p">)</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>    <span class="n">baseline_mean</span> <span class="o">=</span> <span class="n">preds</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>    <span class="c1"># Store baseline</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>        <span class="s2">&quot;GridDay&quot;</span><span class="p">:</span> <span class="n">g</span><span class="p">,</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>        <span class="s2">&quot;AgeClass&quot;</span><span class="p">:</span> <span class="s2">&quot;22-24&quot;</span><span class="p">,</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>        <span class="s2">&quot;AdjMeanYield&quot;</span><span class="p">:</span> <span class="n">baseline_mean</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>    <span class="p">})</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>    <span class="c1"># Now loop over other AgeClasses and compute differences</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>    <span class="k">for</span> <span class="n">age</span> <span class="ow">in</span> <span class="n">sub</span><span class="p">[</span><span class="s2">&quot;AgeClass&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>        <span class="k">if</span> <span class="n">age</span> <span class="o">==</span> <span class="s2">&quot;22-24&quot;</span><span class="p">:</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>            <span class="k">continue</span>  <span class="c1"># skip baseline</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>        <span class="n">coef</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;C(AgeClass)[T.</span><span class="si">{</span><span class="n">age</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>        <span class="c1"># Difference relative to baseline</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>        <span class="n">diff</span> <span class="o">=</span> <span class="n">coef</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>            <span class="s2">&quot;GridDay&quot;</span><span class="p">:</span> <span class="n">g</span><span class="p">,</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>            <span class="s2">&quot;AgeClass&quot;</span><span class="p">:</span> <span class="n">age</span><span class="p">,</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>            <span class="s2">&quot;AdjMeanYieldDiff&quot;</span><span class="p">:</span> <span class="n">diff</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>        <span class="p">})</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a><span class="n">df_adj</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;GridDay&quot;</span><span class="p">,</span> <span class="s2">&quot;AgeClass&quot;</span><span class="p">])</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a><span class="nb">print</span><span class="p">(</span><span class="n">df_adj</span><span class="p">)</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a><span class="n">df_adj</span><span class="o">.</span><span class="n">dtypes</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a><span class="c1"># # %%</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a><span class="c1"># # visualize results to see if they make sense</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a><span class="c1"># import seaborn as sns</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a><span class="c1">#</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a><span class="c1"># sns.lineplot(</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a><span class="c1">#     data=df_adj,</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a><span class="c1">#     x=&quot;GridDay&quot;,</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a><span class="c1">#     y=&quot;AdjMeanYieldDiff&quot;,</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="c1">#     hue=&quot;AgeClass&quot;</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a><span class="c1"># )</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a><span class="c1">#</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="c1"># %%</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="c1"># The values for age class 22-24 are fitted to a lactation curve model</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="k">def</span><span class="w"> </span><span class="nf">lc_model</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a><span class="n">age_class_one</span> <span class="o">=</span> <span class="n">df_adj</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;AdjMeanYield&#39;</span><span class="p">])</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a><span class="n">x</span> <span class="o">=</span> <span class="n">age_class_one</span><span class="p">[</span><span class="s1">&#39;GridDay&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a><span class="n">y</span> <span class="o">=</span> <span class="n">age_class_one</span><span class="p">[</span><span class="s1">&#39;AdjMeanYield&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a><span class="c1"># Fit model</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">lc_model</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="n">a_fit</span><span class="p">,</span> <span class="n">b_fit</span><span class="p">,</span> <span class="n">c_fit</span><span class="p">,</span> <span class="n">d_fit</span> <span class="o">=</span> <span class="n">popt</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="c1"># Get fitted values</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="n">y_fit</span> <span class="o">=</span> <span class="n">lc_model</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a_fit</span><span class="p">,</span> <span class="n">b_fit</span><span class="p">,</span> <span class="n">c_fit</span><span class="p">,</span> <span class="n">d_fit</span><span class="p">)</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="nb">print</span><span class="p">(</span><span class="n">popt</span><span class="p">)</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a><span class="c1"># %%</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a><span class="c1"># visualize LC to sea if it makes sense</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a><span class="c1"># --- Plot ---</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_fit</span><span class="p">,</span> <span class="s1">&#39;k.&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Age_class_22-24&#39;</span><span class="p">)</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;DIM (Days In Milk)&#39;</span><span class="p">)</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Milk (kg)&#39;</span><span class="p">)</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Lactation Curve Fitting&#39;</span><span class="p">)</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="c1"># %%</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="c1"># Now the difference for the different age classes are fitted to another model separate for each age class.</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="c1"># define model</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="k">def</span><span class="w"> </span><span class="nf">dif_model</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="c1"># Drop the rows where age class is the baseline age class</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="n">age_class_not_one</span> <span class="o">=</span> <span class="n">df_adj</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;AdjMeanYieldDiff&#39;</span><span class="p">])</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a><span class="n">a_t</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a><span class="n">b_t</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a><span class="n">c_t</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a><span class="k">for</span> <span class="n">age_class</span> <span class="ow">in</span> <span class="n">age_class_not_one</span><span class="p">[</span><span class="s1">&#39;AgeClass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>    <span class="n">sub</span> <span class="o">=</span> <span class="n">age_class_not_one</span><span class="p">[</span><span class="n">age_class_not_one</span><span class="p">[</span><span class="s1">&#39;AgeClass&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">age_class</span><span class="p">]</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>    <span class="n">x_dif</span> <span class="o">=</span> <span class="n">sub</span><span class="p">[</span><span class="s1">&#39;GridDay&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>    <span class="n">y_dif</span> <span class="o">=</span> <span class="n">sub</span><span class="p">[</span><span class="s1">&#39;AdjMeanYieldDiff&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>    <span class="c1"># fit model</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>    <span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">dif_model</span><span class="p">,</span> <span class="n">x_dif</span><span class="p">,</span> <span class="n">y_dif</span><span class="p">)</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>    <span class="n">a_dif</span><span class="p">,</span> <span class="n">b_dif</span><span class="p">,</span> <span class="n">c_dif</span> <span class="o">=</span> <span class="n">popt</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>    <span class="c1"># store in dictionaries with age_class as key</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>    <span class="n">a_t</span><span class="p">[</span><span class="n">age_class</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_dif</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>    <span class="n">b_t</span><span class="p">[</span><span class="n">age_class</span><span class="p">]</span> <span class="o">=</span> <span class="n">b_dif</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>    <span class="n">c_t</span><span class="p">[</span><span class="n">age_class</span><span class="p">]</span> <span class="o">=</span> <span class="n">c_dif</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a><span class="nb">print</span><span class="p">(</span><span class="n">c_t</span><span class="p">)</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a><span class="c1"># %%</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a><span class="c1"># Now the different parameter values of all of the age classes are combined into two equations, whereby t = age of the cow in months.</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a><span class="c1"># Age classes for parity 1 and 2</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="n">age_classes_parity_one_two</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;25-27&quot;</span><span class="p">,</span> <span class="s2">&quot;28-32&quot;</span><span class="p">,</span> <span class="s2">&quot;33-37&quot;</span><span class="p">,</span> <span class="s2">&quot;38-44&quot;</span><span class="p">]</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="c1"># Model: parameter as linear function of t</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a><span class="k">def</span><span class="w"> </span><span class="nf">model_param_t_low_par</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>    <span class="k">return</span> <span class="n">p</span> <span class="o">+</span> <span class="n">q</span> <span class="o">*</span> <span class="n">t</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a><span class="c1"># Helper: subset dict</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a><span class="k">def</span><span class="w"> </span><span class="nf">subset_dict</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">keys_to_include</span><span class="p">):</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>    <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys_to_include</span><span class="p">}</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a><span class="c1"># Extract parameter values</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a><span class="n">a_par_one_two</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">subset_dict</span><span class="p">(</span><span class="n">a_t</span><span class="p">,</span> <span class="n">age_classes_parity_one_two</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a><span class="n">b_par_one_two</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">subset_dict</span><span class="p">(</span><span class="n">b_t</span><span class="p">,</span> <span class="n">age_classes_parity_one_two</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a><span class="n">c_par_one_two</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">subset_dict</span><span class="p">(</span><span class="n">c_t</span><span class="p">,</span> <span class="n">age_classes_parity_one_two</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a><span class="c1"># Convert age class ranges into average months</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a><span class="n">averages</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a><span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">age_classes_parity_one_two</span><span class="p">:</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>    <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">))</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>    <span class="n">avg</span> <span class="o">=</span> <span class="p">(</span><span class="n">low</span> <span class="o">+</span> <span class="n">high</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>    <span class="n">averages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">avg</span><span class="p">)</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a><span class="c1"># --- Fit models ---</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a><span class="c1"># param a</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a><span class="n">popt_a_low</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">model_param_t_low_par</span><span class="p">,</span> <span class="n">averages</span><span class="p">,</span> <span class="n">a_par_one_two</span><span class="p">)</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a><span class="n">p_a_low</span><span class="p">,</span> <span class="n">q_a_low</span> <span class="o">=</span> <span class="n">popt_a_low</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a><span class="c1"># param b</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a><span class="n">popt_b_low</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">model_param_t_low_par</span><span class="p">,</span> <span class="n">averages</span><span class="p">,</span> <span class="n">b_par_one_two</span><span class="p">)</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a><span class="n">p_b_low</span><span class="p">,</span> <span class="n">q_b_low</span> <span class="o">=</span> <span class="n">popt_b_low</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a><span class="c1"># param c</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a><span class="n">popt_c_low</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">model_param_t_low_par</span><span class="p">,</span> <span class="n">averages</span><span class="p">,</span> <span class="n">c_par_one_two</span><span class="p">)</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a><span class="n">p_c_low</span><span class="p">,</span> <span class="n">q_c_low</span> <span class="o">=</span> <span class="n">popt_c_low</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Param a fit parity 1-2:&quot;</span><span class="p">,</span> <span class="n">p_a_low</span><span class="p">,</span> <span class="n">q_a_low</span><span class="p">)</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Param b fit parity 1-2:&quot;</span><span class="p">,</span> <span class="n">p_b_low</span><span class="p">,</span> <span class="n">q_b_low</span><span class="p">)</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Param c fit parity 1-2:&quot;</span><span class="p">,</span> <span class="n">p_c_low</span><span class="p">,</span> <span class="n">q_c_low</span><span class="p">)</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="c1"># Now do the same for parity three and up</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="n">age_classes_parity_three</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;45-56&quot;</span><span class="p">,</span> <span class="s2">&quot;57-68&quot;</span><span class="p">,</span> <span class="s2">&quot;69-92&quot;</span><span class="p">,</span> <span class="s2">&quot;93-104&quot;</span><span class="p">,</span> <span class="s2">&quot;105+&quot;</span><span class="p">]</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a><span class="c1"># define model</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a><span class="k">def</span><span class="w"> </span><span class="nf">model_param_t_high_par</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>    <span class="k">return</span> <span class="n">p</span> <span class="o">+</span> <span class="n">q</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a><span class="c1"># Extract parameter values</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a><span class="n">a_par_three</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">subset_dict</span><span class="p">(</span><span class="n">a_t</span><span class="p">,</span> <span class="n">age_classes_parity_three</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a><span class="n">b_par_three</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">subset_dict</span><span class="p">(</span><span class="n">b_t</span><span class="p">,</span> <span class="n">age_classes_parity_three</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a><span class="n">c_par_three</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">subset_dict</span><span class="p">(</span><span class="n">c_t</span><span class="p">,</span> <span class="n">age_classes_parity_three</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a><span class="c1"># Convert age class ranges into average months, last category 105+ is set to be 105</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a><span class="n">averages</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a><span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">age_classes_parity_three</span><span class="p">:</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>        <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">))</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>        <span class="n">avg</span> <span class="o">=</span> <span class="p">(</span><span class="n">low</span> <span class="o">+</span> <span class="n">high</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>        <span class="n">averages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">avg</span><span class="p">)</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>        <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>        <span class="n">averages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="c1"># --- Fit models ---</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a><span class="c1"># param a</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a><span class="n">popt_a_high</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">model_param_t_high_par</span><span class="p">,</span> <span class="n">averages</span><span class="p">,</span> <span class="n">a_par_three</span><span class="p">)</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a><span class="n">p_a_high</span><span class="p">,</span> <span class="n">q_a_high</span><span class="p">,</span> <span class="n">r_a_high</span> <span class="o">=</span> <span class="n">popt_a_high</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a><span class="c1"># param b</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a><span class="n">popt_b_high</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">model_param_t_high_par</span><span class="p">,</span> <span class="n">averages</span><span class="p">,</span> <span class="n">b_par_three</span><span class="p">)</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a><span class="n">p_b_high</span><span class="p">,</span> <span class="n">q_b_high</span><span class="p">,</span> <span class="n">r_b_high</span> <span class="o">=</span> <span class="n">popt_b_high</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a><span class="c1"># param c</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a><span class="n">popt_c_high</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">model_param_t_high_par</span><span class="p">,</span> <span class="n">averages</span><span class="p">,</span> <span class="n">c_par_three</span><span class="p">)</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a><span class="n">p_c_high</span><span class="p">,</span> <span class="n">q_c_high</span><span class="p">,</span> <span class="n">r_c_high</span> <span class="o">=</span> <span class="n">popt_c_high</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Param a fit parity &gt;3:&quot;</span><span class="p">,</span> <span class="n">p_a_high</span><span class="p">,</span> <span class="n">q_a_high</span><span class="p">,</span> <span class="n">r_a_high</span><span class="p">)</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Param b fit parity &gt;3:&quot;</span><span class="p">,</span> <span class="n">p_b_high</span><span class="p">,</span> <span class="n">q_b_high</span><span class="p">,</span> <span class="n">r_b_high</span><span class="p">)</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Param c fit parity &gt;3:&quot;</span><span class="p">,</span> <span class="n">p_c_high</span><span class="p">,</span> <span class="n">q_c_high</span><span class="p">,</span> <span class="n">r_c_high</span><span class="p">)</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a><span class="c1"># %%</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a><span class="c1"># now create final correction factor for age, base level is 24 months of calving</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a><span class="k">def</span><span class="w"> </span><span class="nf">correction_factor_age</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply selfmade multiplicative correction to a milkyield at days in milk (t), based on a correction.</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a><span class="sd">    input:</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a><span class="sd">    x (int)= x the age of the animal at calving that was measured in months</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a><span class="sd">    base (int): age at calving in month of referenc animal &gt; lactation you want to correct to</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a><span class="sd">    t (int) = days in milk of milk measurement</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a><span class="sd">    output (numpy float): multiplicative correction factor &quot;&quot;&quot;</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>    <span class="n">level_x</span> <span class="o">=</span> <span class="n">lc_model</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a_fit</span><span class="p">,</span> <span class="n">b_fit</span><span class="p">,</span> <span class="n">c_fit</span><span class="p">,</span> <span class="n">d_fit</span><span class="p">)</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>    <span class="c1"># calculate the base (two versions depending on the parity of the base)</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>    <span class="k">if</span> <span class="n">base</span> <span class="o">&lt;</span> <span class="mi">45</span><span class="p">:</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>        <span class="n">a_base</span> <span class="o">=</span> <span class="n">model_param_t_low_par</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">p_a_low</span><span class="p">,</span> <span class="n">q_a_low</span><span class="p">)</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>        <span class="n">b_base</span> <span class="o">=</span> <span class="n">model_param_t_low_par</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">p_b_low</span><span class="p">,</span> <span class="n">q_b_low</span><span class="p">)</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>        <span class="n">c_base</span> <span class="o">=</span> <span class="n">model_param_t_low_par</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">p_a_low</span><span class="p">,</span> <span class="n">q_a_low</span><span class="p">)</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>        <span class="n">a_base</span> <span class="o">=</span> <span class="n">model_param_t_high_par</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">p_a_high</span><span class="p">,</span> <span class="n">q_a_high</span><span class="p">,</span> <span class="n">r_a_high</span><span class="p">)</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>        <span class="n">b_base</span> <span class="o">=</span> <span class="n">model_param_t_high_par</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">p_b_high</span><span class="p">,</span> <span class="n">q_b_high</span><span class="p">,</span> <span class="n">r_b_high</span><span class="p">)</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>        <span class="n">c_base</span> <span class="o">=</span> <span class="n">model_param_t_high_par</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">p_c_high</span><span class="p">,</span> <span class="n">q_c_high</span><span class="p">,</span> <span class="n">r_c_high</span><span class="p">)</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>    <span class="n">base</span> <span class="o">=</span> <span class="n">level_x</span> <span class="o">+</span> <span class="n">a_base</span> <span class="o">+</span> <span class="n">b_base</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">c_base</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>    <span class="c1"># filter for parity</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>    <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">45</span><span class="p">:</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>        <span class="n">a_t</span> <span class="o">=</span> <span class="n">model_param_t_low_par</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">p_a_low</span><span class="p">,</span> <span class="n">q_a_low</span><span class="p">)</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>        <span class="n">b_t</span> <span class="o">=</span> <span class="n">model_param_t_low_par</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">p_b_low</span><span class="p">,</span> <span class="n">q_b_low</span><span class="p">)</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>        <span class="n">c_t</span> <span class="o">=</span> <span class="n">model_param_t_low_par</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">p_a_low</span><span class="p">,</span> <span class="n">q_a_low</span><span class="p">)</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>        <span class="n">a_t</span> <span class="o">=</span> <span class="n">model_param_t_high_par</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">p_a_high</span><span class="p">,</span> <span class="n">q_a_high</span><span class="p">,</span> <span class="n">r_a_high</span><span class="p">)</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>        <span class="n">b_t</span> <span class="o">=</span> <span class="n">model_param_t_high_par</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">p_b_high</span><span class="p">,</span> <span class="n">q_b_high</span><span class="p">,</span> <span class="n">r_b_high</span><span class="p">)</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>        <span class="n">c_t</span> <span class="o">=</span> <span class="n">model_param_t_high_par</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">p_c_high</span><span class="p">,</span> <span class="n">q_c_high</span><span class="p">,</span> <span class="n">r_c_high</span><span class="p">)</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>    <span class="n">numerator</span> <span class="o">=</span> <span class="n">level_x</span> <span class="o">+</span> <span class="n">a_t</span> <span class="o">+</span> <span class="n">b_t</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">c_t</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>    <span class="n">correction_factor</span> <span class="o">=</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">base</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>    <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">correction_factor</span>  <span class="c1"># this does not follow the original but otherwise the results do not make sense so apply correction factor as 1/correction factor</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a><span class="nb">print</span><span class="p">(</span><span class="n">correction_factor_age</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a><span class="c1"># %% md</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a><span class="c1"># ## Calving season</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a><span class="c1"># %% md</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a><span class="c1"># Wilmink says about this: In deriving adjustment factors for month of calving, month effects were computed from the season effects in Model 1 by interpolation and smoothing, using routine ICSSVC (IMSL, 1980). Adjustment was in an additive manner, because the effect of season of calving was independent of production level, as reported by Wilmink (1985).</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a><span class="c1"># </span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a><span class="c1"># ICSSVC is a Fortran package, so we will not use this and instead try to do the same in Python.</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a><span class="c1"># %%</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a><span class="c1"># months were devided into two month periods for model 1. We will take the middle month as reference point</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a><span class="c1"># from model 1 we have the calving_season_coefs</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a><span class="n">season_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\[T\.(.*)\]&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">calving_season_coefs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a><span class="n">season_midpoints</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>    <span class="s2">&quot;Dec-Jan&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>    <span class="s2">&quot;Feb-Mar&quot;</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>    <span class="s2">&quot;Jun-Jul&quot;</span><span class="p">:</span> <span class="mf">6.5</span><span class="p">,</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>    <span class="s2">&quot;Aug-Sep&quot;</span><span class="p">:</span> <span class="mf">8.5</span><span class="p">,</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>    <span class="s2">&quot;Oct-Nov&quot;</span><span class="p">:</span> <span class="mf">10.5</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a><span class="p">}</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a><span class="n">season_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>    <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">season_midpoints</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">season_dict</span><span class="p">],</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>    <span class="s2">&quot;coef&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">season_dict</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">season_dict</span><span class="p">]</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a><span class="p">})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;month&quot;</span><span class="p">)</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a><span class="c1"># extend for periodicity</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a><span class="n">months_ext</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">season_df</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">],</span> <span class="mf">13.0</span><span class="p">]</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a><span class="n">coef_ext</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">season_df</span><span class="p">[</span><span class="s2">&quot;coef&quot;</span><span class="p">],</span> <span class="n">season_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">season_df</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;coef&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a><span class="n">spl</span> <span class="o">=</span> <span class="n">UnivariateSpline</span><span class="p">(</span><span class="n">months_ext</span><span class="p">,</span> <span class="n">coef_ext</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a><span class="n">months_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a><span class="n">correction_factors</span> <span class="o">=</span> <span class="n">spl</span><span class="p">(</span><span class="n">months_full</span><span class="p">)</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a><span class="n">correction_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>    <span class="s2">&quot;Month&quot;</span><span class="p">:</span> <span class="n">months_full</span><span class="p">,</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>    <span class="s2">&quot;CorrectionFactor&quot;</span><span class="p">:</span> <span class="n">correction_factors</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a><span class="p">})</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a><span class="c1"># month 1 is January</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a><span class="c1"># print(correction_df)</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a><span class="c1"># save file</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a><span class="c1"># correction_df.to_csv(r&#39;C:\Users\Meike van Leerdam\lactation-curves\Cumulative_production_ICAR_Guidelines\correction_factors_calving_season.csv&#39;, index = False)</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a><span class="c1"># %%</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a><span class="c1"># Plot smoothed monthly curve</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">correction_df</span><span class="p">[</span><span class="s2">&quot;Month&quot;</span><span class="p">],</span> <span class="n">correction_df</span><span class="p">[</span><span class="s2">&quot;CorrectionFactor&quot;</span><span class="p">],</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>         <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Smoothed correction&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a><span class="c1"># Plot the raw seasonal midpoints</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">season_df</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">],</span> <span class="n">season_df</span><span class="p">[</span><span class="s2">&quot;coef&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Model coefficients&quot;</span><span class="p">)</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a><span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>           <span class="p">[</span><span class="s2">&quot;Jan&quot;</span><span class="p">,</span> <span class="s2">&quot;Feb&quot;</span><span class="p">,</span> <span class="s2">&quot;Mar&quot;</span><span class="p">,</span> <span class="s2">&quot;Apr&quot;</span><span class="p">,</span> <span class="s2">&quot;May&quot;</span><span class="p">,</span> <span class="s2">&quot;Jun&quot;</span><span class="p">,</span> <span class="s2">&quot;Jul&quot;</span><span class="p">,</span> <span class="s2">&quot;Aug&quot;</span><span class="p">,</span> <span class="s2">&quot;Sep&quot;</span><span class="p">,</span> <span class="s2">&quot;Oct&quot;</span><span class="p">,</span> <span class="s2">&quot;Nov&quot;</span><span class="p">,</span> <span class="s2">&quot;Dec&quot;</span><span class="p">],</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>           <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Month of Calving&quot;</span><span class="p">)</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Correction Factor&quot;</span><span class="p">)</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Smoothed Calving Season Correction Curve&quot;</span><span class="p">)</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a><span class="c1"># %% md</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a><span class="c1">#</span>
</span></pre>
        </div>
      </section>
      <section id="data_path">
        <div class="attr variable">
          <span class="name">data_path</span> =
          <input
            id="data_path-view-value"
            class="view-value-toggle-state"
            type="checkbox"
            aria-hidden="true"
            tabindex="-1"
          />
          <label
            class="view-value-button pdoc-button"
            for="data_path-view-value"
          ></label
          ><span class="default_value"
            >WindowsPath(&#39;C:/Users/Meike van
            Leerdam/lactation-curves/lactationcurve/tests/TestData/MRtestFile.csv&#39;)</span
          >
        </div>
        <a class="headerlink" href="#data_path"></a>
      </section>
      <section id="df">
        <div class="attr variable">
          <span class="name">df</span> =
          <input
            id="df-view-value"
            class="view-value-toggle-state"
            type="checkbox"
            aria-hidden="true"
            tabindex="-1"
          />
          <label
            class="view-value-button pdoc-button"
            for="df-view-value"
          ></label
          ><span class="default_value">
            BirthDate DaysInMilk Parity MilkingYield TestDate TestId CalvingDate
            AgeAtCalvingDays AgeAtCalvingMonths AgeClass CalvingSeason 0
            2017-08-26 27 1 23.6 2019-08-20 3781 2019-07-24 697 22.897503 22-24
            Jun-Jul 1 2017-08-26 64 1 23.1 2019-09-26 3781 2019-07-24 697
            22.897503 22-24 Jun-Jul 2 2017-08-26 98 1 23.7 2019-10-30 3781
            2019-07-24 697 22.897503 22-24 Jun-Jul 3 2017-08-26 132 1 24.1
            2019-12-03 3781 2019-07-24 697 22.897503 22-24 Jun-Jul 4 2017-08-26
            174 1 25.9 2020-01-14 3781 2019-07-24 697 22.897503 22-24 Jun-Jul
            ... ... ... ... ... ... ... ... ... ... ... ... 33340 2016-01-21 13
            4 14.1 2022-01-26 3518 2022-01-13 2184 71.747700 69-92 Dec-Jan 33341
            2016-01-21 54 4 14.2 2022-03-08 3518 2022-01-13 2184 71.747700 69-92
            Dec-Jan 33342 2016-01-21 90 4 10.9 2022-04-13 3518 2022-01-13 2184
            71.747700 69-92 Dec-Jan 33343 2016-01-21 125 4 9.6 2022-05-18 3518
            2022-01-13 2184 71.747700 69-92 Dec-Jan 33344 2016-01-21 162 4 6.1
            2022-06-24 3518 2022-01-13 2184 71.747700 69-92 Dec-Jan [32617 rows
            x 11 columns]</span
          >
        </div>
        <a class="headerlink" href="#df"></a>
      </section>
      <section id="bin_edges">
        <div class="attr variable">
          <span class="name">bin_edges</span> =
          <span class="default_value"
            >[22, 25, 28, 33, 38, 45, 57, 69, 93, 105, inf]</span
          >
        </div>
        <a class="headerlink" href="#bin_edges"></a>
      </section>
      <section id="labels">
        <div class="attr variable">
          <span class="name">labels</span> =
          <span class="default_value"
            >[&#39;22-24&#39;, &#39;25-27&#39;, &#39;28-32&#39;,
            &#39;33-37&#39;, &#39;38-44&#39;, &#39;45-56&#39;, &#39;57-68&#39;,
            &#39;69-92&#39;, &#39;93-104&#39;, &#39;105+&#39;]</span
          >
        </div>
        <a class="headerlink" href="#labels"></a>
      </section>
      <section id="season_labels">
        <div class="attr variable">
          <span class="name">season_labels</span> =
          <span class="default_value"
            >[&#39;Aug-Sep&#39;, &#39;Oct-Nov&#39;, &#39;Dec-Jan&#39;,
            &#39;Feb-Mar&#39;, &#39;Apr-May&#39;, &#39;Jun-Jul&#39;]</span
          >
        </div>
        <a class="headerlink" href="#season_labels"></a>
      </section>
      <section id="shifted_month">
        <div class="attr variable">
          <span class="name">shifted_month</span> =
          <input
            id="shifted_month-view-value"
            class="view-value-toggle-state"
            type="checkbox"
            aria-hidden="true"
            tabindex="-1"
          />
          <label
            class="view-value-button pdoc-button"
            for="shifted_month-view-value"
          ></label
          ><span class="default_value"
            >0 11 1 11 2 11 3 11 4 11 .. 33341 5 33342 5 33343 5 33344 5 33345 8
            Name: CalvingDate, Length: 33346, dtype: int32</span
          >
        </div>
        <a class="headerlink" href="#shifted_month"></a>
      </section>
      <section id="counts">
        <div class="attr variable">
          <span class="name">counts</span> =
          <input
            id="counts-view-value"
            class="view-value-toggle-state"
            type="checkbox"
            aria-hidden="true"
            tabindex="-1"
          />
          <label
            class="view-value-button pdoc-button"
            for="counts-view-value"
          ></label
          ><span class="default_value"
            >TestId 0 7 1 6 2 7 3 7 4 7 .. 4315 3 4316 3 4317 3 4322 1 4324 1
            Name: DaysInMilk, Length: 4259, dtype: int64</span
          >
        </div>
        <a class="headerlink" href="#counts"></a>
      </section>
      <section id="valid_ids">
        <div class="attr variable">
          <span class="name">valid_ids</span> =
          <input
            id="valid_ids-view-value"
            class="view-value-toggle-state"
            type="checkbox"
            aria-hidden="true"
            tabindex="-1"
          />
          <label
            class="view-value-button pdoc-button"
            for="valid_ids-view-value"
          ></label
          ><span class="default_value"
            >Index([ 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, ... 4307, 4308, 4309, 4310,
            4311, 4313, 4314, 4315, 4316, 4317], dtype=&#39;int64&#39;,
            name=&#39;TestId&#39;, length=4069)</span
          >
        </div>
        <a class="headerlink" href="#valid_ids"></a>
      </section>
      <section id="grid">
        <div class="attr variable">
          <span class="name">grid</span> =
          <span class="default_value"
            >[10, 30, 50, 70, 90, 110, 130, 150, 170, 190, 210, 230, 250, 270,
            290]</span
          >
        </div>
        <a class="headerlink" href="#grid"></a>
      </section>
      <section id="interpolate_to_grid">
        <input
          id="interpolate_to_grid-view-source"
          class="view-source-toggle-state"
          type="checkbox"
          aria-hidden="true"
          tabindex="-1"
        />
        <div class="attr function">
          <span class="def">def</span>
          <span class="name">interpolate_to_grid</span
          ><span class="signature pdoc-code condensed"
            >(<span class="param"><span class="n">group</span></span
            ><span class="return-annotation">):</span></span
          >

          <label
            class="view-source-button"
            for="interpolate_to_grid-view-source"
            ><span>View Source</span></label
          >
        </div>
        <a class="headerlink" href="#interpolate_to_grid"></a>
        <div class="pdoc-code codehilite">
          <pre><span></span><span id="interpolate_to_grid-95"><a href="#interpolate_to_grid-95"><span class="linenos"> 95</span></a><span class="k">def</span><span class="w"> </span><span class="nf">interpolate_to_grid</span><span class="p">(</span><span class="n">group</span><span class="p">):</span>
</span><span id="interpolate_to_grid-96"><a href="#interpolate_to_grid-96"><span class="linenos"> 96</span></a>    <span class="c1"># Sort by DIM</span>
</span><span id="interpolate_to_grid-97"><a href="#interpolate_to_grid-97"><span class="linenos"> 97</span></a>    <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;DaysInMilk&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="s2">&quot;DaysInMilk&quot;</span><span class="p">)</span>
</span><span id="interpolate_to_grid-98"><a href="#interpolate_to_grid-98"><span class="linenos"> 98</span></a>
</span><span id="interpolate_to_grid-99"><a href="#interpolate_to_grid-99"><span class="linenos"> 99</span></a>    <span class="c1"># interpolation function with extrapolation allowed</span>
</span><span id="interpolate_to_grid-100"><a href="#interpolate_to_grid-100"><span class="linenos">100</span></a>    <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="s2">&quot;DaysInMilk&quot;</span><span class="p">],</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;MilkingYield&quot;</span><span class="p">],</span>
</span><span id="interpolate_to_grid-101"><a href="#interpolate_to_grid-101"><span class="linenos">101</span></a>                 <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;extrapolate&quot;</span><span class="p">)</span>
</span><span id="interpolate_to_grid-102"><a href="#interpolate_to_grid-102"><span class="linenos">102</span></a>
</span><span id="interpolate_to_grid-103"><a href="#interpolate_to_grid-103"><span class="linenos">103</span></a>    <span class="c1"># Build new df with grid</span>
</span><span id="interpolate_to_grid-104"><a href="#interpolate_to_grid-104"><span class="linenos">104</span></a>    <span class="n">new_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
</span><span id="interpolate_to_grid-105"><a href="#interpolate_to_grid-105"><span class="linenos">105</span></a>        <span class="s2">&quot;TestId&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;TestId&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="interpolate_to_grid-106"><a href="#interpolate_to_grid-106"><span class="linenos">106</span></a>        <span class="s2">&quot;GridDay&quot;</span><span class="p">:</span> <span class="n">grid</span><span class="p">,</span>
</span><span id="interpolate_to_grid-107"><a href="#interpolate_to_grid-107"><span class="linenos">107</span></a>        <span class="s2">&quot;MilkYieldInterp&quot;</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">grid</span><span class="p">),</span>
</span><span id="interpolate_to_grid-108"><a href="#interpolate_to_grid-108"><span class="linenos">108</span></a>        <span class="s2">&quot;AgeClass&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;AgeClass&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="interpolate_to_grid-109"><a href="#interpolate_to_grid-109"><span class="linenos">109</span></a>        <span class="s2">&quot;CalvingSeason&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;CalvingSeason&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="interpolate_to_grid-110"><a href="#interpolate_to_grid-110"><span class="linenos">110</span></a>    <span class="p">})</span>
</span><span id="interpolate_to_grid-111"><a href="#interpolate_to_grid-111"><span class="linenos">111</span></a>    <span class="k">return</span> <span class="n">new_df</span>
</span></pre>
        </div>
      </section>
      <section id="df_grid">
        <div class="attr variable">
          <span class="name">df_grid</span> =
          <input
            id="df_grid-view-value"
            class="view-value-toggle-state"
            type="checkbox"
            aria-hidden="true"
            tabindex="-1"
          />
          <label
            class="view-value-button pdoc-button"
            for="df_grid-view-value"
          ></label
          ><span class="default_value">
            TestId GridDay MilkYieldInterp AgeClass CalvingSeason 0 0 10
            35.400000 105+ Dec-Jan 1 0 30 37.595122 105+ Dec-Jan 2 0 50
            39.790244 105+ Dec-Jan 3 0 70 35.914634 105+ Dec-Jan 4 0 90
            31.719512 105+ Dec-Jan ... ... ... ... ... ... 61030 4317 210
            6.975510 22-24 Feb-Mar 61031 4317 230 4.322449 22-24 Feb-Mar 61032
            4317 250 1.669388 22-24 Feb-Mar 61033 4317 270 -0.983673 22-24
            Feb-Mar 61034 4317 290 -3.636735 22-24 Feb-Mar [61035 rows x 5
            columns]</span
          >
        </div>
        <a class="headerlink" href="#df_grid"></a>
      </section>
      <section id="model">
        <div class="attr variable">
          <span class="name">model</span> =
          <span class="default_value"
            >&lt;statsmodels.regression.linear_model.RegressionResultsWrapper
            object&gt;</span
          >
        </div>
        <a class="headerlink" href="#model"></a>
      </section>
      <section id="ageclass_coefs">
        <div class="attr variable">
          <span class="name">ageclass_coefs</span> =
          <input
            id="ageclass_coefs-view-value"
            class="view-value-toggle-state"
            type="checkbox"
            aria-hidden="true"
            tabindex="-1"
          />
          <label
            class="view-value-button pdoc-button"
            for="ageclass_coefs-view-value"
          ></label
          ><span class="default_value"
            >C(AgeClass)[T.22-24] -2.734804 C(AgeClass)[T.25-27] -2.211606
            C(AgeClass)[T.28-32] -0.982162 C(AgeClass)[T.33-37] 1.532096
            C(AgeClass)[T.38-44] 3.697147 C(AgeClass)[T.45-56] 3.627801
            C(AgeClass)[T.57-68] 4.004640 C(AgeClass)[T.69-92] 3.536557
            C(AgeClass)[T.93-104] 2.569699 dtype: float64</span
          >
        </div>
        <a class="headerlink" href="#ageclass_coefs"></a>
      </section>
      <section id="calving_season_coefs">
        <div class="attr variable">
          <span class="name">calving_season_coefs</span> =
          <input
            id="calving_season_coefs-view-value"
            class="view-value-toggle-state"
            type="checkbox"
            aria-hidden="true"
            tabindex="-1"
          />
          <label
            class="view-value-button pdoc-button"
            for="calving_season_coefs-view-value"
          ></label
          ><span class="default_value"
            >C(CalvingSeason)[T.Aug-Sep] -1.486395 C(CalvingSeason)[T.Dec-Jan]
            0.737406 C(CalvingSeason)[T.Feb-Mar] 0.285529
            C(CalvingSeason)[T.Jun-Jul] -1.700071 C(CalvingSeason)[T.Oct-Nov]
            0.413327 dtype: float64</span
          >
        </div>
        <a class="headerlink" href="#calving_season_coefs"></a>
      </section>
      <section id="results">
        <div class="attr variable">
          <span class="name">results</span> =
          <input
            id="results-view-value"
            class="view-value-toggle-state"
            type="checkbox"
            aria-hidden="true"
            tabindex="-1"
          />
          <label
            class="view-value-button pdoc-button"
            for="results-view-value"
          ></label
          ><span class="default_value"
            >[{&#39;GridDay&#39;: np.int64(10), &#39;AgeClass&#39;:
            &#39;22-24&#39;, &#39;AdjMeanYield&#39;:
            np.float64(25.631057250541204)}, {&#39;GridDay&#39;: np.int64(10),
            &#39;AgeClass&#39;: &#39;105+&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(11.384254089934624)}, {&#39;GridDay&#39;: np.int64(10),
            &#39;AgeClass&#39;: &#39;45-56&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(13.273780898337446)}, {&#39;GridDay&#39;: np.int64(10),
            &#39;AgeClass&#39;: &#39;57-68&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(13.93014028574745)}, {&#39;GridDay&#39;: np.int64(10),
            &#39;AgeClass&#39;: &#39;69-92&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(13.558790596228954)}, {&#39;GridDay&#39;: np.int64(10),
            &#39;AgeClass&#39;: &#39;93-104&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(11.963274329366529)}, {&#39;GridDay&#39;: np.int64(10),
            &#39;AgeClass&#39;: &#39;38-44&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(12.275593459833383)}, {&#39;GridDay&#39;: np.int64(10),
            &#39;AgeClass&#39;: &#39;33-37&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(9.845250892293606)}, {&#39;GridDay&#39;: np.int64(10),
            &#39;AgeClass&#39;: &#39;28-32&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(2.388178895500342)}, {&#39;GridDay&#39;: np.int64(10),
            &#39;AgeClass&#39;: &#39;25-27&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(0.5926975231609941)}, {&#39;GridDay&#39;: np.int64(30),
            &#39;AgeClass&#39;: &#39;22-24&#39;, &#39;AdjMeanYield&#39;:
            np.float64(27.78191136451184)}, {&#39;GridDay&#39;: np.int64(30),
            &#39;AgeClass&#39;: &#39;105+&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(10.969280318822365)}, {&#39;GridDay&#39;: np.int64(30),
            &#39;AgeClass&#39;: &#39;45-56&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(12.94877448593799)}, {&#39;GridDay&#39;: np.int64(30),
            &#39;AgeClass&#39;: &#39;57-68&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(13.906219849690428)}, {&#39;GridDay&#39;: np.int64(30),
            &#39;AgeClass&#39;: &#39;69-92&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(13.541315283121444)}, {&#39;GridDay&#39;: np.int64(30),
            &#39;AgeClass&#39;: &#39;93-104&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(11.945496028533707)}, {&#39;GridDay&#39;: np.int64(30),
            &#39;AgeClass&#39;: &#39;38-44&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(12.020462858152401)}, {&#39;GridDay&#39;: np.int64(30),
            &#39;AgeClass&#39;: &#39;33-37&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(9.167200596369641)}, {&#39;GridDay&#39;: np.int64(30),
            &#39;AgeClass&#39;: &#39;28-32&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(2.273027867109361)}, {&#39;GridDay&#39;: np.int64(30),
            &#39;AgeClass&#39;: &#39;25-27&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(0.5342546848959637)}, {&#39;GridDay&#39;: np.int64(50),
            &#39;AgeClass&#39;: &#39;22-24&#39;, &#39;AdjMeanYield&#39;:
            np.float64(29.393460663507295)}, {&#39;GridDay&#39;: np.int64(50),
            &#39;AgeClass&#39;: &#39;105+&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(10.44461832469051)}, {&#39;GridDay&#39;: np.int64(50),
            &#39;AgeClass&#39;: &#39;45-56&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(12.40357476243453)}, {&#39;GridDay&#39;: np.int64(50),
            &#39;AgeClass&#39;: &#39;57-68&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(13.617570202559401)}, {&#39;GridDay&#39;: np.int64(50),
            &#39;AgeClass&#39;: &#39;69-92&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(13.207029832590596)}, {&#39;GridDay&#39;: np.int64(50),
            &#39;AgeClass&#39;: &#39;93-104&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(11.382594306435788)}, {&#39;GridDay&#39;: np.int64(50),
            &#39;AgeClass&#39;: &#39;38-44&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(11.342160057397495)}, {&#39;GridDay&#39;: np.int64(50),
            &#39;AgeClass&#39;: &#39;33-37&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(8.398592757764668)}, {&#39;GridDay&#39;: np.int64(50),
            &#39;AgeClass&#39;: &#39;28-32&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(2.190873136649529)}, {&#39;GridDay&#39;: np.int64(50),
            &#39;AgeClass&#39;: &#39;25-27&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(0.6190506999525427)}, {&#39;GridDay&#39;: np.int64(70),
            &#39;AgeClass&#39;: &#39;22-24&#39;, &#39;AdjMeanYield&#39;:
            np.float64(29.55281518126297)}, {&#39;GridDay&#39;: np.int64(70),
            &#39;AgeClass&#39;: &#39;105+&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(9.176827598155727)}, {&#39;GridDay&#39;: np.int64(70),
            &#39;AgeClass&#39;: &#39;45-56&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(11.170803189139198)}, {&#39;GridDay&#39;: np.int64(70),
            &#39;AgeClass&#39;: &#39;57-68&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(12.182629113055267)}, {&#39;GridDay&#39;: np.int64(70),
            &#39;AgeClass&#39;: &#39;69-92&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(12.03602341594591)}, {&#39;GridDay&#39;: np.int64(70),
            &#39;AgeClass&#39;: &#39;93-104&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(9.89791499547454)}, {&#39;GridDay&#39;: np.int64(70),
            &#39;AgeClass&#39;: &#39;38-44&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(9.994134096010068)}, {&#39;GridDay&#39;: np.int64(70),
            &#39;AgeClass&#39;: &#39;33-37&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(7.279537766928177)}, {&#39;GridDay&#39;: np.int64(70),
            &#39;AgeClass&#39;: &#39;28-32&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(2.1157327109945014)}, {&#39;GridDay&#39;: np.int64(70),
            &#39;AgeClass&#39;: &#39;25-27&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(0.5956101301865704)}, {&#39;GridDay&#39;: np.int64(90),
            &#39;AgeClass&#39;: &#39;22-24&#39;, &#39;AdjMeanYield&#39;:
            np.float64(29.012321507944026)}, {&#39;GridDay&#39;: np.int64(90),
            &#39;AgeClass&#39;: &#39;105+&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(7.615962073692482)}, {&#39;GridDay&#39;: np.int64(90),
            &#39;AgeClass&#39;: &#39;45-56&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(9.830708658384733)}, {&#39;GridDay&#39;: np.int64(90),
            &#39;AgeClass&#39;: &#39;57-68&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(10.644794489811455)}, {&#39;GridDay&#39;: np.int64(90),
            &#39;AgeClass&#39;: &#39;69-92&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(10.690711843373052)}, {&#39;GridDay&#39;: np.int64(90),
            &#39;AgeClass&#39;: &#39;93-104&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(8.766034604004421)}, {&#39;GridDay&#39;: np.int64(90),
            &#39;AgeClass&#39;: &#39;38-44&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(8.996297216781104)}, {&#39;GridDay&#39;: np.int64(90),
            &#39;AgeClass&#39;: &#39;33-37&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(6.339109238738136)}, {&#39;GridDay&#39;: np.int64(90),
            &#39;AgeClass&#39;: &#39;28-32&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(2.2650070130578546)}, {&#39;GridDay&#39;: np.int64(90),
            &#39;AgeClass&#39;: &#39;25-27&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(0.683209706799785)}, {&#39;GridDay&#39;: np.int64(110),
            &#39;AgeClass&#39;: &#39;22-24&#39;, &#39;AdjMeanYield&#39;:
            np.float64(28.20728186314234)}, {&#39;GridDay&#39;: np.int64(110),
            &#39;AgeClass&#39;: &#39;105+&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(5.757167733283828)}, {&#39;GridDay&#39;: np.int64(110),
            &#39;AgeClass&#39;: &#39;45-56&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(8.593757825838535)}, {&#39;GridDay&#39;: np.int64(110),
            &#39;AgeClass&#39;: &#39;57-68&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(9.269189133914114)}, {&#39;GridDay&#39;: np.int64(110),
            &#39;AgeClass&#39;: &#39;69-92&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(9.285520479437961)}, {&#39;GridDay&#39;: np.int64(110),
            &#39;AgeClass&#39;: &#39;93-104&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(7.451750770863226)}, {&#39;GridDay&#39;: np.int64(110),
            &#39;AgeClass&#39;: &#39;38-44&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(8.103982254247937)}, {&#39;GridDay&#39;: np.int64(110),
            &#39;AgeClass&#39;: &#39;33-37&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(5.5981042769214815)}, {&#39;GridDay&#39;: np.int64(110),
            &#39;AgeClass&#39;: &#39;28-32&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(2.428688008677508)}, {&#39;GridDay&#39;: np.int64(110),
            &#39;AgeClass&#39;: &#39;25-27&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(0.7396297323725207)}, {&#39;GridDay&#39;: np.int64(130),
            &#39;AgeClass&#39;: &#39;22-24&#39;, &#39;AdjMeanYield&#39;:
            np.float64(27.43323330455429)}, {&#39;GridDay&#39;: np.int64(130),
            &#39;AgeClass&#39;: &#39;105+&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(3.8602059346425057)}, {&#39;GridDay&#39;: np.int64(130),
            &#39;AgeClass&#39;: &#39;45-56&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(7.510958496865013)}, {&#39;GridDay&#39;: np.int64(130),
            &#39;AgeClass&#39;: &#39;57-68&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(7.9374319633588835)}, {&#39;GridDay&#39;: np.int64(130),
            &#39;AgeClass&#39;: &#39;69-92&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(7.848683964388826)}, {&#39;GridDay&#39;: np.int64(130),
            &#39;AgeClass&#39;: &#39;93-104&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(6.302926580750917)}, {&#39;GridDay&#39;: np.int64(130),
            &#39;AgeClass&#39;: &#39;38-44&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(7.1224340607706145)}, {&#39;GridDay&#39;: np.int64(130),
            &#39;AgeClass&#39;: &#39;33-37&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(4.774932933046961)}, {&#39;GridDay&#39;: np.int64(130),
            &#39;AgeClass&#39;: &#39;28-32&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(2.054181845895034)}, {&#39;GridDay&#39;: np.int64(130),
            &#39;AgeClass&#39;: &#39;25-27&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(0.6390694722574911)}, {&#39;GridDay&#39;: np.int64(150),
            &#39;AgeClass&#39;: &#39;22-24&#39;, &#39;AdjMeanYield&#39;:
            np.float64(26.692475115423246)}, {&#39;GridDay&#39;: np.int64(150),
            &#39;AgeClass&#39;: &#39;105+&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(2.2949221013387557)}, {&#39;GridDay&#39;: np.int64(150),
            &#39;AgeClass&#39;: &#39;45-56&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(6.301359141670215)}, {&#39;GridDay&#39;: np.int64(150),
            &#39;AgeClass&#39;: &#39;57-68&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(6.662502759656485)}, {&#39;GridDay&#39;: np.int64(150),
            &#39;AgeClass&#39;: &#39;69-92&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(6.306820480642561)}, {&#39;GridDay&#39;: np.int64(150),
            &#39;AgeClass&#39;: &#39;93-104&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(5.363610788176305)}, {&#39;GridDay&#39;: np.int64(150),
            &#39;AgeClass&#39;: &#39;38-44&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(6.150509516609937)}, {&#39;GridDay&#39;: np.int64(150),
            &#39;AgeClass&#39;: &#39;33-37&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(3.963753814549384)}, {&#39;GridDay&#39;: np.int64(150),
            &#39;AgeClass&#39;: &#39;28-32&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(1.7254274784932273)}, {&#39;GridDay&#39;: np.int64(150),
            &#39;AgeClass&#39;: &#39;25-27&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(0.5649287326069747)}, {&#39;GridDay&#39;: np.int64(170),
            &#39;AgeClass&#39;: &#39;22-24&#39;, &#39;AdjMeanYield&#39;:
            np.float64(25.909927242045512)}, {&#39;GridDay&#39;: np.int64(170),
            &#39;AgeClass&#39;: &#39;105+&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(1.0427413412559121)}, {&#39;GridDay&#39;: np.int64(170),
            &#39;AgeClass&#39;: &#39;45-56&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(5.0913213821393795)}, {&#39;GridDay&#39;: np.int64(170),
            &#39;AgeClass&#39;: &#39;57-68&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(5.421776241404311)}, {&#39;GridDay&#39;: np.int64(170),
            &#39;AgeClass&#39;: &#39;69-92&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(4.841608825450599)}, {&#39;GridDay&#39;: np.int64(170),
            &#39;AgeClass&#39;: &#39;93-104&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(4.234885389947496)}, {&#39;GridDay&#39;: np.int64(170),
            &#39;AgeClass&#39;: &#39;38-44&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(5.324016784985845)}, {&#39;GridDay&#39;: np.int64(170),
            &#39;AgeClass&#39;: &#39;33-37&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(3.3822375573280348)}, {&#39;GridDay&#39;: np.int64(170),
            &#39;AgeClass&#39;: &#39;28-32&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(1.434032051406334)}, {&#39;GridDay&#39;: np.int64(170),
            &#39;AgeClass&#39;: &#39;25-27&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(0.5196782217572047)}, {&#39;GridDay&#39;: np.int64(190),
            &#39;AgeClass&#39;: &#39;22-24&#39;, &#39;AdjMeanYield&#39;:
            np.float64(25.18355933930522)}, {&#39;GridDay&#39;: np.int64(190),
            &#39;AgeClass&#39;: &#39;105+&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(-0.22661657547068376)}, {&#39;GridDay&#39;:
            np.int64(190), &#39;AgeClass&#39;: &#39;45-56&#39;,
            &#39;AdjMeanYieldDiff&#39;: np.float64(3.9899141989254825)},
            {&#39;GridDay&#39;: np.int64(190), &#39;AgeClass&#39;:
            &#39;57-68&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(4.288768161496195)}, {&#39;GridDay&#39;: np.int64(190),
            &#39;AgeClass&#39;: &#39;69-92&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(3.549396857815274)}, {&#39;GridDay&#39;: np.int64(190),
            &#39;AgeClass&#39;: &#39;93-104&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(3.0244141688064796)}, {&#39;GridDay&#39;: np.int64(190),
            &#39;AgeClass&#39;: &#39;38-44&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(4.580332138316236)}, {&#39;GridDay&#39;: np.int64(190),
            &#39;AgeClass&#39;: &#39;33-37&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(2.8081570429114167)}, {&#39;GridDay&#39;: np.int64(190),
            &#39;AgeClass&#39;: &#39;28-32&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(1.2973133245367794)}, {&#39;GridDay&#39;: np.int64(190),
            &#39;AgeClass&#39;: &#39;25-27&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(0.4560478732572198)}, {&#39;GridDay&#39;: np.int64(210),
            &#39;AgeClass&#39;: &#39;22-24&#39;, &#39;AdjMeanYield&#39;:
            np.float64(24.483510132759616)}, {&#39;GridDay&#39;: np.int64(210),
            &#39;AgeClass&#39;: &#39;105+&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(-1.6794415991382656)}, {&#39;GridDay&#39;: np.int64(210),
            &#39;AgeClass&#39;: &#39;45-56&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(2.967282790502585)}, {&#39;GridDay&#39;: np.int64(210),
            &#39;AgeClass&#39;: &#39;57-68&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(3.1465162231901647)}, {&#39;GridDay&#39;: np.int64(210),
            &#39;AgeClass&#39;: &#39;69-92&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(2.2712793222062255)}, {&#39;GridDay&#39;: np.int64(210),
            &#39;AgeClass&#39;: &#39;93-104&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(1.883934412576328)}, {&#39;GridDay&#39;: np.int64(210),
            &#39;AgeClass&#39;: &#39;38-44&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(3.856086738639926)}, {&#39;GridDay&#39;: np.int64(210),
            &#39;AgeClass&#39;: &#39;33-37&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(2.0924957434638523)}, {&#39;GridDay&#39;: np.int64(210),
            &#39;AgeClass&#39;: &#39;28-32&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(1.2853721199467447)}, {&#39;GridDay&#39;: np.int64(210),
            &#39;AgeClass&#39;: &#39;25-27&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(0.4301019942446108)}, {&#39;GridDay&#39;: np.int64(230),
            &#39;AgeClass&#39;: &#39;22-24&#39;, &#39;AdjMeanYield&#39;:
            np.float64(23.697751158769048)}, {&#39;GridDay&#39;: np.int64(230),
            &#39;AgeClass&#39;: &#39;105+&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(-3.05351348667635)}, {&#39;GridDay&#39;: np.int64(230),
            &#39;AgeClass&#39;: &#39;45-56&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(1.952682822025112)}, {&#39;GridDay&#39;: np.int64(230),
            &#39;AgeClass&#39;: &#39;57-68&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(1.9177805689534586)}, {&#39;GridDay&#39;: np.int64(230),
            &#39;AgeClass&#39;: &#39;69-92&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(1.0202931870088596)}, {&#39;GridDay&#39;: np.int64(230),
            &#39;AgeClass&#39;: &#39;93-104&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(0.894714415259876)}, {&#39;GridDay&#39;: np.int64(230),
            &#39;AgeClass&#39;: &#39;38-44&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(3.005623960409254)}, {&#39;GridDay&#39;: np.int64(230),
            &#39;AgeClass&#39;: &#39;33-37&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(1.3696562840013078)}, {&#39;GridDay&#39;: np.int64(230),
            &#39;AgeClass&#39;: &#39;28-32&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(1.3120381415083722)}, {&#39;GridDay&#39;: np.int64(230),
            &#39;AgeClass&#39;: &#39;25-27&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(0.41778262653698406)}, {&#39;GridDay&#39;: np.int64(250),
            &#39;AgeClass&#39;: &#39;22-24&#39;, &#39;AdjMeanYield&#39;:
            np.float64(22.83902979598037)}, {&#39;GridDay&#39;: np.int64(250),
            &#39;AgeClass&#39;: &#39;105+&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(-4.242013636450926)}, {&#39;GridDay&#39;: np.int64(250),
            &#39;AgeClass&#39;: &#39;45-56&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(0.9185783688457914)}, {&#39;GridDay&#39;: np.int64(250),
            &#39;AgeClass&#39;: &#39;57-68&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(0.6840558425949064)}, {&#39;GridDay&#39;: np.int64(250),
            &#39;AgeClass&#39;: &#39;69-92&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(-0.20209355322548445)}, {&#39;GridDay&#39;:
            np.int64(250), &#39;AgeClass&#39;: &#39;93-104&#39;,
            &#39;AdjMeanYieldDiff&#39;: np.float64(-0.06684991774755905)},
            {&#39;GridDay&#39;: np.int64(250), &#39;AgeClass&#39;:
            &#39;38-44&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(2.105316172384377)}, {&#39;GridDay&#39;: np.int64(250),
            &#39;AgeClass&#39;: &#39;33-37&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(0.5347018439530749)}, {&#39;GridDay&#39;: np.int64(250),
            &#39;AgeClass&#39;: &#39;28-32&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(1.2136140619229585)}, {&#39;GridDay&#39;: np.int64(250),
            &#39;AgeClass&#39;: &#39;25-27&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(0.40562341665750584)}, {&#39;GridDay&#39;: np.int64(270),
            &#39;AgeClass&#39;: &#39;22-24&#39;, &#39;AdjMeanYield&#39;:
            np.float64(21.87266773514703)}, {&#39;GridDay&#39;: np.int64(270),
            &#39;AgeClass&#39;: &#39;105+&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(-5.520663775233047)}, {&#39;GridDay&#39;: np.int64(270),
            &#39;AgeClass&#39;: &#39;45-56&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(-0.19544556456419815)}, {&#39;GridDay&#39;:
            np.int64(270), &#39;AgeClass&#39;: &#39;57-68&#39;,
            &#39;AdjMeanYieldDiff&#39;: np.float64(-0.5839341454243085)},
            {&#39;GridDay&#39;: np.int64(270), &#39;AgeClass&#39;:
            &#39;69-92&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(-1.3750401459927348)}, {&#39;GridDay&#39;: np.int64(270),
            &#39;AgeClass&#39;: &#39;93-104&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(-1.141576468874694)}, {&#39;GridDay&#39;: np.int64(270),
            &#39;AgeClass&#39;: &#39;38-44&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(1.2450276562317322)}, {&#39;GridDay&#39;: np.int64(270),
            &#39;AgeClass&#39;: &#39;33-37&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(-0.33337559312719545)}, {&#39;GridDay&#39;:
            np.int64(270), &#39;AgeClass&#39;: &#39;28-32&#39;,
            &#39;AdjMeanYieldDiff&#39;: np.float64(1.168361806050352)},
            {&#39;GridDay&#39;: np.int64(270), &#39;AgeClass&#39;:
            &#39;25-27&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(0.33531351837909873)}, {&#39;GridDay&#39;: np.int64(290),
            &#39;AgeClass&#39;: &#39;22-24&#39;, &#39;AdjMeanYield&#39;:
            np.float64(20.842115643344847)}, {&#39;GridDay&#39;: np.int64(290),
            &#39;AgeClass&#39;: &#39;105+&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(-6.801666071270943)}, {&#39;GridDay&#39;: np.int64(290),
            &#39;AgeClass&#39;: &#39;45-56&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(-1.3189712945941936)}, {&#39;GridDay&#39;: np.int64(290),
            &#39;AgeClass&#39;: &#39;57-68&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(-1.933774883057147)}, {&#39;GridDay&#39;: np.int64(290),
            &#39;AgeClass&#39;: &#39;69-92&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(-2.5099202711518833)}, {&#39;GridDay&#39;: np.int64(290),
            &#39;AgeClass&#39;: &#39;93-104&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(-2.3355740685066513)}, {&#39;GridDay&#39;: np.int64(290),
            &#39;AgeClass&#39;: &#39;38-44&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(0.3572900970232794)}, {&#39;GridDay&#39;: np.int64(290),
            &#39;AgeClass&#39;: &#39;33-37&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(-1.216846013150442)}, {&#39;GridDay&#39;: np.int64(290),
            &#39;AgeClass&#39;: &#39;28-32&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(1.137792921510659)}, {&#39;GridDay&#39;: np.int64(290),
            &#39;AgeClass&#39;: &#39;25-27&#39;, &#39;AdjMeanYieldDiff&#39;:
            np.float64(0.3149763229282438)}]</span
          >
        </div>
        <a class="headerlink" href="#results"></a>
      </section>
      <section id="df_adj">
        <div class="attr variable">
          <span class="name">df_adj</span> =
          <input
            id="df_adj-view-value"
            class="view-value-toggle-state"
            type="checkbox"
            aria-hidden="true"
            tabindex="-1"
          />
          <label
            class="view-value-button pdoc-button"
            for="df_adj-view-value"
          ></label
          ><span class="default_value">
            GridDay AgeClass AdjMeanYield AdjMeanYieldDiff 1 10 105+ NaN
            11.384254 0 10 22-24 25.631057 NaN 9 10 25-27 NaN 0.592698 8 10
            28-32 NaN 2.388179 7 10 33-37 NaN 9.845251 .. ... ... ... ... 146
            290 38-44 NaN 0.357290 142 290 45-56 NaN -1.318971 143 290 57-68 NaN
            -1.933775 144 290 69-92 NaN -2.509920 145 290 93-104 NaN -2.335574
            [150 rows x 4 columns]</span
          >
        </div>
        <a class="headerlink" href="#df_adj"></a>
      </section>
      <section id="lc_model">
        <input
          id="lc_model-view-source"
          class="view-source-toggle-state"
          type="checkbox"
          aria-hidden="true"
          tabindex="-1"
        />
        <div class="attr function">
          <span class="def">def</span>
          <span class="name">lc_model</span
          ><span class="signature pdoc-code condensed"
            >(<span class="param"><span class="n">x</span>, </span
            ><span class="param"><span class="n">a</span>, </span
            ><span class="param"><span class="n">b</span>, </span
            ><span class="param"><span class="n">c</span>, </span
            ><span class="param"><span class="n">d</span></span
            ><span class="return-annotation">):</span></span
          >

          <label class="view-source-button" for="lc_model-view-source"
            ><span>View Source</span></label
          >
        </div>
        <a class="headerlink" href="#lc_model"></a>
        <div class="pdoc-code codehilite">
          <pre><span></span><span id="lc_model-203"><a href="#lc_model-203"><span class="linenos">203</span></a><span class="k">def</span><span class="w"> </span><span class="nf">lc_model</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
</span><span id="lc_model-204"><a href="#lc_model-204"><span class="linenos">204</span></a>    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span>
</span></pre>
        </div>
      </section>
      <section id="age_class_one">
        <div class="attr variable">
          <span class="name">age_class_one</span> =
          <input
            id="age_class_one-view-value"
            class="view-value-toggle-state"
            type="checkbox"
            aria-hidden="true"
            tabindex="-1"
          />
          <label
            class="view-value-button pdoc-button"
            for="age_class_one-view-value"
          ></label
          ><span class="default_value">
            GridDay AgeClass AdjMeanYield AdjMeanYieldDiff 0 10 22-24 25.631057
            NaN 10 30 22-24 27.781911 NaN 20 50 22-24 29.393461 NaN 30 70 22-24
            29.552815 NaN 40 90 22-24 29.012322 NaN 50 110 22-24 28.207282 NaN
            60 130 22-24 27.433233 NaN 70 150 22-24 26.692475 NaN 80 170 22-24
            25.909927 NaN 90 190 22-24 25.183559 NaN 100 210 22-24 24.483510 NaN
            110 230 22-24 23.697751 NaN 120 250 22-24 22.839030 NaN 130 270
            22-24 21.872668 NaN 140 290 22-24 20.842116 NaN</span
          >
        </div>
        <a class="headerlink" href="#age_class_one"></a>
      </section>
      <section id="x">
        <div class="attr variable">
          <span class="name">x</span> =
          <span class="default_value"
            >array([ 10, 30, 50, 70, 90, 110, 130, 150, 170, 190, 210, 230, 250,
            270, 290])</span
          >
        </div>
        <a class="headerlink" href="#x"></a>
      </section>
      <section id="y">
        <div class="attr variable">
          <span class="name">y</span> =
          <input
            id="y-view-value"
            class="view-value-toggle-state"
            type="checkbox"
            aria-hidden="true"
            tabindex="-1"
          />
          <label
            class="view-value-button pdoc-button"
            for="y-view-value"
          ></label
          ><span class="default_value"
            >array([25.63105725, 27.78191136, 29.39346066, 29.55281518,
            29.01232151, 28.20728186, 27.4332333 , 26.69247512, 25.90992724,
            25.18355934, 24.48351013, 23.69775116, 22.8390298 , 21.87266774,
            20.84211564])</span
          >
        </div>
        <a class="headerlink" href="#y"></a>
      </section>
      <section id="y_fit">
        <div class="attr variable">
          <span class="name">y_fit</span> =
          <input
            id="y_fit-view-value"
            class="view-value-toggle-state"
            type="checkbox"
            aria-hidden="true"
            tabindex="-1"
          />
          <label
            class="view-value-button pdoc-button"
            for="y_fit-view-value"
          ></label
          ><span class="default_value"
            >array([25.41686796, 28.47934315, 29.25626198, 29.17006026,
            28.74402288, 28.1706556 , 27.52077732, 26.82044087, 26.07923053,
            25.30067219, 24.48606292, 23.63587991, 22.7502987 , 21.82938387,
            20.87315916])</span
          >
        </div>
        <a class="headerlink" href="#y_fit"></a>
      </section>
      <section id="dif_model">
        <input
          id="dif_model-view-source"
          class="view-source-toggle-state"
          type="checkbox"
          aria-hidden="true"
          tabindex="-1"
        />
        <div class="attr function">
          <span class="def">def</span>
          <span class="name">dif_model</span
          ><span class="signature pdoc-code condensed"
            >(<span class="param"><span class="n">x</span>, </span
            ><span class="param"><span class="n">a</span>, </span
            ><span class="param"><span class="n">b</span>, </span
            ><span class="param"><span class="n">c</span></span
            ><span class="return-annotation">):</span></span
          >

          <label class="view-source-button" for="dif_model-view-source"
            ><span>View Source</span></label
          >
        </div>
        <a class="headerlink" href="#dif_model"></a>
        <div class="pdoc-code codehilite">
          <pre><span></span><span id="dif_model-239"><a href="#dif_model-239"><span class="linenos">239</span></a><span class="k">def</span><span class="w"> </span><span class="nf">dif_model</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
</span><span id="dif_model-240"><a href="#dif_model-240"><span class="linenos">240</span></a>    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
</span></pre>
        </div>
      </section>
      <section id="age_class_not_one">
        <div class="attr variable">
          <span class="name">age_class_not_one</span> =
          <input
            id="age_class_not_one-view-value"
            class="view-value-toggle-state"
            type="checkbox"
            aria-hidden="true"
            tabindex="-1"
          />
          <label
            class="view-value-button pdoc-button"
            for="age_class_not_one-view-value"
          ></label
          ><span class="default_value">
            GridDay AgeClass AdjMeanYield AdjMeanYieldDiff 1 10 105+ NaN
            11.384254 9 10 25-27 NaN 0.592698 8 10 28-32 NaN 2.388179 7 10 33-37
            NaN 9.845251 6 10 38-44 NaN 12.275593 .. ... ... ... ... 146 290
            38-44 NaN 0.357290 142 290 45-56 NaN -1.318971 143 290 57-68 NaN
            -1.933775 144 290 69-92 NaN -2.509920 145 290 93-104 NaN -2.335574
            [135 rows x 4 columns]</span
          >
        </div>
        <a class="headerlink" href="#age_class_not_one"></a>
      </section>
      <section id="a_t">
        <div class="attr variable">
          <span class="name">a_t</span> =
          <input
            id="a_t-view-value"
            class="view-value-toggle-state"
            type="checkbox"
            aria-hidden="true"
            tabindex="-1"
          />
          <label
            class="view-value-button pdoc-button"
            for="a_t-view-value"
          ></label
          ><span class="default_value"
            >{&#39;105+&#39;: np.float64(13.843155865025556), &#39;25-27&#39;:
            np.float64(0.7761099135899937), &#39;28-32&#39;:
            np.float64(2.6248619134010784), &#39;33-37&#39;:
            np.float64(9.921534101735357), &#39;38-44&#39;:
            np.float64(13.117795058471836), &#39;45-56&#39;:
            np.float64(15.012984229301013), &#39;57-68&#39;:
            np.float64(16.516900841800062), &#39;69-92&#39;:
            np.float64(16.634357244191545), &#39;93-104&#39;:
            np.float64(13.900449859880698)}</span
          >
        </div>
        <a class="headerlink" href="#a_t"></a>
      </section>
      <section id="b_t">
        <div class="attr variable">
          <span class="name">b_t</span> =
          <input
            id="b_t-view-value"
            class="view-value-toggle-state"
            type="checkbox"
            aria-hidden="true"
            tabindex="-1"
          />
          <label
            class="view-value-button pdoc-button"
            for="b_t-view-value"
          ></label
          ><span class="default_value"
            >{&#39;105+&#39;: np.float64(-0.07288580391609739), &#39;25-27&#39;:
            np.float64(-0.001532388394054113), &#39;28-32&#39;:
            np.float64(-0.005652160567578695), &#39;33-37&#39;:
            np.float64(-0.0379971105425077), &#39;38-44&#39;:
            np.float64(-0.04441663369982123), &#39;45-56&#39;:
            np.float64(-0.05689986150905444), &#39;57-68&#39;:
            np.float64(-0.06386878789985252), &#39;69-92&#39;:
            np.float64(-0.06738709057248315), &#39;93-104&#39;:
            np.float64(-0.05643448201602657)}</span
          >
        </div>
        <a class="headerlink" href="#b_t"></a>
      </section>
      <section id="c_t">
        <div class="attr variable">
          <span class="name">c_t</span> =
          <input
            id="c_t-view-value"
            class="view-value-toggle-state"
            type="checkbox"
            aria-hidden="true"
            tabindex="-1"
          />
          <label
            class="view-value-button pdoc-button"
            for="c_t-view-value"
          ></label
          ><span class="default_value"
            >{&#39;105+&#39;: np.float64(-2.743270382109658), &#39;25-27&#39;:
            np.float64(-0.36038979156057643), &#39;28-32&#39;:
            np.float64(-0.38136480059853806), &#39;33-37&#39;:
            np.float64(0.7024328687239476), &#39;38-44&#39;:
            np.float64(-0.36500963995522223), &#39;45-56&#39;:
            np.float64(-1.804027165809339), &#39;57-68&#39;:
            np.float64(-3.0818357488324826), &#39;69-92&#39;:
            np.float64(-3.9853222293678536), &#39;93-104&#39;:
            np.float64(-2.0443753045966906)}</span
          >
        </div>
        <a class="headerlink" href="#c_t"></a>
      </section>
      <section id="age_classes_parity_one_two">
        <div class="attr variable">
          <span class="name">age_classes_parity_one_two</span> =
          <span class="default_value"
            >[&#39;25-27&#39;, &#39;28-32&#39;, &#39;33-37&#39;,
            &#39;38-44&#39;]</span
          >
        </div>
        <a class="headerlink" href="#age_classes_parity_one_two"></a>
      </section>
      <section id="model_param_t_low_par">
        <input
          id="model_param_t_low_par-view-source"
          class="view-source-toggle-state"
          type="checkbox"
          aria-hidden="true"
          tabindex="-1"
        />
        <div class="attr function">
          <span class="def">def</span>
          <span class="name">model_param_t_low_par</span
          ><span class="signature pdoc-code condensed"
            >(<span class="param"><span class="n">t</span>, </span
            ><span class="param"><span class="n">p</span>, </span
            ><span class="param"><span class="n">q</span></span
            ><span class="return-annotation">):</span></span
          >

          <label
            class="view-source-button"
            for="model_param_t_low_par-view-source"
            ><span>View Source</span></label
          >
        </div>
        <a class="headerlink" href="#model_param_t_low_par"></a>
        <div class="pdoc-code codehilite">
          <pre><span></span><span id="model_param_t_low_par-274"><a href="#model_param_t_low_par-274"><span class="linenos">274</span></a><span class="k">def</span><span class="w"> </span><span class="nf">model_param_t_low_par</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
</span><span id="model_param_t_low_par-275"><a href="#model_param_t_low_par-275"><span class="linenos">275</span></a>    <span class="k">return</span> <span class="n">p</span> <span class="o">+</span> <span class="n">q</span> <span class="o">*</span> <span class="n">t</span>
</span></pre>
        </div>
      </section>
      <section id="subset_dict">
        <input
          id="subset_dict-view-source"
          class="view-source-toggle-state"
          type="checkbox"
          aria-hidden="true"
          tabindex="-1"
        />
        <div class="attr function">
          <span class="def">def</span>
          <span class="name">subset_dict</span
          ><span class="signature pdoc-code condensed"
            >(<span class="param"><span class="n">d</span>, </span
            ><span class="param"><span class="n">keys_to_include</span></span
            ><span class="return-annotation">):</span></span
          >

          <label class="view-source-button" for="subset_dict-view-source"
            ><span>View Source</span></label
          >
        </div>
        <a class="headerlink" href="#subset_dict"></a>
        <div class="pdoc-code codehilite">
          <pre><span></span><span id="subset_dict-279"><a href="#subset_dict-279"><span class="linenos">279</span></a><span class="k">def</span><span class="w"> </span><span class="nf">subset_dict</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">keys_to_include</span><span class="p">):</span>
</span><span id="subset_dict-280"><a href="#subset_dict-280"><span class="linenos">280</span></a>    <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys_to_include</span><span class="p">}</span>
</span></pre>
        </div>
      </section>
      <section id="a_par_one_two">
        <div class="attr variable">
          <span class="name">a_par_one_two</span> =
          <input
            id="a_par_one_two-view-value"
            class="view-value-toggle-state"
            type="checkbox"
            aria-hidden="true"
            tabindex="-1"
          />
          <label
            class="view-value-button pdoc-button"
            for="a_par_one_two-view-value"
          ></label
          ><span class="default_value"
            >[np.float64(0.7761099135899937), np.float64(2.6248619134010784),
            np.float64(9.921534101735357), np.float64(13.117795058471836)]</span
          >
        </div>
        <a class="headerlink" href="#a_par_one_two"></a>
      </section>
      <section id="b_par_one_two">
        <div class="attr variable">
          <span class="name">b_par_one_two</span> =
          <input
            id="b_par_one_two-view-value"
            class="view-value-toggle-state"
            type="checkbox"
            aria-hidden="true"
            tabindex="-1"
          />
          <label
            class="view-value-button pdoc-button"
            for="b_par_one_two-view-value"
          ></label
          ><span class="default_value"
            >[np.float64(-0.001532388394054113),
            np.float64(-0.005652160567578695), np.float64(-0.0379971105425077),
            np.float64(-0.04441663369982123)]</span
          >
        </div>
        <a class="headerlink" href="#b_par_one_two"></a>
      </section>
      <section id="c_par_one_two">
        <div class="attr variable">
          <span class="name">c_par_one_two</span> =
          <input
            id="c_par_one_two-view-value"
            class="view-value-toggle-state"
            type="checkbox"
            aria-hidden="true"
            tabindex="-1"
          />
          <label
            class="view-value-button pdoc-button"
            for="c_par_one_two-view-value"
          ></label
          ><span class="default_value"
            >[np.float64(-0.36038979156057643),
            np.float64(-0.38136480059853806), np.float64(0.7024328687239476),
            np.float64(-0.36500963995522223)]</span
          >
        </div>
        <a class="headerlink" href="#c_par_one_two"></a>
      </section>
      <section id="averages">
        <div class="attr variable">
          <span class="name">averages</span> =
          <span class="default_value">[50.5, 62.5, 80.5, 98.5, 105]</span>
        </div>
        <a class="headerlink" href="#averages"></a>
      </section>
      <section id="age_classes_parity_three">
        <div class="attr variable">
          <span class="name">age_classes_parity_three</span> =
          <span class="default_value"
            >[&#39;45-56&#39;, &#39;57-68&#39;, &#39;69-92&#39;,
            &#39;93-104&#39;, &#39;105+&#39;]</span
          >
        </div>
        <a class="headerlink" href="#age_classes_parity_three"></a>
      </section>
      <section id="model_param_t_high_par">
        <input
          id="model_param_t_high_par-view-source"
          class="view-source-toggle-state"
          type="checkbox"
          aria-hidden="true"
          tabindex="-1"
        />
        <div class="attr function">
          <span class="def">def</span>
          <span class="name">model_param_t_high_par</span
          ><span class="signature pdoc-code condensed"
            >(<span class="param"><span class="n">t</span>, </span
            ><span class="param"><span class="n">p</span>, </span
            ><span class="param"><span class="n">q</span>, </span
            ><span class="param"><span class="n">r</span></span
            ><span class="return-annotation">):</span></span
          >

          <label
            class="view-source-button"
            for="model_param_t_high_par-view-source"
            ><span>View Source</span></label
          >
        </div>
        <a class="headerlink" href="#model_param_t_high_par"></a>
        <div class="pdoc-code codehilite">
          <pre><span></span><span id="model_param_t_high_par-317"><a href="#model_param_t_high_par-317"><span class="linenos">317</span></a><span class="k">def</span><span class="w"> </span><span class="nf">model_param_t_high_par</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
</span><span id="model_param_t_high_par-318"><a href="#model_param_t_high_par-318"><span class="linenos">318</span></a>    <span class="k">return</span> <span class="n">p</span> <span class="o">+</span> <span class="n">q</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span></pre>
        </div>
      </section>
      <section id="a_par_three">
        <div class="attr variable">
          <span class="name">a_par_three</span> =
          <input
            id="a_par_three-view-value"
            class="view-value-toggle-state"
            type="checkbox"
            aria-hidden="true"
            tabindex="-1"
          />
          <label
            class="view-value-button pdoc-button"
            for="a_par_three-view-value"
          ></label
          ><span class="default_value"
            >[np.float64(15.012984229301013), np.float64(16.516900841800062),
            np.float64(16.634357244191545), np.float64(13.900449859880698),
            np.float64(13.843155865025556)]</span
          >
        </div>
        <a class="headerlink" href="#a_par_three"></a>
      </section>
      <section id="b_par_three">
        <div class="attr variable">
          <span class="name">b_par_three</span> =
          <input
            id="b_par_three-view-value"
            class="view-value-toggle-state"
            type="checkbox"
            aria-hidden="true"
            tabindex="-1"
          />
          <label
            class="view-value-button pdoc-button"
            for="b_par_three-view-value"
          ></label
          ><span class="default_value"
            >[np.float64(-0.05689986150905444),
            np.float64(-0.06386878789985252), np.float64(-0.06738709057248315),
            np.float64(-0.05643448201602657),
            np.float64(-0.07288580391609739)]</span
          >
        </div>
        <a class="headerlink" href="#b_par_three"></a>
      </section>
      <section id="c_par_three">
        <div class="attr variable">
          <span class="name">c_par_three</span> =
          <input
            id="c_par_three-view-value"
            class="view-value-toggle-state"
            type="checkbox"
            aria-hidden="true"
            tabindex="-1"
          />
          <label
            class="view-value-button pdoc-button"
            for="c_par_three-view-value"
          ></label
          ><span class="default_value"
            >[np.float64(-1.804027165809339), np.float64(-3.0818357488324826),
            np.float64(-3.9853222293678536), np.float64(-2.0443753045966906),
            np.float64(-2.743270382109658)]</span
          >
        </div>
        <a class="headerlink" href="#c_par_three"></a>
      </section>
      <section id="correction_factor_age">
        <input
          id="correction_factor_age-view-source"
          class="view-source-toggle-state"
          type="checkbox"
          aria-hidden="true"
          tabindex="-1"
        />
        <div class="attr function">
          <span class="def">def</span>
          <span class="name">correction_factor_age</span
          ><span class="signature pdoc-code condensed"
            >(<span class="param"><span class="n">x</span>, </span
            ><span class="param"><span class="n">base</span>, </span
            ><span class="param"><span class="n">t</span></span
            ><span class="return-annotation">):</span></span
          >

          <label
            class="view-source-button"
            for="correction_factor_age-view-source"
            ><span>View Source</span></label
          >
        </div>
        <a class="headerlink" href="#correction_factor_age"></a>
        <div class="pdoc-code codehilite">
          <pre><span></span><span id="correction_factor_age-357"><a href="#correction_factor_age-357"><span class="linenos">357</span></a><span class="k">def</span><span class="w"> </span><span class="nf">correction_factor_age</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
</span><span id="correction_factor_age-358"><a href="#correction_factor_age-358"><span class="linenos">358</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply selfmade multiplicative correction to a milkyield at days in milk (t), based on a correction.</span>
</span><span id="correction_factor_age-359"><a href="#correction_factor_age-359"><span class="linenos">359</span></a>
</span><span id="correction_factor_age-360"><a href="#correction_factor_age-360"><span class="linenos">360</span></a><span class="sd">    input:</span>
</span><span id="correction_factor_age-361"><a href="#correction_factor_age-361"><span class="linenos">361</span></a><span class="sd">    x (int)= x the age of the animal at calving that was measured in months</span>
</span><span id="correction_factor_age-362"><a href="#correction_factor_age-362"><span class="linenos">362</span></a><span class="sd">    base (int): age at calving in month of referenc animal &gt; lactation you want to correct to</span>
</span><span id="correction_factor_age-363"><a href="#correction_factor_age-363"><span class="linenos">363</span></a><span class="sd">    t (int) = days in milk of milk measurement</span>
</span><span id="correction_factor_age-364"><a href="#correction_factor_age-364"><span class="linenos">364</span></a>
</span><span id="correction_factor_age-365"><a href="#correction_factor_age-365"><span class="linenos">365</span></a><span class="sd">    output (numpy float): multiplicative correction factor &quot;&quot;&quot;</span>
</span><span id="correction_factor_age-366"><a href="#correction_factor_age-366"><span class="linenos">366</span></a>
</span><span id="correction_factor_age-367"><a href="#correction_factor_age-367"><span class="linenos">367</span></a>    <span class="n">level_x</span> <span class="o">=</span> <span class="n">lc_model</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a_fit</span><span class="p">,</span> <span class="n">b_fit</span><span class="p">,</span> <span class="n">c_fit</span><span class="p">,</span> <span class="n">d_fit</span><span class="p">)</span>
</span><span id="correction_factor_age-368"><a href="#correction_factor_age-368"><span class="linenos">368</span></a>
</span><span id="correction_factor_age-369"><a href="#correction_factor_age-369"><span class="linenos">369</span></a>    <span class="c1"># calculate the base (two versions depending on the parity of the base)</span>
</span><span id="correction_factor_age-370"><a href="#correction_factor_age-370"><span class="linenos">370</span></a>    <span class="k">if</span> <span class="n">base</span> <span class="o">&lt;</span> <span class="mi">45</span><span class="p">:</span>
</span><span id="correction_factor_age-371"><a href="#correction_factor_age-371"><span class="linenos">371</span></a>        <span class="n">a_base</span> <span class="o">=</span> <span class="n">model_param_t_low_par</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">p_a_low</span><span class="p">,</span> <span class="n">q_a_low</span><span class="p">)</span>
</span><span id="correction_factor_age-372"><a href="#correction_factor_age-372"><span class="linenos">372</span></a>        <span class="n">b_base</span> <span class="o">=</span> <span class="n">model_param_t_low_par</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">p_b_low</span><span class="p">,</span> <span class="n">q_b_low</span><span class="p">)</span>
</span><span id="correction_factor_age-373"><a href="#correction_factor_age-373"><span class="linenos">373</span></a>        <span class="n">c_base</span> <span class="o">=</span> <span class="n">model_param_t_low_par</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">p_a_low</span><span class="p">,</span> <span class="n">q_a_low</span><span class="p">)</span>
</span><span id="correction_factor_age-374"><a href="#correction_factor_age-374"><span class="linenos">374</span></a>
</span><span id="correction_factor_age-375"><a href="#correction_factor_age-375"><span class="linenos">375</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="correction_factor_age-376"><a href="#correction_factor_age-376"><span class="linenos">376</span></a>        <span class="n">a_base</span> <span class="o">=</span> <span class="n">model_param_t_high_par</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">p_a_high</span><span class="p">,</span> <span class="n">q_a_high</span><span class="p">,</span> <span class="n">r_a_high</span><span class="p">)</span>
</span><span id="correction_factor_age-377"><a href="#correction_factor_age-377"><span class="linenos">377</span></a>        <span class="n">b_base</span> <span class="o">=</span> <span class="n">model_param_t_high_par</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">p_b_high</span><span class="p">,</span> <span class="n">q_b_high</span><span class="p">,</span> <span class="n">r_b_high</span><span class="p">)</span>
</span><span id="correction_factor_age-378"><a href="#correction_factor_age-378"><span class="linenos">378</span></a>        <span class="n">c_base</span> <span class="o">=</span> <span class="n">model_param_t_high_par</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">p_c_high</span><span class="p">,</span> <span class="n">q_c_high</span><span class="p">,</span> <span class="n">r_c_high</span><span class="p">)</span>
</span><span id="correction_factor_age-379"><a href="#correction_factor_age-379"><span class="linenos">379</span></a>
</span><span id="correction_factor_age-380"><a href="#correction_factor_age-380"><span class="linenos">380</span></a>    <span class="n">base</span> <span class="o">=</span> <span class="n">level_x</span> <span class="o">+</span> <span class="n">a_base</span> <span class="o">+</span> <span class="n">b_base</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">c_base</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
</span><span id="correction_factor_age-381"><a href="#correction_factor_age-381"><span class="linenos">381</span></a>
</span><span id="correction_factor_age-382"><a href="#correction_factor_age-382"><span class="linenos">382</span></a>    <span class="c1"># filter for parity</span>
</span><span id="correction_factor_age-383"><a href="#correction_factor_age-383"><span class="linenos">383</span></a>    <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">45</span><span class="p">:</span>
</span><span id="correction_factor_age-384"><a href="#correction_factor_age-384"><span class="linenos">384</span></a>        <span class="n">a_t</span> <span class="o">=</span> <span class="n">model_param_t_low_par</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">p_a_low</span><span class="p">,</span> <span class="n">q_a_low</span><span class="p">)</span>
</span><span id="correction_factor_age-385"><a href="#correction_factor_age-385"><span class="linenos">385</span></a>        <span class="n">b_t</span> <span class="o">=</span> <span class="n">model_param_t_low_par</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">p_b_low</span><span class="p">,</span> <span class="n">q_b_low</span><span class="p">)</span>
</span><span id="correction_factor_age-386"><a href="#correction_factor_age-386"><span class="linenos">386</span></a>        <span class="n">c_t</span> <span class="o">=</span> <span class="n">model_param_t_low_par</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">p_a_low</span><span class="p">,</span> <span class="n">q_a_low</span><span class="p">)</span>
</span><span id="correction_factor_age-387"><a href="#correction_factor_age-387"><span class="linenos">387</span></a>
</span><span id="correction_factor_age-388"><a href="#correction_factor_age-388"><span class="linenos">388</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="correction_factor_age-389"><a href="#correction_factor_age-389"><span class="linenos">389</span></a>        <span class="n">a_t</span> <span class="o">=</span> <span class="n">model_param_t_high_par</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">p_a_high</span><span class="p">,</span> <span class="n">q_a_high</span><span class="p">,</span> <span class="n">r_a_high</span><span class="p">)</span>
</span><span id="correction_factor_age-390"><a href="#correction_factor_age-390"><span class="linenos">390</span></a>        <span class="n">b_t</span> <span class="o">=</span> <span class="n">model_param_t_high_par</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">p_b_high</span><span class="p">,</span> <span class="n">q_b_high</span><span class="p">,</span> <span class="n">r_b_high</span><span class="p">)</span>
</span><span id="correction_factor_age-391"><a href="#correction_factor_age-391"><span class="linenos">391</span></a>        <span class="n">c_t</span> <span class="o">=</span> <span class="n">model_param_t_high_par</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">p_c_high</span><span class="p">,</span> <span class="n">q_c_high</span><span class="p">,</span> <span class="n">r_c_high</span><span class="p">)</span>
</span><span id="correction_factor_age-392"><a href="#correction_factor_age-392"><span class="linenos">392</span></a>
</span><span id="correction_factor_age-393"><a href="#correction_factor_age-393"><span class="linenos">393</span></a>    <span class="n">numerator</span> <span class="o">=</span> <span class="n">level_x</span> <span class="o">+</span> <span class="n">a_t</span> <span class="o">+</span> <span class="n">b_t</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">c_t</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
</span><span id="correction_factor_age-394"><a href="#correction_factor_age-394"><span class="linenos">394</span></a>
</span><span id="correction_factor_age-395"><a href="#correction_factor_age-395"><span class="linenos">395</span></a>    <span class="n">correction_factor</span> <span class="o">=</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">base</span>
</span><span id="correction_factor_age-396"><a href="#correction_factor_age-396"><span class="linenos">396</span></a>    <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">correction_factor</span>  <span class="c1"># this does not follow the original but otherwise the results do not make sense so apply correction factor as 1/correction factor</span>
</span></pre>
        </div>

        <div class="docstring">
          <p>
            Apply selfmade multiplicative correction to a milkyield at days in
            milk (t), based on a correction.
          </p>

          <p>
            input: x (int)= x the age of the animal at calving that was measured
            in months base (int): age at calving in month of referenc animal
            &gt; lactation you want to correct to t (int) = days in milk of milk
            measurement
          </p>

          <p>output (numpy float): multiplicative correction factor</p>
        </div>
      </section>
      <section id="season_dict">
        <div class="attr variable">
          <span class="name">season_dict</span> =
          <input
            id="season_dict-view-value"
            class="view-value-toggle-state"
            type="checkbox"
            aria-hidden="true"
            tabindex="-1"
          />
          <label
            class="view-value-button pdoc-button"
            for="season_dict-view-value"
          ></label
          ><span class="default_value"
            >{&#39;Aug-Sep&#39;: -1.48639529134209, &#39;Dec-Jan&#39;:
            0.7374057334145495, &#39;Feb-Mar&#39;: 0.28552867477443217,
            &#39;Jun-Jul&#39;: -1.700071281552897, &#39;Oct-Nov&#39;:
            0.41332716300321504}</span
          >
        </div>
        <a class="headerlink" href="#season_dict"></a>
      </section>
      <section id="season_midpoints">
        <div class="attr variable">
          <span class="name">season_midpoints</span> =
          <span class="default_value"
            >{&#39;Dec-Jan&#39;: 1.0, &#39;Feb-Mar&#39;: 2.5, &#39;Jun-Jul&#39;:
            6.5, &#39;Aug-Sep&#39;: 8.5, &#39;Oct-Nov&#39;: 10.5}</span
          >
        </div>
        <a class="headerlink" href="#season_midpoints"></a>
      </section>
      <section id="season_df">
        <div class="attr variable">
          <span class="name">season_df</span> =
          <input
            id="season_df-view-value"
            class="view-value-toggle-state"
            type="checkbox"
            aria-hidden="true"
            tabindex="-1"
          />
          <label
            class="view-value-button pdoc-button"
            for="season_df-view-value"
          ></label
          ><span class="default_value">
            month coef 1 1.0 0.737406 2 2.5 0.285529 3 6.5 -1.700071 0 8.5
            -1.486395 4 10.5 0.413327</span
          >
        </div>
        <a class="headerlink" href="#season_df"></a>
      </section>
      <section id="months_ext">
        <div class="attr variable">
          <span class="name">months_ext</span> =
          <span class="default_value"
            >array([ 1. , 2.5, 6.5, 8.5, 10.5, 13. ])</span
          >
        </div>
        <a class="headerlink" href="#months_ext"></a>
      </section>
      <section id="coef_ext">
        <div class="attr variable">
          <span class="name">coef_ext</span> =
          <span class="default_value"
            >array([ 0.73740573, 0.28552867, -1.70007128, -1.48639529,
            0.41332716, 0.73740573])</span
          >
        </div>
        <a class="headerlink" href="#coef_ext"></a>
      </section>
      <section id="spl">
        <div class="attr variable">
          <span class="name">spl</span> =
          <span class="default_value"
            >&lt;scipy.interpolate._fitpack2.UnivariateSpline object&gt;</span
          >
        </div>
        <a class="headerlink" href="#spl"></a>
      </section>
      <section id="months_full">
        <div class="attr variable">
          <span class="name">months_full</span> =
          <span class="default_value"
            >array([ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12])</span
          >
        </div>
        <a class="headerlink" href="#months_full"></a>
      </section>
      <section id="correction_factors">
        <div class="attr variable">
          <span class="name">correction_factors</span> =
          <input
            id="correction_factors-view-value"
            class="view-value-toggle-state"
            type="checkbox"
            aria-hidden="true"
            tabindex="-1"
          />
          <label
            class="view-value-button pdoc-button"
            for="correction_factors-view-value"
          ></label
          ><span class="default_value"
            >array([ 0.93332993, 0.25286965, -0.35949391, -0.87400028,
            -1.26088901, -1.49039962, -1.53277167, -1.35824468, -0.94108979,
            -0.34830512, 0.26038429, 0.72122177])</span
          >
        </div>
        <a class="headerlink" href="#correction_factors"></a>
      </section>
      <section id="correction_df">
        <div class="attr variable">
          <span class="name">correction_df</span> =
          <input
            id="correction_df-view-value"
            class="view-value-toggle-state"
            type="checkbox"
            aria-hidden="true"
            tabindex="-1"
          />
          <label
            class="view-value-button pdoc-button"
            for="correction_df-view-value"
          ></label
          ><span class="default_value">
            Month CorrectionFactor 0 1 0.933330 1 2 0.252870 2 3 -0.359494 3 4
            -0.874000 4 5 -1.260889 5 6 -1.490400 6 7 -1.532772 7 8 -1.358245 8
            9 -0.941090 9 10 -0.348305 10 11 0.260384 11 12 0.721222</span
          >
        </div>
        <a class="headerlink" href="#correction_df"></a>
      </section>
    </main>
    <script>
      function escapeHTML(html) {
        return document
          .createElement("div")
          .appendChild(document.createTextNode(html)).parentNode.innerHTML;
      }

      const originalContent = document.querySelector("main.pdoc");
      let currentContent = originalContent;

      function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
          elem = document.createElement("main");
          elem.classList.add("pdoc");
          elem.innerHTML = innerHTML;
        } else {
          elem = originalContent;
        }
        if (currentContent !== elem) {
          currentContent.replaceWith(elem);
          currentContent = elem;
        }
      }

      function getSearchTerm() {
        return new URL(window.location).searchParams.get("search");
      }

      const searchBox = document.querySelector(".pdoc input[type=search]");
      searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
          url.hash = "";
          url.searchParams.set("search", searchBox.value);
        } else {
          url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
      });
      window.addEventListener("popstate", onInput);

      let search, searchErr;

      async function initialize() {
        try {
          search = await new Promise((resolve, reject) => {
            const script = document.createElement("script");
            script.type = "text/javascript";
            script.async = true;
            script.onload = () => resolve(window.pdocSearch);
            script.onerror = (e) => reject(e);
            script.src = "../search.js";
            document.getElementsByTagName("head")[0].appendChild(script);
          });
        } catch (e) {
          console.error("Cannot fetch pdoc search index");
          searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", (e) => {
          if (e.target.hash) {
            searchBox.value = "";
            searchBox.dispatchEvent(new Event("input"));
          }
        });
      }

      function onInput() {
        setContent(
          (() => {
            const term = getSearchTerm();
            if (!term) {
              return null;
            }
            if (searchErr) {
              return `<h3>Error: ${searchErr}</h3>`;
            }
            if (!search) {
              return "<h3>Searching...</h3>";
            }

            window.scrollTo({ top: 0, left: 0, behavior: "auto" });

            const results = search(term);

            let html;
            if (results.length === 0) {
              html = `No search results for '${escapeHTML(term)}'.`;
            } else {
              html = `<h4>${results.length} search result${
                results.length > 1 ? "s" : ""
              } for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
              let doc = result.doc;
              let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
              if (doc.qualname) {
                url += `#${doc.qualname}`;
              }

              let heading;
              switch (result.doc.kind) {
                case "function":
                  if (doc.fullname.endsWith(".__init__")) {
                    heading = `<span class="name">${doc.fullname.replace(
                      /\.__init__$/,
                      ""
                    )}</span>${doc.signature}`;
                  } else {
                    heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                  }
                  break;
                case "class":
                  heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                  if (doc.bases)
                    heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                  heading += `:`;
                  break;
                case "variable":
                  heading = `<span class="name">${doc.fullname}</span>`;
                  if (doc.annotation)
                    heading += `<span class="annotation">${doc.annotation}</span>`;
                  if (doc.default_value)
                    heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                  break;
                default:
                  heading = `<span class="name">${doc.fullname}</span>`;
                  break;
              }
              html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;
            }
            return html;
          })()
        );
      }

      if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
      } else {
        searchBox.addEventListener("focus", initialize, { once: true });
      }

      searchBox.addEventListener("keydown", (e) => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
          let focused = currentContent.querySelector(".search-result.focused");
          if (!focused) {
            currentContent
              .querySelector(".search-result")
              .classList.add("focused");
          } else if (
            e.key === "ArrowDown" &&
            focused.nextElementSibling &&
            focused.nextElementSibling.classList.contains("search-result")
          ) {
            focused.classList.remove("focused");
            focused.nextElementSibling.classList.add("focused");
            focused.nextElementSibling.scrollIntoView({
              behavior: "smooth",
              block: "nearest",
              inline: "nearest",
            });
          } else if (
            e.key === "ArrowUp" &&
            focused.previousElementSibling &&
            focused.previousElementSibling.classList.contains("search-result")
          ) {
            focused.classList.remove("focused");
            focused.previousElementSibling.classList.add("focused");
            focused.previousElementSibling.scrollIntoView({
              behavior: "smooth",
              block: "nearest",
              inline: "nearest",
            });
          } else if (e.key === "Enter") {
            focused.querySelector("a").click();
          }
        }
      });
    </script>
  </body>
</html>
